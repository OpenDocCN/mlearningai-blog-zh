<html>
<head>
<title>Web Scraping in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的网页抓取</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/web-scraping-in-r-dcd1e95ae8fd?source=collection_archive---------1-----------------------#2022-08-28">https://medium.com/mlearning-ai/web-scraping-in-r-dcd1e95ae8fd?source=collection_archive---------1-----------------------#2022-08-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7b76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我们将关注R中的web抓取，我们将演练什么是Web抓取，在R中使用什么库，什么是CSS选择器，以及一个逐步的例子。希望你觉得有用，我感谢任何反馈。另外，请在下面的GitHub或Gitlab库中找到这些项目。</p><p id="b194" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">gitlab:<a class="ae jc" href="https://gitlab.com/rshowrav/webscraping-in-r" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/rshowrav/webscraping-in-r</a></p><p id="ff9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">GitHub:【https://github.com/rshowrav/webscraping-in-r T2】</p><h1 id="5b39" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">什么是网页抓取？</h1><p id="37ba" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">网络抓取最简单的定义是从网站中提取内容和数据的行为。网站是使用超文本标记语言(HTML)代码构建的，网页抓取代码或网页抓取器可以从该代码下载对象。r是一个强大的工具，让我们使用代码来抓取网站。</p><h1 id="e008" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">什么是CSS选择器？</h1><p id="d1b9" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">当使用HTML构建网站时，它们与定义了规则的属性值一起存储。在Web抓取的意义上，通过识别CSS选择器，我们可以更简单地获得HTML代码的特定部分。SelectorGadget是为给定站点识别CSS选择器的一个很好的工具。SelectorGadget确实要求你使用谷歌Chrome作为浏览器。注意，在示例项目中也使用了这个工具来识别所需的CSS选择器。要了解有关该工具的更多信息，请参阅以下链接中的文档:</p><div class="kg kh ez fb ki kj"><a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hi fi z dy ko ea eb kp ed ef hg bi translated">选择orGadget</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">简单，强大的CSS选择器生成。</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">chrome.google.com</p></div></div><div class="ks l"><div class="kt l ku kv kw ks kx ky kj"/></div></div></a></div><h1 id="64a4" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">这个例子</h1><p id="b65f" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在本文中，我们将浏览一家笔记本电脑商店，并从网站上获取所需的基本信息。这个例子中使用商店是MicroCenter。将收集的详细信息包括笔记本电脑信息、SKU号码、产品价格和预计发货时间。我们将在r中执行必要的提取。</p><h1 id="627c" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步骤1:安装必要的软件包</h1><p id="610c" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">使用下面的代码，我们下载必要的包来执行网络抓取。每个包装的详细信息如下:</p><ul class=""><li id="cdf3" class="kz la hh ig b ih ii il im ip lb it lc ix ld jb le lf lg lh bi translated">Rvest-是R中用于网页抓取的首要包，特别是对于有多个页面的网站。</li><li id="3ce2" class="kz la hh ig b ih li il lj ip lk it ll ix lm jb le lf lg lh bi translated">tidy verse——是一个R包，它是主要用于数据科学的包的集合。具体来说，对于这个例子，将使用的来自Tidyverse的包是Dplyer，它允许管道函数(即if then函数)。</li><li id="fd94" class="kz la hh ig b ih li il lj ip lk it ll ix lm jb le lf lg lh bi translated">data . table——是一个R包，允许我们以列和行的形式存储数据。</li></ul><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="6d84" class="lw je hh ls b fi lx ly l lz ma">install.packages("rvest")<br/>install.packages("tidyverse")<br/>install.packages("data.table")</span></pre><h1 id="9990" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步骤2:加载包</h1><p id="a110" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在安装完软件包之后，必须将它们加载到R中，以便用于我们的代码。这可以使用下面的代码来完成。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="ad1c" class="lw je hh ls b fi lx ly l lz ma">library(rvest)<br/>library(tidyverse)<br/>library(data.table)</span></pre><h1 id="560e" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第三步:了解网站</h1><p id="9cb5" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">接下来就是了解网站了。正在使用的示例包含以下内容。</p><figure class="ln lo lp lq fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mb"><img src="../Images/5bc69983d18afdc8839f5aafeb1c1e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OqxY6uWB1LMYNtdGH2QLrA.png"/></div></div></figure><p id="a2db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的截图向我们展示了我们想要获取的功能，包括笔记本电脑信息、SKU号码、价格和发货时间等细节。另外，请注意，总共有154台可用的笔记本电脑(即我们预期的记录数量)。此外，请注意，这些笔记本电脑在多个网页上。</p><h1 id="2246" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步骤4:了解统一资源定位器(URL)</h1><p id="0249" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">理解如何与URL交互是网络抓取的关键。正如我们在下面看到的，如果我们转到网站的第2页，我们会看到下面的URL。</p><figure class="ln lo lp lq fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mi"><img src="../Images/3183ea751afea6d52ea9097770cedda1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrZhaMpy2m3X2GgsmBGjLA.png"/></div></div></figure><p id="edda" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重复这个过程，转到第1页，得到下面的网址。</p><figure class="ln lo lp lq fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/b25f6add8b2d919e7c467f3428cf01e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cyylMvhl5SgnM1jgle_bw.png"/></div></div></figure><p id="6adf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，在URL中，转到URL中的第2页，我们看到page=2，转到第1页，URL变为page=1。此外，URL中的所有其他字段保持不变。</p><h1 id="ac46" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步骤5:创建一个空数据表</h1><p id="5443" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">要填充和追加R中的数据表，我们必须使用data.table包创建一个空的数据表。这可以使用下面的代码来完成。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="1e41" class="lw je hh ls b fi lx ly l lz ma">laptops = data.table()</span></pre><h1 id="5665" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第六步:网页抓取</h1><p id="ea2c" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">下面R中的最后一个代码是数据的实际抓取和复杂化，我们将解释它的每个元素。第一部分是一个for循环，它创建了一个pgn元素，这个元素从1到7(注意:这是因为网站有7个页面。下一部分是创建一个链接，这是分为3个部分的网址，中间部分填充后页=正如我们在研究时确定的网址。因此，将使用Rvest语句read_html读取每个页面。接下来，为了收集每个感兴趣的特性，我们使用管道函数(Dplyer包):它的第一个方面读取页面，下一个方面(html_nodes)定位CSS选择器(注意:使用SelectorGadget)，最后一个方面以文本形式返回结果。此循环的最后一部分将把一页中的记录添加到列和行中的选择要素的数据表中，然后在循环中运行另一页时追加。循环运行，直到它通过所有7页。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="00f5" class="lw je hh ls b fi lx ly l lz ma">for(pgn in seq(from=1, to=7, by =1 )){    </span><span id="7bf2" class="lw je hh ls b fi mk ly l lz ma">link = paste0("https://www.microcenter.com/search/search_results.aspx?       N=4294967288&amp;NTK=all&amp;page=",pgn,"&amp;cat=Laptops/Notebooks-:-MicroCenter")  <br/>page = read_html(link)    <br/>  <br/>info = page%&gt;% html_nodes(".normal a")%&gt;% html_text()  <br/>sku = page%&gt;% html_nodes(".sku")%&gt;% html_text()  <br/>price = page%&gt;% html_nodes(".price &gt; span")%&gt;% html_text()                  ship_time= page%&gt;% html_nodes(".availabilityTrunc")%&gt;% html_text()       </span><span id="aaa1" class="lw je hh ls b fi mk ly l lz ma">laptops = rbind(laptops, data.table(info, sku, price, ship_time, stringsAsFactors = FALSE))}</span></pre><h1 id="1a91" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">最终输出</h1><p id="1bdd" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">最终输出将是下面的内容，其中包含我们感兴趣的特征和现在在数据表中的154条记录。</p><figure class="ln lo lp lq fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ml"><img src="../Images/1d8f4d8839393dc1cf315eae1d54b832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0vgyk9U9qw7nvMkAZfLQA.png"/></div></div></figure><div class="kg kh ez fb ki kj"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hi fi z dy ko ea eb kp ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">medium.com</p></div></div><div class="ks l"><div class="mm l ku kv kw ks kx ky kj"/></div></div></a></div></div></div>    
</body>
</html>