<html>
<head>
<title>How to Deploy a Machine Learning Model to the Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将机器学习模型部署到云中</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-deploy-a-machine-learning-model-to-the-cloud-1c9ca637897c?source=collection_archive---------0-----------------------#2022-10-20">https://medium.com/mlearning-ai/how-to-deploy-a-machine-learning-model-to-the-cloud-1c9ca637897c?source=collection_archive---------0-----------------------#2022-10-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="55c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用FastAPI、Docker和AWS EC2部署ML模型，使其可用于最终用户\生产环境。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/79974db1cf9e042c26ab0e3f59e98ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IKXmk6m66px1eRMH"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@ilumire?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jelleke Vanooteghem</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3840" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过大量的研究和数小时的编码，你开发了一个ML模型！太好了，但是工作并没有就此结束。仍然有必要询问如何使用这个模型，这是部署阶段的切入点。</p><p id="f341" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当你不需要立即的结果时，比如在一个周期性的工作中，最好的部署解决方案可能是<strong class="ig hi">批量预测</strong>。这可以通过简单地调用predict函数或使用类似Airflow的调度工具来完成。</p><p id="bd42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，在许多情况下，我们需要一个<strong class="ig hi">按需</strong>服务<strong class="ig hi"> </strong>和<strong class="ig hi">接近实时的预测</strong>。例如，我们可以提到推荐系统、欺诈检测、搜索工具、医疗诊断等。在本文中，我们将介绍如何创建一个用于预测的web服务来解决这类问题。</p><p id="332b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此，我们将经历三个步骤:</p><ul class=""><li id="de13" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">用FastAPI web框架创建一个REST API。</li><li id="abec" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">构建Docker映像，通过容器运行服务器。</li><li id="a254" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">在AWS EC2实例中托管Docker容器。</li></ul><h1 id="8976" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">模型</h1><p id="29d2" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">这篇文章的目的不是教你如何建立一个ML模型。因此，我们将使用已经开发的XGBoost模型，该模型能够预测产品的运输成本。</p><p id="5473" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可能会发现看一看这个模型是如何构建的很有趣，因为在它的开发过程中，我接触了一系列重要的主题，例如:数据处理、特征工程、度量定义、超参数调整、模型选择、模型评估等等。您可以在下面的资源库中找到所有步骤(以及本文中使用的源代码)。</p><div class="lk ll ez fb lm ln"><a href="https://github.com/FelipeMezzarana/shipping_price_estimate" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hi fi z dy ls ea eb lt ed ef hg bi translated">GitHub-feli pemezzarana/shipping _ price _ estimate:ML模型来估计一个…</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">基于一个电子商务数据集+部署FastAPI、Docker和…的ML模型来估计订单的运输价格</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb jm ln"/></div></div></a></div><p id="f7ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，如果您只对部署感兴趣，那么您真正需要知道的是，在构建您的模型之后，您需要将它转储到一个文件中，这可以通过pickle包轻松完成:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure></div><div class="ab cl me mf go mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ha hb hc hd he"><h1 id="0cb9" class="kh ki hh bd kj kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le bi translated">第一步:创建REST API</h1><p id="1cbe" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">现在我们有了一个模型，在云中部署它的第一步是创建REST API。在这一点上，许多人选择使用Flask framework，主要是因为它是一个较老的工具，人们只是习惯了它。</p><p id="ad4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，尽管FastAPI是一个年轻的框架，但它比Flask有许多优势，例如更高的性能、<strong class="ig hi">本地并发支持、内置数据验证和自动文档系统</strong>。由于这些原因，我更喜欢FastAPI而不是Flask。</p><p id="a6e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，创建一个. py文件，我的文件将被命名为“server.py”。然后，我们可以创建FastAPI对象并加载之前保存的模型。请确保所有内容都保存在同一个路径中。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><blockquote class="mq mr ms"><p id="0ec9" class="ie if mt ig b ih ii ij ik il im in io mu iq ir is mv iu iv iw mw iy iz ja jb ha bi translated">提示:在这个例子中，模型将在每次请求后被加载，您可能希望定义一个函数来将模型作为全局变量只加载一次。这是一种权衡，你获得了速度，但需要分配更多的内存。</p></blockquote><p id="91cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如前所述，FastAPI支持内置数据验证，因此我们需要定义哪种数据将作为预测的输入，以及哪些数据将被输出。为此，我们将使用BaseModel为所有输入变量定义一个类，并为输出变量定义另一个类。这比听起来容易:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="3bc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，“价格”、“产品_重量_克”、“产品_高度_厘米”、“交货_距离_公里”和“产品_体积_立方厘米”都是预测运输价格所需的输入。</p><p id="7421" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们只需要定义我们的<strong class="ig hi"> API端点！</strong>在我们的例子中，我们将只有两个端点，一个在主页面中检查服务器是否工作，另一个进行预测。方法是这样的:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="bd29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里发生了一些重要的事情。</p><ul class=""><li id="437a" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">在定义端点时，您需要说明它将使用“get”还是“post”方法。对于预测，我们需要用户输入，所以使用“post”方法很重要。</li><li id="fc73" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">我们需要定义输入和输出数据类型，如图所示。默认值是string，这就是为什么我们不需要在home_page()中声明输出</li><li id="0eaf" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">我们使用“异步定义”来定义函数，这使得我们的函数能够并行运行</li></ul><p id="6ba4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最终的server.py文件应该如下所示:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="ab61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以使用uvicorn在本地测试服务器。安装软件包后，只需运行命令行:</p><p id="7e5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du mx my mz na b">uvicorn server:app --host 0.0.0.0 --port 80</code></p><p id="1034" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您应该会看到类似这样的内容:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nb"><img src="../Images/622d0dafbd7f8ce6c4a8303fefd1ee24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPxLbz1vsaXySTGss7SJrQ.png"/></div></div></figure><p id="108b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们可以直接向'<a class="ae js" href="http://localhost:80'" rel="noopener ugc nofollow" target="_blank"> http://localhost:80' </a>发出请求，因此可以在jupyter笔记本中执行如下测试:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nc"><img src="../Images/7f77472ed521e17b23b1f24c275ccef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z13HtqVX7NyFvTHlNAhWyg.png"/></div></div></figure></div><div class="ab cl me mf go mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ha hb hc hd he"><h1 id="74e1" class="kh ki hh bd kj kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le bi translated">第二步:建立一个Docker形象</h1><p id="bdd4" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">Docker来解决程序员人生中最老的问题！</p><p id="3ca4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mt">“但它在我的机器上能用…”</em></p><p id="42c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了Docker，就有可能创建一个“位置”(容器)，里面有你的应用程序运行所需的一切，就像你开发它的方式一样，因此可以保证<strong class="ig hi">应用程序可以在任何机器上运行！</strong></p><p id="5003" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在云中部署ML模型也很方便，我们可以将模型工作所需的一切放在docker映像中，在本地测试它，如果一切正常，就将映像上传到云中！</p><p id="ff24" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要做到这一点，第一步是创建一个Python虚拟环境(这不完全是一个强制步骤，但它使我们的生活变得容易得多)。在本指南中，我不会介绍如何创建一个虚拟环境，互联网上有数百个教程供你使用。</p><p id="0973" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">准备好虚拟环境后，确保只安装应用程序运行所需的库。现在，我们将生成一个包含这个virtaul env的所有依赖项的文件。这个文件在创建我们的Docker图像时会非常有用。</p><p id="6c0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在命令行上，激活您刚刚创建的虚拟env。您可以使用第一个命令检查env路径，并使用第二个命令激活它:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="a8e7" class="nh ki hh na b fi ni nj l nk nl">conda info --env<br/>conda activate  your_env_path</span></pre><p id="39d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，要生成该文件，只需输入:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="bc93" class="nh ki hh na b fi ni nj l nk nl">cd path_for_your_file<br/>pip list --format=freeze &gt; requirements.txt</span></pre><p id="a3e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个命令将在您定义的路径中创建一个requirements.txt文件。该文件应该如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nm"><img src="../Images/122be2d9c928ffe37c21aa11e974b440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*vi3qyx6228dhWJbCITgAMw.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">requirements.txt example</figcaption></figure><p id="9b2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经准备好创建docker文件了！<strong class="ig hi">docker file只是一个包含构建指令的文本文件。</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nn"><img src="../Images/1ec8979d9992191b9b4f60d9117552da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qn9_9SyTDhF-2NXM.png"/></div></div></figure><p id="feae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Dockerfile文件没有扩展名。如果您在windows上使用docker，使用<a class="ae js" href="https://notepad-plus-plus.org/downloads/v8.4.6/" rel="noopener ugc nofollow" target="_blank">记事本++ </a>编写指令，保存时选择“所有类型”并将文件名保存为“Dockerfile”。用Linux的话，用“vim Dockerfile”就可以了。</p><p id="44d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的docker文件必须包含以下命令:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="195e" class="nh ki hh na b fi ni nj l nk nl"><em class="mt"># FROM defines the "starting point" of your image</em><br/>FROM python:3.9.13 </span><span id="580e" class="nh ki hh na b fi no nj l nk nl"><em class="mt"># We need to copy all the files that will be used in our container <br/># Note, /deploy/ is a created folder, it could have any name</em><br/>COPY ./requirements.txt /deploy/<br/>COPY ./server.py /deploy/<br/>COPY ./shipping_estimate_model.pkl /deploy/ </span><span id="3643" class="nh ki hh na b fi no nj l nk nl"><em class="mt"># Define where instructions perform their tasks</em><br/>WORKDIR /deploy/ </span><span id="df01" class="nh ki hh na b fi no nj l nk nl"><em class="mt"># Remember the file created earlier? <br/># Here we install all the libs listed in it</em><br/>RUN pip install -r requirements.txt</span><span id="105b" class="nh ki hh na b fi no nj l nk nl"><em class="mt"># execute the command only when we create the container</em><br/>CMD ["uvicorn","server:app","--host", "0.0.0.0", "--port", "80"]</span></pre><p id="6803" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们有了建立码头工人形象所需的一切！确保将文件“shipping_estimate_model.pkl”、“requirements.txt”、“server.py”和“Dockerfile”放在同一个目录中。然后，为了最终创建我们的docker映像(我的映像将被命名为“app-shipping”)，在命令行中输入:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="60e8" class="nh ki hh na b fi ni nj l nk nl">cd files_path<br/>docker image build -t app-shipping .</span></pre><blockquote class="mq mr ms"><p id="6daf" class="ie if mt ig b ih ii ij ik il im in io mu iq ir is mv iu iv iw mw iy iz ja jb ha bi translated">提示:最后一个参数。，指示dockerfile文件的路径。我们使用点号来表示我们已经在正确的目录中(通过cd命令访问)</p></blockquote><p id="a02f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将执行Docker文件中定义的所有命令，创建名为“app-shipping”的Docker映像！现在我们只需要运行映像来创建容器并启动本地服务器。在命令行上输入:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="aacd" class="nh ki hh na b fi ni nj l nk nl">docker run -p 80:80 app-shipping</span></pre><p id="6886" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您应该会看到以下输出:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es np"><img src="../Images/44232d515ed4690bdbdc083ae7b5fb05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tme-srwpxDOTaJ8IwsWQPA.png"/></div></div></figure><p id="c0da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它的外观和工作方式就像本指南第一步中创建的本地服务器一样。为了进行确认，您可以从jupyter笔记本或网页再次向'<a class="ae js" href="http://localhost:80'" rel="noopener ugc nofollow" target="_blank"> http://localhost:80' </a>发出请求(仅get方法)</p><p id="9733" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">唯一的(也是非常重要的)区别是，现在<strong class="ig hi">应用程序完全独立于您的机器运行，</strong>这在我们指南的第三和最后一步将非常有用。</p></div><div class="ab cl me mf go mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ha hb hc hd he"><h1 id="3bd0" class="kh ki hh bd kj kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le bi translated">3步:在AWS EC2实例中托管Docker容器</h1><p id="76a9" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">我们终于做好了向世界其他地方发布我们的模型的一切准备！</p><p id="8e44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，您需要创建一个AWS帐户。这个过程非常简单，但是你需要输入一个有效的信用卡。不过不要担心，在第一年，您将可以访问AWS免费层，它允许您免费访问许多AWS服务，包括完成本指南所需的一切。</p><p id="3d21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在您已经有了一个AWS帐户，<strong class="ig hi">我们将创建一个在AWS云上运行的虚拟机。</strong>在搜索栏中，输入“ec2 ”,进入“Dashboard”。在新页面上，单击“启动实例”</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nq"><img src="../Images/e19c9f81252620bdfe525d2e39ea1405.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*2Qal4M3BVirywgqCN_l3DA.jpeg"/></div></figure><p id="144a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您需要选择虚拟机系统和规格。我们将使用一个<strong class="ig hi">亚马逊Linux </strong>系统，你可以选择任何带有“自由层资格”印章的虚拟机。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nr"><img src="../Images/3c7c6d1e15b7272e8c51b1b10802744b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*KY7hZVho327J5qkR11n2Cw.jpeg"/></div></figure><p id="198e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要访问虚拟机，<strong class="ig hi">你需要一把钥匙</strong>。这个密钥是一个文件，无论何时您想要访问VM，您都需要将密钥文件路径作为一个参数来传递。您可以选择不使用密钥继续，但不要选择此选项！毕竟，没有密钥任何人都可以访问你的虚拟机，这似乎不是一个好主意，不是吗？</p><p id="5c74" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，如果您没有密钥，您将需要生成一个。这里没有秘密，只需点击<em class="mt">“创建新的密钥对”</em>为密钥选择一个名称，点击<em class="mt">“创建密钥对”</em>就会下载一个文件<em class="mt">“choosed _ name . PEM”</em>。把它放在安全的地方。</p><p id="a0aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一个必要的配置在“<em class="mt">网络设置”</em>选项卡中。检查所有选项非常重要，因为这将允许我们的API连接到互联网。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ns"><img src="../Images/f7317a558b070b81ec089d419ec49104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xx01rLny1nkqXGi1Cm1HPQ.jpeg"/></div></div></figure><blockquote class="mq mr ms"><p id="e83f" class="ie if mt ig b ih ii ij ik il im in io mu iq ir is mv iu iv iw mw iy iz ja jb ha bi translated">提示:有了这个配置，任何ip都可以向您的API发出请求。在生产环境中，限制这种访问可能很有意思，可以在这个阶段完成。</p></blockquote><p id="9ad0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经解决了一切！点击start an instance，在显示实例已创建的消息后，转到“<em class="mt"> instance选项卡”。您应该能够看到您的实例正在运行。趁机复制虚拟机IP。</em></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nt"><img src="../Images/8907bfcad2897d0d418acfead3178adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*igDfJwmetq_nmaiF0iIMOA.jpeg"/></div></figure><p id="94d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是时候使用<a class="ae js" href="https://www.ssh.com/academy/ssh/protocol" rel="noopener ugc nofollow" target="_blank"> SSH协议</a>连接到我们刚刚创建的虚拟机了，在命令行上输入:</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="26a0" class="nh ki hh na b fi ni nj l nk nl">ssh -i pem_file_path ec2-user@virtual_machine_ip</span></pre><p id="a249" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果一切按预期进行，您现在已经连接到您的Amazon Linux虚拟机了！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nu"><img src="../Images/2fe307d10bb15458a6e34c70be1a30fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*Zmvot5wo8CT2B-SNkmaBZA.png"/></div></figure><p id="184d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虚拟机是空的，因此我们将开始安装docker，启动它，授予用户使用Docker的权限，最后退出虚拟机(接下来的步骤将从您的机器上执行)。</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="ca1b" class="nh ki hh na b fi ni nj l nk nl"># Installing Docker on VM<br/>sudo amazon-linux-extras install docker</span><span id="ed22" class="nh ki hh na b fi no nj l nk nl"># Starting Docker<br/>sudo service docker start</span><span id="4822" class="nh ki hh na b fi no nj l nk nl"># Giving permission to the default user<br/>sudo usermod -a -G docker ec2-user</span><span id="bbba" class="nh ki hh na b fi no nj l nk nl"># Returning to local machine<br/>exit</span></pre><p id="cbe1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将使用<a class="ae js" href="https://www.ibm.com/docs/en/flashsystem-v7000u/1.6.2?topic=system-using-scp" rel="noopener ugc nofollow" target="_blank"> SCP协议</a>将所需文件复制到虚拟机。</p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="47df" class="nh ki hh na b fi ni nj l nk nl"># Copying 4 files to /home/ec2-user (linux default directory)<br/>scp -i pem_file_path ^<br/>path\dockerfile ^<br/>path\requirements.txt ^<br/>path\server.py ^<br/>path\shipping_estimate_model.pkl ^<br/>ec2user@ip_maquinavirtual:/home/ec2-user</span></pre><p id="166b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">全部抄袭！是时候重新连接虚拟机了，最后<strong class="ig hi">构建我们的Docker映像</strong>和<strong class="ig hi">运行容器，</strong>输入<strong class="ig hi"> : </strong></p><pre class="jd je jf jg fd nd na ne nf aw ng bi"><span id="e0be" class="nh ki hh na b fi ni nj l nk nl"># Connect to VM<br/>ssh -i pem_file_path ec2-user@virtual_machine_ip</span><span id="f556" class="nh ki hh na b fi no nj l nk nl"># Build Docker image<br/>docker image build -t app-shipping .</span><span id="9562" class="nh ki hh na b fi no nj l nk nl"># Run container<br/>docker run -p 80:80 app-shipping </span></pre><h2 id="9af2" class="nh ki hh bd kj nv nw nx kn ny nz oa kr ip ob oc kv it od oe kz ix of og ld oh bi translated">祝贺你，你成功地创建了一个web服务！！</h2><p id="0d2d" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">现在全世界都可以使用您的API来发出请求。要获取API地址，请返回AWS网站上的实例面板，搜索<strong class="ig hi"> Public IPv4 DNS。</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es oi"><img src="../Images/23e28d32e6a395712a4140fd4a8cad30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyFYpuWsSM4UGnvUIpRTFQ.png"/></div></div></figure><p id="205a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就是这样，现在你可以从任何地方向这个地址发出请求了！出于测试目的，让我们使用jupyter笔记本</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mc md l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es oj"><img src="../Images/7b6c301c504916e6a9c68fb187391a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBQvJkGy0fMQefrOBI0GmA.png"/></div></div></figure><p id="8108" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以直接在网页上进行测试(仅限“get”方法)。例如，您可能想看看由FastAPI自动生成的令人惊叹的文档</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ok"><img src="../Images/b5c4936c69b57af8bdd83b539b600891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zzMKWpTMrLqVkBjDc5_y_w.png"/></div></div></figure><h2 id="aff8" class="nh ki hh bd kj nv nw nx kn ny nz oa kr ip ob oc kv it od oe kz ix of og ld oh bi translated">重要！</h2><p id="7648" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">既然您已经测试了您的API，并确保一切正常运行，不要忘记终止实例，<strong class="ig hi">否则可能会收费。</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ol"><img src="../Images/be64c7590a5c52e5d775b113004690fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8u8XkMnRC5KRXrQUaI2Bg.jpeg"/></div></div></figure></div><div class="ab cl me mf go mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ha hb hc hd he"><h1 id="99c9" class="kh ki hh bd kj kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le bi translated">从这里去哪里？</h1><p id="1f73" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">重要的是，本指南是一个基本示例。部署是一个复杂的主题，还有比我在这里介绍的更多的内容。</p><p id="e764" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想继续学习，这里有一些你可能想看看的话题:</p><ul class=""><li id="7231" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">如何随着时间的推移控制指标；</li><li id="c416" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">如何让模型保持最新(概念漂移，模型再训练)；</li><li id="7b12" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">如何随着时间的推移存储结果；</li><li id="0077" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">如何提高部署的安全性？</li></ul></div><div class="ab cl me mf go mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ha hb hc hd he"><p id="ab34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">非常感谢你走到这一步！我希望我已经说清楚了，但是如果有任何问题或反馈，请随时联系我！！</p><div class="lk ll ez fb lm ln"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hi fi z dy ls ea eb lt ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">medium.com</p></div></div><div class="lw l"><div class="om l ly lz ma lw mb jm ln"/></div></div></a></div></div></div>    
</body>
</html>