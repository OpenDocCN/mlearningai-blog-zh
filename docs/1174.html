<html>
<head>
<title>Cryptocurrency Markets using APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用API的加密货币市场</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/cryptocurrency-markets-using-apis-d8edf7b0c59a?source=collection_archive---------7-----------------------#2021-10-17">https://medium.com/mlearning-ai/cryptocurrency-markets-using-apis-d8edf7b0c59a?source=collection_archive---------7-----------------------#2021-10-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/cfc44fac785d346bc6594820664167ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yn0Xc3MdX2q_Bobl"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@executium?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Executium</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9610" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">隔离不仅让大多数人成为了厨师，也让我们大多数人成为了投资大师。我们都记得，当两大交易平台向客户提供加密货币后，比特币价格飙升，世界上第一种加密货币——比特币已经上涨了<strong class="iw hi">640%</strong>,以至于我80岁的爷爷都在提到它。毫无疑问，加密货币在疫情期间蓬勃发展，并在所有年龄组中普及。</p><h1 id="be94" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">使用BeautifulSoup进行网页抓取</h1><p id="719e" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">说到网页抓取，我向像我这样的初学者推荐<a class="ae it" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank"> BeautifulSoup </a>库。正如它的名字所暗示的，它允许你漂亮地从HTML和XML文件中删除数据，这是帮助我理解网页的所有组成部分和网页删除基础的教程。</p><div class="kv kw ez fb kx ky"><a href="https://www.dataquest.io/blog/web-scraping-python-using-beautiful-soup/" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hi fi z dy ld ea eb le ed ef hg bi translated">教程:使用漂亮的汤用Python进行网页抓取</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">互联网绝对是一个巨大的数据来源——我们可以使用网络抓取和Python来访问这些数据！事实上…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">www.dataquest.iogen</p></div></div><div class="lh l"><div class="li l lj lk ll lh lm in ky"/></div></div></a></div><h2 id="4a48" class="ln jt hh bd ju lo lp lq jy lr ls lt kc jf lu lv kg jj lw lx kk jn ly lz ko ma bi translated"><strong class="ak">报废卷筒纸的一般步骤</strong></h2><ol class=""><li id="12e6" class="mb mc hh iw b ix kq jb kr jf md jj me jn mf jr mg mh mi mj bi translated">从URL中检查真正感兴趣的内容</li><li id="a1ab" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">从API检索数据的请求标头</li><li id="1319" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">通过soup找到您想要的数据</li><li id="a7a0" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">如果需要重复提取数据，请使用“for循环”</li></ol><p id="343f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是我在抓取网页时最常用的方法；它给出了非常结构化的数据。现在让我们来看看加密货币数据是如何工作的。</p></div><div class="ab cl mp mq go mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ha hb hc hd he"><p id="d153" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">目标:从</strong><a class="ae it" href="https://coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank"><strong class="iw hi">coinmarketcap</strong></a><strong class="iw hi">中抓取每枚硬币的历史数据，我们对每枚硬币的日期、市值、成交量、开盘价、最高价、最低价、收盘价感兴趣。</strong></p><p id="3261" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该项目包含两个部分:</p><ul class=""><li id="4a36" class="mb mc hh iw b ix iy jb jc jf mw jj mx jn my jr mz mh mi mj bi translated">第1部分:获取所有硬币的名称</li><li id="bcfc" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mz mh mi mj bi translated">第2部分:通过API V3废弃历史数据</li></ul><h1 id="b1ea" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">硬币名称和符号</h1><p id="92a8" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">一旦你打开<a class="ae it" href="https://coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank"> coinmarketcap </a>，你可以看到一个包含所有当前硬币名称的表格。共有56页数据，共5501枚硬币。(该项目于2021年夏季完成)</p><figure class="nb nc nd ne fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/2391b72e7be18cebc7adf55feb817b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HN-yuu5MflBmw9GITD_ASg.png"/></div></div></figure><pre class="nb nc nd ne fd nf ng nh ni aw nj bi"><span id="1ad3" class="ln jt hh ng b fi nk nl l nm nn">for i in range(1,57):<br/>    url= 'https://coinmarketcap.com/?page='+str(i)<br/>    response  = requests.get(url, headers=headers).text<br/>    soup = BeautifulSoup(response)</span><span id="701c" class="ln jt hh ng b fi no nl l nm nn">   # soup.prettify()</span><span id="a52c" class="ln jt hh ng b fi no nl l nm nn">    data = soup.find('script',id="__NEXT_DATA__").get_text()<br/>    jsdata = json.loads(data)<br/>    list_data = jsdata['props']['initialState']['cryptocurrency']['listingLatest']['data']</span><span id="9954" class="ln jt hh ng b fi no nl l nm nn">   all_data.extend(list_data)<br/>   print(i)</span></pre><p id="cde1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是保存的所有硬币名称的文件。</p><figure class="nb nc nd ne fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es np"><img src="../Images/9e844a5052ec749bdf7e1cef9d99945b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSQdq-nSf8zidFvW9KgNiA.png"/></div></div></figure><h1 id="6505" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">通过API v3的历史数据</h1><p id="9b8c" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated"><a class="ae it" href="https://api.coinmarketcap.com/data-api/v3/cryptocurrency/historical?id=1&amp;convertId=2785&amp;timeStart=1367078400&amp;timeEnd=1622764800" rel="noopener ugc nofollow" target="_blank"> <em class="nq">比特币API示例</em> </a></p><p id="a33a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为有超过5000个硬币，所以在提取时有必要为每个硬币创建一个临时文件夹。最终，将它们合并到一个数据框中。</p><pre class="nb nc nd ne fd nf ng nh ni aw nj bi"><span id="135f" class="ln jt hh ng b fi nk nl l nm nn">dn = len(os.listdir('data/'))</span></pre><p id="3a2d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">长度表示的是。目录中的csv文件；以防在提取数据时出现任何技术问题，我们不需要从头开始。</p><pre class="nb nc nd ne fd nf ng nh ni aw nj bi"><span id="ec9a" class="ln jt hh ng b fi nk nl l nm nn">num=dn</span><span id="d589" class="ln jt hh ng b fi no nl l nm nn">for url in urls[dn:]:<br/>   response  = requests.get(url).text<br/>   jsdata = json.loads(response)<br/>   name = jsdata['data']['name'].replace('/',' ')<br/>   quote = [i['quote'] for i in  jsdata['data']['quotes']]</span><span id="2c94" class="ln jt hh ng b fi no nl l nm nn">   df = pd.DataFrame(quote)<br/>   df.to_csv('data/'+name+'.csv')</span><span id="d2b6" class="ln jt hh ng b fi no nl l nm nn">   time.sleep(3)<br/>   num+=1</span><span id="d12e" class="ln jt hh ng b fi no nl l nm nn">   print(num,name,'Done!')</span></pre><p id="0da1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">结合所有小的。使用<strong class="iw hi"> pd.concat </strong>将csv文件合并成一个。</p><pre class="nb nc nd ne fd nf ng nh ni aw nj bi"><span id="5416" class="ln jt hh ng b fi nk nl l nm nn">dfs=[]</span><span id="4fb3" class="ln jt hh ng b fi no nl l nm nn">for i in os.listdir('data/'):<br/>   try:<br/>      df = pd.read_csv('data/'+i)<br/>      df['name']=i.strip('.csv')<br/>      dfs.append(df)<br/>   except:<br/>       pass</span><span id="dd93" class="ln jt hh ng b fi no nl l nm nn">#         print('data/'+i)</span><span id="8400" class="ln jt hh ng b fi no nl l nm nn">df = pd.concat(dfs,axis=0)</span></pre><p id="8b74" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是最终数据框的样子。</p><figure class="nb nc nd ne fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nr"><img src="../Images/deaecb5837becae2cd555daee6ba64e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9jPNAUqOXs-IyeYGneKoQ.png"/></div></div></figure><p id="d41e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以访问名称文件和。我的<a class="ae it" href="https://github.com/Asuna-sama-1/cryptocurrency" rel="noopener ugc nofollow" target="_blank"> Github </a>里的py文件。下一步将利用这些历史数据进行加密货币市场分析和预测。</p></div></div>    
</body>
</html>