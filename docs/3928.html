<html>
<head>
<title>Accelerated Machine Learning Inference via USB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过USB加速机器学习推理</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/accelerated-ml-inference-via-usb-31fe6a927d92?source=collection_archive---------4-----------------------#2022-11-11">https://medium.com/mlearning-ai/accelerated-ml-inference-via-usb-31fe6a927d92?source=collection_archive---------4-----------------------#2022-11-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a6a847581e09e3b15dba97694945fab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYQNJAx4uOJpyRw9rd6wEA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo from Pexels by Jonathan Petersson</figcaption></figure><p id="928d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">你曾经…</p><ul class=""><li id="226a" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">…有一台旧笔记本电脑，如果你能让它运行一些更重的ML推理，它会有很大用处？</li><li id="cc5b" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated">…有一个没有足够ML计算能力的树莓Pi，而你又不想买一个昂贵的Jetson Nano？</li></ul><p id="13d1" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这里是你能做的！</p><p id="a371" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">你所需要的只是这台旧笔记本电脑或者树莓Pi，对我来说，它是一台联想ThinkPad，配有i5内核，没有GPU或任何其他花哨的配件。还有一个你要用的东西:一个USB加速器！</p><p id="c95a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">想象一下，它就像一个u盘，可以在进行并行计算时提高PC的速度。听起来好得难以置信？</p><p id="6f8d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">事实上，这个“u盘”通过添加一个TPU协处理器来为您的系统提供额外的资源。就像显卡一样，但USB加速器，顾名思义，只是插入USB端口。有各种各样的型号，其中英特尔的Neural Compute Stick II和谷歌的CoralAI Compute Stick是最著名的，也是我正在使用的。</p><p id="d24f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这篇文章介绍了CoralAI计算棒。如果你对推理比较感兴趣，比如说，神经计算棒II，请告诉我。</p><h1 id="943a" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">CoralAI电脑棒—体验</h1><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ld"><img src="../Images/8ad17be4d93420b61a81b476a63aa99d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWGgyb_qDj7vX_GFcKsVWA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae li" href="https://www.pexels.com/photo/close-up-photo-of-survey-spreadsheet-590022/" rel="noopener ugc nofollow" target="_blank">Lukas</a></figcaption></figure><p id="6f5f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">根据Coral产品页面(<a class="ae li" href="https://coral.ai/" rel="noopener ugc nofollow" target="_blank">https://coral.ai/</a>)的说法，协处理器能够执行4次top运算(<strong class="iv hi"> t </strong>万亿次运算o<strong class="iv hi">p</strong>er<strong class="iv hi">s</strong>秒)，这导致使用MobileNet v2时接近400 FPS。(更多基准测试<a class="ae li" href="https://coral.ai/docs/edgetpu/benchmarks/" rel="noopener ugc nofollow" target="_blank">此处</a>)</p><p id="1dd2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">阅读这个引起了我的兴趣，我立即订购了一个。在撰写本文时，我已经收到了计算棒，并进行了第一次测试。在Windows操作系统上安装和运行是非常简单的。</p><p id="9885" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在详细展示测试步骤之前，我想预测另一个我最感兴趣的结果:</p><p id="9814" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv hi"> <em class="lj">我的系统的CPU在加速杆上做推断的时候实际要承载多少负载？</em>T15】</strong></p><h2 id="bb8a" class="lk kg hh bd kh ll lm ln kl lo lp lq kp je lr ls kt ji lt lu kx jm lv lw lb lx bi translated">推断过程中的CPU工作负载</h2><p id="f90a" class="pw-post-body-paragraph it iu hh iv b iw ly iy iz ja lz jc jd je ma jg jh ji mb jk jl jm mc jo jp jq ha bi translated">这个结果让我大吃一惊。除了加载和卸载记忆棒之外，它基本上不消耗任何CPU工作负载，如下图所示。</p><figure class="le lf lg lh fd ii er es paragraph-image"><div class="er es md"><img src="../Images/b105fe4dfa5782efcefdfb80988b1689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*2qr4RfYukr7AU9kKRC7DZw.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">CPU Workload in %</figcaption></figure><p id="b560" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在脚本开始之后，在将工作负荷降低到静止水平之前，会出现一个工作负荷峰值。停止脚本后，另一个高峰出现了。</p><p id="a966" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这真是一个糟糕的结果。尤其是如果您的目标是使用系统CPU进行后处理或并行执行其他任务。</p><p id="54cf" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">好吧，让我们回到我是如何到达那里的。</p><h2 id="8337" class="lk kg hh bd kh ll lm ln kl lo lp lq kp je lr ls kt ji lt lu kx jm lv lw lb lx bi translated">入门指南</h2><p id="e48e" class="pw-post-body-paragraph it iu hh iv b iw ly iy iz ja lz jc jd je ma jg jh ji mb jk jl jm mc jo jp jq ha bi translated">安装非常简单，在coralAI页面上有详细的步骤说明，适用于Linux、IOS、Windows和Raspberry PI。对于Windows操作系统设置，我大致做了以下工作:</p><ol class=""><li id="a26b" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq me jx jy jz bi translated">确保您拥有最新版本的Visual Studio C++ 2019</li><li id="528a" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq me jx jy jz bi translated">下载<a class="ae li" href="https://github.com/google-coral/libedgetpu/releases/download/release-grouper/edgetpu_runtime_20221024.zip" rel="noopener ugc nofollow" target="_blank">压缩文件</a></li><li id="5a05" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq me jx jy jz bi translated">双击install.bat进行解压和安装</li><li id="93fa" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq me jx jy jz bi translated">将设备插入USB 3.0端口</li></ol><blockquote class="mf mg mh"><p id="a4f0" class="it iu lj iv b iw ix iy iz ja jb jc jd mi jf jg jh mj jj jk jl mk jn jo jp jq ha bi translated">注:USB 2.0也可以工作，但性能较低</p></blockquote><p id="3930" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">5.安装PyCoral库(Python 3.6或更新版本)</p><pre class="le lf lg lh fd ml mm mn bn mo mp bi"><span id="f022" class="mq kg hh mm b be mr ms l mt mu">python -m pip install --extra-index-url https://google-coral.github.io/py-repo/ pycoral~=2.0</span></pre><p id="2135" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在你已经准备好了。对于MobileNet V2示例，请执行以下步骤。</p><ul class=""><li id="6903" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">获取示例代码</li></ul><pre class="le lf lg lh fd ml mm mn bn mo mp bi"><span id="74a5" class="mq kg hh mm b be mr ms l mt mu">mkdir coral &amp;&amp; cd coral<br/><br/>git clone https://github.com/google-coral/pycoral.git<br/><br/>cd pycoral</span></pre><ul class=""><li id="35cf" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">获取模型、标签和样本输入</li></ul><pre class="le lf lg lh fd ml mm mn bn mo mp bi"><span id="3902" class="mq kg hh mm b be mr ms l mt mu">bash examples/install_requirements.sh classify_image.py</span></pre><ul class=""><li id="f7e1" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">奔跑</li></ul><pre class="le lf lg lh fd ml mm mn bn mo mp bi"><span id="86a0" class="mq kg hh mm b be mr ms l mt mu">python examples/classify_image.py \<br/>--model test_data/mobilenet_v2_1.0_224_inat_bird_quant_edgetpu.tflite \<br/>--labels test_data/inat_bird_labels.txt \<br/>--input test_data/parrot.jpg</span></pre><p id="fc79" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">输出如下所示:</p><pre class="le lf lg lh fd ml mm mn bn mo mp bi"><span id="450c" class="mq kg hh mm b be mr ms l mv mu">----INFERENCE TIME----<br/>Note: The first inference on Edge TPU is slow because it includes loading the model into Edge TPU memory.<br/>11.6ms<br/>3.2ms<br/>2.9ms<br/>2.7ms<br/>2.8ms<br/>-------RESULTS--------<br/>Ara macao (Scarlet Macaw): 0.75</span></pre><h1 id="4f23" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">摘要</h1><p id="b79b" class="pw-post-body-paragraph it iu hh iv b iw ly iy iz ja lz jc jd je ma jg jh ji mb jk jl jm mc jo jp jq ha bi translated">CoralAI Compute Stick的产品页面让我渴望了解这款设备。在这篇文章中，我使用入门指南检查了设置，并进行了第一次推理测试。设置是直截了当的，棍子的表现和广告宣传的一样。然而，最值得注意的是，在加速杆的TPU推断过程中，CPU没有使用任何工作负载，这是一个积极的副作用。总之，我看到了一个巨大的潜力，特别是IOT应用程序，因为它非常灵活，易于设置，实际上加速了ML模型。</p><p id="e036" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">下一步是通过部署自制的姿态估计网络来实际检查CoralAI加速棒的性能。我将比较使用和不使用加速杆时的性能。我还计划用神经计算棒II做一个比较。</p><p id="9375" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">因此，请继续关注使用CoralAI计算棒的更重推理的更新，以及与神经计算棒II的比较。如果您对任何其他分析感兴趣，请告诉我。</p><div class="mw mx ez fb my mz"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd hi fi z dy ne ea eb nf ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">medium.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn in mz"/></div></div></a></div></div></div>    
</body>
</html>