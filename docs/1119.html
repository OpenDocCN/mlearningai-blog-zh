<html>
<head>
<title>Implement Latent Network Models &amp; Visualize Network Data in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实现潜在网络模型并在R中可视化网络数据</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/implementation-of-latent-network-models-visualize-network-data-in-r-b25c42f6d95a?source=collection_archive---------1-----------------------#2021-10-06">https://medium.com/mlearning-ai/implementation-of-latent-network-models-visualize-network-data-in-r-b25c42f6d95a?source=collection_archive---------1-----------------------#2021-10-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="3108" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">实现一类统计模型的代码演示——LNMs，并用R</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/60c692ceb20bcfeb733d39229b5545db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKHMy6b1pi9guCcOWGo3rw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Image by author</figcaption></figure><h1 id="0874" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">介绍</h1><p id="8e69" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">在《带R 的网络数据的<a class="ae la" href="https://link.springer.com/book/10.1007/978-1-4939-0983-4" rel="noopener ugc nofollow" target="_blank">统计分析》一书中，作者谈到了适用于网络数据的三类统计模型，分别是指数随机图模型(ERGMs)、网络块模型(NBMs)和潜在网络模型(LNMs)。在这篇博客中，我将演示如何在R中的网络数据上安装LNMs，并使用名为“eigen model”(Hoff，2008)的库向您展示项目输出的潜在用途(可视化)。本博客中涵盖的方法、代码和发现源自我与堪萨斯大学Srinivasan教授合作的一个正在进行的研究项目中的一个实验项目，即<strong class="kg hi"> <em class="lb">图形分析，用于分析美国医院就诊出院记录报告</em> </strong>中的异常模式。</a></p><h1 id="7973" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">潜在网络模型</h1><p id="c0eb" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">像在许多其他机器学习和统计建模领域一样，潜在变量的想法也已被研究并纳入潜在网络模型类的网络分析中(Kolaczyk等人，2014)。lnm旨在帮助人们使用在网络形成过程中起重要作用但未被观察到的变量来研究网络。要了解更多关于它的概念，请参考从第102页到第108页的书。</p><h1 id="b9c7" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">数据</h1><p id="652f" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">本项目使用亚利桑那州卫生局公共卫生统计局(<em class="lb"><a class="ae la" href="https://azdhs.gov/preparedness/public-health-statistics/hospital-discharge-data/index.php#data-release" rel="noopener ugc nofollow" target="_blank"><em class="lb">AZDHS</em></a><em class="lb">)</em>提供的亚利桑那州医院出院数据公共使用文件(PUF)作为部分数据源。这是我在<a class="ae la" rel="noopener" href="/analytics-vidhya/analyzing-disease-co-occurrence-using-networkx-gephi-and-node2vec-53941da35a0f">使用NetworkX、Gephi和Node2Vec </a>分析疾病共现时使用的类似数据集。我们还引入了<a class="ae la" href="https://www.icd10data.com/LicenseICD10Data" rel="noopener ugc nofollow" target="_blank"> ICD-10数据</a>作为参考表来丰富分析。</em></p><p id="9fe4" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">原始输入是代表疾病共现的<strong class="kg hi">加权边列表</strong>(从电子健康记录生成)，以及包含每个诊断的患病率和类别的<strong class="kg hi">节点属性数据集</strong>。关于数据和边缘权重计算的详细描述，请参考<a class="ae la" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3877615" rel="noopener ugc nofollow" target="_blank">本文</a>。</p><p id="918f" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">在这个项目中，我想比较三个连续时期(新冠肺炎之前、开始和高峰期)亚利桑那州医院系统的疾病网络，以监测随着时间的变化。而这三个时期分别是2019年下半年、2020年上半年、2020年下半年。</p><p id="77cd" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">我们的数据集中有21种诊断。我们挑选了其中的五个(基于总患病率)进行观察，并手动为它们分配不同的颜色，未被选中的类别都被标记为‘灰色’。选定的类别及其配对颜色:(代谢疾病:burlywood1)，(精神和行为障碍:一枝黄花)，(循环系统疾病:蓝绿色)，(呼吸系统疾病:darkorchid1)，和(其他健康服务:红色)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es lh"><img src="../Images/b327815516451de18c9f2196e45254dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*H7opNUv9FR5BQJW1CK--uA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Figure 1: Sample data for Edgelist</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es li"><img src="../Images/fe35dbbc182d058d04d6ebad111ff73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2CL3vWGoOSTgEhlF8Zu5A.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Figure 2: Sample Data for Node Attributes</figcaption></figure><h1 id="6557" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">密码</h1><h2 id="2b34" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">步骤1:读取数据并生成图表</h2><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="9e2e" class="lj jn hh ly b fi mc md l me mf">#### Load Package #####<br/>library(eigenmodel)<br/>library(igraph)</span><span id="f804" class="lj jn hh ly b fi mg md l me mf">#### Load data ####<br/>set.seed(42)<br/>edge1 &lt;- read.csv("edge1.csv")<br/>icd101 &lt;- read.csv("icd101.csv")</span><span id="5f0e" class="lj jn hh ly b fi mg md l me mf">#### Convert Graph ####<br/>start.time &lt;- Sys.time()<br/>g1 &lt;- graph_from_edgelist(as.matrix(edge1[,1:2]), directed = FALSE)<br/>end.time &lt;- Sys.time()<br/>time.taken &lt;- end.time - start.time<br/>time.taken</span></pre><h2 id="e709" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">步骤2:添加必要的节点属性</h2><p id="6c8a" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">这些属性将用于以后的绘图。</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="5b68" class="lj jn hh ly b fi mc md l me mf">#### Add attributes ####<br/>###### re-index the icd10 files<br/>icd101&lt;-icd101[match(V(g1)$name,icd101[,1]),]</span><span id="18cc" class="lj jn hh ly b fi mg md l me mf">###### add prevalence<br/>V(g1)$Prevalence&lt;-icd101[,5]</span><span id="0c49" class="lj jn hh ly b fi mg md l me mf">##### add color<br/>V(g1)$Color&lt;-icd101$Color</span></pre><h2 id="6fb2" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">步骤3:生成邻接矩阵</h2><p id="5098" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">“特征模型”需要邻接矩阵作为输入。</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="6ad0" class="lj jn hh ly b fi mc md l me mf">A &lt;- get.adjacency(g1, sparse = FALSE)</span></pre><h2 id="d162" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">第四步:安装LNMs</h2><p id="5180" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">如需了解该型号的更多参数，请点击<a class="ae la" href="https://cran.r-project.org/web/packages/eigenmodel/eigenmodel.pdf" rel="noopener ugc nofollow" target="_blank">查看</a>(第4页)。</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="9ab1" class="lj jn hh ly b fi mc md l me mf">model1.1 &lt;- eigenmodel_mcmc(A, R = 2)</span></pre><h2 id="a716" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">步骤5:提取特征向量和其他属性</h2><p id="a55d" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">ULU_postmean是降秩近似矩阵的后验均值，根据书中的教程，我们使用前两列数据作为绘图目的的布局。默认矩阵有1000个维度，我尝试了任何二维潜在空间的不同组合，结果没有一个组合能胜过彼此。</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="42b6" class="lj jn hh ly b fi mc md l me mf">model1.1.lo &lt;- eigen(model1.1$ULU_postmean)$vec[,1:2]<br/>v.colors &lt;- V(g1)$Color<br/>v.size &lt;- log(V(g1)$Prevalence)/1.3</span></pre><h2 id="6ab3" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">第六步:比较原始图和有潜在变量的图</h2><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="ba70" class="lj jn hh ly b fi mc md l me mf">par(mfrow=c(1,2))<br/>plot(simplify(simplify(g1)), vertex.color=v.colors,vertex.size = v.size, vertex.label=NA)<br/>plot(g1, layout=model1.1.lo, vertex.color=v.colors,vertex.size = v.size, vertex.label=NA,margin=-.1)</span></pre><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/a61965fe83acf2d663925fff20262e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5mgzRfH5omBxm3nEoCerQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Figure 3: Regular Plot vs. LNMs Plot</figcaption></figure><h2 id="8560" class="lj jn hh bd jo lk ll lm js ln lo lp jw kn lq lr jy kr ls lt ka kv lu lv kc lw bi translated">步骤7:对其余两个周期重复步骤1-5，并比较结果</h2><p id="22a3" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">图3显示了三个选定连续周期的网络图。很明显，第一张图有几个非常明显的集群。然而，随着Convid-19开始传播，一些集群已经消失，而在第二和第三时期形成了一些新的集群，这些图形不像第一个时期那样有组织，第一个时期代表正常时期或新冠肺炎之前的时期。对新星团形成的一种解释可能是，在那段时间里报告了更多不寻常的并发症。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/59067a35848938e04d08b87ccdce65fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pFbhzxR2mHD5hBJ42PFxw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Figure 4: Network Plots with Eigenvalues Over Time</figcaption></figure><h1 id="3899" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">适合度</h1><p id="acc4" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">书中提到的评价拟合优度的方法之一就是比较拟合模型的L_postsamp中元素的后验均值。如果其中一个特征值明显优于另一个(例如1.04和0.26)，这意味着网络不能很好地用当前变量/结构来解释。另一方面，如果特征值在大小上是可比较的(例如，0.59和0.31)，这意味着模型拟合得很好，并且留给潜在变量捕捉的结构明显更少。</p><p id="4bd9" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">以我们的第一个模型和第三个模型为例:</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="e1c2" class="lj jn hh ly b fi mc md l me mf">&gt; apply(model1.1$L_postsamp, 2, mean)<br/>[1] 0.2227712 0.1773729</span><span id="9b9b" class="lj jn hh ly b fi mg md l me mf">&gt; apply(model3.1$L_postsamp, 2, mean)<br/>[1]  0.23991516 -0.01474853</span></pre><p id="9c7f" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">我们可以从输出中看出，第一个模型的特征值非常接近，这对于第一个模型的拟合度来说是一个非常好的信号。然而，第三个模型(2020年下半年的数据)的特征值不像第一个模型那样具有可比性。这种变化表明，随着新冠肺炎在亚利桑那州的加剧，有未观察到的变量对该州的整个医院系统产生影响，但原始数据集没有足够的信息供LNMs进行推断。</p><h1 id="c4cc" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">讨论</h1><p id="2a14" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">从潜在网络模型(lnm)的名称不难看出，模型的输出(潜在变量)很难用人类语言解释。自二十世纪五十年代(Lazarsfeld，1955)以来，潜变量的概念在统计学习领域得到了研究和发展，但在网络分析中的研究和应用较少。在这篇文章中，我在第6.4章“使用R进行网络数据的统计分析”的基础上，用R中的“特征模型”库演示了它的实现和一种潜在用途。这篇博客中的项目成果应该有助于您将其应用推广到类似的项目，也为您提供了研究该模型更多用途的第一步。</p><p id="ebf1" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated">在我的实验中，我还发现“本征模型”也有一些局限性，我在这里对它们进行了总结。首先，由于它使用的是<br/>马尔可夫链蒙特卡罗(MCMC)方法，采样过程将大大减慢拟合过程。第二，它很难处理大量的网络数据，有时甚至不会收敛。</p><h1 id="79a8" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">结论</h1><p id="0402" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated">在这篇博客中，我谈到了r中潜在网络模型的基本概念、实现、一种潜在用途、拟合度和局限性。它可以帮助我们轻松地观察亚利桑那州医院系统的变化模式。实现这种方法有助于通过可视化向非技术人员传达有价值的见解。最后，但同样重要的是，这个项目的想法应该可以推广到其他社交网络项目。</p><p id="eb95" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated"><strong class="kg hi"> <em class="lb">请随时与我联系</em></strong><a class="ae la" href="https://www.linkedin.com/in/jinhangjiang/" rel="noopener ugc nofollow" target="_blank"><strong class="kg hi"><em class="lb">LinkedIn</em></strong></a><strong class="kg hi"><em class="lb">。</em>T13】</strong></p><h1 id="6c87" class="jm jn hh bd jo jp jq jr js jt ju jv jw in jx io jy iq jz ir ka it kb iu kc kd bi translated">相关阅读</h1><p id="6a8f" class="pw-post-body-paragraph ke kf hh kg b kh ki ii kj kk kl il km kn ko kp kq kr ks kt ku kv kw kx ky kz ha bi translated"><a class="ae la" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3877615" rel="noopener ugc nofollow" target="_blank">使用网络分析比较新冠肺炎之前和期间亚利桑那州与怀孕和分娩相关的医院就诊情况</a></p><p id="549e" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated"><a class="ae la" rel="noopener" href="/analytics-vidhya/analyzing-disease-co-occurrence-using-networkx-gephi-and-node2vec-53941da35a0f">使用NetworkX、Gephi和Node2Vec分析疾病共现</a></p><p id="747c" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated"><a class="ae la" href="https://towardsdatascience.com/networkx-code-demo-for-manipulating-subgraphs-e45320581d13" rel="noopener" target="_blank"> NetworkX:操纵子图的代码演示</a></p><p id="5b04" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated"><a class="ae la" href="https://towardsdatascience.com/network-analysis-in-r-manipulating-network-data-ee388fba7215?source=user_profile---------2----------------------------" rel="noopener" target="_blank">用R |操纵网络数据进行网络分析</a></p><p id="30f5" class="pw-post-body-paragraph ke kf hh kg b kh lc ii kj kk ld il km kn le kp kq kr lf kt ku kv lg kx ky kz ha bi translated"><a class="ae la" href="https://towardsdatascience.com/visualize-high-dimensional-network-data-with-3d-360-degree-animated-scatter-plot-d583932d3693?source=user_profile---------0----------------------------" rel="noopener" target="_blank">用3D 360度动画散点图可视化高维网络数据</a></p></div></div>    
</body>
</html>