<html>
<head>
<title>Explainability Technique — Shapley Value</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可解释技术——Shapley值</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/explainability-technique-shapley-value-f69adb363991?source=collection_archive---------3-----------------------#2022-07-19">https://medium.com/mlearning-ai/explainability-technique-shapley-value-f69adb363991?source=collection_archive---------3-----------------------#2022-07-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/9d13d1e44fb3764e07ecece18be7a369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A6SeFJF_w4Wh-9ve"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@grstocks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">GR Stocks</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9bd7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">创建好的模型是我们唯一关心的事情的日子已经一去不复返了。随着易于消费的开源项目和自动化机器学习，我们正在向审计ML模型迈进，其中可解释性是一个重要的方面。在这篇文章中，我们将探索一种解释技巧的博弈论方法:Shapley值。不过，在我们开始这一部分之前，我们将快速绕道了解博弈论的基础知识。</p><p id="d03c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">基本面</strong></p><p id="99a0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">博弈论简单来说就是用数学方法研究逻辑决策者行为的领域。它在多个学科中有着广泛的应用——从解释你的日常现象到揭示巨大规模的问题。博弈论的核心包含三个要素:</p><ul class=""><li id="f022" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">一款<em class="kb">游戏</em></li><li id="8d9b" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated"><em class="kb">选手</em></li><li id="eae5" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated"><em class="kb">奖励</em></li></ul><p id="5323" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">游戏是玩家有一系列选择的情况，每个选择都与回报(和成本)相关联。目标是在给定其他玩家做出的选择的情况下得到最优选择。当然，一个游戏有很多变化，它会很快变得复杂。但是，谈论博弈论不可能不提到<strong class="iw hi">囚徒困境</strong>——这是一个同时非合作博弈的例子，参与者同时做出好的决策。然而，这并不意味着他们必须在<strong class="iw hi"> <em class="kb">确切的</em> </strong>同一时间做出这些决定。关键是每个参与者都不能观察到其他人的选择。经典的囚徒困境有以下条件:</p><ul class=""><li id="2a17" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">有两个球员正在接受犯罪审讯</li><li id="2d90" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">每个玩家只有两个选择:要么让<strong class="iw hi"><em class="kb"/></strong>保持沉默，要么让<strong class="iw hi"> <em class="kb">出卖</em> </strong>他/她的同伙</li><li id="a9d1" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">每个行动都有自己的奖励，取决于另一方选择的行动</li></ul><p id="6960" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这种情况下，有四种可能的排列(2):</p><ul class=""><li id="3fda" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">两名球员都保持沉默，这将奖励他们一个较轻的判决</li><li id="8860" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">玩家A背叛了，玩家B保持沉默，这将让玩家A获得自由，但玩家B必须服刑</li><li id="a704" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">玩家B背叛了玩家A，玩家A保持沉默，这将让玩家B获得自由，但是玩家A必须服刑</li><li id="a58f" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">两个球员互相告密，所以他们都会被判重刑</li></ul><p id="0264" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最好的情况是双方都保持沉默。但是，互相告密是<strong class="iw hi"> <em class="kb"> </em>的最佳策略</strong>。假设我们是a。如果我们选择保持沉默，我们知道B会有背叛我们的动机，因为，谁不想无拘无束地把一切都归咎于我们呢？如果我们选择背叛，我们知道从逻辑上讲，B不会选择保持沉默，因为这意味着我们将自由地将一切都寄托在B身上。因此，无论我们选择什么，B都会背叛我们，因此，我们应该选择背叛。如果我们是B，同样的分析也可以用。这个最佳策略叫做<strong class="iw hi">纳什均衡(NE) </strong>。如果没有任何策略激励参与者改变他们的决策，那么这个策略就是无效的。简单来说就是玩家陷入僵局。然而，最佳策略<strong class="iw hi">可能不是</strong>的最佳情况，就像我们的例子一样。在这种情况下，最佳策略不是<strong class="iw hi">帕累托有效<em class="kb"> </em> </strong>因为嗯，它不是有效的。</p><h1 id="b722" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated"><strong class="ak">合作游戏—总结</strong></h1><p id="089e" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">既然我们已经讨论了游戏的最基本的例子，我们将增加一个等级的难度——我们将深入合作游戏，在这种情况下，玩家被允许建立联盟以最大化他们的收益。例如，在小组项目中，我们可能会选择与表现最好的学生组成一个小组，以获得更高的分数。然而，既然合作是可能的，就出现了一个问题:</p><blockquote class="lk ll lm"><p id="c863" class="iu iv kb iw b ix iy iz ja jb jc jd je ln jg jh ji lo jk jl jm lp jo jp jq jr ha bi translated">我们如何创建一个解决方案，为所有参与的玩家带来公平的回报？</p></blockquote><p id="579f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">回到小组项目的例子，通常会有同行评议会议，在会议的最后会评估我们对团队的贡献。评估的结果将会被考虑到我们的最终成绩中。因此，在我们的例子中，同行评审确保每个参与者得到公平的回报。但是在其他例子中，事情会变得稍微复杂一些。因此，需要一个通用的解决方案来确保合作博弈中的参与者能够获得公平的收益。该问题的完美解决方案满足四个特征:</p><ul class=""><li id="ed7e" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><em class="kb">效率</em>:每个玩家的收益总和应该等于总的可用收益</li><li id="6115" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">对称:对于两个贡献相等的玩家，他们的收益应该是相同的</li><li id="5a55" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">虚拟人:对联盟贡献为零的玩家，他/她的收益应该为零</li><li id="5eb2" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated"><em class="kb">可加性</em>:对于一个玩家来说，他/她在不同子游戏中的总收益应该等于他/她在游戏中的总收益</li></ul><p id="1739" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">而<strong class="iw hi"> Shapley值</strong>是满足以上所有的<strong class="iw hi">唯一的</strong>解概念:</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es lq"><img src="../Images/a9af6d222fc37e412e4efb128d227def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*cV5ea3eYr3CJsJuXRr-Cjw.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Shapley Value</figcaption></figure><p id="e1d1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">直观地说，Shapley值是一个玩家对联盟所有可能排列的边际贡献的加权平均值。在合作游戏中，玩家组队的顺序很重要。在这种背景下，我们必须考虑两种情况:</p><ul class=""><li id="8d15" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">在玩家<em class="kb"> i </em>加入之前，团队中现有玩家的排列由阶乘捕获:|S|！</li><li id="d745" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">在玩家<em class="kb"> i </em>之后加入队伍的玩家的排列，用阶乘(p -|S|-1)来描述！</li></ul><p id="49ab" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们还必须知道特定玩家的边际贡献。举个例子，如果一个团队的总收益是60，然后当玩家<em class="kb"> i </em>加入时收益增加到100，那么他的边际贡献就是100 - 60 = 40。让我们用一个例子来帮助我们理解。假设有一个博弈，条件如下:</p><ul class=""><li id="dad6" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">有三个玩家:甲、乙和丙</li><li id="cd9e" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">我们感兴趣的是找到C的Shapley值</li><li id="056c" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">当{C}加入{A，B}时，他的边际贡献是30 — <strong class="iw hi">排列A </strong></li><li id="2f95" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">当{C}加入{A}时，他的边际贡献是40 — <strong class="iw hi">排列B </strong></li><li id="83ed" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">当{C}加入{B}时，他的边际贡献是20 — <strong class="iw hi">排列C </strong></li><li id="1401" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated">当{C}首先创建自己的团队时，他的边际贡献是50 — <strong class="iw hi">排列D </strong></li></ul><p id="68f4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当我们只和三个玩家打交道时，对每个玩家来说，我们在六种(3！)来计算Shapley值。这是因为有对称性。以排列A为例。从C的角度来看，是A先组队还是B先组队并不重要。就他的边际贡献而言，仍将是30。排列d也是如此，A先加入C还是B先加入C并不重要。他的边际贡献仍将是50英镑。通过考虑上述四种排列和公式，C的Shapley值为</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es lv"><img src="../Images/38e18fad42927af28fe9a53a588e66af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*PhM_G86Iy26zLf4nSwkc7Q.png"/></div></figure><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/92bd35c07f64479b08560e5f913730e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*AbPJhSpC95h1JEjDJnpd5Q.png"/></div></figure><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es lx"><img src="../Images/85e71e967a086d03061a2c15c5958607.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*IKHAIzb0BHxfHACAFbIzog.png"/></div></figure><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/9d2c0ee65c81abf1ebad2de602cbe01b.png" data-original-src="https://miro.medium.com/v2/resize:fit:64/format:webp/1*LKRHc21QKaI1KStEKzB9WA.png"/></div></figure><h1 id="be62" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">它和XAI有什么联系？</h1><p id="1a54" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">XAI的主要目标之一是解释为什么会做出某些预测，我们可以用以下细节将其转化为一个游戏:</p><ul class=""><li id="d20b" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><em class="kb">游戏:确定哪些特征对预测很重要</em></li><li id="245e" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated"><em class="kb">玩家:模型训练阶段使用的特征</em></li><li id="ed24" class="js jt hh iw b ix kc jb kd jf ke jj kf jn kg jr jx jy jz ka bi translated"><em class="kb">奖励:沙普利值</em></li></ul><p id="0587" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们给功能自由形成联盟和“玩”对彼此。特定预测的最重要特征将是具有最高Shapley值的特征。重要的一步是确定馅饼的大小。换句话说，可以在特性之间共享的总收益。在机器学习上下文中，饼图的大小是特定实例的预测和数据集的平均预测之间的<strong class="iw hi">差</strong>。如果您想知道，Shapely Value对分类和回归用例都有效，并且是模型不可知的。由于其坚实的理论基础，Shapley值无疑是ML可解释性的一个有吸引力的选项。幸运的是，如果您想使用它，已经有一个开源实现:</p><div class="lz ma ez fb mb mc"><a href="https://shap.readthedocs.io/en/latest/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hi fi z dy mh ea eb mi ed ef hg bi translated">欢迎来到SHAP文档- SHAP最新文档</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">SHAP是一种博弈论的方法来解释任何机器学习模型的输出…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">shap.readthedocs.io</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq in mc"/></div></div></a></div><h1 id="a939" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">限制</h1><p id="0955" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">虽然理论基础是坚实的，但沙普利价值观并不完美。它有自己的一套限制，在某些应用中可能会被关闭。例如，在我以前的工作中，我没有使用Shapley值，而是选择简单和可解释的算法，如线性回归和基于树的模型。在这一小节中，我们将探讨它的一些局限性。</p><h2 id="11f3" class="mr ki hh bd kj ms mt mu kn mv mw mx kr jf my mz kv jj na nb kz jn nc nd ld ne bi translated"><strong class="ak">运算速度慢</strong></h2><p id="a53d" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">如前所述，Shapely Value考虑了联盟的所有可能排列。可以想象，这可能是一个瓶颈，尤其是当我们处理具有大量特征的复杂数据时。传统的Shapley值计算通常需要指数时间。但是，通过使用基于树的模型来近似Shapley值(TreeShap ),已经做出了一些改进。这将计算时间减少到多项式。最近，甚至更快版本的TreeShap算法已经被开发出来。我们将不得不看看这些算法是否可以应用于具有许多特征的大型数据集。</p><h2 id="1eb3" class="mr ki hh bd kj ms mt mu kn mv mw mx kr jf my mz kv jj na nb kz jn nc nd ld ne bi translated"><strong class="ak">误导性解读</strong></h2><p id="8962" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">对沙普利价值的解释比看起来要复杂。特征的Shapley值是<strong class="iw hi">而不是</strong>该特征对最终预测结果的直接影响。正确的解释是:给定我们所拥有的特征，特征的Shapley值是该特征对<strong class="iw hi">实际预测</strong>和<strong class="iw hi">平均预测</strong>之间的<strong class="iw hi">差</strong>的贡献。这意味着我们不能使用Shapley值进行分析，例如:</p><blockquote class="lk ll lm"><p id="f17c" class="iu iv kb iw b ix iy iz ja jb jc jd je ln jg jh ji lo jk jl jm lp jo jp jq jr ha bi translated">如果我改变特征A，对这个特定人的预测会如何改变？</p></blockquote><p id="bac9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要做这样的分析，我们将需要一个<em class="kb">反事实的解释，</em>不是Shapley值。</p><h2 id="9b33" class="mr ki hh bd kj ms mt mu kn mv mw mx kr jf my mz kv jj na nb kz jn nc nd ld ne bi translated"><strong class="ak">假设特征独立</strong></h2><p id="93ac" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">Shapley值最重要的限制之一可能在于它假设每个特征都是相互独立的(零相关)。这在业内几乎是不成立的。因此，当要素相互关联时，Shapley值可能无法反映正确的解释，因此会产生误导。有人试图解决这个问题。然而，在撰写这篇文章的时候，我还没有看到算法在当前开源包中的实现。因此，实现从零开始是必需的，顺便说一下，这可能是一个有趣的附带项目！</p><h2 id="dc9e" class="mr ki hh bd kj ms mt mu kn mv mw mx kr jf my mz kv jj na nb kz jn nc nd ld ne bi translated">结论</h2><p id="1028" class="pw-post-body-paragraph iu iv hh iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">虽然Shapley值有其吸引力，但我们必须在正确的背景下应用它。作为一个个人准则，只要有可能，我宁愿选择简单和可解释的ML算法。然而，当我发现自己处于简单的ML算法不够用的情况下，Shapley值当然可以有所帮助。数据的大小也会影响我的决定。如果我正在处理一个需要复杂算法的大型数据集，我总是可以考虑另一种可解释性方法:<strong class="iw hi">局部可解释模型不可知可解释性(LIME) </strong> ⁴.</p></div><div class="ab cl nf ng go nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ha hb hc hd he"><p id="aad8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[1]<a class="ae it" href="https://www.scirp.org/(S(351jmbntvnsjt1aadkozje))/reference/referencespapers.aspx?referenceid=2126587" rel="noopener ugc nofollow" target="_blank">https://www . scirp . org/(S(351 jmbntvnsjt 1 aadkozje))/reference papers . aspx？referenceid=2126587 </a></p><p id="1afd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[2]https://arxiv.org/abs/2109.09847<a class="ae it" href="https://arxiv.org/abs/2109.09847" rel="noopener ugc nofollow" target="_blank"/></p><p id="7f70" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[3]<a class="ae it" href="https://www.sciencedirect.com/science/article/pii/S0004370221000539" rel="noopener ugc nofollow" target="_blank">https://www . science direct . com/science/article/pii/s 0004370221000539</a></p><p id="3e63" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://arxiv.org/abs/1602.04938?context=cs" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1602.04938?context=cs</a></p><div class="lz ma ez fb mb mc"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hi fi z dy mh ea eb mi ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">medium.com</p></div></div><div class="ml l"><div class="nm l mn mo mp ml mq in mc"/></div></div></a></div></div></div>    
</body>
</html>