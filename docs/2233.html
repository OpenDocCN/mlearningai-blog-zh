<html>
<head>
<title>The factors of yearly beer sales — Linear model in time series analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">啤酒年销售量的影响因素——时间序列分析中的线性模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/the-factors-of-yearly-beer-sales-linear-model-in-time-series-analysis-9666dd6cd4d9?source=collection_archive---------1-----------------------#2022-03-28">https://medium.com/mlearning-ai/the-factors-of-yearly-beer-sales-linear-model-in-time-series-analysis-9666dd6cd4d9?source=collection_archive---------1-----------------------#2022-03-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/03eaa0dcc86d182e608edcb468e55352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RGJqVnCOopWvMW78J5sTPA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Beer in Supermarket!</figcaption></figure><p id="3915" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">啤酒是德国最著名的饮料之一，当然也是德国文化的一部分！柏林的一家杂货配送公司收集了全年的啤酒销售和其他因素的数据。他们想知道哪个因素对啤酒销售很重要，并据此调整他们的商业策略。</p><p id="4efa" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">所有的代码和原始数据都可以在Github的<a class="ae jr" href="https://github.com/WHPAN0108/DurstExpress_exercise" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><h1 id="86c2" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">数据</h1><p id="abac" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">该数据集包含2019年每一天的以下值:</p><ul class=""><li id="26c6" class="kv kw hh iv b iw ix ja jb je kx ji ky jm kz jq la lb lc ld bi translated">售出的啤酒箱数</li><li id="275e" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq la lb lc ld bi translated">日照时间</li><li id="71f2" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq la lb lc ld bi translated">公共假日(0或1)</li><li id="dd77" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq la lb lc ld bi translated">以摄氏度为单位的平均温度</li></ul><figure class="lk ll lm ln fd ii er es paragraph-image"><div class="er es lj"><img src="../Images/1db9a1e5c241e5c43747ec2b5d939643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*An6L_UeexR8PwZfFz0g6mQ.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">data for the sales</figcaption></figure><h1 id="690c" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">探索性分析</h1><p id="ce78" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">在运行任何模型之前，我们希望更深入地了解数据。</p><ul class=""><li id="43b5" class="kv kw hh iv b iw ix ja jb je kx ji ky jm kz jq la lb lc ld bi translated"><strong class="iv hi">时基数据趋势—每日</strong></li></ul><figure class="lk ll lm ln fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/40053fa35a6fe032836600f6acbb0a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*rwf_IL5BuBFdYvQNQv0bOQ.png"/></div></figure><p id="80ea" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们可以看到销售肯定与日照时间和温度有关(一点也不奇怪，谁不喜欢夏天喝啤酒呢？)</p><ul class=""><li id="3608" class="kv kw hh iv b iw ix ja jb je kx ji ky jm kz jq la lb lc ld bi translated"><strong class="iv hi">时基数据趋势—工作日</strong></li></ul><figure class="lk ll lm ln fd ii er es paragraph-image"><div class="er es lp"><img src="../Images/b3dca3052677f5d6e6602aaf36c18e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*F4T7xHjVuzQC65JMQmJJTA.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">weekday trend for the beer sale</figcaption></figure><p id="bef2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们可以看到<code class="du lq lr ls lt b">crates_sold</code>在周四、周五和周六更高(也不奇怪)。</p><h1 id="0dc6" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">因变量之间的相关性</h1><p id="f2e3" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">我计算相关性并绘制出<code class="du lq lr ls lt b">hours_of_daylight</code>和<code class="du lq lr ls lt b">mean_temperature</code>的散点图。相关性非常高(Pearson相关性0.801)，这可能会导致模型中的共线性问题。</p><figure class="lk ll lm ln fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/d9e71e3ece9642bb9a8b5819c74c23c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*h4HwaIg-tojkZCNhAlWpJg.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">correlation between temperature and daylight</figcaption></figure><h1 id="68b7" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">简单线性模型</h1><p id="7d9c" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">由于<code class="du lq lr ls lt b">hours_of_daylight</code>和<code class="du lq lr ls lt b">mean_temperature</code>的高度相关性，我们只将<code class="du lq lr ls lt b">mean_temperature</code>放入模型中以避免共线性。我试图将交互作用放入模型中，但是交互作用项并不重要。所以我选择最终的模型只有主效果。</p><pre class="lk ll lm ln fd lv lt lw lx aw ly bi"><span id="d455" class="lz jt hh lt b fi ma mb l mc md">mod = smf.ols(formula='crates_sold ~ mean_temperature+public_holiday', data=data)<br/>reg = mod.fit()<br/>model_norm_residuals = reg.get_influence().resid_studentized_internal<br/>print(reg.summary())</span></pre><figure class="lk ll lm ln fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/bf63f42d7c2b14c5578d3415e49c741c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzc1vAreSSEHAbYGkw38yw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Result of the simple linear model</figcaption></figure><h1 id="5e60" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">简单线性模型的模型诊断</h1><p id="7de0" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">线性模型的假设:残差应该是</p><ol class=""><li id="8fbb" class="kv kw hh iv b iw ix ja jb je kx ji ky jm kz jq mf lb lc ld bi translated">平均值等于0的正态分布</li><li id="080d" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq mf lb lc ld bi translated">等方差</li><li id="5400" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq mf lb lc ld bi translated">身份证</li></ol><div class="lk ll lm ln fd ab cb"><figure class="mg ii mh mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/74d2fce0817f2faa197ab7b54211e3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*SDGNqLbLMPkhr-4cGR_15A.png"/></div></figure><figure class="mg ii mm mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/51eddbe7a8dae2a507bc3345c97a2fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*Qoy2vs454NtKiBEZ9WVXdw.png"/></div></figure><figure class="mg ii mn mi mj mk ml paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/f1adfe8da73dba5a9db33a9fd91ee631.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*-WmqpQy2_MJrOUuGMxpd2w.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx mo di mp mq">Residual histogram and QQ-plot</figcaption></figure></div><p id="ed0e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">看起来正态性很好，但是残差之间的相关性如何呢？</p><p id="aed7" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这不是随机的……意味着它们在某种程度上是相关的</p><h1 id="294f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">自相关</h1><p id="c0d6" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">误差应该相互独立。但是在下面的图中，我们可以看到<strong class="iv hi"> 7 </strong>的趋势，这可能表明误差项与工作日有关。</p><pre class="lk ll lm ln fd lv lt lw lx aw ly bi"><span id="0da8" class="lz jt hh lt b fi ma mb l mc md">acf = smt.graphics.plot_acf(reg.resid, lags=40 , alpha=0.05)<br/>acf.show()</span></pre><figure class="lk ll lm ln fd ii er es paragraph-image"><div class="er es mr"><img src="../Images/59d2e2167c1204cca564d6b4c125b6a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*On81z_SVcXbpRpAtZeCWmw.png"/></div></figure><p id="21d5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们可以看到在7天的时间里有三个高峰，分别是周四、周五和周六的比赛。</p><h1 id="1225" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">通过添加新功能重新建模</strong></h1><p id="e55e" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">我在模型中添加了工作日(星期四、星期五、星期六)、月份(3-12)</p><pre class="lk ll lm ln fd lv lt lw lx aw ly bi"><span id="7daf" class="lz jt hh lt b fi ma mb l mc md">mod_final = smf.ols(formula='crates_sold ~ mean_temperature +public_holiday +Weekday_Name_Friday + Weekday_Name_Saturday + Weekday_Name_Thursday  + Month_3 + Month_4 +Month_5 + Month_6 + Month_7 +Month_8 +Month_9 + Month_10 + Month_11 + Month_12', data=new_data) <br/>reg_final = mod_final.fit()</span><span id="9b2c" class="lz jt hh lt b fi ms mb l mc md">print(reg_final.summary())</span></pre><figure class="lk ll lm ln fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mt"><img src="../Images/93156ede5e73466507daa6a8398f72f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*giisePO3yptyxsn4cAUNBw.png"/></div></div></figure><h1 id="4366" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">再次模型诊断</h1><div class="lk ll lm ln fd ab cb"><figure class="mg ii mu mi mj mk ml paragraph-image"><img src="../Images/1e9c10e9f6ed8baa15597ddb4c34fc80.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*huz9CsyPC-hRcbq5m8Lj7A.png"/></figure><figure class="mg ii mv mi mj mk ml paragraph-image"><img src="../Images/6d83aeb7570197de7557ce0ee9f017b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*eu1cnCaukgT1tYwJyG_tDg.png"/></figure></div><div class="ab cb"><figure class="mg ii mw mi mj mk ml paragraph-image"><img src="../Images/fcc2095765bcd4d26bcbb9793734d400.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*GXn1wiMbcvRYfFw1_i0hiQ.png"/></figure><figure class="mg ii mx mi mj mk ml paragraph-image"><img src="../Images/3cacaec2d904d003ef7f059090753db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*2NVlH6BWVQQqvAmhHN9M0Q.png"/></figure></div><p id="d176" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">自相关没了！！！！！！！</p><h1 id="dd7c" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论和意见</h1><p id="033c" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">最终模型与数据非常吻合，残差符合模型假设。</p><h1 id="edee" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">关注:</h1><p id="e566" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">模型的R平方为0.94。这是极高的，甚至有点不寻常。这可能是由于过度拟合。为了解决这个潜在的问题，我将使用更多的历史数据来验证这个模型。</p><h1 id="c440" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">业务备注:</h1><ol class=""><li id="0e2b" class="kv kw hh iv b iw kq ja kr je my ji mz jm na jq mf lb lc ld bi translated">制定销售策略:<br/>根据数据，某些工作日和月份的销售情况较低。我们可以建议营销团队在那几天提供特别优惠来增加订单。</li><li id="5d2e" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq mf lb lc ld bi translated">做好资源安排的计划:<br/>销售情况高度依赖季节。我们可以调整送货司机/车辆的安排。这种布置也可以应用于饮料储存。</li><li id="0d4c" class="kv kw hh iv b iw le ja lf je lg ji lh jm li jq mf lb lc ld bi translated">城市间的差异:<br/>该数据来自柏林。在其他城市新开市场时，可以这个模型为基线，我们可以根据真实的数据来改变模型结构。</li></ol><h1 id="876a" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">PS。</h1><p id="9d54" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated"><em class="nb">这是我在2020年申请一家在线饮料配送公司的数据科学家职位时的一次练习。它曾经是我梦想中的公司之一。可惜我没入选，不过从另一方面来说，这也不算太差。几个月后，这家公司与另一家公司合并了，许多员工被解雇了。也许这是上帝给的。</em></p><p id="aa54" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="nb">在面试中，我认识了那里的一位数据科学家，我们甚至一起吃了顿饭，这是一次很好的经历！很荣幸认识</em> <a class="ae jr" href="https://www.linkedin.com/in/dwolfeu/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">丹尼尔</em> </a> <em class="nb"> :) </em></p><div class="nc nd ez fb ne nf"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ng ab dw"><div class="nh ab ni cl cj nj"><h2 class="bd hi fi z dy nk ea eb nl ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nm l"><h3 class="bd b fi z dy nk ea eb nl ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nn l"><p class="bd b fp z dy nk ea eb nl ed ef dx translated">medium.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt in nf"/></div></div></a></div></div></div>    
</body>
</html>