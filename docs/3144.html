<html>
<head>
<title>Setup Deep Learning workstation with Ubuntu 22.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Ubuntu 22.04设置深度学习工作站</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/setup-deep-learning-environment-with-ubuntu-22-04-8ad40cb28f95?source=collection_archive---------0-----------------------#2022-07-26">https://medium.com/mlearning-ai/setup-deep-learning-environment-with-ubuntu-22-04-8ad40cb28f95?source=collection_archive---------0-----------------------#2022-07-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e3e17fb7da006fda910de6a0c6f86d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QOLUcbfMafoff9bE"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@agk42?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alex Knight</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="iu iv iw"><p id="d86c" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">本文假设您熟悉初级/中级水平的UNIX/Linux工作经验，并确保您的机器中有支持CUDA的GPU设备，以成功完成设置并在设备上运行测试。</p></blockquote><h1 id="1993" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">准备好您的系统更新</h1><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6b9e" class="ld jx hh kz b fi le lf l lg lh">sudo apt update &amp;&amp; sudo apt upgrade -y</span><span id="9d6f" class="ld jx hh kz b fi li lf l lg lh">sudo apt install git curl vim build-essential gcc-9 g++-9 python-is-python3 python3-virtualenv</span></pre><p id="25f4" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">我们不需要在升级后重启ubuntu，但建议这样做。</p><p id="adfc" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">Ubuntu 22.04自带对NVIDIA显卡的开箱即用驱动支持。所以，我们可以使用元包。转到“<strong class="ja hi">软件&amp;更新</strong>，然后选择“<strong class="ja hi">附加驱动程序</strong>”选项卡。</p><p id="1eff" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">它应该看起来如下:(总是选择<em class="iz">专有的、经过测试的</em>和最新的驱动程序号)</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/01d163ac578ef88ab987d184eea932d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSnIYLophudfx-O_2jaEJA.png"/></div></div></figure><h1 id="ce3d" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">安装CUDA:</h1><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="e95a" class="ld jx hh kz b fi le lf l lg lh"># install dependencies<br/>sudo apt install git curl vim build-essential gcc-9 g++-9 python-is-python3 python3-virtualenv</span><span id="036a" class="ld jx hh kz b fi li lf l lg lh"># download cuda 11.2 package</span><span id="ba41" class="ld jx hh kz b fi li lf l lg lh">wget https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda_11.2.0_460.27.04_linux.run</span><span id="c530" class="ld jx hh kz b fi li lf l lg lh"># run the installer and follow instructions on screen <br/>sudo sh cuda_11.2.0_460.27.04_linux.run</span></pre><p id="70c9" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">如果安装程序没有通过任何gcc版本检查，那么运行下面的命令来找出所有可用的gcc版本:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="3961" class="ld jx hh kz b fi le lf l lg lh">dpkg --list | grep compiler</span></pre><p id="0119" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">注意:确保您至少有一个低于10的gcc版本，以便gcc &lt;10 is compatible with the cuda 11.2</p><p id="2861" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">In my machine, I have gcc 9 installed, so set 9 as my preferred version:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="9ecc" class="ld jx hh kz b fi le lf l lg lh"># SET g++ compiler version<br/>sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 100<br/># SET gcc version; 100=priority<br/>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 100</span><span id="5224" class="ld jx hh kz b fi li lf l lg lh"># RUN the installer again<br/>sudo sh cuda_11.2.0_460.27.04_linux.run</span></pre><p id="4984" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">You may want to read more about update-alternatives priority <a class="ae it" href="https://manpages.ubuntu.com/manpages/jammy/en/man1/update-alternatives.1.html" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/9a4537acd5c9c1d592e9421fb05eef32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0uf0MjFkhrKbwVbjS-wOg.png"/></div></div></figure><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/69898cba50c32455d6739effecdbb53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBFLpEsSvD44HLvCLIC3lQ.png"/></div></div></figure><p id="625a" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated"><strong class="ja hi">注意</strong>:由于我们已经安装了驱动程序，请务必通过按“space”键取消选中驱动程序。</p><p id="4242" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">现在，更新环境变量，并将下面几行添加到<code class="du lo lp lq kz b">~/.bashrc or ~/.zshrc</code></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ac91" class="ld jx hh kz b fi le lf l lg lh">export PATH=/usr/local/cuda-11.2/bin${PATH:+:${PATH}}<br/>export LD_LIBRARY_PATH=/usr/local/cuda-11.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}<br/>export CUDA_HOME=/usr/local/cuda<br/>export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH</span><span id="19c6" class="ld jx hh kz b fi li lf l lg lh"># source the config<br/>source ~/.bashrc or source ~/.zshrc</span></pre><h1 id="3a8e" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">测试CUDA安装</h1><p id="1501" class="pw-post-body-paragraph ix iy hh ja b jb lr jd je jf ls jh ji lj lt jl jm lk lu jp jq ll lv jt ju jv ha bi translated">CUDA安装附带了一些样例程序，它们存储在HOME中，所以让我们导航到样例程序并运行设备查询程序</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8393" class="ld jx hh kz b fi le lf l lg lh">cd ~/NVIDIA_CUDA-11.2_Samples/1_Utilities/deviceQuery<br/>make all<br/>make run </span></pre><p id="6847" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">如果安装成功，您应该会看到如下所示的输出:</p><p id="96ab" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated"><strong class="ja hi">注意</strong>:我安装了2个GPU，所以我会在输出中看到它们，如果你有1个设备，你只会看到一个或任何可用的设备。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/0952760b387c111f8a6aa46d0b118fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q42T9yBdCdgvm8mBou_rkw.png"/></div></div></figure><h1 id="8c51" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">安装CUDNN</h1><p id="8070" class="pw-post-body-paragraph ix iy hh ja b jb lr jd je jf ls jh ji lj lt jl jm lk lu jp jq ll lv jt ju jv ha bi translated">您必须向nvidia注册一个帐户，并验证您用于注册的电子邮件，然后您必须在安装时下载与cuda-11.2版本兼容的8.1.1 cudnn存档。(如果您稍后尝试此设置，您可能需要查看兼容性列表，以获得适用于您的cuda版本的正确存档版本。)</p><div class="lx ly ez fb lz ma"><a href="https://developer.nvidia.com/rdp/cudnn-archive#a-collapse811-111" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hi fi z dy mf ea eb mg ed ef hg bi translated">cuDNN档案</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">探索和下载cuDNN GPU加速的深度神经网络原语库的过去版本，为您的…</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">developer.nvidia.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo in ma"/></div></div></a></div><p id="c480" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">下载并准备好正确的归档文件后，导航到存储归档文件的目录，并运行以下命令继续安装:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="cf43" class="ld jx hh kz b fi le lf l lg lh">tar -zvxf cudnn-11.2-linux-x64-v8.1.1.33.tgz<br/>sudo cp -P cuda/include/cudnn.h /usr/local/cuda-11.2/include<br/>sudo cp -P cuda/lib64/libcudnn* /usr/local/cuda-11.2/lib64/<br/>sudo chmod a+r /usr/local/cuda-11.2/lib64/libcudnn*</span></pre><p id="5b52" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated"><strong class="ja hi">验证cudnn安装:</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="645d" class="ld jx hh kz b fi le lf l lg lh"># check for nvidia cuda compiler (nvcc) version<br/>nvcc -V</span><span id="d2ba" class="ld jx hh kz b fi li lf l lg lh"># you should see similar output<br/>nvcc: NVIDIA (R) Cuda compiler driver<br/>Copyright (c) 2005-2020 NVIDIA Corporation<br/>Built on Mon_Nov_30_19:08:53_PST_2020<br/>Cuda compilation tools, release 11.2, V11.2.67<br/>Build cuda_11.2.r11.2/compiler.29373293_0</span></pre><p id="e69b" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">设置依赖关系:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="0404" class="ld jx hh kz b fi le lf l lg lh">sudo apt install build-essential pkg-config cmake cmake-qt-gui ninja-build valgrind</span><span id="d009" class="ld jx hh kz b fi li lf l lg lh">sudo apt install python3 python3-wheel python3-pip python3-venv python3-dev python3-setuptools</span><span id="533d" class="ld jx hh kz b fi li lf l lg lh"># create virtual env for gpu specific<br/>python3 -m venv ~/venv/torchgpu</span><span id="d45a" class="ld jx hh kz b fi li lf l lg lh"># activate venv<br/>source venv/torchgpu/bin/activate</span><span id="1b56" class="ld jx hh kz b fi li lf l lg lh">pip install torch torchvision torchaudio --extra-index-url <a class="ae it" href="https://download.pytorch.org/whl/cu113" rel="noopener ugc nofollow" target="_blank">https://download.pytorch.org/whl/cu113</a></span><span id="edca" class="ld jx hh kz b fi li lf l lg lh">pip install ipykernel</span><span id="7d5a" class="ld jx hh kz b fi li lf l lg lh">python -m ipykernel install --user --name TORCH-GPU --display-name "PyTorch GPU"</span><span id="b840" class="ld jx hh kz b fi li lf l lg lh"># if you see any warning/error w.r.t openGL and glut during make all/run of any sample program run <br/>sudo apt-get install freeglut3 freeglut3-dev</span></pre><h1 id="9768" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">快速PyTorch试验:</h1><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mp"><img src="../Images/b8b8f59a637df9e2a7f838466fc8be27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8jCa5DUH2IGlcNsOHRampA.png"/></div></div></figure><h1 id="5f8d" class="jw jx hh bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">测试一个将利用我们GPU的示例模拟程序:</h1><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6d0f" class="ld jx hh kz b fi le lf l lg lh"># navigate to sample program<br/>cd $HOME/NVIDIA_CUDA-11.2_Samples/5_Simulations/smokeParticles</span><span id="d7cc" class="ld jx hh kz b fi li lf l lg lh">make all<br/>make run</span><span id="b568" class="ld jx hh kz b fi li lf l lg lh"># you should see a simulation window appear with 60 fps or something</span></pre><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mq"><img src="../Images/5c5887045caed9590bf3e98f588790bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-q8c31DOBgDXTWHLUI-_A.png"/></div></div></figure><p id="54f3" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">运行模拟时，打开一个新的终端会话，查看机器中每个GPU发生了什么:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ecef" class="ld jx hh kz b fi le lf l lg lh"># run this command<br/>nvidia-smi</span><span id="f7fa" class="ld jx hh kz b fi li lf l lg lh"># you should see output similar to what is in snapshot below</span></pre><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/6ad2fe8ee9672a44f478aa7389dd35ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5KRRCEV2Lu8B3s1L0CzAg.png"/></div></div></figure><p id="a244" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">我们可以看到，我们的样本程序，烟雾粒子是运行在GPU设备。</p><p id="1180" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">这个帖子到此为止。</p><p id="082e" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji lj jk jl jm lk jo jp jq ll js jt ju jv ha bi translated">谢谢你的检查，请在评论中告诉我你的设置如何:-)。</p><div class="lx ly ez fb lz ma"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hi fi z dy mf ea eb mg ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">medium.com</p></div></div><div class="mj l"><div class="ms l ml mm mn mj mo in ma"/></div></div></a></div></div></div>    
</body>
</html>