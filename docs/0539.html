<html>
<head>
<title>Predicting car prices with machine learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测汽车价格</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/predicting-car-prices-with-machine-learning-40665403296a?source=collection_archive---------1-----------------------#2021-05-12">https://medium.com/mlearning-ai/predicting-car-prices-with-machine-learning-40665403296a?source=collection_archive---------1-----------------------#2021-05-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8599" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如何利用数据科学买车</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/c73da26e0aa02c82abf10372f1f4322c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6Omasee8vNYA2O2L-6zVg.jpeg"/></div></div></figure><p id="7cd0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">购买二手车的过程可能需要很长时间。你可以在网上和网下找到数以千计的汽车，你可以很容易地花几个小时或几天来比较它们，因为二手车的定价不是很透明。因此，我决定尽可能用最无聊的方式搜索汽车:浏览一个汽车网站，创建一个模型来预测二手车的市场价值。</p><h1 id="e9e5" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">数据</strong></h1><p id="83ed" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">由于我希望有一个数据集来训练机器学习模型和选择潜在的购买汽车，我决定自己创建一个荷兰汽车网站，而不是使用旧的Kaggle数据集。可以用Selenium或BeautifulSoup进行刮擦，这产生了价格在€5k和€25k之间的大约45k二手车的数据集，不包括柴油车。</p><p id="0d11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在清理数据(并检查分布)后，数据集包括许多相关的特征，这些特征可用于预测数据集中每辆汽车的市场价值。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kr"><img src="../Images/3d08c03b3f59c2870e0388460afa9127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4obCpImlM6oujbnS3Wqlww.png"/></div></div></figure><p id="d8dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查制造商的汽车分布显示，在我的数据集中排名第一的制造商是大众，其次是欧宝和雷诺，我的数据集中大多数汽车是掀背车，其次是SUV。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="c069" class="kx jp hh kt b fi ky kz l la lb">plt.figure(figsize = (20,15))<br/>cars['Brand'].value_counts().plot(kind='bar')</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/353fbee38cbc6bf9d63962861de5a6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLsU1U8aSZMynPcYUXphfA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Distribution of cars by brand</figcaption></figure><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="c149" class="kx jp hh kt b fi ky kz l la lb">plt.figure(figsize = (20,15))<br/>cars['Type'].value_counts().plot(kind='bar')</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lh"><img src="../Images/53a25da2a2dd19c555b83ed3de99169c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBy2n4T1CN5sEuNK5k4VlQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Distribution of cars by type</figcaption></figure><p id="3461" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了直观显示数据集并更好地理解变量之间的关系，我们可以创建一个关联热图。这张热图显示了变量<em class="li">年份</em>和<em class="li">价格</em>之间，以及汽车的<em class="li">新价格</em>和实际<em class="li">价格</em>之间的高度正相关。在变量<em class="li">年</em>和<em class="li">公里</em>(里程表)之间可以观察到高度负相关。这些相关性是有意义的，因此这是数据建模部分的一个好的起点。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="92ad" class="kx jp hh kt b fi ky kz l la lb"># calculate correlation matrix<br/>corr = cars.corr()<br/># plot the heatmap<br/>plt.figure(figsize =(20,15))<br/>ax=sns.heatmap(corr, xticklabels=corr.columns, yticklabels=corr.columns, annot=True, cmap=sns.diverging_palette(220, 20, as_cmap=True))<br/>bottom, top = ax.get_ylim()<br/>ax.set_ylim(bottom + 0.5, top - 0.5)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lj"><img src="../Images/bfc6fc009c5a5fc23cb0b8935a2c31dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BStibWVLg1Wh43GzttSADw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Correlation heatmap</figcaption></figure><h1 id="7f02" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">数据建模</h1><p id="f318" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为了预测数据集中汽车的市场价值，我使用了随机森林模型。在开始建模之前，我首先必须将分类变量转换成虚拟变量，将变量的每个唯一值转换成它自己的二进制变量。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="75c7" class="kx jp hh kt b fi ky kz l la lb">cars = pd.get_dummies(cars, drop_first=True)</span></pre><p id="e6db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其次，我需要缩放自变量。自变量的比例很重要，因为<em class="li">年</em>变量的最大值是2021，而<em class="li">公里</em>(里程表)的最大值是385，000公里。因此，如果您不缩放数据，那么与<em class="li">年</em>变量的相同变化相比，<em class="li">公里</em>变量的微小变化将对模型产生更大的影响。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="ce67" class="kx jp hh kt b fi ky kz l la lb">from sklearn.preprocessing import StandardScaler<br/>X_head = cars.iloc[:, cars.columns != 'Price']<br/>X = cars.loc[:, cars.columns != 'Price']<br/>y = cars['Price']<br/>X = StandardScaler().fit_transform(X)</span></pre><p id="a110" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们可以训练和测试随机森林模型。随机森林基本上构建了多个决策树，并将它们合并在一起(作为一个整体运行)以获得更准确和稳定的预测。我用数据集的80%来训练模型，20%来测试它。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="c73d" class="kx jp hh kt b fi ky kz l la lb">from sklearn.ensemble import RandomForestRegressor<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import mean_absolute_error as mae<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=.20, random_state=0)<br/>model = RandomForestRegressor(random_state=1, max_depth=50)<br/>model.fit(X_train, y_train)<br/>pred = model.predict(X_test)<br/>print(mae(y_test, pred))<br/>print(cars['Price'].mean())<br/>model.score(X_test,y_test)</span></pre><p id="c9a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该模型的平均绝对误差(MAE)为896，€的平均价格为13，498，准确率为94.3%！</p><p id="a58c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以用下面的代码来可视化随机森林模型的一个单独的决策树:</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="45f3" class="kx jp hh kt b fi ky kz l la lb">from sklearn.tree import export_graphviz<br/>from sklearn import tree<br/>from sklearn.datasets import load_boston<br/>from dtreeviz.trees import dtreeviz # will be used for tree visualization<br/>from matplotlib import pyplot as plt<br/>plt.rcParams.update({'figure.figsize': (12.0, 8.0)})<br/>plt.rcParams.update({'font.size': 14})<br/>plt.figure(figsize=(20,20))</span><span id="b548" class="kx jp hh kt b fi lk kz l la lb">treepicture = tree.plot_tree(model.estimators_[50], feature_names=cars.columns, filled=True)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ll"><img src="../Images/f6040117622315b8639b38a11b37f548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*beM7e7Lczu8KDSYwoO-sYg.png"/></div></div></figure><p id="4854" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">阅读整个决策树是不可能的，所以我们可以限制决策树的深度，以检查具有有限数量变量的单个决策树。要对一个新点进行分类，只需沿着树向下移动，使用该点的特征来回答问题，直到到达一个叶节点，在该叶节点上，类就是预测。但是请记住，所有变量都是按比例缩放的，因此树中的所有特征值也是按比例缩放的。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lm"><img src="../Images/aeed143d34a0e7fd9ff54bff7bfcb83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FqLca4ZhStmDTFOQwzaJ2Q.png"/></div></div></figure><p id="c38e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查特征重要性表明，<em class="li">年</em>变量和<em class="li">新_价格</em>变量是计算二手车市场价值的关键特征，其次是<em class="li">公里</em>(里程表)变量。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ln"><img src="../Images/437bdee10c0cad3b43d001f396ec4b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*h5-GG5Gj_oThHbBB2azKaA.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">Feature importance of the model</figcaption></figure><p id="59b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于汽车的<em class="li"> new_price </em>也间接计入了其他汽车特性，所以我也是在没有这个变量的情况下训练模型。这仍然会导致93.8%的准确率。车的特性，比如马力(<em class="li"> PK </em>变量)，在这款车型中变得更加重要。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lo"><img src="../Images/c4b2486cc192294dbc5ef42cab3cc72c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*KNDyt8DO-sZBAWZza1nLhQ.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">Feature importance of the model without the new price variable</figcaption></figure><p id="9a09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用训练好的模型创建了一个数千辆汽车的数据集，包括汽车功能、价格和基于随机森林模型的估计市场价值。这让我能够筛选出最好的汽车交易，并进一步探索这些汽车的细节。该模型还允许我检查我在其他网站和线下发现的汽车的估计市场价值，几天前，我基于这个小型数据科学项目买了一辆汽车！</p></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><p id="f369" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="li">感谢您的阅读！如果你对这篇文章有任何问题或评论，请在下面随意评论。</em></p></div></div>    
</body>
</html>