<html>
<head>
<title>Demonstrating Customers Segmentation with DBSCAN Clustering Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python演示DBSCAN聚类的客户细分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/demonstrating-customers-segmentation-with-dbscan-clustering-using-python-8a2ba0db2a2e?source=collection_archive---------2-----------------------#2021-03-04">https://medium.com/mlearning-ai/demonstrating-customers-segmentation-with-dbscan-clustering-using-python-8a2ba0db2a2e?source=collection_archive---------2-----------------------#2021-03-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="43c4" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">带噪声的基于密度的空间聚类应用程序(DBSCAN)，这是一个备受瞩目的获奖聚类算法。了解什么是DBSCAN及其在客户细分中的应用，这是业务分析中的一个关键领域。</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/3e594182f3945afa4a5181b739123281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-sJ6yO4XcIkRTKozI8oAg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">What is clustering?</figcaption></figure><p id="65da" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">简介</strong></p><p id="b41c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们总是试图专注于潜在客户的子集，而不是广泛的覆盖面，通过客户细分努力缩小我们的目标客户，从而优化我们的业务目标。回想一下在之前的<a class="ae ki" rel="noopener" href="/swlh/exploring-customers-segmentation-with-rfm-analysis-and-k-means-clustering-93aa4c79f7a7">帖子</a>中讨论的通过基于质心的聚类(K-Means)进行的客户细分，我们可能希望最小化或甚至消除与应用的模型相关的一些缺点，以提出更灵活或稳健的模型作为替代方案。在本文中，我们将介绍一种基于密度的解决方案——DBS can，它可以解决这些问题。</p><p id="969e" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">为什么是DBSCAN？</strong></p><p id="a210" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">从K-Means的聚类结果来看，每个数据点被分配到一个聚类，点的平均值是每个聚类的质心。因此，每个点在确定集群中发挥了它们的作用。实际上，一些数据点偏离“正常”并不罕见，也就是所谓的异常或异常值。单个点中存在单个异常值或微小变化可能会扭曲整个聚类结果。此外，由K-Means形成的簇更接近球形，如果簇是其它奇数或椭圆形，问题就出现了。碎石图和剪影图作为确定参数k的指导，但它们受模型对异常的敏感性的影响很大。创造一种新的方法旨在克服现有方法的复杂性。DBSCAN处理K-Means的大部分缺点。</p><p id="7884" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">数据库扫描</strong></p><p id="c87d" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">DBSCAN也是基于密度的非参数无监督学习，我们不指定数据来自的任何模型。假设更少，模型建立更灵活，应用更广泛。与K-Means类似，DBSCAN根据距离函数和密度，按相似性对数据进行分组。这里的密度是指由模型参数定义的区域中的点数。让我们定义用于解释幕后发生的过程的术语:</p><p id="06e7" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">1.<em class="kj"> eps </em> —定义一个点的邻域，<em class="kj"> x </em>，或以<em class="kj"> x </em>为圆心的圆(或N-D空间中的超球)的半径</p><p id="02b6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">2.<em class="kj">min pts</em>——邻域内形成密集区域的最小点数</p><p id="00c8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">3.核心点——在<em class="kj"> eps内至少有<em class="kj"> minPts </em>个数据点的点。</em></p><p id="7a9d" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">4.边界点-位于密集区域或聚类内但不是核心点的点</p><p id="b667" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">5.噪音-不属于任何聚类</p><p id="fcea" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">6.直接密度可达—点<em class="kj"> x </em>是从<em class="kj"> y </em>直接密度可达的，如果x在<em class="kj">EPS</em>-y的邻域内</p><p id="ffcd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">7.间接密度可达—点<em class="kj"> x(1) </em>据说是从<em class="kj"> x(n) </em>间接密度可达的(<em class="kj"> eps，minPts </em>，如果有一个点链{ <em class="kj"> x(1) </em>，…，<em class="kj"> x(n) </em> }使得<em class="kj"> x(i+1) </em>是从<em class="kj"> x(i) </em>直接密度可达的。</p><p id="a6ef" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">8.密度连通性—如果有一个点<em class="kj"> z </em>使得<em class="kj"> x </em>和<em class="kj"> y </em>都可以从<em class="kj"> z </em>直接到达，则点<em class="kj"> x </em>是从<em class="kj"> y </em>密度连通的(<em class="kj"> eps，minPts </em>)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kk"><img src="../Images/1bd0638f249f86f8205b2f70637aefe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucmrRr3QpoqxzZvXPpOAqA.png"/></div></div></figure><p id="a87a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">DBSCAN对数据进行分区，使得密集区域被稀疏区域分隔开。它处理具有以下特征的数据:</p><p id="535c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">不规则簇形状</p><p id="b9c8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">不同的集群大小</p><p id="22d5" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">异常值的存在</p><p id="bd90" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">算法:</p><p id="ccbf" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">1.在<em class="kj">EPS</em>-邻域中随机选取一个点并检查其是否为具有<em class="kj"> minPts </em>点的核心点，形成一个簇。</p><p id="8fa3" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">2.在核心点附近的点上递归运行，直到所有点都被访问，将密度可达点指定为一个集群。</p><p id="1f87" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">3.对剩余的未访问点重复该过程。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kl"><img src="../Images/a6cca1273ff81f342bd1d17130f5f78f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/1*-15_aekTt82CxfpxoGH2oA.gif"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Illustrating DBSCAN process. credit: <a class="ae ki" href="https://www.digitalvidya.com/blog/the-top-5-clustering-algorithms-data-scientists-should-know/" rel="noopener ugc nofollow" target="_blank">https://www.digitalvidya.com</a></figcaption></figure><p id="0bf3" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">实现DBSCAN </strong></p><p id="70ed" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">只有当我们试图探究数字背后的含义时，数据才有用。如果我们不对数据进行分析、消化和可视化，那么数据将只是一个记录。在对DBSCAN做了一些简单的介绍后，下文将通过采用之前<a class="ae ki" rel="noopener" href="/swlh/exploring-customers-segmentation-with-rfm-analysis-and-k-means-clustering-93aa4c79f7a7">帖子</a>中经过预处理的真实世界数据来演示DBSCAN的应用。总体规划将是相同的，但这一轮DBSCAN将接管K-Means的角色，并负责执行分区任务。</p><p id="b1a2" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">首先，我们需要估计和指定DBSCAN的参数，从<em class="kj"> minPts </em>开始，然后是<em class="kj"> eps </em>使用前者。如果<em class="kj"> minPts=1 </em>，每个数据点将自己形成一个簇，这意味着如果我们有n个数据，我们将有<em class="kj"> n个</em>簇。这对于进行聚类没有任何意义。如果<em class="kj"> minPts=2 </em>，则与单链接层次聚类相同。因此，<em class="kj"> minPts </em>应设为<em class="kj"> minPts ≥ D+1 </em>。然而，根据经验，为简单起见，下面将其设置为<em class="kj"> minPts=2*D </em>。向前移动，<em class="kj"> eps </em>由k距离图确定。计算距离<em class="kj"> k </em>最近邻居的平均距离，并根据1:n的范围绘制。曲线上“肘”点的y值，在这种情况下<em class="kj"> eps=0.7 </em>。</p><p id="0a27" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="kj"> Python代码:</em></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es km"><img src="../Images/5bb4d79a1cca6d4082bb7c57d00ad140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*us7rJaAMp9KGlXeetf6w3A.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">code for determining parameter eps.</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kn"><img src="../Images/ff8e791254d770a32f04dae8321f3553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*xcINWnvdp7Bcbo-kIa6xWA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">k distance graph</figcaption></figure><p id="5538" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">应用估计的参数，拟合DBSCAN模型，并在3D绘图中可视化结果。注意黑点是检测到的异常，sklearn库中的DBSCAN模型会标注为'-1 '。异常被发现松散地分布在远离密集区域的地方。聚类数和离群值集在很大程度上受参数设置的影响。在一些令人困惑的情况下，发现“肘部”可能是主观的，因为曲线没有显示连续点之间的距离有明显变化。因此，记录要寻找的簇的可能或逻辑数目可能是重要的。在这种情况下，尝试改变参数，可能会获得大量的簇，这不太合理，并且偏离了我们感兴趣的内容。解释这种情况的原因之一是由于处理数据的样本量小。然后在下面的蛇图中分析和总结每个聚类的重要特征或聚合特征，以帮助企业做出商业决策。</p><p id="faae" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="kj"> Python代码:</em></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ko"><img src="../Images/c3df429df1b9f1466377a5f6a1bea894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXBLL8JOZihd9tHI--vvkw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">code for fitting a model.</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kp"><img src="../Images/c25643baba03ce6361ecfd57fe93ed0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owfydN6U06RWVVR58kQ8FQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">code for visualizing clusters in 3D plot.</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kn"><img src="../Images/8b8a1f833ef7f49f5ce80f2193d95069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nowTMu_mSIvCiiNtinJISQ.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">3D plot. Black color points are anomalies detected.</figcaption></figure><p id="5ba1" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="kj"> Python代码:</em></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kq"><img src="../Images/03d43f5e24d1260d179b45b06f68e18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gOitlk8oMyobIykBHbx19w.png"/></div></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kn"><img src="../Images/66ccaf51a708fd1f43e5aa0601a9e1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*oRyRdmDLQSGbPt0iCnMzyQ.png"/></div></figure><p id="e755" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这幅蛇图的整体形状与图6 <a class="ae ki" rel="noopener" href="/swlh/exploring-customers-segmentation-with-rfm-analysis-and-k-means-clustering-93aa4c79f7a7">中的</a>相似，但仔细观察上面记录或绘制的数字，还是有一些不同。“货币”方面的差异稍微明显一些。集群2对具有最低“新近性”的企业最具经济价值。最高的“货币”和“频率”。当这个任务的目标改变时，我们看待这个结果的方式应该更新，以做出合理的商业决策。例如，如果企业希望保留潜在的流动客户或寻找一些新产品或促销的目标，具有高“新近性”的聚类吸引我们的注意，随后选择其他聚类而不是2个。仔细和全面规划的分析目标至关重要，因为它会影响数据的处理方式，从而对结果产生重大影响。</p><p id="9daa" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi"> DBSCAN vs K-Means </strong></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kn"><img src="../Images/90dcb0b2a8d28b994a9a2b967c19ab51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*RqtwgERyGeyEJ7RUn2YHJQ.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Comparing kmeans and dbscan.</figcaption></figure><p id="6433" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">结论</strong></p><p id="ae57" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">距离函数用于计算样本之间的相似性。参数的选择基于所选择的功能。在更简单的情况下，我们设法直观地确定散点图中的密集区域。这种现象非常罕见，尤其是当我们接触到更高维度的数据或密集区域之间没有清晰边界的数据时。虽然DBSCAN比K-Means有优势，但是当数据维数太大时，它的结果会恶化，出现“维数灾难”问题。具有不同密度或松散分布的数据的聚类结果不会太好，甚至偏离我们的目标。有时这些点会落在边界不清的混乱区域，它们可能会被归入任何一个聚类中。了解我们拥有的数据，选择能够处理数据结构的模型，以获得讲述真实故事的最准确的结果。</p></div></div>    
</body>
</html>