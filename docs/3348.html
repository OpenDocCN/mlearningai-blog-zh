<html>
<head>
<title>Stock Price Prediction Using Time Series Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用时间序列数据预测股票价格</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/stock-price-prediction-using-time-series-data-f2895dff38e6?source=collection_archive---------2-----------------------#2022-08-21">https://medium.com/mlearning-ai/stock-price-prediction-using-time-series-data-f2895dff38e6?source=collection_archive---------2-----------------------#2022-08-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6162" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">股票价格数据本质上是按时间顺序排列的。如你所料，每一天都跟随着前一天。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/95d94c64a433037a4ec3d652022c4dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5QPE3MhqR2CzLPCp"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@donaldwuid?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Donald Wu</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0af1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了预测未来的股票价格，使用一种特殊类型的神经网络，称为递归神经网络(RNN)。这种类型的网络不同于普通的CNN，因为它将节点组织成一个时间序列。</p><p id="6518" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要开始应用这个，我们首先需要访问时间序列股票数据。在本例中，<a class="ae js" href="https://developer.tdameritrade.com/apis" rel="noopener ugc nofollow" target="_blank">Ameritrade API</a>用于生成数据文件，但是也可以使用其他来源。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="6adf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的代码查询Ameritrade APIs并返回10年的股票价格数据，在本例中是美国航空公司的股票价格数据。绘制完成后，数据应该如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jv"><img src="../Images/00f8dba0c027b4c4e835d478bbc45614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0YiJ_XPoN6klvqUQ9PXeQ.png"/></div></div></figure><p id="8755" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，蜡烛线数据被转换成熊猫数据框架，并为前一天的收盘价添加一个新列。然后保存到一个CSV文件中。</p><p id="3f0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后可以单独加载文件，开始处理预测。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="baf2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将数据加载回dataframe后，需要将时间戳列设置为索引，然后必须将其调整到0到1的范围内，以便于处理。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="dad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此，我们只缩放收盘价、成交量和前几天收盘价列。</p><p id="0e18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们将把数据分成训练数据集和测试数据集。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="01d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重要的是，数据在时间序列的预定点被分割。在这种情况下，我们在80%标记处将其分开，这意味着时间序列的后20%将用于稍后测试预测。</p><p id="ce3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们必须打开数据窗口。这样做可以沿着时间序列创建数据片段，每个片段都将被独立训练。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="0242" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的例子中，数据被窗口化为5个样本的组。每组中的样本数量可以变化，结果会因使用的值不同而有很大差异。</p><p id="b9f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据现在已经准备好了，所以我们将继续构建RNN模型本身。这从创建一个回调函数开始，如果性能没有提高，就提前停止训练。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="c424" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模型建立后，我们现在可以将它与数据进行拟合。最初，我们将在50个时期和20个批次中使用0.0001的学习率。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jw"><img src="../Images/208fc2d5b14c25d53dd9e1ca2e44239d.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*1riBQihPV6iNLzSeY1qA0w.png"/></div></figure><p id="016c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着时代的运行，模型损失函数应随时间而降低。在这种情况下，大约10个时期后达到最佳结果。训练持续了一段时间，提前停止的回调在大约25个时期停止了训练。该模型现在已经训练完毕，可以进行一些预测了。</p><p id="caf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面的代码片段加载以前加窗的训练数据，并生成新的预测。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="5ef2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该预测是训练期间的实际股票价格与预测价格的对比。由于我们是根据我们训练的相同数据进行预测的，因此通常会获得非常好的结果，如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jx"><img src="../Images/fcfc4cf48409627a9af53f203fbd0800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHk0LDwmNTt4bFYO4VonUg.png"/></div></div></figure><p id="eb3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们现在根据保留的测试数据(我们在开始时分离的20%)生成一个预测，可以生成一个更现实的预测。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jy"><img src="../Images/49e326f786c2046dd5d1ecd6ec1defb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHcP0YufZ5NdGK-ViiO0uw.png"/></div></div></figure><p id="449c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，我们看到值之间有一些分离，但预测值通常遵循实际值。</p><p id="e65e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，对该模型的真正考验是，它对另一个股票价格的概括能力有多强。为此，另一个股票价格被捕获到一个csv文件中(使用我们在开始时运行的相同代码)，然后加载到模型中以生成预测。以下示例显示了对Microsoft股票价格的预测:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jz"><img src="../Images/1b2c8a776711eae9d09b7d50db2d9895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GHNjL2lYUVjybM5OvBaSw.png"/></div></div></figure><p id="26ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">总的来说，模型表现得相当好。预测中存在一定程度的噪音，但它很好地遵循了总体趋势。</p><p id="7c9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后要做的事情是建立能够预测明天股票价格的解决方案。为此，我们向数据序列添加另一个零值窗口。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="24ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将像以前一样运行预测，但在这种情况下，最后一个窗口将包含未来预测。要提取实际预测，必须反转开始时应用的缩放比例。</p><p id="6e9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就完成了解决方案！</p><div class="ka kb ez fb kc kd"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ke ab dw"><div class="kf ab kg cl cj kh"><h2 class="bd hi fi z dy ki ea eb kj ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kk l"><h3 class="bd b fi z dy ki ea eb kj ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kl l"><p class="bd b fp z dy ki ea eb kj ed ef dx translated">medium.com</p></div></div><div class="km l"><div class="kn l ko kp kq km kr jm kd"/></div></div></a></div></div></div>    
</body>
</html>