<html>
<head>
<title>General approach for Custom Object Detection with Tensorflow 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tensorflow 2中自定义对象检测的一般方法</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/general-approach-for-custom-object-detection-with-tensorflow-2-61593a67a02d?source=collection_archive---------2-----------------------#2021-08-30">https://medium.com/mlearning-ai/general-approach-for-custom-object-detection-with-tensorflow-2-61593a67a02d?source=collection_archive---------2-----------------------#2021-08-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/92e43a18224c98b6a9f8b88d21ab35e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H9iEvN65L0FBNfKRQVUPg.png"/></div></div></figure><p id="e7cf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇博客中，我将带您了解如何使用Tensorflow 2训练您自己的自定义对象检测器。这不是做某种类型检测的教程，而是一种我们可以用来检测任何东西的通用方法。</p><p id="e2ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要使用Tensorflow对象检测API训练自定义对象检测模型，您需要完成以下步骤:</p><ul class=""><li id="7d9b" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">下载Tensorflow对象检测API</li><li id="82dd" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">检索数据</li><li id="7acd" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">为OD API准备数据</li><li id="1cbb" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">超参数调谐</li><li id="467e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">火车模型</li><li id="622f" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">保存模型</li><li id="c061" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">试验模型</li></ul><h1 id="8430" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">装置</h1><p id="4564" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">您可以使用Python包安装程序(pip)或<a class="ae le" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>安装TensorFlow对象检测API，后者是一个用于部署和管理容器化应用程序的开源平台。要在本地运行Tensorflow对象检测API，建议使用Docker。如果您不熟悉Docker，使用pip安装可能会更容易。</p><p id="83c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先克隆Tensorflow模型存储库的主分支:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7ffd" class="lo kc hh lk b fi lp lq l lr ls">git clone <a class="ae le" href="https://github.com/tensorflow/models.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/models.git</a></span></pre><h1 id="9acd" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">码头设备</h1><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="4fea" class="lo kc hh lk b fi lp lq l lr ls"># From the root of the git repository (inside the models directory)<br/>docker build -f research/object_detection/dockerfiles/tf2/Dockerfile -t od .<br/>docker run -it od</span></pre><h1 id="2ce4" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Python包安装</h1><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a03e" class="lo kc hh lk b fi lp lq l lr ls">cd models/research<br/># Compile protos.<br/>protoc object_detection/protos/*.proto --python_out=.<br/># Install TensorFlow Object Detection API.<br/>cp object_detection/packages/tf2/setup.py .<br/>python -m pip install .</span><span id="fd0f" class="lo kc hh lk b fi lt lq l lr ls">import os<br/>import sys<br/>args = sys.argv<br/>directory = args[1]<br/>protoc_path = args[2]<br/>for file in os.listdir(directory):<br/>    if file.endswith(".proto"):<br/>        os.system(protoc_path+" "+directory+"/"+file+" --python_out=.")</span><span id="e162" class="lo kc hh lk b fi lt lq l lr ls">python use_protobuf.py &lt;path to directory&gt; &lt;path to protoc file&gt;</span></pre><p id="6f1a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要测试安装运行:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9687" class="lo kc hh lk b fi lp lq l lr ls">python object_detection/builders/model_builder_tf2_test.py</span></pre><p id="6d3f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果一切安装正确，您应该看到如下内容:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="8cb8" class="lo kc hh lk b fi lp lq l lr ls">...<br/>[       OK ] ModelBuilderTF2Test.test_create_ssd_models_from_config<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_faster_rcnn_batchnorm_update<br/>[       OK ] ModelBuilderTF2Test.test_invalid_faster_rcnn_batchnorm_update<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_first_stage_nms_iou_threshold<br/>[       OK ] ModelBuilderTF2Test.test_invalid_first_stage_nms_iou_threshold<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_model_config_proto<br/>[       OK ] ModelBuilderTF2Test.test_invalid_model_config_proto<br/>[ RUN      ] ModelBuilderTF2Test.test_invalid_second_stage_batch_size<br/>[       OK ] ModelBuilderTF2Test.test_invalid_second_stage_batch_size<br/>[ RUN      ] ModelBuilderTF2Test.test_session<br/>[  SKIPPED ] ModelBuilderTF2Test.test_session<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_faster_rcnn_feature_extractor<br/>[       OK ] ModelBuilderTF2Test.test_unknown_faster_rcnn_feature_extractor<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_meta_architecture<br/>[       OK ] ModelBuilderTF2Test.test_unknown_meta_architecture<br/>[ RUN      ] ModelBuilderTF2Test.test_unknown_ssd_feature_extractor<br/>[       OK ] ModelBuilderTF2Test.test_unknown_ssd_feature_extractor<br/>----------------------------------------------------------------------<br/>Ran 20 tests in 91.767s</span><span id="7d83" class="lo kc hh lk b fi lt lq l lr ls">OK (skipped=1)</span></pre><h1 id="7622" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">获取数据</h1><p id="85c1" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">在开始构建对象检测器之前，您需要一些数据。如果您已经有一个带标签的数据集，您可以跳过这一节，直接为Tensorflow OD API准备数据。</p><h1 id="a537" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">公共数据集</h1><p id="6f1d" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">如果您对构建和使用对象检测模型的过程更感兴趣，那么利用已经标记的公共数据集是一个好主意。</p><ul class=""><li id="7425" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated"><a class="ae le" href="https://gilberttanner.com/" rel="noopener ugc nofollow" target="_blank">卡格尔</a></li><li id="2c2e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">开源代码库</li></ul><h1 id="e6b8" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">收集数据</h1><p id="fe95" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">如果你想创建自己的数据集，你首先需要得到一些图片。为了训练一个健壮的模型，图片应该尽可能多样化。所以它们应该有不同的背景，不同的视角，不同的光照条件，以及不相关的随机物体。</p><p id="cfaf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以自己拍照，也可以从网上下载图片。对于我的头盔探测器，我使用kaggle数据集</p><div class="lf lg lh li fd ab cb"><figure class="lu ii lv lw lx ly lz paragraph-image"><img src="../Images/1a46144521616774dda684cadb3a46dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*iI2SEQCisX6fIvBj8jfSFw.png"/></figure><figure class="lu ii ma lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/bad725bddcb5d3bc7e9e810e65b477b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*8aCJXAyUQpKEAiJEussoxw.png"/></div></figure><figure class="lu ii mb lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/9475f84a6865621ecab8bde3adcde9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*7JwefaVE7QTPZdNN1u0-Mw.png"/></div></figure></div><div class="ab cb"><figure class="lu ii mc lw lx ly lz paragraph-image"><img src="../Images/66c9ece24df6bd427713310e3f791181.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Kf4Ct-8d0wnsNslz7ZQpbg.png"/></figure><figure class="lu ii mc lw lx ly lz paragraph-image"><img src="../Images/1d63abfe718a8f92a4a4f6f18d783a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*CJ-nOnjSK2HIwdClkDN-CA.png"/></figure></div><div class="ab cb"><figure class="lu ii md lw lx ly lz paragraph-image"><img src="../Images/5c3fcd27e6486942e2cb362e0dc7eb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*6oGoT_rkWMGcdmnNDyoRPA.png"/></figure><figure class="lu ii me lw lx ly lz paragraph-image"><img src="../Images/67f096a9e19d3fa535cddc6c5b426c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*cE8DhPzxiJwLrGppmUErjA.png"/></figure></div><p id="ebec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在你有了所有的图像之后，将大约90%移动到object_detection/images/train目录，另外10%移动到object_detection/images/test目录。确保两个目录中的图像都有很多种类。</p><h1 id="8d81" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">标签数据</h1><p id="00ac" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">如果您使用自己的数据集，您需要标记图像。有许多免费的开源标签工具可以帮助你。</p><p id="c227" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，我推荐使用<a class="ae le" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> LabelImg </a>，因为它可以很容易地下载和使用，但还有许多其他伟大的工具，包括<a class="ae le" href="http://www.robots.ox.ac.uk/~vgg/software/via/" rel="noopener ugc nofollow" target="_blank"> VGG图像注释工具</a>和<a class="ae le" href="https://github.com/microsoft/VoTT" rel="noopener ugc nofollow" target="_blank"> VoTT(视觉对象标记工具)</a>。</p><h1 id="f49f" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">为对象检测API准备数据</h1><p id="c6d2" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">数据被标记后，是时候将其转换为Tensorflow可以使用的格式了。该API处理<a class="ae le" href="https://www.tensorflow.org/tutorials/load_data/tfrecord" rel="noopener ugc nofollow" target="_blank"> TFRecod格式</a>的文件，这是一种存储二进制记录序列的简单格式。</p><p id="1927" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于不同的标签格式，将数据转换为TFRecord格式的过程会有所不同。在本文中，我将向您展示如何使用Pascal VOC格式，这是LabelImg生产的格式。您可以在<a class="ae le" href="https://github.com/tensorflow/models/tree/master/research/object_detection/dataset_tools" rel="noopener ugc nofollow" target="_blank">object _ detection/dataset _ tools目录</a>中找到用于转换其他数据格式的文件。</p><p id="81bb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于Pascal VOC格式，首先使用我的Github中的<a class="ae le" href="https://github.com/TannerGilbert/Tensorflow-Object-Detection-API-Train-Model/blob/master/xml_to_csv.py" rel="noopener ugc nofollow" target="_blank"> xml_to_csv.py </a>文件将所有xml文件转换成一个csv文件。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9f9e" class="lo kc hh lk b fi lp lq l lr ls">python xml_to_csv.py</span></pre><p id="fb68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，下载并打开<a class="ae le" href="https://github.com/TannerGilbert/Tensorflow-Object-Detection-API-Train-Model/blob/master/generate_tfrecord.py" rel="noopener ugc nofollow" target="_blank"> generate_tfrecord.py </a>文件，用自己的标签映射替换class_text_to_int方法中的labelmap。</p><p id="0a7d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于我的数据集，class_text_to_int方法如下所示:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="c216" class="lo kc hh lk b fi lp lq l lr ls">def class_text_to_int(row_label):<br/>    if row_label == 'With Helmet':<br/>        return 1<br/>    elif row_label == 'Without Helmet':<br/>        return 2<br/>    else:<br/>        return None</span></pre><p id="ca48" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，可以通过键入以下命令来生成TFRecords:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ac1e" class="lo kc hh lk b fi lp lq l lr ls">python generate_tfrecord.py --csv_input=images/train_labels.csv --image_dir=images/train --output_path=train.record<br/>python generate_tfrecord.py --csv_input=images/test_labels.csv --image_dir=images/test --output_path=test.record</span></pre><p id="56a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">执行上述命令后，object_detection文件夹中应该有一个train.record和test.record文件。</p><h1 id="88c8" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">配置培训</h1><p id="911d" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">在训练之前，您需要做的最后一件事是创建一个标签映射和一个训练配置文件。</p><h1 id="96e0" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Labelmap</h1><p id="509f" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">标签映射将id映射到名称。我的探测器的标签图可以在下面看到。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="6891" class="lo kc hh lk b fi lp lq l lr ls">item {<br/>    id: 1<br/>    name: 'With Helmet'<br/>}<br/>item {<br/>    id: 2<br/>    name: 'Without Helmet'<br/>}</span></pre><p id="826f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从id到name的映射应该与generate_tfrecord.py文件中的映射相同。</p><h1 id="5b73" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">培训配置</h1><p id="2830" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">接下来，您需要根据您选择的模型创建一个培训配置文件。</p><p id="341d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我将使用mobilenetv2 _ fnite——在神经架构搜索的帮助下发现的SOTA模型的最新家族。你可以在<a class="ae le" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2物体检测模型动物园</a>中找到Tensorflow 2所有可用模型的列表。</p><p id="c2bf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该型号的<a class="ae le" href="https://github.com/tensorflow/models/blob/master/research/object_detection/configs/tf2/ssd_efficientdet_d0_512x512_coco17_tpu-8.config" rel="noopener ugc nofollow" target="_blank">底座</a>可以在型号github repo的<a class="ae le" href="https://github.com/tensorflow/models/tree/master/research/object_detection/configs/tf2" rel="noopener ugc nofollow" target="_blank"> configs/tf2文件夹</a>中找到。需要将其更改为自定义数据和预训练重量。一些训练参数也需要改变。</p><p id="f814" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些变化如下所示:</p><ul class=""><li id="a07a" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将类的数量更改为您想要检测的对象的数量(在我的例子中是4)</li><li id="922b" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将fine_tune_checkpoint更改为model.ckpt文件的路径。</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="da95" class="lo kc hh lk b fi lp lq l lr ls">fine_tune_checkpoint: "&lt;path&gt;/<a class="ae le" href="http://download.tensorflow.org/models/object_detection/tf2/20200711/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.tar.gz" rel="noopener ugc nofollow" target="_blank">SSD MobileNet V2 FPNLite 320x320</a>/checkpoint/ckpt-0"</span></pre><ul class=""><li id="d5e9" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将微调检查点类型更改为检测</li><li id="6a6d" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将train_input_reader的输入路径更改为train.record文件的路径:</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e36d" class="lo kc hh lk b fi lp lq l lr ls">input_path: "&lt;path&gt;/train.record"</span></pre><ul class=""><li id="b963" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将eval_input_reader的输入路径更改为test.record文件的路径:</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="8da3" class="lo kc hh lk b fi lp lq l lr ls">input_path: "&lt;path&gt;/test.record"</span></pre><ul class=""><li id="3e17" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将标签地图路径更改为标签地图的路径:</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9092" class="lo kc hh lk b fi lp lq l lr ls">label_map_path: "&lt;path&gt;/label_map.pbtxt"</span></pre><ul class=""><li id="31a2" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将batch_size更改为适合您的硬件的数字，如4、8或16。</li></ul><h1 id="5546" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">火车模型</h1><p id="31a1" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">若要定型模型，请在命令行中执行以下命令:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="22c4" class="lo kc hh lk b fi lp lq l lr ls">python model_main_tf2.py \<br/>    --pipeline_config_path=training/ssd_efficientdet_d0_512x512_coco17_tpu-8.config \<br/>    --model_dir=training \<br/>    --alsologtostderr</span></pre><p id="c5c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果一切设置正确，培训应该很快开始，您应该会看到如下内容:</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/7043de21d2cecdf116516377dd3465e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYRaRtjJBE2wB1Lp2aJSnQ.png"/></div></div></figure><p id="e9c7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">每隔几分钟，Tensorboard就会记录当前状态。打开Tensorboard，方法是打开第二个命令行，导航到object_detection文件夹，然后键入:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="38e5" class="lo kc hh lk b fi lp lq l lr ls">tensorboard --logdir=training/train</span></pre><p id="ddee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这将在localhost:6006打开一个网页。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/0a0b6063aa7b5a576431562d1c6269d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2cXqAJAZhvFt3lOs5g-7-w.png"/></div></div></figure><p id="281e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">训练脚本每隔几分钟保存一次检查点。训练模型，直到它达到令人满意的损失，然后您可以通过按Ctrl+C来终止训练过程。</p><h1 id="b239" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">导出推理图</h1><p id="1e7d" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">为了更容易使用和部署您的模型，我建议将它转换成一个冻结的图形文件。这可以使用exporter_main_v2.py脚本来完成。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a32c" class="lo kc hh lk b fi lp lq l lr ls">python exporter_main_v2.py \<br/>    --trained_checkpoint_dir=training \<br/>    --pipeline_config_path=training/ssd<a class="ae le" href="http://download.tensorflow.org/models/object_detection/tf2/20200711/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.tar.gz" rel="noopener ugc nofollow" target="_blank"> MobileNet V2 FPNLite</a>_tpu-8.config \<br/>    --output_directory inference_graph</span></pre><h1 id="a6af" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">试验模型</h1><p id="081a" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在您已经训练了您的模型，并将其导出到一个推理图中，您可以使用它进行推理。在培训结束时，您可以借助open cv找到一个推理示例</p><p id="7d32" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">图:预测</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/4d2e1ce0b7bfcdba5bba4554e0b25a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lffbdY1aHP4OCNkNlUb3DQ.jpeg"/></div></div></figure><h1 id="93ee" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">资源</h1><ul class=""><li id="caca" class="jn jo hh ir b is kz iw la ja mi je mj ji mk jm js jt ju jv bi translated"><a class="ae le" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> Tensorflow对象检测API库</a></li><li id="3a08" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><a class="ae le" href="https://github.com/tensorflow/models/tree/master/research/object_detection/g3doc" rel="noopener ugc nofollow" target="_blank"> Tensorflow对象检测API文档</a></li><li id="f90e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><a class="ae le" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank">模型动物园</a></li></ul></div></div>    
</body>
</html>