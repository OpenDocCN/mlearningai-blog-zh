<html>
<head>
<title>Cohort Analysis for Customer Transaction Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">客户交易数据的群组分析</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/cohort-analysis-in-python-abcc103917f0?source=collection_archive---------0-----------------------#2022-04-23">https://medium.com/mlearning-ai/cohort-analysis-in-python-abcc103917f0?source=collection_archive---------0-----------------------#2022-04-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/36738bd222ffcabc0fe7a6acd5b64965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtUc-J2WS8N-WI6JI1s9IA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image by <a class="ae it" href="https://pixabay.com/photos/ecommerce-selling-online-2140604/" rel="noopener ugc nofollow" target="_blank">pixabay</a></figcaption></figure><p id="2304" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数字营销是当今在线生态系统中最受欢迎的角色，我相信在这个领域工作的每一个人都将用户保持率作为主要的KPI之一。</p><p id="960c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是有了丰富的数据，Excel文件在分析活动结果时就没那么有效了。</p><p id="13e4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，在本文中，我将展示您的数据/BI分析师或者营销团队的人员如何利用Python来衡量用户保留率。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="3e5f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">指导方针:</p><ol class=""><li id="3e47" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">数据清理和数据操作</li><li id="7fd2" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">创建群组月份和索引</li><li id="ddf2" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">生成用户保留汇总表</li><li id="d736" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">想象结果</li><li id="03f0" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><strong class="iw hi">数据清理和操作</strong></li></ol><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="db52" class="kw kx hh ks b fi ky kz l la lb">!pip install openpyxl</span><span id="8f8a" class="kw kx hh ks b fi lc kz l la lb">df = pd.read_excel('/kaggle/input/customer-transaction-dataset/KPMG_VI_New_raw_data_update_final.xlsx', sheet_name = 'Transactions')</span><span id="75ea" class="kw kx hh ks b fi lc kz l la lb">df.head()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ld"><img src="../Images/f8f5a33b575933cdeb73ad0b582e280d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFPkmvmr22zpy5pMgenPqQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Snapshot of Dataframe</figcaption></figure><p id="f84d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">正如你们所看到的，从上面的数据中，索引0处的第一行是列名，我们希望用第一行替换当前列。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="825c" class="kw kx hh ks b fi ky kz l la lb">df.columns = df.iloc[0]<br/>df.drop(df.index[0],inplace=True, axis = 0)</span><span id="1440" class="kw kx hh ks b fi lc kz l la lb">df.head()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/a8161513691151caf0661fff727c4fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzyfqtSBbUj0HzdX8totRg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Snapshot After Replacing Columns</figcaption></figure><p id="40db" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，该表看起来就像我们熟悉的一样，接下来，我们将从上面的数据中选择几列，用于群组分析。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="95e8" class="kw kx hh ks b fi ky kz l la lb">#Get the necessary columns for Cohort Analysis</span><span id="5753" class="kw kx hh ks b fi lc kz l la lb">df_final = df[['customer_id','transaction_date','online_order','order_status']]<br/>df_final.head()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lf"><img src="../Images/4eafd911ac32fbf9858a29216a8a4ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0REgbsIlGMdqv8INjdktUw.png"/></div></div></figure><p id="2b86" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我们希望衡量成功完成交易的用户的用户保持率，因此我们将过滤具有“批准”状态的数据，并删除重复值(如果有)。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="2ca4" class="kw kx hh ks b fi ky kz l la lb">df_final = df_final[df_final['order_status'] == 'Approved']<br/>df_final = df_final[~df_final.duplicated()]<br/>df_final.info()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lg"><img src="../Images/f087ba4a4696b99e238664fd941e46ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNj0NccJjf7AvCZqZYAR2w.png"/></div></div></figure><p id="44f5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一切就绪，现在我们将在计算用户保持率之前创建我们的群组月份和指数。</p><p id="9095" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 2。创建群组月份和索引</strong></p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="fdbc" class="kw kx hh ks b fi ky kz l la lb">#Get Transaction Month for the dataframe<br/>import datetime as dt</span><span id="3980" class="kw kx hh ks b fi lc kz l la lb">def get_month(x) :<br/>    return dt.datetime(x.year, x.month,1)</span><span id="5770" class="kw kx hh ks b fi lc kz l la lb">df_final['transaction_date'] = pd.to_datetime(df['transaction_date'])<br/>df_final['transaction_month'] = df['transaction_date'].apply(get_month)</span><span id="c02b" class="kw kx hh ks b fi lc kz l la lb">#Create Cohort Month per Rows</span><span id="9221" class="kw kx hh ks b fi lc kz l la lb">group = df_final.groupby('customer_id')['transaction_month']<br/>df_final['cohort_month'] = group.transform('min')</span><span id="f8a1" class="kw kx hh ks b fi lc kz l la lb">#Calculate Cohort Index for Each Rows</span><span id="b952" class="kw kx hh ks b fi lc kz l la lb">def get_date_int(df, column) :<br/>    year = df[column].dt.year<br/>    month = df[column].dt.month<br/>    day = df[column].dt.day<br/>    <br/>    return year, month, day</span><span id="d2b1" class="kw kx hh ks b fi lc kz l la lb">transaction_year, transaction_month, transaction_day = get_date_int(df_final, 'transaction_month')<br/>cohort_year, cohort_month, cohort_day = get_date_int(df_final,'cohort_month')</span><span id="574f" class="kw kx hh ks b fi lc kz l la lb">#Calculate Year Differences<br/>years_diff = transaction_year - cohort_year</span><span id="7601" class="kw kx hh ks b fi lc kz l la lb">#Calculate Month Differences<br/>months_diff = transaction_month - cohort_month</span><span id="fdf8" class="kw kx hh ks b fi lc kz l la lb">df_final['cohort_index'] = years_diff*12 + months_diff + 1</span><span id="eebc" class="kw kx hh ks b fi lc kz l la lb">df_final.head()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/39561731807b2d682ca04b41b3952199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2ubb28NoiNuQr2HqlTfSw.png"/></div></div></figure><p id="091e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，下面是来自上述代码的逐步方法:</p><ol class=""><li id="fe3a" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">从每个transaction_date数据中获取“月”值，并创建一个名为“transaction_month”的新列</li><li id="3729" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">基于第一个交易月的每个客户id生成“群组_月份”列</li><li id="075b" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">计算“transaction_month”和“cohort_month”之间的差异，并将这些值存储到“cohort_index”中(使用+1表示交易的第一个月，而不是使用0)</li></ol><p id="2ce9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">群组分析所需的所有数据点都已完成，下一步是计算每个群组指数的保留率。</p><p id="2896" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 3。生成用户留存汇总表</strong></p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="9a88" class="kw kx hh ks b fi ky kz l la lb">#Final Grouping to Calculate Total Unique Users in Each Cohort<br/>cohort_group = df_final.groupby(['cohort_month','cohort_index'])</span><span id="24f7" class="kw kx hh ks b fi lc kz l la lb">cohort_data = cohort_group['customer_id'].apply(pd.Series.nunique)<br/>cohort_data = cohort_data.reset_index()</span><span id="3997" class="kw kx hh ks b fi lc kz l la lb">cohort_counts = cohort_data.pivot_table(index = 'cohort_month',<br/>                                        columns = 'cohort_index',<br/>                                        values = 'customer_id'   <br/>                                       )</span><span id="52a7" class="kw kx hh ks b fi lc kz l la lb">cohort_data.head()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div class="er es li"><img src="../Images/5866871a46c0d3776a5f16edd25f983d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*gaB8kARypFyMGptW-ejBHA.png"/></div></figure><p id="bff8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 4。将结果可视化</strong></p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="b448" class="kw kx hh ks b fi ky kz l la lb">#Calculate Retention rate per Month Index</span><span id="91ac" class="kw kx hh ks b fi lc kz l la lb">cohort_size = cohort_counts.iloc[:,0]</span><span id="552b" class="kw kx hh ks b fi lc kz l la lb">retention = cohort_counts.divide(cohort_size, axis = 0)</span><span id="7464" class="kw kx hh ks b fi lc kz l la lb">retention = retention.round(3)*100</span><span id="8571" class="kw kx hh ks b fi lc kz l la lb">retention.index = retention.index.strftime('%Y-%m')</span><span id="a214" class="kw kx hh ks b fi lc kz l la lb">#Plotting Heatmap for Retention Table</span><span id="18be" class="kw kx hh ks b fi lc kz l la lb">import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="3735" class="kw kx hh ks b fi lc kz l la lb">plt.figure(figsize = (16,10))</span><span id="cfa1" class="kw kx hh ks b fi lc kz l la lb">plt.title('MoM Retention Rate for Customer Transaction Data')</span><span id="5268" class="kw kx hh ks b fi lc kz l la lb">sns.heatmap(retention, annot = True, cmap="YlGnBu", fmt='g')</span><span id="f41b" class="kw kx hh ks b fi lc kz l la lb">plt.xlabel('Cohort Index')<br/>plt.ylabel('Cohort Month')<br/>plt.yticks(rotation = '360')</span><span id="36ef" class="kw kx hh ks b fi lc kz l la lb">plt.show()</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/28f316159da26704c7050f33c9583e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKixf_x_cbRNV4F8JVvx7w.png"/></div></div></figure><p id="48f3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是基于上述代码的流程:</p><ol class=""><li id="1c01" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">根据首次交易日期和每月指数计算独立用户总数</li><li id="aade" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">从计算表生成数据透视表，并根据第一个群组月的用户总数划分所有值</li><li id="a5e0" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">最后，使用热图可视化最终表格，以便更好地理解数据。</li></ol><p id="5dfe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是这篇文章的结尾，我希望你们能够真正利用上述代码进行营销活动。</p><p id="798d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">群组分析已经被许多科技公司用来判断活动是否成功。</p><p id="fb3e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">再次感谢你给我支持，为我鼓掌，并把我的故事保存到你的个人阅读中。</p><p id="2deb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请随时联系我或在下面给出评论，这样我就可以更好地理解你们想要阅读的内容。</p><p id="55ab" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">谢谢大家！</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><div class="kn ko kp kq fd lk"><a href="https://www.kaggle.com/code/kelvinprawtama/customer-transaction-cohort-analysis/notebook" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hi fi z dy lp ea eb lq ed ef hg bi translated">客户交易-群组分析</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自Customer_transaction_dataset的数据</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">www.kaggle.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly in lk"/></div></div></a></div><div class="lz ma ez fb mb lk"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hi fi z dy lp ea eb lq ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">medium.com</p></div></div><div class="lt l"><div class="mc l lv lw lx lt ly in lk"/></div></div></a></div></div></div>    
</body>
</html>