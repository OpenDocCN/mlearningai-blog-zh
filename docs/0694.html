<html>
<head>
<title>Let’s mine those Apple Health data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们挖掘那些苹果健康数据</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/lets-have-fun-with-those-apple-health-data-91a0f7f07447?source=collection_archive---------2-----------------------#2021-06-14">https://medium.com/mlearning-ai/lets-have-fun-with-those-apple-health-data-91a0f7f07447?source=collection_archive---------2-----------------------#2021-06-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/740c8eeb5aeb38ec74524fa43d7abd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sZdj6Qp2HpaaxNuN"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Photo by <a class="ae hu" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aron Visuals</a> on <a class="ae hu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="dc33" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">将这些数据从你的手机中移出，获取信息</h2></div><p id="e25c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们很多人口袋里都有一部iPhone，它会持续跟踪我们的活动。记录的信息的一些例子是:<strong class="jo hy">步数</strong>、<strong class="jo hy">距离</strong>跑步、体温<strong class="jo hy">温度</strong>、饮食行为等等。</p><p id="9750" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">当然，这同样适用于其他品牌的设备，但这里我们将讨论如何特别从Apple Health导出。</p><p id="be8d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">内含的<a class="ae hu" href="https://www.apple.com/ios/health/" rel="noopener ugc nofollow" target="_blank">苹果健康</a>应用收集了所有这些数据，作为一名数据科学家，让我们看看我们能从它们身上学到什么。</p><h1 id="f11a" class="ki kj hx bd kk kl km kn ko kp kq kr ks jd kt je ku jg kv jh kw jj kx jk ky kz bi translated">获取数据</h1><p id="65e0" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">在进行分析之前，首先要做的是获取数据。这可以通过苹果健康数据轻松获取。遵循<a class="ae hu" href="https://support.apple.com/en-gb/guide/iphone/iph27f6325b2/ios" rel="noopener ugc nofollow" target="_blank">导出数据指南</a>我们的健康数据可以导出到XML文件。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div class="er es lf"><img src="../Images/cb8392be986645397fb031c06df45992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*iGXwyDmB4hhUrIg6_4oTyg.jpeg"/></div><figcaption class="hq hr et er es hs ht bd b be z dx">Export All Health Data. Image by author.</figcaption></figure><h2 id="d1db" class="lk kj hx bd kk ll lm ln ko lo lp lq ks jv lr ls ku jz lt lu kw kd lv lw ky lx bi translated">XML解析器</h2><p id="cc9d" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">使用<a class="ae hu" href="https://julialang.org/" rel="noopener ugc nofollow" target="_blank"> Julia </a> lightXML包可以读取导出的数据并开始分析它们。这个包能够<em class="ly">解析</em>一个xml文件，并用整个数据集构建一个树。</p><div class="hg hh ez fb hi lz"><a href="https://github.com/JuliaIO/LightXML.jl" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hy fi z dy me ea eb mf ed ef hw bi translated">JuliaIO/LightXML.jl</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">这个包是libxml2的一个轻量级Julia包装器，它提供了一个包含功能的最小接口…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ho lz"/></div></div></a></div><p id="d9f5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">从Apple导出的文件有一个名为<em class="ly"> HealthData </em>的<strong class="jo hy">根</strong>，其中包含设备中所有可用的条目。</p><pre class="lg lh li lj fd mo mp mq mr aw ms bi"><span id="cbb9" class="lk kj hx mp b fi mt mu l mv mw">xdoc = parse_file(“export.xml”)</span><span id="722e" class="lk kj hx mp b fi mx mu l mv mw"># get the root element</span><span id="06f0" class="lk kj hx mp b fi mx mu l mv mw">xroot = root(xdoc) # an instance of XMLElement</span><span id="095f" class="lk kj hx mp b fi mx mu l mv mw"># print its name</span><span id="b5de" class="lk kj hx mp b fi mx mu l mv mw">println(name(xroot)) # this should print: HealthData</span></pre><p id="90ff" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">健康数据有很多孩子，其中一个有它的<strong class="jo hy">标签</strong>。标签描述了条目中数据的种类。</p><p id="3d2b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">可用键的一些例子是:</p><ul class=""><li id="0382" class="my mz hx jo b jp jq js jt jv na jz nb kd nc kh nd ne nf ng bi translated">HKQuantityTypeIdentifierBodyTemperature</li><li id="d249" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi translated">hkquantitypeidentifierdistancewalking running</li><li id="3d2d" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi translated">HKQuantityTypeIdentifierHeartRate</li><li id="9c9a" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi translated">hkquantitypeidentifierstepcount</li><li id="ef3c" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi translated">hkquantitypeidentifiersingheartrate</li><li id="dba9" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi translated">hkquantitypeidentifierbloodpres</li><li id="5c84" class="my mz hx jo b jp nh js ni jv nj jz nk kd nl kh nd ne nf ng bi">…</li></ul><p id="dbd0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">完整的列表可从<a class="ae hu" href="https://developer.apple.com/documentation/healthkit/data_types" rel="noopener ugc nofollow" target="_blank">苹果文档</a>中获得。</p><pre class="lg lh li lj fd mo mp mq mr aw ms bi"><span id="0be5" class="lk kj hx mp b fi mt mu l mv mw">for child in child_nodes(xroot)</span><span id="8b43" class="lk kj hx mp b fi mx mu l mv mw">  if is_elementnode(child)<br/>    e = XMLElement(child)  # this makes an XMLElement instance</span><span id="0cf5" class="lk kj hx mp b fi mx mu l mv mw">    node_name = name(e)</span><span id="5e61" class="lk kj hx mp b fi mx mu l mv mw">    if node_name == "Record"</span><span id="42da" class="lk kj hx mp b fi mx mu l mv mw">    e_dict = attributes_dict(e)</span></pre><p id="421c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">特别地，这些孩子具有<em class="ly">值、</em>开始日期<em class="ly">和<em class="ly">结束日期</em></em></p><pre class="lg lh li lj fd mo mp mq mr aw ms bi"><span id="5422" class="lk kj hx mp b fi mt mu l mv mw">record_type = e_dict["type"]</span><span id="4b51" class="lk kj hx mp b fi mx mu l mv mw">date = e_dict["endDate"]<br/>value = parse(Float64, e_dict["value"])</span></pre><h2 id="3d92" class="lk kj hx bd kk ll lm ln ko lo lp lq ks jv lr ls ku jz lt lu kw kd lv lw ky lx bi translated">绘制健康工具包值</h2><p id="d682" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">为了提取这些值，只需将xml标签转换成浮点型数据就可以了。</p><div class="hg hh ez fb hi lz"><a href="https://github.com/JuliaPy/PyPlot.jl" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hy fi z dy me ea eb mf ed ef hw bi translated">JuliaPy/PyPlot.jl</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">这个模块提供了一个Julia接口到Python的Matplotlib绘图库，特别是到…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="np l mk ml mm mi mn ho lz"/></div></div></a></div><p id="7d38" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">一个例子是用时间表示的体温。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nq"><img src="../Images/d47c9adbf0102076635204343054d88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FG6g2tT7bjxcNKLZi7m-9w.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Example of body temperature extracted from Apple Health. Image by author.</figcaption></figure><h1 id="b3d2" class="ki kj hx bd kk kl km kn ko kp kq kr ks jd kt je ku jg kv jh kw jj kx jk ky kz bi translated">你跑了多少？</h1><p id="1348" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">使用<em class="ly">hkquantitytypeidentifierdistancewalking running</em>可以提取另一个有趣的数据，这特别有用，因为设备会持续收集数据，所以每天都有一个点。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nq"><img src="../Images/ac67284342ef584542c14c14402a27dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_1Wq47_GNW0fRt4ikVZ-w.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Example of analysis of distance walked. Image from author.</figcaption></figure><p id="7ba7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果一个人能更好地推断趋势，画出平均值并对数据进行<strong class="jo hy">平滑</strong>会很有用。</p><h1 id="334e" class="ki kj hx bd kk kl km kn ko kp kq kr ks jd kt je ku jg kv jh kw jj kx jk ky kz bi translated">你怎么睡觉？</h1><p id="82e5" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">人们可以绘制的最后一个关键是睡眠时间的表示。在这种情况下，它们需要一些预处理。例如，如果<em class="ly">结束日期</em>和<em class="ly">开始日期</em>在同一天，则可能是<strong class="jo hy">午睡</strong>。晚上睡觉，无论如何开始结束结束在两个不同的日子，所以我们必须小心当代表他们。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nq"><img src="../Images/bd9da50c7334ee0ca35961f44d118a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svZfBcFMkH2ajAR86mA3bg.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Example of analysis of sleep windows. Image by author.</figcaption></figure><p id="69eb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">一个表示睡眠数据的提议是将y轴格式化，使<strong class="jo hy">午夜</strong>为零，并显示<strong class="jo hy">数字</strong>模24。</p><pre class="lg lh li lj fd mo mp mq mr aw ms bi"><span id="9b47" class="lk kj hx mp b fi mt mu l mv mw">set_yticklabels([y &gt; 0 ? Int64(round(abs(24 — y) % 24)) : Int64(abs(y)) for y in ax.get_yticks()])</span></pre><h1 id="c988" class="ki kj hx bd kk kl km kn ko kp kq kr ks jd kt je ku jg kv jh kw jj kx jk ky kz bi translated">结论</h1><p id="05a1" class="pw-post-body-paragraph jm jn hx jo b jp la iy jr js lb jb ju jv lc jx jy jz ld kb kc kd le kf kg kh ha bi translated">最后，如果你有一部跟踪你活动的iPhone，我希望你已经在这里找到了一些将它们从你的手机中移走的见解，让我们把它们视为有用的信息。</p></div></div>    
</body>
</html>