<html>
<head>
<title>Machine Learning Model Deployment with Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask部署机器学习模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/machine-learning-model-deployment-with-flask-4d7c1c59e22f?source=collection_archive---------2-----------------------#2021-07-04">https://medium.com/mlearning-ai/machine-learning-model-deployment-with-flask-4d7c1c59e22f?source=collection_archive---------2-----------------------#2021-07-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="ff5b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">局部环境模型</strong></h1><p id="99c5" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">创建微调机器学习模型的过程包括加载数据源、数据准备、理解及其分析和模型开发，然后是超参数调整。所有这些都只存在于开发人员这一方。一般来说，在一个典型的场景中，机器学习模型往往会永远存在于我们的机器上。但是为了让终端用户可以使用和体验，我们部署了我们的机器学习模型。从此，烧瓶出现在画面中。</p><p id="f11e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">内容</strong></p><ul class=""><li id="838e" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">瓶</li><li id="a632" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">安装烧瓶</li><li id="6f0b" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">问题陈述</li><li id="ed2f" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">代码结构</li><li id="a1a8" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">网页</li><li id="25ad" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">结束注释</li></ul><h1 id="9751" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">烧瓶</strong></h1><p id="13d3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Flask是一个最初用Python编写的web框架。它完全是通过Python开发的，用于实现基于Web的应用程序。在机器学习场景中，Flask是在网页上部署模型时最重要的部分。</p><h1 id="db96" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">安装烧瓶</h1><p id="713d" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">目前我正在使用我的Windows 64位操作系统来设置Flask。执行一个命令就可以安装Flask。就这么简单！</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="f907" class="lc if hh ky b fi ld le l lf lg">$ pip install Flask</span></pre><p id="0123" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为了在Ubuntu上设置；</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3812" class="lc if hh ky b fi ld le l lf lg">sudo apt-get install python3-flask</span></pre><p id="9a08" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现在，为了确保Flask的安装是正确的，在命令提示符/终端中执行下面的命令。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="a165" class="lc if hh ky b fi ld le l lf lg">C:\Users\Aryan&gt;Flask --version<br/>Python 3.9.2<br/>Flask 1.1.2</span></pre><p id="db74" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您将在终端上看到如上所示的内容。确保使用与完全创建模型相同的python解释器来运行Flask应用程序。</p><h1 id="3f91" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">问题陈述</strong></h1><p id="4a2a" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我目前考虑的数据集是心力衰竭预测数据集。你可以在这里看看详情<a class="ae lh" href="https://archive.ics.uci.edu/ml/datasets/Heart+failure+clinical+records" rel="noopener ugc nofollow" target="_blank">！粗略地说一下我们的数据集，我们有12个特征作为我们机器学习模型的输入——年龄、贫血、肌酐磷酸激酶、糖尿病、射血分数、高血压、血小板、血清肌酐、血清钠、性别、吸烟和时间。目标变量是死亡事件(0/1)。</a></p><p id="6a13" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">因此，一旦我们创建了预测目标变量的机器学习模型，下一步就是将我们的模型权重保存在。pkl格式，为此我们使用joblib/pickle库。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="4ef8" class="lc if hh ky b fi ld le l lf lg">from sklearn.externals import joblib</span><span id="af1a" class="lc if hh ky b fi li le l lf lg"># Saving<br/>joblib.dump(prediction_model, ‘modelname.pkl’)</span><span id="2267" class="lc if hh ky b fi li le l lf lg"># Loading<br/>model = joblib.load(‘modelname.pkl’)</span><span id="a642" class="lc if hh ky b fi li le l lf lg"># Prediction<br/>model.predict(x_test)</span></pre><p id="df53" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">根据数据集上使用的模型数量设置此代码。我在这边做基于树的分类器。</p><p id="0b7d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下一步是创建一个网页，从客户端获取输入，然后输入到我们的模型中。</p><h1 id="ccf2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">代码结构</h1><p id="aad8" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们现在最重要的焦点是精确设置后端！烧瓶装置的结构如下——</p><ol class=""><li id="f8c5" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz lj kl km kn bi translated">在现有工作目录下创建一个文件夹<strong class="je hi">“Templates”</strong></li><li id="608d" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">在Templates文件夹中添加两个HTML文件，名为<strong class="je hi">“Home”</strong>，用于主页接收用户输入和“Output”以显示预测消息。</li><li id="d1a1" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">回到主工作目录，添加名为<strong class="je hi">“app”</strong>的Python文件，这里是整个功能发生的地方。你可以把它看作是整个后端:D的控制室</li></ol><h1 id="58ef" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">网页</h1><p id="d11f" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">给定的代码实现了一个基本的网页，用于设置输入字段及其相应的功能名称。</p><ul class=""><li id="7bac" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">【Home.html T2】号</li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="4143" class="lc if hh ky b fi ld le l lf lg">&lt;html&gt;<br/> &lt;body&gt;<br/>  &lt;center&gt;</span><span id="3982" class="lc if hh ky b fi li le l lf lg">&lt;h1&gt; HEART ATTACK PREDICTION &lt;/h1&gt;<br/>   &lt;body background=''&gt;</span><span id="6a6b" class="lc if hh ky b fi li le l lf lg">&lt;form method="POST", action="{{url_for('home')}}"&gt;<br/>     &lt;b&gt; Age : &lt;input type="number", name='a', placeholder='Age'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Anaemia : &lt;input type="number", name='b', placeholder='Anaemia'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Creatinine Phosphokinase : &lt;input type="number", name='c', placeholder='Creatinine Phosphokinase'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Diabetes : &lt;input type="number", name='d', placeholder='Diabetes'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Ejection Fraction : &lt;input type="number", name='e', placeholder='Ejection Fraction'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; High Blood Pressure : &lt;input type="number", name='f', placeholder='High Blood Pressure'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Platelets : &lt;input type="number", name='g', placeholder='Platelets'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Serum Creatinine : &lt;input type="number", name='h', placeholder='Serum Creatinine'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Serum Sodium : &lt;input type="number", name='i', placeholder='Serum Sodium'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Gender : &lt;input type="number", name='j', placeholder='Gender'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Smoking : &lt;input type="number", name='k', placeholder='Smoking'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;b&gt; Time : &lt;input type="number", name='l', placeholder='Time'&gt;&lt;br&gt;&lt;br&gt;<br/>     &lt;input type="submit", value='pred'&gt;<br/>    &lt;/b&gt;<br/>   &lt;/form&gt;</span><span id="15b5" class="lc if hh ky b fi li le l lf lg">  &lt;/center&gt;<br/> &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="1ab1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现在我们继续创建预测页面，我们的模型根据从用户端接收的输入显示输出消息。</p><ul class=""><li id="85e7" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">【Output.html T4】</li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="103b" class="lc if hh ky b fi ld le l lf lg">&lt;html&gt;</span><span id="2180" class="lc if hh ky b fi li le l lf lg"> &lt;body&gt;</span><span id="02ae" class="lc if hh ky b fi li le l lf lg">  &lt;center&gt;</span><span id="d688" class="lc if hh ky b fi li le l lf lg">&lt;h1&gt; PREDICTION &lt;/h1&gt;<br/>   &lt;br&gt;<br/>   &lt;br&gt;<br/>   &lt;br&gt;<br/>   {%if data==0%}<br/>   &lt;h2&gt; You have not encountered a heart attack &lt;/h2&gt;</span><span id="ab5b" class="lc if hh ky b fi li le l lf lg">    {{pred}}</span><span id="7e5e" class="lc if hh ky b fi li le l lf lg">{%else%}<br/>   &lt;h2&gt; You need to look for doctors because you have encountered a Heart Attack&lt;/h2&gt;<br/>   &lt;br&gt;<br/>   &lt;br&gt;<br/>   &lt;br&gt;</span><span id="5cb2" class="lc if hh ky b fi li le l lf lg">{%endif%}<br/>   &lt;h6&gt; Thank You &lt;/h6&gt;</span><span id="5b54" class="lc if hh ky b fi li le l lf lg">  &lt;/center&gt;</span><span id="c089" class="lc if hh ky b fi li le l lf lg"> &lt;/body&gt;<br/> <br/>&lt;/html&gt;</span></pre><p id="c00f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">目标变量属于分类类型。因此该模型只能以二进制格式进行预测。根据预测，我们设置了if-else块。</p><p id="0b6f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为了使这两个文件同步并按照模型输出正常工作，我们创建了一个称为Flask控制室的东西(好吧，我这样称呼它:P ),整个流连接在这里发生！转到您的工作目录，在app.py中编写以下代码。</p><ul class=""><li id="7cd3" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated"><strong class="je hi"> app.py </strong></li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="9caf" class="lc if hh ky b fi ld le l lf lg"># Importing necessary modules<br/>from flask import Flask, render_template, request<br/>import pickle<br/>import numpy as np</span><span id="8a90" class="lc if hh ky b fi li le l lf lg"># Loading the Models<br/>dclf_heart = pickle.load(open('dclf.pkl', 'rb'))<br/>xrclf_heart = pickle.load(open('xrclf.pkl', 'rb'))<br/>xclf_heart = pickle.load(open('xclf.pkl', 'rb'))</span><span id="2c11" class="lc if hh ky b fi li le l lf lg"># Instantiate app object <br/>app = Flask(__name__)</span><span id="afcb" class="lc if hh ky b fi li le l lf lg"># Setting up app routes<a class="ae lh" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank"><br/>@app</a>.route('/')<br/>def man(): <br/> return render_template('Home.html')</span><span id="9e8d" class="lc if hh ky b fi li le l lf lg"><a class="ae lh" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict', methods=['POST'])<br/>def home():<br/> feature1 = int(request.form['a'])<br/> feature2 = int(request.form['b'])<br/> feature3 = int(request.form['c'])<br/> feature4 = int(request.form['d'])<br/> feature5 = int(request.form['e'])<br/> feature6 = int(request.form['f'])<br/> feature7 = int(request.form['g'])<br/> feature8 = int(request.form['h'])<br/> feature9 = int(request.form['i'])<br/> feature10 = int(request.form['j'])<br/> feature11 = int(request.form['k'])<br/> feature12 = int(request.form['l'])</span><span id="4715" class="lc if hh ky b fi li le l lf lg"> arr = np.array([[feature1, feature2, feature3, feature5, feature6, feature7, feature8, feature9, feature11, feature12]])<br/> pred1 = dclf_heart.predict(arr)<br/> pred2 = xrclf_heart.predict(arr)<br/> pred3 = xclf_heart.predict(arr)</span><span id="add5" class="lc if hh ky b fi li le l lf lg">final_pred = [pred1, pred2, pred3]<br/> if final_pred.count(1) &gt; final_pred.count(0):<br/>  pred = 1<br/> else:<br/>  pred = 0</span><span id="2a5e" class="lc if hh ky b fi li le l lf lg">return render_template('Output.html', data=pred)</span><span id="84be" class="lc if hh ky b fi li le l lf lg"># Flask server<br/>if __name__=="__main__":<br/> app.run(debug=True)</span></pre><p id="f645" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这在一开始可能会令人生畏，但让我们一次一个地分解它…</p><ol class=""><li id="def4" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz lj kl km kn bi translated">最初的几行是我们导入模块的地方。</li><li id="72d5" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">使用pickle模块，我们将读取二进制格式下的模型分配给dclf_heart、xrclf_heart、xclf_heart。(这些是我们的模型所在的pickle文件，为了便于理解，将它们视为模型)</li><li id="fdf7" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">我们为要运行的代码实例化app对象，认为这是后端代码库的核心。</li><li id="86e4" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">下一步是指定应用程序路由来连接我们之前创建的网页:)第一个路由在Templates文件夹下呈现我们的主页，下一个路由呈现预测页面。</li><li id="d36d" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">在第二个应用程序路径中，从Home.html以整数格式(主要是因为我的数据集的所有要素都处理整数)请求值(从用户端通过网页提供给模型的输入)，并将其分配给变量feature1、feature2、feature3等。</li><li id="c555" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">在这里，我们的工作完成得非常完美！但如前所述，我使用了3个基于树的分类器，为了获得所需的输出，我使用了聚合器功能，该功能主要基于多数投票来选择输出。代码非常简单，易于理解。if-else块的基本实现。</li><li id="8e90" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz lj kl km kn bi translated">调用run函数在本地启动Flask服务器。最后一行是我们的后台！！！！应用程序在默认参数设置为True的情况下运行。</li></ol><p id="b4d3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> Flask服务器</strong>接收来自该端的请求并获取其响应，其中来自用户端的输入被接收并馈入模型。</p><h1 id="52df" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">结束注释</strong></h1><p id="bd08" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这就是后端使用Flask 加载和部署<strong class="je hi">机器学习模型的工作方式。根据处理的数据，开发人员可以设计网页前端。但是说到后端，最初可能有点难以理解它是如何以及为什么以这种方式运行的，但是随着时间的推移，事情会变得清晰并且更容易理解！</strong></p><p id="1c50" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这是<strong class="je hi">“如何使用Flask部署机器学习模型”</strong>，我希望这个过程清晰简洁，并附有评论和解释。</p><p id="32f0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果你喜欢我写的东西，一定要看看我的其他博客，我很想知道你对此的看法，谢谢:)</p></div></div>    
</body>
</html>