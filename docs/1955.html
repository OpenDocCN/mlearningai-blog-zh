<html>
<head>
<title>Debugging deep learning models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试深度学习模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/debugging-deep-learning-models-18d125915507?source=collection_archive---------4-----------------------#2022-02-15">https://medium.com/mlearning-ai/debugging-deep-learning-models-18d125915507?source=collection_archive---------4-----------------------#2022-02-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e4a760c4f31787eb62a7cd4adef701c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pSLms1MHi-n2CgQ3"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Ried</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="91e2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">机器学习模型调试不同于传统调试，在传统调试中，我们可以简单地在某些检查点检查输出，如果有任何错误，过程将崩溃。</p><p id="fc56" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">深度学习模型可能非常庞大，有时调试甚至知道有问题都很困难。我希望本指南能帮助您发现模型的问题。</p><h2 id="9094" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">如何调试</h2><ol class=""><li id="c280" class="kn ko hh iw b ix kp jb kq jf kr jj ks jn kt jr ku kv kw kx bi translated"><strong class="iw hi">查资料:🔍</strong></li></ol><p id="196b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为我们将使用一些数据来训练或测试模型，所以检查数据总是一个好主意。在这里，我们可以创建一个笔记本，并加载一些数据示例来检查注释是否正确。例如，在对象检测数据集中，我们可以通过在一些随机图像中绘制边界框来检查边界框是否正确。<a class="ae it" href="https://github.com/voxel51/fiftyone" rel="noopener ugc nofollow" target="_blank">第五十一条</a>是一个非常好的数据可视化工具。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ky"><img src="../Images/55c208f3871782120e44548a28d0cd3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6W6TnZhkkXNs1bIODSO8hA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Dataset visualization with FiftyOne</figcaption></figure><p id="d351" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">2.<strong class="iw hi">小数据下模型过度拟合:📈</strong></p><p id="41b9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，一旦我们确定了数据，要检查模型是否有效，最好是在数据集的一小部分中对模型进行过度填充。这不会确认模型是正确的，如果过度它发生了，但如果过度它没有发生，那么模型有问题。</p><p id="0517" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">3.<strong class="iw hi">虚拟数据测试💎</strong></p><p id="9c82" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我们确定模型有问题，请从培训代码中删除模型代码。创建一个随机数据样本，并通过模型传递，检查</p><ul class=""><li id="30cc" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">如果结果在具有相同输入的运行中是一致的。</li><li id="f103" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">如果结果不一致，请检查中间层的结果。这可以通过<a class="ae it" href="https://docs.python.org/3/library/pdb.html" rel="noopener ugc nofollow" target="_blank"> pdb </a>库轻松完成。在<code class="du lm ln lo lp b">forward</code>功能中做任何事情之前使用<code class="du lm ln lo lp b">pdb.set_trace()</code>，您可以检查中间结果。</li></ul><p id="b7fc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 4 .✨常见培训问题</strong></p><p id="5959" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有时，错误的准确性并不意味着模型有问题。很少有事情能有所帮助</p><ul class=""><li id="0b01" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">【失正T2】中，降低学习率。这可能是因为爆炸梯度。</li><li id="8165" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">如果损失为<code class="du lm ln lo lp b">0</code>，则可能是因为梯度消失。</li><li id="dcfa" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">最好检查损耗与历元图。根据损失曲线更新超参数。</li><li id="f297" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">对批量使用适当的学习率。</li><li id="9186" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">如果多GPU训练有问题，尝试在单个GPU上进行训练，以检查是否是多GPU训练有问题或模型代码有问题。</li></ul><p id="130e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 5。记录和跟踪实验📃</strong></p><p id="c2c2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">深度学习模型训练可能需要时间。最好跟踪实验和数据集。有时可能是因为某些超参数，模型精度不起作用。追踪器可以帮助我们很容易地获得这种洞察力，因为我们可以在一个地方检查结果。</p><ul class=""><li id="0e28" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">对于实验跟踪，我个人比较喜欢<a class="ae it" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank"> MLflow </a>和<a class="ae it" href="https://github.com/tensorflow/tensorboard" rel="noopener ugc nofollow" target="_blank"> Tensorboard </a>。有许多其他工具(查看参考资料部分)可用于此目的，也可以随意尝试。</li><li id="79b1" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">如果我们大量更改数据集，数据集跟踪就变得很重要。跟踪数据集有助于检出旧版本，并比较和计算不同版本的准确性。对于数据集跟踪，我通常使用<a class="ae it" href="https://github.com/iterative/dvc" rel="noopener ugc nofollow" target="_blank"> DVC </a>。</li><li id="06ee" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">给训练一些时间。对于一个模型来说，至少需要一两天的时间来处理大量的数据是很常见的。尝试为大的时期进行训练，并检查实验跟踪器中的验证准确性，以检查是否过度拟合。</li></ul><p id="2c40" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 6。使用基线模型⭐️ </strong></p><ul class=""><li id="aeee" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">从一个没有错误并且之前已经测试过的库中的基线模型开始是一个好的实践。</li><li id="7835" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">这将给出数据集的基线精度。</li><li id="98f2" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">任何精度较低的新的复杂模型都需要调试，但是如果精度较高，问题可能出在(小的或类似的)数据集上，并且模型可能已经达到其最佳性能。</li><li id="6b46" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">以数据为中心的方法现在越来越受欢迎，从数据集的角度来看，人们可以尝试添加更多的数据或尝试提高现有数据集的质量。</li><li id="7fd5" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">为了提高数据集的质量，可以修复错误的注释，使它们保持一致，等等(查看参考资料部分了解更多信息)。</li></ul><p id="7fbf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 7。查看模型设计☁️ </strong></p><ul class=""><li id="9f62" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">如果我们正在实施一个新的体系结构，并对旧的体系结构进行一些更改，我们必须确保数据按照我们的计划通过网络传输。</li><li id="dea9" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">我们可以想象任何带有Netron的网络。它支持许多格式的模型架构，比如ONNX、TensorFlow Lite、Caffe、Keras、Darknet等等。</li></ul><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/a2fe23da21a28d6e4b5febe8a13f76be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zo3eQU6IH04dm0DH7YjYvw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Model architecture in Netron</figcaption></figure><ul class=""><li id="e9f8" class="kn ko hh iw b ix iy jb jc jf ld jj le jn lf jr lg kv kw kx bi translated">检查损失函数输入，并确保它以预期的格式获得预测向量和地面真实向量的输入。</li></ul><h2 id="e64d" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">生产调试🏃</h2><ul class=""><li id="4ed1" class="kn ko hh iw b ix kp jb kq jf kr jj ks jn kt jr lg kv kw kx bi translated">在部署之后和之前计算模型的性能是一个很好的实践。</li><li id="8197" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">这是必要的，因为有时部署环境可能不会像开发环境那样给出精确的结果。</li><li id="3cff" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">这种差异对于边缘部署来说可能非常显著，性能变化可能会让您大吃一惊。</li><li id="5190" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">一旦部署了模型，使用一些模型监控工具可能是一个好主意，如果有数据漂移或概念漂移，该工具将标记出来。</li><li id="467f" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">监控很重要，因为它可以帮助您轻松地确定问题。</li><li id="cfdd" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated">例如，假设我们已经部署了一个模型，它给出了98%的准确率。但是7个月后，它的准确率下降到了60%。这可能是因为数据的变化。假设之前我们只获得白天的数据，由于该解决方案运行良好，用户决定也使用夜间数据。因为该模型不是用夜间数据训练的，所以它的准确性降低了。这是数据漂移的一个例子。</li></ul></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="1445" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一般来说，我们可以尽量少用样板代码。这可以通过使用一个框架来完成，而不是从头开始实现一切。例如，你可以使用<a class="ae it" href="https://www.pytorchlightning.ai/" rel="noopener ugc nofollow" target="_blank"> PyTorch Lightning </a>或者使用<a class="ae it" href="https://hydra.cc/" rel="noopener ugc nofollow" target="_blank"> Hydra </a>来配置系统，而不是在PyTorch中实现所有东西。</p><p id="35e4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">希望这篇文章对你有帮助。在<a class="ae it" href="https://www.linkedin.com/in/mandalsouvik/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上对我进行任何深度学习或计算机视觉讨论。</p><h2 id="e767" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">相关资源</h2><ul class=""><li id="a9ab" class="kn ko hh iw b ix kp jb kq jf kr jj ks jn kt jr lg kv kw kx bi translated"><a class="ae it" href="https://www.youtube.com/watch?v=06-AZXmwHjo" rel="noopener ugc nofollow" target="_blank">与Andrew就MLOps的对话:从以模型为中心到以数据为中心的人工智能</a></li><li id="d619" class="kn ko hh iw b ix lh jb li jf lj jj lk jn ll jr lg kv kw kx bi translated"><a class="ae it" href="https://mlops.toys/" rel="noopener ugc nofollow" target="_blank">简化机器学习工作流程的工具</a>。</li></ul><div class="ly lz ez fb ma mb"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hi fi z dy mg ea eb mh ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">medium.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp in mb"/></div></div></a></div></div></div>    
</body>
</html>