<html>
<head>
<title>Practical Transfer Learning with TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow的实用迁移学习</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/practical-transfer-learning-with-tensorflow-1f16bb9ac379?source=collection_archive---------11-----------------------#2022-05-22">https://medium.com/mlearning-ai/practical-transfer-learning-with-tensorflow-1f16bb9ac379?source=collection_archive---------11-----------------------#2022-05-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="41d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">是你的神经网络表现不好吗？您的计算资源有限吗？不用担心；还有希望！拿起你的咖啡，让我们去另一个冒险！=D</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/6f3e1ef931d6c8f4b9d5112c2f793dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lpMCuVukToDuZdJJ"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@santesson89?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrea De Santis</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f42a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">简介</strong></h1><p id="8470" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">今天，我将向您展示迁移学习如何帮助提高模型的质量，减少培训时间，并减少在CPU、GPU和TPU上的花费。所有这一切只需一个简单的实现！</p><p id="7d84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这怎么可能呢？</p><p id="10ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">转移学习</strong></p><p id="9b49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">迁移学习是重用已经训练好的模型并扩展它(用你自己的数据添加和训练最终的层)。</p><p id="d9c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了举例说明这个过程是如何工作的，让我们建立一个神经网络来对猫和狗进行分类。然后我们再用迁移学习创建第二个神经网络，就可以对比了！</p><h1 id="4033" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">开始！</h1><p id="940c" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated"><strong class="ig hi">首先要做的事情！</strong></p><p id="6f0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的第一步将是导入库并加载数据！我们将使用tensorflow_dataset库加载图像。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="8920" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们加载了猫和狗，元数据以及训练和验证(80-20)的划分。你可以在这里找到这个数据集<a class="ae js" href="https://www.tensorflow.org/datasets/catalog/cats_vs_dogs" rel="noopener ugc nofollow" target="_blank">，</a>以及其他几个。</p><p id="b6db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">处理数据</strong></p><p id="8a90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用迁移学习时，了解我们将要使用的模型的input_shape是至关重要的，这样我们就可以调整数据以适应神经网络。在这个猫和狗的数据集中，我们有不同大小的图像，我们要使用的模型要求图像的分辨率为224x224。</p><p id="63ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了使模型正常工作，像素值需要归一化[0，1]，而不是以标准方式[0，255]。</p><p id="bd43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建一个两者都做的函数！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="ab7c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好吧！现在让我们创建培训和验证批次！不要忘记应用预取，这将在处理当前数据的同时准备后续数据，从而减少训练所需的时间。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="64a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第一枪</strong></p><p id="73af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">那么，让我们建立我们的第一个神经网络吧！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="7a4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们有网络的总结！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ky"><img src="../Images/f68b9ced03a060c0d542b32c8a4cb2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*JVn0D4XoZa0R4e0ViVgZ-g.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Summary of the first model —Source: the author</figcaption></figure><p id="c443" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如你所看到的，我们有几层Conv和最大池对。卷积层负责在不同的输入图像区域应用过滤器(内核)。最大池减少了输入图像的大小(在这种情况下，从网格中选择最大值)。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kz"><img src="../Images/5a710acfca63fd13d763e4a3e45b2b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4v0d_cZIt01HHcaDqTutHg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Convolution and Max Pooling — Source: the author</figcaption></figure><p id="aecb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果这些概念仍然不清楚，我推荐<a class="ae js" href="https://towardsdatascience.com/a-comprehensive-guide-to-convolutional-neural-networks-the-eli5-way-3bd2b1164a53" rel="noopener" target="_blank">这篇文章</a>深入探讨卷积层和最大池。</p><p id="d1fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注:卷积x相关</strong></p><p id="f91d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们常说的卷积的运算，其实就是相关！这两个过程非常相似，不同之处在于，在卷积中，我们在将滤波器应用于图像之前将其旋转180°。如果你想进一步了解这种差异，可以查看<a class="ae js" href="https://towardsdatascience.com/convolution-vs-correlation-af868b6b4fb5" rel="noopener" target="_blank">这篇优秀的文章</a>(感谢纳赛尔·博安的推荐)。</p><p id="85f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好吧！现在是时候编译和训练我们的模型了！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="0b98" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该模型是用adam优化器、准确性和交叉熵编译的。我们将进行15个时期的训练！让我们看看结果！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es la"><img src="../Images/0a7bc892fcb8a3764c954ddc66719bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKiqNiuHLWVsUlAsDrpozg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Training of the first model — Source: the author</figcaption></figure><p id="1510" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，我们的模型在验证数据集中停滞在接近88%的准确率！我们能得到更好的结果吗？</p><p id="d3fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第二枪</strong></p><p id="987d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是转移学习的时候了！让我们选择一个已经在<a class="ae js" href="https://tfhub.dev/" rel="noopener ugc nofollow" target="_blank"> TensorFlow Hub网站</a>上训练过的模型吧！</p><p id="fc35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我为本文选择的是<a class="ae js" href="https://tfhub.dev/google/tf2-preview/mobilenet_v2/feature_vector/4" rel="noopener ugc nofollow" target="_blank"> MobileNet V2 </a>，一个轻量级的、移动优化的神经网络。还记得分辨率的标准224x224吗？您可以在每个型号的TensorFlow Hub页面上找到这些信息。</p><p id="c411" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一步是下载没有最终分类层(特征向量)的模型。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="ad89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下载完神经网络后，让我们冻结所有层(只训练最后一层)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="7b43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们构建模型，类似于我们之前所做的，但是现在使用feature_extractor。在这个例子中，我们只添加了输出层的特征向量，但你也可以添加其他层！(感谢加布里埃尔·卡西米罗指出这一点)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ky"><img src="../Images/aa31eaf9e0122b8f67a4561169437dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*7xViqTnjnAVuG9V_c-DPZQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Summary of the second model —Source: the author</figcaption></figure><p id="41c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，我们现在有了MobileNet网络和最后一个密集层！另外，请注意，这个网络的参数比前一个少。让我们编译模型，看看结果！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="546c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如你所见，我们将只训练3个纪元！而且只有最后一层！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lb"><img src="../Images/df472e4c5cd7bb5cf719f82dcbcdb779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3aIjXmXFDfKBql68MH-P6Q.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Training of the second model — Source: the author</figcaption></figure><p id="9f18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">哇！我们的神经网络在验证数据集中有98%的准确率！这就是迁移学习的力量！</p><p id="5715" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">保存并加载模型</strong></p><p id="2c67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以保存模型以备后用！让我们将其保存为HDF5 (.h5)格式，这将允许我们重新创建模型，即使我们无法访问创建它的代码！</p><p id="ee38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">值得注意的是，我们将要创建的. h5文件将包括模型架构、训练过程中学习到的权重、编译器传输的设置以及优化器状态(允许您从停止的地方继续)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="b13b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">看到多简单了吧？模型现在在选择的目录中！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="4975" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要加载模型，只需传递路径和custom_objects(告诉keras如何加载hub。KerasLayer)在tf.keras.models的load_model中！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="7774" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以用我们训练的最后一个模型做一些预测，用我们加载的这个模型，你会看到预测值之间不会有差别！上面打印的结果是0.0。</p><p id="db4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="1c4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在今天的旅程中，我们看到了迁移学习如何以更低的时间和硬件成本提供更好的预测能力的示例。如果你想看更多用图像迁移学习的例子，我推荐<a class="ae js" href="https://towardsdatascience.com/transfer-learning-with-vgg16-and-keras-50ea161580b4" rel="noopener" target="_blank">这篇文章</a>。</p><p id="0c9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在轮到你了！玩得开心！</p><p id="d151" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">那都是乡亲们！</strong></p><div class="lc ld ez fb le lf"><a href="https://github.com/JPedroBraganca/my-tensorflow-playground" rel="noopener  ugc nofollow" target="_blank"><div class="lg ab dw"><div class="lh ab li cl cj lj"><h2 class="bd hi fi z dy lk ea eb ll ed ef hg bi translated">GitHub-JPedroBraganca/my-tensor flow-游乐场</h2><div class="lm l"><h3 class="bd b fi z dy lk ea eb ll ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ln l"><p class="bd b fp z dy lk ea eb ll ed ef dx translated">github.com</p></div></div><div class="lo l"><div class="lp l lq lr ls lo lt jm lf"/></div></div></a></div><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lu"><img src="../Images/46d6c1394c263e7256f59a3591bd6cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JYyGj0amoVbboq9D"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@ninjason?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jason Leung</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class="lc ld ez fb le lf"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lg ab dw"><div class="lh ab li cl cj lj"><h2 class="bd hi fi z dy lk ea eb ll ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lm l"><h3 class="bd b fi z dy lk ea eb ll ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ln l"><p class="bd b fp z dy lk ea eb ll ed ef dx translated">medium.com</p></div></div><div class="lo l"><div class="lv l lq lr ls lo lt jm lf"/></div></div></a></div></div></div>    
</body>
</html>