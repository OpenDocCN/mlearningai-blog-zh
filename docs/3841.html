<html>
<head>
<title>YOLOv5 for segmentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于分段的YOLOv5</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/yolov5-for-segmentation-fab39c3487f6?source=collection_archive---------0-----------------------#2022-10-30">https://medium.com/mlearning-ai/yolov5-for-segmentation-fab39c3487f6?source=collection_archive---------0-----------------------#2022-10-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="65c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大家好！今天我要讲的是“如何训练YOLOv5进行分段”。</p><p id="72a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的故事由几个步骤组成:</p><ol class=""><li id="97e3" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">为分段准备数据集</li><li id="057a" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">在自定义数据集上训练YOLOv5</li><li id="5af8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">用YOLOv5推理</li></ol></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><ol class=""><li id="65dc" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">为分割准备数据集</strong></li></ol><p id="af09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一步，您需要以适当的格式准备数据集。这种格式与用于检测的YOLOv5格式非常相似。您需要创建如下所示的目录:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es jx"><img src="../Images/df5bb79fa93eb464f36e3e28a969be03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYZ4lr703m_wr39CC6rkFQ.png"/></div></div></figure><p id="2abd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面我们来看看<strong class="ig hi"> <em class="kj"> data.yaml </em> </strong>文件里面的内容。该文件的结构与检测任务的结构相同。其结构如下所示:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kk"><img src="../Images/cda61a234422a82d0d427f22cc757462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IlLT1Dg5VYYesICRWdW6pQ.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">The structure of <strong class="bd kp">data.yaml</strong> file</figcaption></figure><pre class="jy jz ka kb fd kq kr ks kt aw ku bi"><span id="e335" class="kv kw hh kr b fi kx ky l kz la"><strong class="kr hi">train</strong> - path to your train images<br/><strong class="kr hi">val</strong> - path to your validation images<br/><strong class="kr hi">nc</strong> - number of classes<br/><strong class="kr hi">names</strong> - сlass names</span></pre><p id="f87c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们来看看. txt文件的内部。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es lb"><img src="../Images/30a7d1cb580afa34a62ab34a0e09c44f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BETtQiunPTXsk1fsNSLBqg.png"/></div></div></figure><p id="b59f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个元素是“0”。这是班级的人数。接下来的值是多边形的x和y坐标。奇数元素是x，偶数元素是y。这些坐标被归一化为原始图像的大小。如果你想用这个多边形看一个图像，你应该使用下面的函数。第一个打开图像和标记文件，第二个显示图像和标记。</p><figure class="jy jz ka kb fd kc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="740c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码的结果如下所示:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es le"><img src="../Images/647a667e04907ee88433e2b0787e5cbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwtAC_DgcyYsI4s6MG76Eg.png"/></div></div></figure><p id="d8f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有些情况下，你没有多边形，但有二进制遮罩。拥有将二进制掩码转换为多边形的函数将非常有用。此类功能的一个示例如下所示:</p><figure class="jy jz ka kb fd kc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="c069" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上图的结果将是:</p><pre class="jy jz ka kb fd kq kr ks kt aw ku bi"><span id="f5bc" class="kv kw hh kr b fi kx ky l kz la">Number of points: <strong class="kr hi">1444</strong></span></pre><p id="9d62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中<strong class="ig hi"> 722 </strong>分别指向<strong class="ig hi"> x </strong>和<strong class="ig hi"> y </strong>坐标。</p><p id="930c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">原则上，我们可以继续在这方面训练模型，但我想给出另一个函数的例子，它允许您在将遮罩转换为多边形后减少获得的点数。当您不想用太多的点高亮显示一个对象时，这很有用。</p><figure class="jy jz ka kb fd kc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="54d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些函数不是我自己写的，而是在一个堆栈溢出讨论中找到的。这些函数的输出如下所示:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es lf"><img src="../Images/23310a406b1af62932b64e253463f680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24Zezqgx5zFyQHsOKuGrWA.png"/></div></div></figure><p id="8500" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">x和y分别有722个点。x和y分别变成了200分。</p><p id="d18a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">至此，我想结束这一章，继续训练模型。</p></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><p id="07ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2。在自定义数据集上训练yolov 5</strong></p><p id="65e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，您需要在控制台中遵循以下步骤:</p><pre class="jy jz ka kb fd kq kr ks kt aw ku bi"><span id="af84" class="kv kw hh kr b fi kx ky l kz la">1. git clone <a class="ae lg" href="https://github.com/ultralytics/yolov5.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ultralytics/yolov5.git</a><br/>2. pip install -r requirements.txt</span></pre><p id="029a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您将YOLOv5存储库克隆到您的计算机上并安装了所有必需的库之后，您就可以开始学习了。我用的是预训练模型。</p><pre class="jy jz ka kb fd kq kr ks kt aw ku bi"><span id="3058" class="kv kw hh kr b fi kx ky l kz la">python3 segment/train.py --data "/Users/vladislavefremov/Downloads/Instance_Segm_2/data.yaml" --weights yolov5s-seg.pt --img 640 --batch-size 2 --epochs 50</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es lh"><img src="../Images/be245fd42db2c86e6f65ac0b29c4ef28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBgnlYi0wYqtz8_JeRYLOQ.png"/></div></div></figure><p id="46fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">培训结束后，您可以在验证集上查看结果:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es li"><img src="../Images/0f588748345761d7da98dd5791724743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3uzYX49TWNrJ9TBq3CazA.jpeg"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Model predictions on validation.</figcaption></figure><p id="bf6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想了解更多关于YOLOv5的参数，你应该去官方知识库(<a class="ae lg" href="https://github.com/ultralytics/yolov5" rel="noopener ugc nofollow" target="_blank">https://github.com/ultralytics/yolov5</a>)或者阅读，比如这篇文章(<a class="ae lg" href="https://towardsdatascience.com/the-practical-guide-for-object-detection-with-yolov5-algorithm-74c04aac4843" rel="noopener" target="_blank">https://towards data science . com/the-practical-guide-for-object-detection-with-yolov 5-algorithm-74c 04 AAC 4843</a>)。</p></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><p id="03ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 3。用YOLOv5 </strong>进行推理</p><p id="24d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经训练了模型，现在我们可以从一张照片、一个包含照片的目录、一个视频、一个包含视频的目录等等中做出推断。</p><p id="b8eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们先对一个视频做个推断，看看最后的结果。</p><pre class="jy jz ka kb fd kq kr ks kt aw ku bi"><span id="dbfa" class="kv kw hh kr b fi kx ky l kz la">python3 segment/predict.py --weights "/home/user/Disk/Whales/weights/whale_3360/weights/best.pt" --source "/home/user/Disk/Whales/Video" --imgsz 1280 --name video_whale</span></pre><figure class="jy jz ka kb fd kc"><div class="bz dy l di"><div class="lj ld l"/></div></figure><p id="1c38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">推理后得到的标记是什么形式？多边形还将具有类别索引和绝对x和y坐标。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es lk"><img src="../Images/880849a2f46ea419467002063d786991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUCeY3_Zd1tnsNyxIh4vKA.png"/></div></div></figure></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><p id="01c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="d216" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们研究了如何为YOLOv5算法的分段准备数据。我们看了一些有用的函数，它们可以快速地将一个遮罩转换成一个多边形，反之亦然。我们看了一下如何训练YOLOv5算法，并在训练好的尺度上做出推断。</p><p id="8a3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用jupyter笔记本链接github:<a class="ae lg" href="https://github.com/Vlad188-1/YOLOv5_segmentation_medium_article" rel="noopener ugc nofollow" target="_blank">https://github . com/Vlad 188-1/yolov 5 _ segmentation _ medium _ article</a></p><div class="ll lm ez fb ln lo"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hi fi z dy lt ea eb lu ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">medium.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc kh lo"/></div></div></a></div></div></div>    
</body>
</html>