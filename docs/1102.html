<html>
<head>
<title>How To Build a Scalable Data Collection System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建可扩展的数据收集系统</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-build-a-scalable-data-collection-system-9703a2367735?source=collection_archive---------2-----------------------#2021-10-02">https://medium.com/mlearning-ai/how-to-build-a-scalable-data-collection-system-9703a2367735?source=collection_archive---------2-----------------------#2021-10-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="85f7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="f4f9" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">随着新技术在一个激动人心的创新时代的展开，收集数据对任何组织来说无疑都很重要。数据催生了分析洞察力和人工智能，而这些在其他情况下是很难实现的。</p><p id="73f0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">随着公司挖掘获取大数据的潜力，他们必须用最好的技术和设计技巧来染指。在这篇博客文章中，我将分享我多年来在构建多个爬行系统时作为系统设计师的经验。</p><p id="a1fb" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">那么什么是数据采集系统呢？</strong></p><p id="0207" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">数据收集系统是一种软件系统，可用于从互联网网站、存储系统、ftp和更多数据存储解决方案中收集非结构化数据，并将其提供给中央数据仓库。</p><p id="8abd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">本系统设计文档首先描述了可扩展数据收集系统的高级架构。然后重点介绍了web爬行系统的低级架构和伪代码，该系统可扩展到数千个数据源，每个数据源都有数百万页。</p><p id="331e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">作为一个系统的架构师，能够描述我们设计的范围和局限性是明智的。因此，在本文档结束时，我们应该能够拥有这样的系统的清晰体系结构，能够有效地收集、验证、流式传输、存储和分析所收集的数据。</p><h1 id="3c08" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">假设</h1><p id="edde" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">法律考量</strong></p><ul class=""><li id="8ab1" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">对于您设计的任何系统来说，考虑非法访问、使用和分发所采集的数据是很重要的。</li><li id="369c" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">特别是像检查每个网站的<strong class="je hi"> robot.txt </strong>这样的规定对这个项目来说非常重要。但是为了完成这项任务，让我们假设国际和国内的法律实践都适用。</li></ul><p id="b196" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">设计范围</strong></p><ul class=""><li id="8359" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">在设计系统时，良好的抽象层次解决了大量的问题，如开发成本、时间、系统性能、可扩展性和业务目标。</li><li id="b35f" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">这是为了支持从web(或任何数据源)中收集任何类型的数据，如果它实现了底层契约和模式定义的话。</li></ul><p id="d4f9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">用户体验</strong></p><ul class=""><li id="19e4" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">博客文章假设我们的数据被数据工程师使用，而不是最终用户，他们需要一个花哨的用户界面来访问数据。基于这个假设，没有面向用户界面开发的客户端。</li><li id="86a4" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">仅使用cloud️数据可视化解决方案来显示结果。这对数据分析师和科学家来说非常方便。</li></ul><p id="dd28" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">量表</strong></p><p id="a647" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们假设</p><ul class=""><li id="59c5" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">网站或数据源可能会更改</li><li id="c403" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">可以添加网站或数据源</li><li id="bcce" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">我们可能还想添加更多的数据源(网站)</li><li id="3b08" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">让我们假设数据源的规模是数千个，每个都有数百万页</li></ul><p id="d6b6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">基于这些假设，以下两个表预测了我们最终在带宽、存储、时间和硬件要求方面的复杂性水平。</p><p id="943c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们定义用于计算存储、带宽和时间的公式</p><h2 id="9e6c" class="kt if hh bd ig ku kv kw ik kx ky kz io jn la lb is jr lc ld iw jv le lf ja lg bi translated">估计</h2><p id="4554" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">假设您平均从每个数据源获取五个实体。只要遵循下面描述的数据定义，获取的数据并不重要。</p><p id="7d2a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我们有<strong class="je hi"> 5个实体</strong>将被存储到数据库，请查看下面的数据定义部分，以了解为什么考虑5个实体。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="7f08" class="kt if hh lm b fi lq lr l ls lt">psql&gt; desc entities (let's take one of the tables on database);</span><span id="d237" class="kt if hh lm b fi lu lr l ls lt">+-------------+----------+------+-----+---------+----------------+<br/>| Field       | Type     | Size |                                |<br/>+-------------+----------+------+-----+---------+----------------+<br/>| ID          | double   | 8 Byt|                                |<br/>| Name        | char(35) | 35Byt|     |         |                |<br/>| Address     | VARC(255)| 255  |     |         |                |<br/>| ........    | ........ |      |     |         |                |<br/>| ..........  | .......  |      |     |         |                |<br/>+-------------+----------+------+-----+---------+----------------+</span><span id="688b" class="kt if hh lm b fi lu lr l ls lt">let's take the average of the three columns  = (8+35 + 255)/3 ~ 100 bytes<br/>Single column takes average of 100 bytes. <br/>One RowSize = 10 columns * 100 bytes = 1000 bytes per row = 1k Bytes per a row</span></pre><p id="495b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果我们假设对每个爬行事件我们创建五个实体(数据库记录)</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="24cc" class="kt if hh lm b fi lq lr l ls lt">$DataBaseRowSize = NoOfRows * RowSize$</span><span id="b2f4" class="kt if hh lm b fi lu lr l ls lt">$DataBaseRowSize = 5 Records * 1k Bytes = 5k Bytes$</span></pre><p id="5d2d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">对于每次报废，我们有5个新闻实体，这意味着我们将需要5k字节。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="3165" class="kt if hh lm b fi lq lr l ls lt">$TotalTime = (NetworkLatency * NoOfRquests) /  (ConcurrencyLimit*NoOfServers)$</span></pre><p id="4247" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">就网络延迟而言，假设没有下载附加的多媒体文件(如pdf和图像),每个网络请求平均需要1.8秒。</p><p id="02d6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">基于上述假设，让我们来看看复杂程度</p><figure class="lh li lj lk fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lv"><img src="../Images/d862c562804c4c81a783d9f310ae15a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57k2DFVsWe_eL9ytkyXPNw.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx">estimation table</figcaption></figure><p id="2dc7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">根据我们预测的数字，如果我们有<strong class="je hi"> 20 </strong>台服务器，每台服务器可以请求<strong class="je hi"> 100个请求/秒</strong>，我们可以预期接收4 TB到20PB的<strong class="je hi">卷</strong>，持续时间范围为<strong class="je hi">单日</strong>到<strong class="je hi">年</strong>。由于依赖于不同的资源，这些数字可能总是在变化。例如并发级别和硬件基础设施。</p><p id="de3c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">它还假设被废弃的网站或数据源能够处理这种负载，这是不太可能的。因此，我们将为此进行权衡。</p><p id="9350" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">该假设的优点</strong></p><ul class=""><li id="e9b0" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">我们可以很容易地找出资源限制</li><li id="26a2" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">举例。如果我们使用一台服务器，即使在最好的情况下，我们也可能需要等待数月才能达到目标。</li><li id="442a" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">考虑多个数据源和数据源类型，而不是只对一个数据源进行约束</li><li id="d7b3" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">它使用并发和分布式计算，这是非常重要的</li></ul><p id="779e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">这个假设的缺点</strong></p><ul class=""><li id="6baa" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">不太可能在一天之内以如此高的并发量将所有这些请求发送到数据源网站。</li><li id="7b07" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">在现实生活中，我们可能希望改变IP地址，并且在废弃数据源之前随机等待，以避免过度破坏被废弃的网站。</li><li id="4488" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">因此，需要针对这些场景调整时间</li><li id="b1b3" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">假设不包括下载PDF等多媒体文件</li><li id="d1e1" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">一些假设的基础可能是错误的。举例。页面加载延迟/页面大小，但是您应该能够根据需要对其进行参数化和更新。</li></ul><h1 id="0715" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">高层建筑</h1><p id="6c0a" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">高级架构描述了在逻辑层中分组的块级组件。</p><p id="826a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如设计所示，每一层都在某种程度上处理数据，然后将其传递给下一层。高层次设计非常重要，因为它展示了组件如何交互，使您的基础架构对每个人都是透明的。</p><p id="bca1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">需要注意的是，每一层都是由单个/多个微服务组成的。在现实生活中，层之间的连接可能看起来有点不同</p><figure class="lh li lj lk fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mh"><img src="../Images/a8c6a8f5efb7e24967072983ba50456e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymBwiQNXNSIaY_bns3n2Rg.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx"><em class="mi">High level architecture drawing </em><a class="ae mj" href="https://miro.com/app/board/o9J_lCgtSGE=/" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://miro.com/app/board/o9J_lCgtSGE=/</em></a></figcaption></figure><h1 id="71b9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第1层—数据源</h1><p id="b974" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">将数据源抽象为它自己的微服务是很重要的，因为这是关键的系统需求之一。</p><p id="0d87" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为什么数据源的抽象很重要</p><ul class=""><li id="281f" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">如果想要添加更多的数据源。</li><li id="132e" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">如果我们把数据源改成CSV，S3甚至ftp会怎么样</li><li id="0ff4" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">独立于其他系统的开发和测试</li><li id="bc57" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">关注点的分离以及与其他系统接口的方便性</li><li id="a746" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">隐藏实现和细节</li></ul><p id="b6fa" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">抽象数据源层将给我们的系统一个下降的自由度，以适应未来可能的需求变化。此外，与整个系统分离的独立测试将非常容易。</p><p id="44a0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">根据需求和性能优化水平，我们可能需要存储数据源的关键元素。</p><p id="c582" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">那么样本数据源应该包含什么呢？</p><p id="2afc" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">你如何定义它？</strong></p><p id="0b5b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下是您如何详细指定</p><ul class=""><li id="ff69" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">类型—示例。网站，CSV，S3 …</li><li id="27e5" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">定义-将包括数据源的详细信息</li><li id="a2fe" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">根据数据源的类型，详细信息可能会有所不同。</li></ul><p id="12e6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">例如，让我们为<strong class="je hi">网站数据源</strong>定义一个样本定义</p><ul class=""><li id="c21e" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">网址→网站的网址</li><li id="3a0e" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">计划→覆盖系统计划</li><li id="a263" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">身份验证→存储凭据如果我们需要在抓取之前登录，</li><li id="36c9" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">字段和选择器→要清理的字段和HTML选择器清理时，配置主url和详细信息</li><li id="2a27" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">列表→页面上选项列表的选择器。我们想要废弃或收集的所有东西都将有html选择器配置</li><li id="06e2" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">字段和验证器→基于定义的验证方案的数据类型输入和输出的验证规则</li><li id="ce03" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">DNS →性能搜索的DNS解析设置</li><li id="18ba" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">状态→轻松启用或禁用信号源。</li></ul><h1 id="20f4" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第2层-数据收集</h1><p id="6950" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">数据收集系统将负责从数据源向数据处理器传输数据。这个系统处理外部系统，如网站和存储器。因此，在这个层面上实现并发和分布式计算非常重要。</p><p id="a3c6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">由于这一层是本文的核心部分，因此将在底层架构部分详细讨论。</p><p id="c9c6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">将在这一层执行的步骤有</p><ul class=""><li id="4d37" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">从已配置的数据源中读取</li><li id="6388" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">使用资源和队列调度来确定要爬网的数据源</li><li id="cedf" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">检查缓存和数据新鲜度</li><li id="793e" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">对配置的数据源中的数据进行爬网</li><li id="f48f" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">验证输入和输出。在这个阶段抛出的错误被记录到我们的监控系统中</li></ul><p id="6a4f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">一旦完成上述步骤，结果将通过管道传输到第3层的数据处理。</p><h1 id="81c7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第3层-数据处理</h1><p id="54a7" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这一层是关于数据转换的。我们希望将来自第2层爬虫的结果进行转换，以便以非常高的性能、高吞吐量和分布式的方式进行验证和处理。</p><p id="d669" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在此阶段，可以执行的几个主要流程是</p><ul class=""><li id="3cd7" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">数据验证对于保持<strong class="je hi">数据质量和完整性</strong>至关重要。在这个阶段抛出的错误被记录到我们的监控系统中。这将确保系统是否按计划运行。验证在管道的每个阶段完成。</li><li id="24e6" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">转换用预处理器定义的相关数据结构包装数据，并与作为上下文存在的数据相关联。</li><li id="1525" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">处理批量数据处理请求</li><li id="63dc" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">像NER、NLP这样的底层数据上的机器学习过程可以在这个阶段完成</li><li id="0ee4" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">存储到数据存储系统或交付到商业智能层</li></ul><p id="189c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为了让我们的解决方案有效地工作，在管道的每一步结束时都有一个数据验证阶段是非常重要的。</p><p id="25e2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为此，我们可以为每种数据类型设计验证方案。</p><p id="b452" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">举个例子。</strong></p><p id="526a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">实体的每个属性都应该用它的类型验证器来验证。我们还可以在需要时添加验证块</p><ul class=""><li id="cf23" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">日期验证器→用于不同的日期类型，如文件日期、浮点数、字符串等</li><li id="07b3" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">正则表达式验证器→用于匹配模式</li><li id="da75" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">唯一性验证器→确保数据在数据存储中是唯一的</li><li id="f6eb" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">新鲜度→确保数据是新鲜和最新的</li></ul><p id="e33d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这一层的技术选择相当容易。由于行业积累了非常有趣的选择。像<strong class="je hi"> Kafka、</strong> Apache Hadoop和Spark这样的工具在巨大的名气和社区支持下派上了用场。</p><h1 id="8b81" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第4层-存储</h1><p id="5198" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">存储数据对于应用程序的数据可访问性和组织级别的共享非常重要。</p><p id="814e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下面列出了我们系统的重要属性</p><ul class=""><li id="8cef" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">并发性—每秒写入数百万数据的高并发性</li><li id="8155" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">分布式—它们可以以分布式方式水平扩展</li><li id="2bc4" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">文档存储—灵活性和易用性，因为数据形状发生了变化</li><li id="73d8" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">速度—支持海量数据和高吞吐量</li></ul><p id="edd5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">像MongoDB和Cassandra这样的分布式数据存储最适合这种情况。</p><h1 id="5b2c" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第4层-数据查询、分析和监控层</h1><p id="91d0" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这个阶段，我们创建一个透明层，使应用程序数据访问更加容易。</p><p id="8a94" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">企业主可以与软件和数据工程师合作，快速开发工具并交付面向业务的决策。</p><p id="07e4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这部分回答了我们如何衡量我们的成功，可视化和查询我们的数据。</p><p id="4b68" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该层的建议工具列表如下</p><ul class=""><li id="f74e" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">使用Kibana进行日志记录、搜索和可视化的弹性搜索</li><li id="0aee" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">用于生成和共享报告的Data studio</li><li id="1d44" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">Grafana用于快速分析、警报和可视化</li></ul><p id="d4c4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">作为一名系统设计师，你需要留意可能出现的主要系统和业务问题。如果您使用以下关键指标设置监控系统，您可以充分利用上述工具。</p><ul class=""><li id="e1b6" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">当误差阈值超过某个数值时</li><li id="0c47" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">当系统在一定时间内无法运行时</li><li id="4272" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">当数据的形状不同并且验证不起作用时</li><li id="2417" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">网站报废时还禁止…</li><li id="26b3" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">当系统运行状况不佳或服务器停机时</li><li id="7a30" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">当出现错误并且监控服务关闭时</li><li id="67bf" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">当您一些系统关闭时</li></ul><p id="2cc0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">好了，现在你的房子里有了数据，你如何不断地改变它，移动和转换它。如何让您的数据模型文档保持最新？</p><p id="e162" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">别担心，DBT会支持你的。感谢我的同事费利克斯·维默，他把我介绍给了DBT，现在我可以像普通程序一样处理我的数据模型了。像DBT(数据构建工具)这样的工具非常适合对数据进行ETL。</p><p id="46ae" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您可以使用它将数据移动到Postgres DB，进行数据转换，或者通过构建模型的依赖图来记录您的数据模型。</p><p id="3c53" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">好了，现在你已经完成了数据处理和ETL，相应地存储了你的数据，然后是可视化的时候了。</p><h1 id="989f" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第5层-视觉层(用户界面层)</h1><p id="c467" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">一些基于云的工具，你可以快速设置你的数据可视化是Kibana，Grafana和Looker</p><p id="10eb" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">太棒了，现在你在这里，最酷的部分还在后面。</p><h1 id="27ae" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">数据收集层的低层体系结构</h1><p id="b612" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">很难为上面讨论的所有阶段做底层架构。为了这个职位，低层次架构高度集中在<strong class="je hi">数据收集层。</strong></p><figure class="lh li lj lk fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mk"><img src="../Images/d47dc6b5987c9ed45df12e3f547c84a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DwLSRIHNY7HxubY9cCfA1w.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx"><em class="mi">Low level architecture </em><a class="ae mj" href="https://miro.com/app/board/o9J_lCgtSGE=/" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://miro.com/app/board/o9J_lCgtSGE=/</em></a></figcaption></figure><p id="4d4d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们详细解释每个组件。</p><p id="1794" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该说明将讨论以下要点</p><ul class=""><li id="77ee" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">为什么数据收集组件很重要</li><li id="9417" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">它如何与其他系统通信</li><li id="e3cb" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">可能的设计瓶颈和建议</li><li id="3e67" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">更适合我们需求的工具</li></ul><h1 id="5e0d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">储存；储备</h1><p id="2e87" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">让我们深入了解存储组件是如何使用的，以及它如何适应体系结构。</p><p id="ead1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">随着系统的扩展，我们将针对不同的目的使用多种类型的存储系统。我们使用<strong class="je hi"> Redis </strong>进行快速查找缓存存储，并检查缓存中的URL是否与<strong class="je hi">重复</strong>。Postgres用于存储对我们的业务逻辑至关重要的关系实体。所有输入到<strong class="je hi">任务调度器</strong>的数据源都存储在<strong class="je hi"> postgres </strong>中。</p><p id="5c7b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">要存储来自我们的<strong class="je hi">消息代理的事件，Mongo DB </strong>是最合适的，因为它以高并发&amp;吞吐量分布。</p><p id="ad50" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此设计中存储系统的关键设计瓶颈<strong class="je hi">是数据处理和冗余。最好的例子之一是确保URL被提取一次，并且没有重复的项目被保存。</strong></p></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="d02a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为系统收集的每个数据精心设计实体识别(ID)技术也非常重要。url规范化和名称间距等技术以及对数据源结构的良好理解非常重要。还有其他瓶颈，如确保数据质量和完整性，这些主要由爬虫和消息代理服务来完成。最佳实践是将错误从消息代理传送到我们的监控系统，如图所示。这将为我们如何实现业务目标提供一个透明而高效的视图。</p><h1 id="374a" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">任务调度程序</h1><p id="68e8" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">任务调度器通过跟踪预定的后台cron工作负载和启动任务来发挥重要作用。</p><p id="952b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现阶段的瓶颈是保持工作负载<strong class="je hi">运行和可用资源</strong>的良好平衡。任务调度器将与<strong class="je hi">爬虫/数据收集</strong>服务通信，以调用调度的任务。</p><p id="7a70" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">举例。如果想要在每天的午夜运行计划任务来收集数据，我们可以像这样配置我们的调度程序<code class="du ms mt mu lm b">00 00 * * *</code></p><p id="e1a9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">有很多像AWS scheduler &amp; Active batch这样的工具来完成这样的任务。</p><h1 id="46d4" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">爬虫/数据收集</h1><p id="1253" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这是爬行系统中最重要的部分，所以我会深入解释。</p><p id="336f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该服务结合队列系统将负责与互联网通信，并根据下面定义的<strong class="je hi">数据源定义</strong>获取数据源。</p><figure class="lh li lj lk fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mv"><img src="../Images/344e21523fa789480c934350c957ed99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmTXpBmdCxYelM5BNN036w.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx"><em class="mi">Data collection system design drawing </em><a class="ae mj" href="https://miro.com/app/board/o9J_lCgtSGE=/" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://miro.com/app/board/o9J_lCgtSGE=/</em></a></figcaption></figure><p id="611a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们来看看这一层的主要组件。</p><p id="91e6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> DNS解析器</strong></p><p id="90fe" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">缓存最新的请求IP地址。这将通过减少DNS解析的往返行程来大大减少我们的网络爬虫的延迟。</p><p id="845d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">网址验证器</strong></p><ul class=""><li id="3184" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">这确保了url操作，如</li><li id="2b32" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">URL规范化和名称间距</li><li id="894e" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">基于过滤器和排除的<em class="mw">数据源定义</em></li><li id="965f" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">检查缓存和复制</li></ul><p id="f781" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">实体验证器</strong></p><p id="8db1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">处理每个数据源的实体及其属性的验证和转换。</p><p id="dfdf" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">记录器</strong></p><p id="38e7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">确保日志通过管道传输到监控服务，以便我们可以测量系统的健康状况和性能</p></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="9714" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现在，让我们看看通过访问互联网和获取html数据来完成长时间运行工作负载的核心部分。</p><p id="841e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">提取器</strong></p><p id="1509" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">向数据源发送http调用，并分析结果html文本。这是一个轻量级的scrapper，如果网站是服务器端渲染的话，应该尽可能地使用它。</p><p id="dfd2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">无头渲染</strong></p><p id="9b4e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Headless render将呈现数据源页面，就像在普通浏览器中呈现一样。这对于javascript密集型页面来说很好。</p><p id="8a90" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">由于渲染器和fetcher服务上运行的工作负载非常密集，资源可能有限。如体系结构所示，运行这些工作负载的机器可以被复制，这样系统可以以分布式方式更快地运行。</p><p id="fe5e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们深入研究fetcher的部分并进行渲染。</p><p id="9afa" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">主节点</strong>需要保持工作节点上的运行状况、并发级别和工作负载。例如，确保并发级别低于/高于某个限制。</p><p id="2cac" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">工人</strong>(显示了提取器和渲染器)，其主要目标也是读取<strong class="je hi">数据源定义</strong>并从互联网上获取。理想情况下，它不应该知道数据源。所有关于数据源的信息都应该通过如下所示的配置来传递。</p><p id="51b3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这一点至关重要，因为每次我们添加源代码时，只需要再添加一个这样的配置。然后，crawler服务知道如何基于定义的接口下载、解析和验证数据源定义中的每个字段。</p><p id="8973" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此阶段的关键瓶颈是</p><ul class=""><li id="9e66" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated"><strong class="je hi">分布式工作负载:</strong>可以使用分布式计算模式和微服务来解决</li><li id="e270" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi">存储和缓存:</strong>可以通过缓存技术来解决</li><li id="5c89" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi"> IP轮换</strong> : IP可以通过使用私有或云VPN技术进行路由</li><li id="51f7" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi">数据质量:</strong>可通过数据验证和处理技术解决</li><li id="6012" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi">监控</strong>:可以通过将错误和系统健康状态记录到监控系统中来解决</li></ul><p id="c0fd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在我们开始描述伪代码之前，让我们用一个简单的网站为演示创建一个示例数据源定义。</p><p id="ad88" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这将有助于我们可视化对数据源的期望。</p><p id="413c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在注释中解释了数据源定义的最重要的属性</p><p id="d41a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">数据源定义示例</strong></p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a55a" class="kt if hh lm b fi lq lr l ls lt">{<br/>   "name":"Name of your data source ",<br/>   "data_source_type":"website",<br/>   "source_urls":[<br/>      {<br/>         "name ":"Data source",<br/>         "section":"chicago",<br/>         "tags":"USA,chicago",<br/>         "url":"&lt;<a class="ae mj" href="https://www.newsbrain.io" rel="noopener ugc nofollow" target="_blank">https://www.newsbrain.io</a>&gt;"<br/>      }<br/>   ],<br/>   "authentication":{<br/>      "username":"${user}",<br/>      "password":"${pass}"<br/>   },<br/>   "crawler_type":"renderer",<br/>   "config":{<br/>      "config_type":"legal_option",<br/>      "list":{<br/>         "name":"legal_option_urls",<br/>         "selector":{<br/>            "value":"value"<br/>         },<br/>         "validator":{<br/>            "type":"regex",<br/>            "value":{<br/>               "regex":"*.newsbrain.ai/category/*",<br/>               "filter_list":[<br/>                  "*.newsbrain/options/chicago/*"<br/>               ]<br/>            }<br/>         }<br/>      },<br/>      "fields":[<br/>         {<br/>            "name":"ID",<br/>            "key":"id",<br/>            "selector":{<br/>               "value":"#id"<br/>            },<br/>            "validator":{<br/>               "type":"number"<br/>            }<br/>         },<br/>         {<br/>            "name":"Field Name",<br/>            "key":"name",<br/>            "selector":{<br/>               "value":"div.name"<br/>            },<br/>            "validator":{<br/>               "type":"string"<br/>            }<br/>         }<br/>      ]<br/>   }<br/>}</span></pre><p id="2a71" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们讨论一下关于数据源定义的一些关键要点</p><ul class=""><li id="cf56" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">数据源有一个名称，URL和一些你想作为上下文传递的元数据。现在，使用它的名字，很容易识别数据源。如果我们想添加更多的源，甚至在需要的时候配置部分和标签，这也是可能的</li><li id="0d85" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">数据源可能有嵌套的链接和页面。因此，对于这种情况，有一个管道一个接一个地获取是很好的。我们的数据源定义试图处理这种情况。首先是页面列表，然后从这些页面中获取字段/属性。在复杂的情况下，这应该是一个串联的管道。</li><li id="c86c" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">字段/属性也有名称、关键字、html选择器和验证方案。</li><li id="4b6a" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">重要的是要知道，crawler服务没有特定数据源的逻辑，但它只是支持任何数据源类型的通用接口。</li></ul><p id="db6b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">当前系统限制和可能的改进</strong></p><ul class=""><li id="d96d" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">目前，开发人员必须使用上述数据定义配置数据源。这可以是自动化的，使用用户界面，ML服务和网站元标签</li><li id="76c7" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">应该添加IP轮换和VPN</li><li id="d951" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">应该添加数据仓库以进行归档</li><li id="2d76" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">对于嵌套页面的复杂场景，Scrappers应该是流水线式的</li></ul><p id="2b23" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">词汇表</strong></p><ul class=""><li id="28eb" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated"><strong class="je hi">数据定义</strong>:用于定义传入<a class="ae mj" href="https://www.notion.so/How-To-Build-a-Scalable-Data-Collection-System-64501a771b994e8490856410cf7a191b" rel="noopener ugc nofollow" target="_blank">数据源</a>的对象/地图</li><li id="5320" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi">Crawler/scraper:</strong>可互换使用，表示从互联网获取数据的任务</li><li id="9eff" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated"><strong class="je hi">实体</strong>面向对象的方式表示业务逻辑的主要参与者。</li></ul><p id="eff4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">感谢您通读。非常感谢您的反馈。</p></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="e267" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果你觉得这个帖子有用，请给它竖起大拇指。</p><p id="b996" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">关于作者</strong></p><p id="e2f5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">本文作者为<a class="mx my ge" href="https://medium.com/u/590f8c2e9818?source=post_page-----9703a2367735--------------------------------" rel="noopener" target="_blank"> Dagm Fekadu </a>。</p><p id="6d9e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Dagm目前是一名高级软件工程师，在<a class="ae mj" href="https://priceloop.ai" rel="noopener ugc nofollow" target="_blank"> priceloop.ai </a>构建数据驱动的定价解决方案。他还是newsbrain.io的联合创始人兼首席技术官，该网站让你随时随地都能听到你最喜欢的文章。</p><p id="f7a9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在<a class="ae mj" href="https://www.linkedin.com/in/dagmfekadu/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</p><p id="49bd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">跟随Github </p><p id="4958" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">跟随<a class="ae mj" rel="noopener" href="/@dagmfekadu">介质</a></p></div></div>    
</body>
</html>