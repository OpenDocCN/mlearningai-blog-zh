<html>
<head>
<title>Linear Regression in Pyspark with Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark中带数据块的线性回归</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/linear-regression-in-pyspark-with-databricks-ba923d2ab156?source=collection_archive---------3-----------------------#2022-11-11">https://medium.com/mlearning-ai/linear-regression-in-pyspark-with-databricks-ba923d2ab156?source=collection_archive---------3-----------------------#2022-11-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/67d5a00b016ff5f782f5b75495ed23fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WT9HxlKOk6KajjhW"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8f55" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi js translated">大家好，</p><p id="2d2b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇文章中，让我们深入探讨如何在pyspark的数据砖中执行一个基本的线性回归任务。</p><blockquote class="kb kc kd"><p id="6565" class="iu iv ke iw b ix iy iz ja jb jc jd je kf jg jh ji kg jk jl jm kh jo jp jq jr ha bi translated">查看如何设置自己的databricks社区版进行实验。</p></blockquote><div class="ki kj ez fb kk kl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/how-to-use-data-bricks-community-edition-9b899a2c0f40"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hi fi z dy kq ea eb kr ed ef hg bi translated">如何使用数据砖社区版？</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">在这篇文章中，你将学习如何获得你的数据砖社区版！</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">medium.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz in kl"/></div></div></a></div><p id="0c1e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于这个实验，我使用了一个汽车价格预测数据集，数据可以从<a class="ae it" href="https://raw.githubusercontent.com/rohandawar/Databricks/main/data/CarPrice_Assignment.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><p id="8a69" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我已经下载了数据，并使用文件&gt;上传数据到DBFS和浏览数据集上传到数据块。</p><p id="ef9a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ke">问题陈述:</em> </strong>一家中国汽车公司吉利汽车渴望进入美国市场，在那里设立制造厂，在当地生产汽车，与美国和欧洲的同行竞争。他们与一家汽车咨询公司签订了合同，以了解汽车定价所依赖的因素。具体来说，他们希望了解影响美国市场汽车定价的因素，因为这些因素可能与中国市场非常不同。公司想知道:</p><ul class=""><li id="b9c1" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lf lg lh li bi translated">哪些变量在预测汽车价格时很重要？</li><li id="475f" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">根据各种市场调查，这家咨询公司收集了美国市场上不同类型汽车的大型数据集。</li><li id="cc49" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">你需要用可用的独立变量来模拟汽车的价格。它将被管理层用来理解价格是如何随自变量变化的。他们可以相应地操纵汽车的设计、商业策略等。以满足一定的价格水平。此外，该模型将是管理层了解新市场定价动态的好方法。</li></ul></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="10c5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请注意，在这篇文章中，我只会尝试建模的数据，请让我知道在回应，如果你想让我涵盖EDA以及。</p><ol class=""><li id="16de" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lv lg lh li bi translated">让我们从导入必要的库开始。(<em class="ke">我倾向于在单个单元中导入库，这有助于更好地理解代码</em>)。</li></ol><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for Importing the Libraries</figcaption></figure><p id="6875" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">2.让我们读取数据。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for reading the data</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/bb5a76802e8937ff84d1e51706a29924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2bhKBf29oYoLvDWbLtqGg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample Outut for display of the data</figcaption></figure><p id="9024" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">3.接下来，让我们看看数据的形状</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for checking the shape of the dataframe</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/fdbd73b220cac6c285f7f31db7de7b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17IAZ7-EQj3M84cSbIOboA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample output</figcaption></figure><p id="57e2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据集由206行和26列组成。</p><p id="59b5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">3.让我们检查空值，现在pyspark中没有直接的方法，就像在pandas中一样，但是找到了一个有趣的方法来找到空值，为此感谢google:)</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for checking the null values in a pyspark dataframe</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/783b1feb7a5d1c93c02c1b0b74d3c1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLvBJZdJWxbQeZhFlv-CCw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample output for NULL checking</figcaption></figure><p id="05ba" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，数据集是干净的，不存在空值。</p><p id="ddaf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">4.接下来是训练，测试分割，它将帮助我们保留一组看不见的数据，用于我们的评估目的。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for train &amp; test split</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/7fa246413a55c065f52442381a027137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yf404v1e9WjTb7eSJz9uUQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample output showing the shape of training &amp; testing dataframe</figcaption></figure><p id="0fff" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">5.让我们创建一些基线模型，通常使用平均值/中值，以检查我们的天真模型是否比它们更好。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for calculating the mean &amp; median Price &amp; adding the same as column</figcaption></figure><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for Calculating RMSE &amp; R2 for baseline models</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/520e6f1de23dad7041f84d68fc99a350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHp_xFa_besp3jdgk-AHzA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample evaluation metric for baseline model</figcaption></figure><p id="a79a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">基线RMSE非常大。</p><p id="fb68" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">6.通过快速浏览数据，我看到数据集由分类和数字列组成，因此我们将借助StingIndexer &amp; OneHotEncoding来处理分类特性。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for Pre-processing Categorical Variables</figcaption></figure><p id="b4cb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">6.我们需要提出的最后一个转换是VectorAssembler，因为spark ML期望特性a是vectors。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for Pre-processing (Vector Assembler)</figcaption></figure><blockquote class="kb kc kd"><p id="a5dd" class="iu iv ke iw b ix iy iz ja jb jc jd je kf jg jh ji kg jk jl jm kh jo jp jq jr ha bi translated">看看我对重要性转换的解释</p></blockquote><div class="ki kj ez fb kk kl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/one-transformation-we-cannot-model-without-in-pyspark-vectorassembler-a36f58f9ed3b"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hi fi z dy kq ea eb kr ed ef hg bi translated">Pyspark中不可或缺的一个转换——vector assembler</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">大家好！</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">medium.com</p></div></div><div class="ku l"><div class="mh l kw kx ky ku kz in kl"/></div></div></a></div><p id="7190" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">7.现在，我们都准备好开始建模了，在这个实验中，我决定使用管道，因为这将帮助我无缝转换测试数据。</p><p id="6311" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">8.为了设置管道，我首先定义我希望转换发生的阶段，作为最后一个阶段，我将添加线性回归模型。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for model initiation &amp; pipeline creation</figcaption></figure><p id="a2b7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">9.让我们根据训练数据训练模型，并保存模型以备将来使用。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for pipeline fit &amp; saving the model</figcaption></figure><p id="5006" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">10.让我们加载模型并转换训练/测试集，以便为训练集生成预测</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for loading the saved model &amp; performing transformations on train &amp; test data</figcaption></figure><p id="c302" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">11.它的评估时间，所以看起来我们的模型，从基线上表现得好一点，但仍然有改进的余地。</p><figure class="lw lx ly lz fd ii"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Code for evaluation for train &amp; test dataframes</figcaption></figure><figure class="lw lx ly lz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/e68fdc700d7213f2e7d13a9916e44dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbcyuC7jhmzut5cThSnqqQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample output for RMSE from training &amp; test dataframes</figcaption></figure><p id="3cd2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个实验的整个笔记本可以在我的github <a class="ae it" href="https://github.com/rohandawar/Databricks" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="aef6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="ke">敬请关注更多此类内容！下一集再见！！快乐学习！如果你喜欢，你读什么关注我</em> <a class="ae it" href="https://www.linkedin.com/in/rohandawar/" rel="noopener ugc nofollow" target="_blank"> <em class="ke"> linkedIN </em> </a></p><p id="964f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">参考资料:</p><ul class=""><li id="b2dc" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lf lg lh li bi translated"><a class="ae it" href="https://spark.apache.org/docs/3.1.3/api/python/reference/api/pyspark.ml.feature.VectorAssembler.html" rel="noopener ugc nofollow" target="_blank">矢量装配器</a>的文档</li><li id="88b7" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><a class="ae it" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.StringIndexer.html" rel="noopener ugc nofollow" target="_blank"> StringIndexer </a>的文档</li><li id="3ff9" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><a class="ae it" href="https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.ml.feature.OneHotEncoder.html" rel="noopener ugc nofollow" target="_blank"> OneHotEncoding </a>的文档</li><li id="d06a" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><a class="ae it" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.evaluation.RegressionEvaluator.html" rel="noopener ugc nofollow" target="_blank">回归评估器</a>的文档</li><li id="3c22" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><a class="ae it" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.regression.LinearRegression.html" rel="noopener ugc nofollow" target="_blank">线性回归</a>的文档</li></ul><div class="ki kj ez fb kk kl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hi fi z dy kq ea eb kr ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">medium.com</p></div></div><div class="ku l"><div class="mj l kw kx ky ku kz in kl"/></div></div></a></div></div></div>    
</body>
</html>