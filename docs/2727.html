<html>
<head>
<title>How to setup up LSTM in Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Tensorflow中设置LSTM</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-setup-up-lstm-in-tensorflow-10a569771965?source=collection_archive---------2-----------------------#2022-06-04">https://medium.com/mlearning-ai/how-to-setup-up-lstm-in-tensorflow-10a569771965?source=collection_archive---------2-----------------------#2022-06-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1537" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">理解LSTM模型如何工作的理论步骤可能具有挑战性，但Tensorflow中可用的工具有助于设置LSTM。我发现X_train和Y_train矩阵的符号和预处理有点棘手，因此我想在一篇简短的博文中概述一下这些步骤。</p><p id="5852" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">LSTM是一种有趣的算法，用于预测时间序列中的下一个点，或者时间序列中的下一个点或一组点是否与某个类别相关联。例如，在预测下一个点或几个点很重要的金融预测中，可能希望使用LSTM，将return_sequence设置为True以用于特定的观察窗口。或者，对于像心理学、神经科学和人类活动识别(HAR)这样的领域，在一段时间内收集数据，通常称为试验，以便可以预测每次试验的行为，可能需要使用LSTM，将return_sequence设置为False，用于特定的观察窗口。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/841a4b18e398f881ae4de91bc6bb835d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_85wz2dnB0R7UqBPsX17wA.png"/></div></div></figure><h1 id="7a39" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">加载数据</h1><p id="3b43" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我使用了Tensorflow教程中使用的相同数据集，该教程位于:<a class="ae kr" href="https://www.tensorflow.org/tutorials/structured_data/time_series#setup" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tutorials/structured _ data/time _ series # setup</a>。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ku"><img src="../Images/2d8fe546d82256e9f057418d8806c7e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLkwybuIeaCxbUrEDKgXaQ.png"/></div></div></figure><h1 id="1479" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">加载子功能</h1><p id="47e8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">参见github页面(【https://github.com/j622amilah/LSTM】T2)访问四个主要的子功能:unsupervised _ lab _ k means _ clustering、create _ X _ batch _ time steps _ feature、binarize _ Y1Dvec _ 2 _ Ybin和LSTM_arch。</p><h1 id="35a2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">预测示例</h1><p id="4919" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在这里，我们使用函数input return_sequences = True来获得每个批处理的每个时间步长的输出。下面我们首先分配X和y矩阵，从DataFrame (T (degC))中的温度列创建一个y标签。使用kmeans，我们可以创建一个包含两个或更多类的y标签。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="7989" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在图中，我们可以看到，也许3个类捕获了温度数据的波动，因此让我们选择3个类作为示例。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kv"><img src="../Images/122108f98ab6654b4f6177d8107728d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*z6swO5XyrQyQh567lHw7zQ.png"/></div></figure><p id="cba4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，将X和y_class3矩阵分成训练和测试集数据。然后把y向量做成二值化矩阵，使每一列对应一个类；我发现当y被二进制化时，更容易跟踪y的大小。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kw"><img src="../Images/cb17314dec2e0e4513accca9457f3629.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*k_icM0JdQBjZDsrJBmA66g.png"/></div></figure><p id="d637" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，让我们指定批次大小窗口，并折叠每个批次的数据。我将input_width = 24指定为批处理大小窗口，时间周期可能为24小时。此外，我指定return_sequence = True来告诉LSTM模型，我们需要在每个时间步长进行预测。n_a =32个单位表示每个LSTM单元具有隐藏状态和32个值的输出大小。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kx"><img src="../Images/d27a964a6c6aaf5c3c89684b99bad75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LXGdcRkux9BbqUgLNr2aNw.png"/></div></div></figure><p id="dbab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如图所示，隐藏/单元存储器状态用c表示，激活/输出用a表示，n_a对于调整很重要，因为输入到输出的映射会影响预测。请注意，a和c是size (n_a，batch，feature ), X的每个输入列是size (batch，1，feature ),因此每个时间步长的特征值都映射到n_a值。最后，时间步长的数量表示所需的LSTM单元的数量，我们可以在每个时间步长输出一个预测，或者继续将a和c传递给下一个LSTM单元，并在最后输出一个预测(基于所有批处理数据)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ky"><img src="../Images/37bf2114dcdfd033a84bd11b85fe1505.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*Ose1Vc8XgxOSIOlGALp2Bg.png"/></div></figure><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kz"><img src="../Images/5def2467b0b89efd3172acfd22ed3ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pd_tQdM0ilzaPaQIMVbG_A.png"/></div></div></figure><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es la"><img src="../Images/1b613333ced0b9ee0d2798343a1ebcb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*zf1h038jxGsYj0u9PL_Z_Q.png"/></div></figure><h1 id="c7a1" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">测试模型</h1><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lb"><img src="../Images/696e712b9324c65d7dfa8f36308ccc53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CR-uWQCW7o7wTOGFRFn2XQ.png"/></div></div></figure><h1 id="5bf6" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">画出一些预测</h1><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es la"><img src="../Images/259db34a61240ec936373dd7d590a2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*c87frE8DinXA9P6byFqYRg.png"/></div></figure><p id="5205" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">LSTM模型可以以91%的准确率预测测试数据集中的每个时间步长，这太棒了！查看上图，我们可以看到，对于批次194，由y_hat表示的LSTM在24个时间步中出现了两个错误。</p><p id="5010" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">既然我们知道了如何预测一个批次中的每个时间步长，那么让我们只预测每个批次中的一个点。</p><h1 id="0f49" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">HAR/审判实例</h1><p id="29fe" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">正如我前面提到的，大多数想要预测一段时间内行为的人通常对获得整批行为的一个预测感兴趣，因为行为是一个取决于许多连续时间点的因果事件。</p><p id="d546" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们继续这3个类，并设置return_sequences = False。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lc"><img src="../Images/9092c75249f43648fc6ede6a67232690.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*gH5Kyx62kDjkbKNyZA6b3w.png"/></div></figure><p id="0dfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，唯一改变的变量是yout，return_sequence=False的大小是(batch，n_outputs)。但是，对于return_sequence=True以上，yout的大小为(batch，timesteps，n_outputs)。让我们使用更多的历元再次运行模型，以便获得更好的准确性。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ld"><img src="../Images/39e95ccd5d6b2034851d93a0bad25685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJzhnOQJkCUjoBaNu7G25w.png"/></div></div></figure><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es le"><img src="../Images/c1dee62b0ed7a4efb0630a8969d61269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PkvCYdak-aPGdvXJwVdRA.png"/></div></div></figure><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lf"><img src="../Images/3ef0585ccbe18478ec9372cca7e6796a.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*GUzbg8PHiFH_8U3zk5DH8Q.png"/></div></figure><p id="a2df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上图中，我们可以看到每批LSTM的预测。如果我们为超过200个时期训练模型，LSTM可以预测得更好。我希望LSTM的这个解释是有帮助的和清楚的。</p><p id="e780" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">练习愉快！</p><div class="lg lh ez fb li lj"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hi fi z dy lo ea eb lp ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx jm lj"/></div></div></a></div></div></div>    
</body>
</html>