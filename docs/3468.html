<html>
<head>
<title>Building a Customer Firewall Archive Analyzer in AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS中构建客户防火墙档案分析器</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-a-customer-firewall-archive-analyzer-in-aws-47da1fbf3c97?source=collection_archive---------9-----------------------#2022-09-06">https://medium.com/mlearning-ai/building-a-customer-firewall-archive-analyzer-in-aws-47da1fbf3c97?source=collection_archive---------9-----------------------#2022-09-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f81e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对一个<em class="jc">接近</em>的专有解决方案拥有完整的粒度</p><p id="7a77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加入一家初创企业的经历与众不同——令人害怕、兴奋、困惑——但最重要的是——这是一个绝佳的学习机会。</p><p id="f63b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在任何工作中，能够控制自己或快速适应都是一个巨大的优势，没有什么比创业生活更能教会你这一点了。</p><p id="2fc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">幸运的是，在我第五次创业时，我抓到了一只<a class="ae jd" href="https://en.wikipedia.org/wiki/Black_swan_theory" rel="noopener ugc nofollow" target="_blank">黑天鹅</a>；一家在3个月内从3名员工发展到250人的公司。从我们机器的秘密制造到全球生产，该产品开始像野火一样迅速发展。</p><p id="17a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在一个投资组合下为4家不同的公司担任AWS云架构师。同一所有者下的4家公司，都有各自的安全问题。</p><p id="e939" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为唯一一名负责远程保护10个仓库的全职开发人员，在管理这种安全状况的同时还要执行日常功能请求和更新AWS架构，这是一项艰巨的任务。</p><p id="dafc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以我开始想出一个冗余的解决方案…</p><p id="60b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">我们将要使用的服务:</strong></p><ul class=""><li id="5729" class="je jf hh ig b ih ii il im ip jg it jh ix ji jb jj jk jl jm bi translated">Fargate集群(EC2实例)—使用<a class="ae jd" href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/Fireware/firebox_cloud/deploy_aws.html" rel="noopener ugc nofollow" target="_blank">定制维度服务器映像</a> AMI</li><li id="150c" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">S3存储桶—具有各种存储类别(标准、冰川)和生命周期策略</li><li id="eaf2" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">AWS Lambda —解压缩文件夹并将日志文件夹放入标准存储中</li><li id="6d32" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">AWS Sagemaker — IP insights算法</li></ul><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/a82c3d3617f5c548c37dfca58d8901d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaZl79zRQ7fRkRFR90cdxQ.png"/></div></div></figure><p id="3787" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">数据收集:</strong></p><p id="cc6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有内部安全解决方案；一个小型的校园防火墙。它每天输出3 GB的防火墙日志数据。有9个这样的Watchguard设备——用于德克萨斯州的9个不同的仓库。</p><p id="8429" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着一天要处理大约27 GB的数据。</p><p id="d948" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我看到了通过构建机器学习解决方案来改善德克萨斯州范围内的安全状况的机会。</p><p id="67f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我创建了一个Fargate EC2实例，作为所有WatchGuard防火墙的所有日志的中央存储库。来自休斯顿仓库、拉伯克、埃尔帕索和得克萨斯州所有办公室的日志都将出现，所有这些都采用相同的格式(。TSV) &amp;拉上拉链。</p><p id="406c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">存储:</strong></p><p id="c91d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我确定WatchGuard设备内部的数据保留期为一周。一周后，日志被删除。但是，在创建日志时，它们会自动发送到S3存储桶进行保留。日志将在标准对象类中随时可用7天，直到它们被移动到Glacier。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ke"><img src="../Images/1933ddda851a02ed07cb3464cc481030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhQ4MyeNQGTCcqzNBYfvrw.png"/></div></div></figure><p id="21df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据“上传”请求，lambda函数复制日志(在数据保留桶中保留一份副本)，解压缩文件夹，准备数据(即从TSV转换为CSV)，然后随后将数据存放到另一个S3桶中。这个新桶是训练桶，具有为IP Insights算法准备的数据。</p><p id="fb1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">训练/建模:</strong></p><p id="242e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择了一个p 3.2x大型实例来运行培训作业。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kf"><img src="../Images/b854c269daf09cc3a0f2ab4d7a32cdeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVDGg81sh5AB6iIDxdcSzw.png"/></div></div></figure><p id="24cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在运行了指定的epochs数(20)之后，我能够配置一个Sagemaker推断端点。</p><p id="c5f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在检查验证指标和运行恶意流量注入后，推理端点已经可用，我们可以测试控制(Watchguard设备)和我们新训练的Sagemaker端点。</p><p id="bc45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的Sagemaker端点和机器学习解决方案的目标是看看我们是否可以消除仓库内SSID入侵和“虚假入侵者”用户设备存在的误报(通过异常分数)。</p><p id="fd20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">分析:</strong></p><p id="723f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">令人惊讶的是，Watchguard防火墙产生了误报，而模型却没有。WatchGuard防火墙会将自己的SSIDs标记为恶意入侵。一旦我们分析了模型和我们自己的WatchGuard UI之间的差异，我们就能够将警告降级为误报。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kg"><img src="../Images/79bf72aa33dc6eed4ab38c1ea1d266fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/1*IYjnLsCx2ZisDgl0BxSDkw.gif"/></div></figure><p id="514c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这本来是一个概念验证，但是，它最终变成了一个需要关键安全洞察力的it团队的宝贵资产。</p><p id="cc6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">也就是说，这是解决冗余的可行方法吗？</p><p id="188d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不，这就是为什么我称之为“黑天鹅”事件。</p><p id="048c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">可供选择的改进方案？</strong></p><p id="8b76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">雅典娜搜索</strong></p><p id="71d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用Athena Search——一种无服务器查询交互工具，而不是构建这个需要大量计算实例的系统。只要日志的格式可读，我们就能够搜索它们。</p><p id="f8ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这样，我们可以使用Watchguard技术和防火墙日志作为事实的来源，并使用Athena查询服务来搜索潜在的恶意IP。</p><p id="3ca1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>我仍然不会在这里使用AWS胶水，因为<a class="ae jd" href="https://stackoverflow.com/questions/48953777/decompress-a-zip-file-in-aws-glue" rel="noopener ugc nofollow" target="_blank">解压缩执行时间非常长</a></p><p id="b541" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">冰川选择</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kh"><img src="../Images/750d7ec441491daba1fef4716b15e47b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRswMRLH2twfj9jH729vCA.png"/></div></div></figure><p id="654d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用<a class="ae jd" href="https://aws.amazon.com/blogs/aws/s3-glacier-select/" rel="noopener ugc nofollow" target="_blank"> Glacier Select </a>简单地查询S3存储桶中我们需要的对象，即使它们在“冻结”对象类中，而不是挖掘整个文件并支付快速检索的成本。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ki"><img src="../Images/89ef68670ff3e8e416b50359d0643e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBp2wcNn8v7xrj26cOfyKQ.png"/></div></div></figure><p id="ecee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于不同的用例，我们可以使用Glacier Select或Athena Search</p><ul class=""><li id="f345" class="je jf hh ig b ih ii il im ip jg it jh ix ji jb jj jk jl jm bi translated"><strong class="ig hi">如果</strong>文件在标准对象存储器<strong class="ig hi">中，使用</strong> Athena搜索</li><li id="71ea" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated"><strong class="ig hi">如果</strong>文件在冰川对象存储器<strong class="ig hi">中，使用</strong>冰川选择</li></ul><p id="f11c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">❓有问题吗？技术还是其他？——<a class="ae jd" href="mailto:matthewduke0@gmail.com" rel="noopener ugc nofollow" target="_blank">Matthewduke0@gmail.com</a>❓</p><div class="kj kk ez fb kl km"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">medium.com</p></div></div><div class="kv l"><div class="kw l kx ky kz kv la kc km"/></div></div></a></div></div></div>    
</body>
</html>