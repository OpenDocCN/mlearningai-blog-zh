<html>
<head>
<title>Pytorch &amp; C++ #5: Serving Torchvision Models in C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pytorch &amp; C++ #5:用C++服务Torchvision模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/pytorch-c-5-serving-torchvision-models-in-c-a944156bc189?source=collection_archive---------2-----------------------#2022-10-01">https://medium.com/mlearning-ai/pytorch-c-5-serving-torchvision-models-in-c-a944156bc189?source=collection_archive---------2-----------------------#2022-10-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2df193ef8fcb85dc3308b62b246c4add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCzSulsaZvXvQktwYMRTPw.png"/></div></div></figure><h1 id="a90c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="301f" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我试图在这个系列中提供Pytorch c++ API的例子/实践/项目。如果你是这个系列的新手，你可以在潜水前查看第一篇博客。在这个故事中，我们将使用C++来服务Alexnet，这是我们在之前的博客中使用的。为经过训练的深度学习模型服务也很重要，所以我认为这个博客会帮助你最终完成你的深度学习项目。所有代码都可以在<a class="ae kl" href="https://github.com/EmreOzkose/pytorch_cpp" rel="noopener ugc nofollow" target="_blank">这个Github repo </a>中找到。</p><h1 id="96c7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">内容</h1><ol class=""><li id="ed8c" class="km kn hh jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">以前的博客</li><li id="3b17" class="km kn hh jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">写入服务器</li><li id="c756" class="km kn hh jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">编写客户端</li><li id="efc1" class="km kn hh jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">运行示例</li></ol><h1 id="d8f0" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">以前的博客</h1><p id="fbd3" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><a class="ae kl" rel="noopener" href="/mlearning-ai/pytorch-c-4-using-torchvision-models-f12bd25f4744">在之前的博客</a>中，我们在Python中用Jit格式导出了Alexnet，并在C++中用来推断一个蜜蜂形象。我们获得了一个程序，它采用一个图像路径，并根据Imagenet类预测这是什么。</p><h1 id="c96c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">计算机网络服务器</h1><p id="771c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">因为我们试图预测给定图像的类别，所以我们应该将图像数据从客户端发送到服务器。我使用<a class="ae kl" href="https://github.com/Dayof/opencv-socket" rel="noopener ugc nofollow" target="_blank">这个repo </a>作为发送和接收图像的模板。这是非常有用和基本的。首先，我们应该创建一个服务器对象</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="35a2" class="pw-post-body-paragraph jn jo hh jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ha bi translated">我们将创建一个服务器对象并等待图像。</p><pre class="la lb lc ld fd ll lm ln lo aw lp bi"><span id="fa52" class="lq iq hh lm b fi lr ls l lt lu">auto server = SERVER();<br/>auto img = server.receive_img(false);</span></pre><p id="d03f" class="pw-post-body-paragraph jn jo hh jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ha bi translated">函数receive_img()获取一个原始图像，该图像在Alexnet转发之前应进行预处理。因此，我们将使用一个函数将接收到的图像转换为张量，并应用预处理。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="c88e" class="pw-post-body-paragraph jn jo hh jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ha bi translated">之后，我们的输入被读取并提供给模型。</p><pre class="la lb lc ld fd ll lm ln lo aw lp bi"><span id="a402" class="lq iq hh lm b fi lr ls l lt lu">auto img_tensor = Mat2Tensor(img);</span></pre><h1 id="3e7f" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">客户</h1><p id="c2a8" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">现在，我们将把我们的客户机定义为类似于服务器结构。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="d7a8" class="pw-post-body-paragraph jn jo hh jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ha bi translated">现在，我们可以读取一个图像，并将其发送到服务器，如下所示</p><pre class="la lb lc ld fd ll lm ln lo aw lp bi"><span id="17e3" class="lq iq hh lm b fi lr ls l lt lu">cv::Mat image = cv::imread(image_path);<br/>cv::resize(image, image, cv::Size( IM_WIDTH , IM_HEIGHT ));</span><span id="5e55" class="lq iq hh lm b fi lv ls l lt lu">client.send_image(image);</span></pre><h1 id="0682" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">运行示例</h1><figure class="la lb lc ld fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/14dfcfd2c78d629e9089223961642b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VkqFObY9WALUts3yrJ-5xg.jpeg"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">Image source: <a class="ae kl" href="https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html" rel="noopener ugc nofollow" target="_blank">https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html</a></figcaption></figure><p id="7a6e" class="pw-post-body-paragraph jn jo hh jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ha bi translated">在<code class="du mb mc md lm b">server.cpp</code>中，我们应该定义我们的模型并等待接收图像。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd ll lm ln lo aw lp bi"><span id="9ab5" class="lq iq hh lm b fi lr ls l lt lu">Prediction: bee</span></pre><h1 id="77ce" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="27cd" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在这篇博客中，我们创建了服务器和客户端脚本，以使用我们导出的深度学习模型。所有代码都可以在<a class="ae kl" href="https://github.com/EmreOzkose/pytorch_cpp" rel="noopener ugc nofollow" target="_blank">这个Github Repo </a>中找到。</p><div class="me mf ez fb mg mh"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hi fi z dy mm ea eb mn ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv in mh"/></div></div></a></div></div></div>    
</body>
</html>