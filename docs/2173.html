<html>
<head>
<title>CRISP-DM Methodology With Python (Model Deployment Using Flask Included) | Classification Case Study</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的CRISP-DM方法(包括使用Flask的模型部署)|分类案例研究</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/crisp-dm-methodology-with-python-model-deployment-using-flask-included-classification-case-33b9e184f4e7?source=collection_archive---------0-----------------------#2022-03-19">https://medium.com/mlearning-ai/crisp-dm-methodology-with-python-model-deployment-using-flask-included-classification-case-33b9e184f4e7?source=collection_archive---------0-----------------------#2022-03-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8e8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">跨行业数据挖掘标准流程(CRISP-DM)方法由6个阶段组成，包括业务理解、数据准备和解释性数据分析(EDA)、建模、评估、部署以及维护和监控。出于这个案例研究的目的，我将使用来自Kaggle的<a class="ae jc" href="https://www.kaggle.com/prachi13/customer-analytics" rel="noopener ugc nofollow" target="_blank">电子商务运输数据</a>。🚢</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9246d01871e9d16db29a4d6f3814b072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IKa5ydZOTvCjHLggVgY9w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Source: <a class="ae jc" href="https://www.pexels.com/photo/photography-of-ship-799091/" rel="noopener ugc nofollow" target="_blank">Pexels@Martin Damboldt</a></figcaption></figure><p id="0ac9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第一阶段:业务理解🐣</strong></p><p id="aa4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们开始分析过程之前，我们需要设定SMART(具体的、可测量的、可操作的、以结果为导向的、有时限的)目标。一个<strong class="ig hi"> </strong> SMART目标可以让我们理解从商业角度判断项目成功的标准。🎯</p><p id="5601" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于本案例研究，主要目标是通过识别和减少延迟发货，在3个月内将客户流失率(客户转向竞争对手的比率)降低5%。相关的业务问题可能是<em class="jt">“客户的询问得到回答了吗？”</em>、<em class="jt">“客户评价如何？产品是否按时交付？”</em>或<em class="jt">“如果产品重要性高，产品是否按时交付？”。</em></p><p id="3759" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了使我们的目标成为现实，我们需要一个描述必要步骤的<strong class="ig hi">项目计划</strong>、约束<strong class="ig hi"/>(例如，适用于建模的数据集的大小)、截止日期、可能导致项目延迟或失败的风险/事件，以及相应的应急计划。</p><p id="9683" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第二阶段:数据准备/解释性数据分析(EDA)📈</strong></p><ul class=""><li id="5939" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">从<a class="ae jc" href="https://www.kaggle.com/prachi13/customer-analytics" rel="noopener ugc nofollow" target="_blank">电子商务运输数据</a>下载数据集，并将其保存在您的本地电脑上。打开Jupyter笔记本，导入所需的库。要加载数据集，您需要右键单击下载的CSV文件，选择“复制”，然后粘贴代码的路径。记住在将普通字符串转换为原始字符串的路径前加上<code class="du kd ke kf kg b">r</code>。否则，您可能会得到Unicode错误。</li></ul><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="4b1a" class="kl km hh kg b fi kn ko l kp kq">import numpy as np <em class="jt"># linear algebra</em><br/>import pandas as pd <em class="jt"># data processing<br/></em>import matplotlib.pyplot as plt<br/>%matplotlib inline<br/>import seaborn as sns</span><span id="7b58" class="kl km hh kg b fi kr ko l kp kq">ecomm = pd.read_csv(r"C:\Users\User\Desktop\Data Science\Kaggle Data\ecomm.csv")</span></pre><ul class=""><li id="5c9a" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">为了对数据有一些基本的了解，我们可以使用<code class="du kd ke kf kg b"><a class="ae jc" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.describe.htmlhttps://pandas.pydata.org/docs/reference/api/pandas.DataFrame.describe.html" rel="noopener ugc nofollow" target="_blank">DataFrame.describe()</a></code>函数。默认情况下，该函数返回数值变量的描述性统计数据。然而，我们可以通过将<code class="du kd ke kf kg b">include=’object’</code>作为参数来找出对象的信息。(很酷吧？😎)</li></ul><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="cd36" class="kl km hh kg b fi kn ko l kp kq">ecomm[['Customer_care_calls','Customer_rating', 'Cost_of_the_Product','Prior_purchases','Discount_offered', 'Weight_in_gms']].describe()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/1ab39ddd4bb8ea314d413737b487cb48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyfwkhPxch_KsR1337BQig.png"/></div></div></figure><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="7f7b" class="kl km hh kg b fi kn ko l kp kq">ecomm.describe(include='object')</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/4161033bb9d7558f4596cdac3f7d4d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*O92K7XilGGGeMI1nwh-0Nw.png"/></div></figure><ul class=""><li id="aa8f" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">下面是结果<code class="du kd ke kf kg b"><a class="ae jc" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.info.html" rel="noopener ugc nofollow" target="_blank">Dataframe.info()</a></code>，它显示电子商务运输数据包含12列和10，999行。8列数据是整数形式，而其余的是字符串形式。我们还可以得出结论，数据的任何列中都没有缺失值(数据集的所有列都为10，999非空)。</li></ul><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="b418" class="kl km hh kg b fi kn ko l kp kq">ecomm.info()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ku"><img src="../Images/edb91d5dbb8795ba097d7d425a8292fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*GsYtNIB3Ij2xvANNeGek5g.png"/></div></figure><ul class=""><li id="b95b" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">在创建任何可视化之前，我们需要了解数据集的每一列的数据类型。<code class="du kd ke kf kg b"><em class="jt">‘</em>Cost_of_the_Product<em class="jt">’</em></code>、<code class="du kd ke kf kg b">‘Weight_in_gms’</code>和<code class="du kd ke kf kg b">‘Discount_offered’</code>下的数据是数值型的，我们可以使用直方图来探究这些列的累积频率分布。</li></ul><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="d640" class="kl km hh kg b fi kn ko l kp kq"><em class="jt"># plotting multiple graphs in a grid</em><br/>fig, axes = plt.subplots(3,1,figsize=(20,16))<br/><br/><em class="jt"># cumulative frequency distribution for '</em>Cost_of_the_Product<em class="jt">'</em><br/>sns.histplot(ecomm.Cost_of_the_Product, kde=True, ax=axes[0])<br/>ax=axes[0].set_title('Frequency Distribution of Product Cost',fontsize=12)<br/>ax=axes[0].set_xlabel('Product Cost',fontsize=10)<br/>ax=axes[0].set_ylabel('Count',fontsize=10)<br/><br/><em class="jt"># cumulative frequency distribution for 'Weight_in_gms'</em><br/>sns.histplot(ecomm.Weight_in_gms, kde=True, ax=axes[1])<br/>ax=axes[1].set_title('Frequency Distribution of Weight',fontsize=12)<br/>ax=axes[1].set_xlabel('Weight (in gms)',fontsize=10)<br/>ax=axes[1].set_ylabel('Count',fontsize=10)<br/><br/><em class="jt"># cumulative frequency distribution for'Discount_offered'</em><br/>sns.histplot(ecomm.Discount_offered, kde=True, ax=axes[2])<br/>ax=axes[2].set_title('Frequency Distribution of Discount Offered',fontsize=12)<br/>ax=axes[2].set_xlabel('Discount Offered',fontsize=10)<br/>ax=axes[2].set_ylabel('Count',fontsize=10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kv"><img src="../Images/c4ab3af7ccc99c083ff1a3712d538648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlU_NNGikBBelrzZ2-ce0g.png"/></div></div></figure><p id="13c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的直方图中，我们可以推断:</p><ol class=""><li id="9dc9" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb kw ka kb kc bi translated">大多数产品的价格在240.00-275.00美元之间。</li><li id="6a9a" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">大多数产品的重量在1000-2000克和4000-6000克之间。</li><li id="b9a6" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">最有可能给出的折扣在1%到10%之间。有许多异常值位于第三个四分位数。</li></ol><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="88be" class="kl km hh kg b fi kn ko l kp kq">fig, axes = plt.subplots(2,2,figsize=(20,12),facecolor='#e6ffff')</span><span id="f3d8" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for 'Warehouse_block'</em><br/>sns.countplot(x=ecomm["Warehouse_block"], ax=axes[0,0], palette='CMRmap_r')<br/>axes[0,0].set_title('Orders Handled By Each Warehouse Block', fontsize=12)<br/>axes[0,0].set_xlabel('Warehouse Block', fontsize=10)<br/>axes[0,0].set_ylabel('Count', fontsize=10)</span><span id="823d" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for 'Mode_of_Shipment' </em><br/>sns.countplot(x=ecomm["Mode_of_Shipment"], ax=axes[0,1], palette=['#DC143C','#556b2f','#008b8b'])<br/>axes[0,1].set_title('Number of Orders By Shipment Mode', fontsize=12)<br/>axes[0,1].set_xlabel('Shipment Mode', fontsize=10)<br/>axes[0,1].set_ylabel('Count', fontsize=10)</span><span id="a634" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for 'Customer_care_calls'</em><br/>sns.countplot(x=ecomm["Customer_care_calls"], ax=axes[1,0],palette='cubehelix')<br/>axes[1,0].set_title('Number of Customer Care Calls Made by Customers', fontsize=12)<br/>axes[1,0].set_xlabel('Customer Care Calls', fontsize=10)<br/>axes[1,0].set_ylabel('Count', fontsize=10)</span><span id="fdb4" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for 'Customer_rating'</em><br/>sns.countplot(x=ecomm["Customer_rating"], ax=axes[1,1],palette="rocket")<br/>axes[1,1].set_title('Customer Rating Received', fontsize=12);<br/>axes[1,1].set_xlabel('Customer Rating', fontsize=10)<br/>axes[1,1].set_ylabel('Count', fontsize=10);</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/d00ac25fa60007781f9a9c91089c522a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1fblkwpKq3cYODAGrhnkg.png"/></div></div></figure><p id="8c4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的支线剧情中，我们可以做出如下推论:</p><ol class=""><li id="823c" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb kw ka kb kc bi translated">大多数订单由仓库区F处理，而其他仓库区同样处理其余订单。</li><li id="34b1" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">大部分订单都是海运，其次是航班，最后是公路。</li><li id="5ff2" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">许多客户需要打4次电话来跟踪他们的货物。这是公司的一个警告点，因为客户的问题需要尽快解决，而不需要客户打几个电话。</li><li id="f422" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">1是第二高的评分。更有可能是因为产品没有按时交付，以及客户需要打大量的电话。</li></ol><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="e3e9" class="kl km hh kg b fi kn ko l kp kq">fig, axes = plt.subplots(2,2,figsize=(20,12),facecolor='#e6ffff')</span><span id="096e" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for 'Prior_purchases'</em><br/>sns.countplot(x=ecomm["Prior_purchases"],ax=axes[0,0],palette='viridis')<br/>axes[0,0].set_title('Number of Prior Purchases Made by Customers', fontsize=12)<br/>axes[0,0].set_xlabel('Prior Purchases', fontsize=10)<br/>axes[0,0].set_ylabel('Count', fontsize=10)</span><span id="60c7" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for'Product_importance'</em><br/>sns.countplot(x=ecomm["Product_importance"], order=abs_priority.index,ax=axes[0,1])<br/>axes[0,1].set_title('Number of Orders Made by Product Importance', fontsize=12)<br/>axes[0,1].set_xlabel('Product Importance', fontsize=10)<br/>axes[0,1].set_ylabel('Count', fontsize=10)</span><span id="40d9" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for'Gender'</em><br/>sns.countplot(x=ecomm["Gender"], order=abs_gender.index,ax=axes[1,0],palette=['#800000','#191970'])<br/>axes[1,0].set_title("Number of Orders Made by Customers' Gender", fontsize=12)<br/>axes[1,0].set_xlabel("Customers' Gender", fontsize=10)<br/>axes[1,0].set_ylabel('Count', fontsize=10)</span><span id="e546" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># countplot for'Reached.on.Time_Y.N'</em><br/>sns.countplot(x=ecomm["Reached.on.Time_Y.N"], order=abs_arrival.index,ax=axes[1,1],palette='tab20c_r')<br/>axes[1,1].set_title('Number of Orders Based On Arrival Time', fontsize=12)<br/>axes[1,1].set_xlabel('Arrival', fontsize=10)<br/>axes[1,1].set_xticklabels(['On Time', 'Late'])<br/>axes[1,1].set_ylabel('Count', fontsize=10);</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/66668a0328b871d49f7be3d7fb3f8f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4Yk6oJCdYXiLPVfRaDyQg.png"/></div></div></figure><p id="8903" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的支线剧情，我们可以得出结论:</p><ol class=""><li id="e35e" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb kw ka kb kc bi translated">许多顾客已经购买了3次。我们还发现，我们有大约100名忠诚客户，他们之前至少购买过8次。</li><li id="da0b" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">大多数订单的重要性较低，其次是中等和高。</li><li id="3d8f" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb kw ka kb kc bi translated">在10，999份订单中，超过一半的订单没有按时交付。</li></ol><p id="aafd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">👋如果您想了解在可视化中添加数据标签的方法，请查看我的另一篇关于<a class="ae jc" rel="noopener" href="/mlearning-ai/building-pie-chart-stacked-bar-chart-column-bar-chart-with-data-labels-using-matplotlib-32fc3fb5cfe9">的文章“使用Matplotlib&amp;Seaborn</a>构建饼状图、堆积条形图&amp;柱形图(带数据标签)”。🤩</p><ul class=""><li id="cde2" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">为了更深入地挖掘，我们可以问一些关于数据的问题并回答它们。结果可以是任何格式。下面是你可以提出的问题的例子。</li></ul><blockquote class="ld le lf"><p id="84a4" class="ie if jt ig b ih ii ij ik il im in io lg iq ir is lh iu iv iw li iy iz ja jb ha bi translated">产品的平均成本是多少，给那些订单非常重要但延迟到达的客户的平均折扣是多少，客户给的评分是1？</p></blockquote><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="a249" class="kl km hh kg b fi kn ko l kp kq">ecomm[(ecomm['Product_importance']=='high') &amp; (ecomm['Reached.on.Time_Y.N']==1) &amp; (ecomm['Customer_rating']==1)][['Prior_purchases','ID','Discount_offered','Cost_of_the_Product','Customer_rating']].groupby('Customer_rating').agg({'Prior_purchases':'mean','ID':'count','Discount_offered':'mean', 'Cost_of_the_Product':'mean'})</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/ca6a7fcc818c0b9b73fbc07fea46f407.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*WCFeCJKWKpoF0DSxKN3eig.png"/></div></figure><blockquote class="ld le lf"><p id="d836" class="ie if jt ig b ih ii ij ik il im in io lg iq ir is lh iu iv iw li iy iz ja jb ha bi translated">不同重要性的产品的折扣范围是多少？</p></blockquote><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="9f06" class="kl km hh kg b fi kn ko l kp kq">sns.boxplot(x=ecomm['Product_importance'],<br/>            y=ecomm['Discount_offered'])</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/503d9d28c7ca7009dbd4615e533ed39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*nriFJBINMgUYnDsIGmoneA.png"/></div></figure><h2 id="e856" class="kl km hh bd ll lm ln lo lp lq lr ls lt ip lu lv lw it lx ly lz ix ma mb mc md bi translated"><strong class="ak">第三阶段:建模💁‍♀️ </strong></h2><p id="5acb" class="pw-post-body-paragraph ie if hh ig b ih me ij ik il mf in io ip mg ir is it mh iv iw ix mi iz ja jb ha bi translated">为了预测订单是否按时交付，我们可以使用<code class="du kd ke kf kg b">‘Reached.on.Time_Y.N’</code>列作为输出。既然是分类数据，就需要使用分类监督的机器学习算法，比如逻辑回归、K-neighbors、支持向量机等。在我们开始应用这些算法之前，我们需要将分类变量转换成虚拟变量，并对数值变量进行缩放</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="b3bd" class="kl km hh kg b fi kn ko l kp kq"><em class="jt"># create dummy variables for categorical variables<br/></em>dummy1 = pd.DataFrame(pd.get_dummies(ecomm[['Warehouse_block', 'Mode_of_Shipment','Product_importance','Gender']]))<br/>dummy2 = pd.DataFrame(pd.get_dummies(ecomm[['Customer_care_calls','Customer_rating','Prior_purchases']].astype(str)))</span><span id="724d" class="kl km hh kg b fi kr ko l kp kq"># for normalizing data<br/>from sklearn.preprocessing import scale  <br/>ecomm1 = pd.DataFrame(scale(ecomm[['Cost_of_the_Product','Discount_offered', 'Weight_in_gms']]),columns=['Cost_of_the_Product','Discount_offered', 'Weight_in_gms'])</span><span id="0d3d" class="kl km hh kg b fi kr ko l kp kq"># create new datafame for modeling <br/>ecomm2 = pd.concat([ecomm1,dummy1,dummy2,ecomm[['Reached.on.Time_Y.N']]],axis=1)</span></pre><p id="4796" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，我们需要将数据分离为训练和测试数据，以及导入必要的ML算法库。💦</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="a10a" class="kl km hh kg b fi kn ko l kp kq">from sklearn.model_selection import train_test_split</span><span id="8494" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># split data into output and input</em><br/>X = ecomm2.iloc[:,:-1] # inputs<br/>Y = ecomm2['Reached.on.Time_Y.N'] # outputs</span><span id="0954" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># split data into train data and test data</em><br/>X_train, X_test, Y_train, Y_test = train_test_split(X,Y, test_size=0.25,shuffle=True) </span><span id="df59" class="kl km hh kg b fi kr ko l kp kq"><em class="jt"># import classification ML </em><br/>import xgboost<br/>from sklearn.linear_model import LogisticRegression <br/>from sklearn.neighbors import KNeighborsClassifier<br/>from sklearn.tree import DecisionTreeClassifier as DT<br/>from sklearn.ensemble import RandomForestClassifier as RT<br/>from sklearn.naive_bayes import GaussianNB as GB  <br/>from sklearn.svm import SVC </span></pre><p id="217d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们可以建立模型。👷‍♀️</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="d050" class="kl km hh kg b fi kn ko l kp kq"><em class="jt"># append different classification models into classifiers array </em><br/>classifiers=[]<br/>LR_model = LogisticRegression()<br/>classifiers.append(LR_model)<br/>KNN_model = KNeighborsClassifier(n_neighbors=11, metric='euclidean')<br/>classifiers.append(KNN_model)<br/>DT_model = DT(criterion = 'entropy',max_depth=4) <br/>classifiers.append(DT_model)<br/>RF_model = RT(n_jobs=2, n_estimators=99, criterion="entropy")<br/>classifiers.append(RF_model)<br/>GNB_model = GB() <br/>classifiers.append(GNB_model)<br/>SVC_model = SVC(kernel = "linear")<br/>classifiers.append(SVC_model)<br/>XGB_model = xgboost.XGBClassifier()<br/>classifiers.append(XGB_model)</span></pre><h2 id="b1a7" class="kl km hh bd ll lm ln lo lp lq lr ls lt ip lu lv lw it lx ly lz ix ma mb mc md bi translated">第4阶段:评估🧠</h2><p id="3313" class="pw-post-body-paragraph ie if hh ig b ih me ij ik il mf in io ip mg ir is it mh iv iw ix mi iz ja jb ha bi translated">我们可以根据测试精度来选择型号。根据下面的结果，我们可以选择决策树作为我们的最终模型，因为它返回了最高的测试精度。</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="b777" class="kl km hh kg b fi kn ko l kp kq">from sklearn.metrics import accuracy_score</span><span id="23eb" class="kl km hh kg b fi kr ko l kp kq">accuracy_result = pd.DataFrame(data={'Model':['LR','KNN','Decision Tree','Random Forest','Gaussian Bayes','SVM','XGB'],<br/>'Training Accuracy':accuracy_train,<br/>'Testing Accuracy':accuracy_test})<br/>accuracy_result.sort_values('Testing Accuracy',ascending=False)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/934a5be61e255ef5f4617c57ff4e892e.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*orF57u_KgJm7i7EIYcFuZw.png"/></div></div></figure><p id="d190" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要绘制决策树，可以使用下面几行代码。正如你可能意识到的，我喜欢把<code class="du kd ke kf kg b">facecolor</code>参数放在支线剧情中。这个功能帮助我们设置支线剧情的背景颜色。您可以传入十六进制代码(如EDA部分所示)或颜色名称。</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="57d9" class="kl km hh kg b fi kn ko l kp kq">from sklearn import tree<br/>from sklearn.tree import plot_tree</span><span id="db5b" class="kl km hh kg b fi kr ko l kp kq">DT_model = DT(criterion = 'entropy',max_depth=4) <br/>DT_model.fit(X_train,Y_train)</span><span id="98b2" class="kl km hh kg b fi kr ko l kp kq">fig, ax = plt.subplots(figsize=(20, 20), facecolor='w')<br/>tree.plot_tree(DT_model,<br/>               feature_names=np.array(X.columns),<br/>               class_names=['0','1'],<br/>               filled=True,<br/>               ax=ax);</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mk"><img src="../Images/e16da4d2ac9831da47d0290580c2d39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*-L1Q2DhdBpFz3ydSw0UCEA.png"/></div></figure><p id="4e04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是你如何为你的困惑矩阵创建一个热图。</p><p id="384c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">👋如果你想给你的混淆矩阵添加数据标签，你可以看看我的另一篇文章<a class="ae jc" rel="noopener" href="/mlearning-ai/heatmap-for-correlation-matrix-confusion-matrix-extra-tips-on-machine-learning-b0377cee31c2">‘相关矩阵热图&amp;混淆矩阵|机器学习的额外技巧’</a>。🍡</p><pre class="je jf jg jh fd kh kg ki kj aw kk bi"><span id="b07b" class="kl km hh kg b fi kn ko l kp kq">from sklearn.metrics import confusion_matrix<br/>plt.figure(figsize=(16,5))<br/>sns.heatmap(confusion_matrix(Y_test,pred_test_DT), annot=True, fmt='', cmap='Blues')<br/>plt.title('Confusion matrix for test data (DT model)',fontsize=16);</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/3108343be555631e1c5e52e33a59219c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ir4i_2ZxgJ5fs1FeLIQDEg.png"/></div></div></figure><h2 id="7786" class="kl km hh bd ll lm ln lo lp lq lr ls lt ip lu lv lw it lx ly lz ix ma mb mc md bi translated"><strong class="ak">阶段5:部署(使用</strong> <a class="ae jc" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">烧瓶</strong> </a> <strong class="ak"> + HTML + CSS)🏭</strong></h2><p id="14b7" class="pw-post-body-paragraph ie if hh ig b ih me ij ik il mf in io ip mg ir is it mh iv iw ix mi iz ja jb ha bi translated"><strong class="ig hi">为什么需要部署？</strong>并非每个用户都是程序员，因此期望最终用户知道如何运行Jupyter笔记本并获得输出是不现实的。因此，模型部署可能是ML中最关键的部分。</p><p id="005f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">我们如何部署模型？这取决于你想使用的编程语言。如果你用的是R，你可以用<a class="ae jc" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> R闪亮</a>。如果你正在使用Python，你可以使用Flask，你也需要有一些关于HTML和CSS的基础知识。对于这个案例研究，我将使用Flask进行演示。别担心！我将详细解释。😉</strong></p><p id="9612" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们已经使用决策树分类器创建了一个模型。然后，我们需要使用<a class="ae jc" href="https://docs.python.org/2/library/pickle.html" rel="noopener ugc nofollow" target="_blank"> pickle </a>将训练好的模型序列化，并将序列化后的格式保存到一个文件中。🥒运行下面的代码后，您可以在您的目录中找到一个名为'<em class="jt">finalized _ dt _ model _ ecomm . pkl '</em>的pickle文件，请不要删除该文件，因为我们将在main.py中使用它(该应用程序文件获取并使用来自用户的输入来进行预测，并将结果发送回用户)。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/ed88aaaa62910fb493fb1c5692190688.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*YQd_POnN0cbdOmkrE9QHrg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Structure of Model Deployment Directory</figcaption></figure><p id="8e5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如上图所示，我们需要创建一个名为'<em class="jt"> templates </em>的文件夹来存储<em class="jt">home.html</em>文件(基本上是一个允许用户传入输入的表单)和<em class="jt">result.html</em>文件(向用户显示结果的文件)。</p><p id="152d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是部分<em class="jt">home.html</em>文件。我将解释一些重要的事情，当你在此基础上创建表单时，你需要知道这些事情。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="f43a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一个名为“静态”的文件夹用于存储CSS文件，以改善网页的外观或存储任何图像。您可以使用<code class="du kd ke kf kg b"><a class="ae jc" href="https://www.w3schools.com/tags/att_link_rel.asp" rel="noopener ugc nofollow" target="_blank">&lt;link&gt;</a></code>将CSS文件链接到HTML文件。你是否想要创建一个CSS文件是可选的，因为你总是可以在HTML中应用<a class="ae jc" href="https://www.instagram.com/p/CTtXPh8PbAO/" rel="noopener ugc nofollow" target="_blank">内部CSS </a>，通过在HTML文件的<code class="du kd ke kf kg b">&lt;head&gt;</code>部分使用<code class="du kd ke kf kg b">&lt;style&gt;</code>标签来包含样式特性(PS:内部CSS可能会增加页面大小和加载时间)。</p><p id="d095" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的代码可以看出(在<code class="du kd ke kf kg b">&lt;select&gt;</code>和<code class="du kd ke kf kg b"><a class="ae jc" href="https://www.w3schools.com/html/html_form_input_types.asp" rel="noopener ugc nofollow" target="_blank">&lt;input&gt;</a></code>中)，每个问题都有一个<strong class="ig hi">名称。这些名称很重要，因为我们将在<em class="jt"> main.py </em>文件</strong>中使用相同的名称，以便将相应的输入正确分配给模型中的相应变量。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="5688" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了Flask库，我们还需要导入以下库:</p><ul class=""><li id="dbe9" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated"><code class="du kd ke kf kg b">render_template</code>:渲染HTML模板。</li><li id="94de" class="ju jv hh ig b ih kx il ky ip kz it la ix lb jb jz ka kb kc bi translated"><code class="du kd ke kf kg b">request</code>:使用Python发送HTTP请求。</li></ul><p id="6ef5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要使用<code class="du kd ke kf kg b">@app.route(“/”)</code>来创建到主页的路径。之后，我们需要构建一个定制的预测函数和<code class="du kd ke kf kg b">@app.route(“/result”, methods=[“POST”])</code>来根据用户的输入预测货物的到达(准时到达或延迟到达)，并将输出呈现给<em class="jt">result.html</em>。值得注意的是，<em class="jt">中的<code class="du kd ke kf kg b">methods=[“POST”]</code>也是home.html</em>中的元素。相信你明白<em class="jt">home.html</em>和<em class="jt"> main.py </em>之间的联系。🤓</p><p id="28f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">完成编码部分后，您可以在本地PC上运行<em class="jt"> main.py </em>并通过点击出现的链接使用浏览器查看应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/7c283801c6a6d8bb3586444398512dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvczBt0BXncQbivUvSnUGQ.png"/></div></div></figure><p id="e421" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是点击链接后你可能<em class="jt">看到的<em class="jt">home.html</em>页面。顺便说一下，我的部署代码还有改进的空间。如果你能评论并让我知道你的想法使它变得更好，我将不胜感激。</em></p><div class="je jf jg jh fd ab cb"><figure class="mq ji mr ms mt mu mv paragraph-image"><img src="../Images/ba25f7652aeec094e109b1e8c12c8208.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*4qq055xAr8OQ77BtHhEf3Q.png"/></figure><figure class="mq ji mw ms mt mu mv paragraph-image"><img src="../Images/c1a1387395195faabe0292c4d737cf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*xGlkrhDgvNuGFCKMsuHYDA.png"/></figure></div><p id="1e83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第六阶段:维护&amp;监控🚴‍♂️ </strong></p><p id="dcf9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">总有千变万化的政治、经济、社会、技术(害虫)因素。模型并不总是在静态环境中运行，这些有害因素会导致模型漂移(模型性能下降)，因为模型对解释不熟悉的数据没有预测能力。🍭</p><p id="557b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">无论模型的表现如何，都需要了解模型中的数据和变量更改的频率，以便以固定的间隔重新训练模型。⏳</p><p id="b424" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望你喜欢我的文章。🙌如果你愿意，你也可以在我的GitHub库上查看完整的项目，名为<a class="ae jc" href="https://github.com/jadanpl/E-Commerce-Shipping" rel="noopener ugc nofollow" target="_blank">电子商务-运输</a>。☕</p><p id="d23c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">快乐学习！😊</p><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jn na"/></div></div></a></div></div></div>    
</body>
</html>