<html>
<head>
<title>Building animated graphs in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用R构建动画图形</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-animated-graphs-in-r-dcacf0be3255?source=collection_archive---------8-----------------------#2022-01-17">https://medium.com/mlearning-ai/building-animated-graphs-in-r-dcacf0be3255?source=collection_archive---------8-----------------------#2022-01-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="9ec3" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">第四维是一个奇妙的东西</h2></div><p id="05c1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi js translated">当我年轻的时候，我想创作3D动画。我喜欢的玩具总动员。《海底总动员》我看了无数遍。唉，成为一名3d建模师的道路并不平坦，所以我成为了一名喜欢制作图表和动画的统计建模师。在一篇小博文中，我将向你展示如何使用R来创建动画。该数据集是来自OWID的新冠肺炎数据集。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="44a3" class="kk kl hh kg b fi km kn l ko kp">library(readr)<br/>library(ggplot2)<br/>library(gganimate)<br/>library(tidyverse)<br/>library(ggrepel)<br/>library(lubridate)<br/>library(tidymodels)<br/>library(modeltime)<br/>library(tsbox)<br/>library(TSstudio)<br/>library(timetk)<br/>library(tseries)</span></pre><p id="625d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们加载数据并创建必要的数据集，以绘制生活在欧洲国家的完全接种疫苗的人口百分比与ICU提交率和超额死亡率之间的关系。这些图表没有证明因果关系，事实上是一个很好的例子，说明为什么边际横截面比较没有多大帮助。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="5f90" class="kk kl hh kg b fi km kn l ko kp">getwd()<br/>data_folder &lt;- file.path("")<br/>url &lt;- "<a class="ae kq" href="https://covid.ourworldindata.org/data/owid-covid-data.csv" rel="noopener ugc nofollow" target="_blank">https://covid.ourworldindata.org/data/owid-covid-data.csv</a>"<br/>name &lt;- "owid-covid-data.csv"<br/>download.file(url = url, destfile = paste0(data_folder,name))<br/>setwd(data_folder)<br/>coviddat  &lt;- read_csv(paste0(data_folder,name))<br/>coviddat$vax_perc&lt;-(coviddat$people_fully_vaccinated/coviddat$population)*100<br/>coviddat$week&lt;-week(coviddat$date)</span><span id="adf9" class="kk kl hh kg b fi kr kn l ko kp">coviddat2&lt;-coviddat%&gt;%dplyr::select(date,<br/>                                    week,<br/>                                    location, <br/>                                    continent, <br/>                                    vax_perc,<br/>                                    icu_patients_per_million,<br/>                                    excess_mortality,<br/>                                    stringency_index)%&gt;%<br/>  filter(continent=="Europe")%&gt;%<br/>  filter(complete.cases(.))%&gt;%<br/>  group_by(location)%&gt;%<br/>  summarise_by_time(date,.by="week",<br/>                  vax_perc_week=max(vax_perc,na.rm=TRUE),<br/>                  icu_week=max(icu_patients_per_million,na.rm=TRUE),<br/>                  location=location,<br/>                  continent=continent,<br/>                  em_week=mean(excess_mortality,na.rm=TRUE),<br/>                  </span></pre><p id="0cbe" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我将准备所需的图形。它看起来真的很像一个GGPLOT，但是区别就在这里，在<em class="ks">转换状态</em>函数中。这个函数告诉R在各种图像中创建开始移动变量，之后通过<em class="ks">动画</em>函数进行优化。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="06ad" class="kk kl hh kg b fi km kn l ko kp">p&lt;-coviddat2%&gt;%filter(continent=="Europe" &amp; <br/>                       date&gt;"2020-12-31")%&gt;%ggplot(., aes(<br/>  x=vax_perc_week, <br/>  y=icu_week,<br/>  size = SI_week, <br/>  color=as.factor(location),<br/>  label=as.factor(location))) + <br/>  geom_text(nudge_y = 1) +<br/>  ylim(0,120) +<br/>  theme_bw() + <br/>  theme(legend.position = "none") +<br/>  labs(title= 'Week: {closest_state}', <br/>       x = 'Fully Vaxed Percentage', <br/>       y = 'ICU patients per Million') +<br/>  transition_states(week, <br/>                    transition_length = 2,<br/>                    state_length = 1) +<br/>  ease_aes('linear') + <br/>  enter_fade()+<br/>  exit_fade()<br/>anim4 &lt;- animate(p,nframes=350)<br/>anim_save(filename="VAX_ICU.gif", animation=anim4)</span></pre><figure class="kb kc kd ke fd ku er es paragraph-image"><div class="er es kt"><img src="../Images/4fb1983fdcda35a122deb8b391365ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*pLYqWKGQDHlx2s4y61ftjQ.gif"/></div><figcaption class="kx ky et er es kz la bd b be z dx">And this is what we end up with!</figcaption></figure><p id="c9da" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们结合超额死亡率对完全接种疫苗的人群重复同样的步骤。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="c9f7" class="kk kl hh kg b fi km kn l ko kp">q&lt;-coviddat2%&gt;%filter(continent=="Europe" &amp; <br/>                        date&gt;"2020-12-31")%&gt;%ggplot(., aes(<br/>                          x=vax_perc_week, <br/>                          y=em_week,<br/>                          size = SI_week, <br/>                          color=as.factor(location),<br/>                          label=as.factor(location))) + <br/>  geom_text(nudge_y = 1) +<br/>  theme_bw() + <br/>  theme(legend.position = "none") +<br/>  labs(title= 'Week: {closest_state}', <br/>       x = 'Fully Vaxed Percentage', <br/>       y = 'Excess Mortality') +<br/>  transition_states(week, <br/>                    transition_length = 2,<br/>                    state_length = 1) +<br/>  ease_aes('linear') + <br/>  enter_fade()+<br/>  exit_fade()<br/>anim5 &lt;- animate(q,nframes=350)<br/>anim_save(filename="VAX_EM.gif", animation=anim5)</span></pre><figure class="kb kc kd ke fd ku er es paragraph-image"><div class="er es kt"><img src="../Images/91535de99c3290b0ee2b6fe8def282b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*ukX05sn5tHKmr5PysGZECw.gif"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Tadaa! Here it is.</figcaption></figure><p id="37b8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">简明扼要，你可以重复这个例子，并用于任何你喜欢的动画。尽情享受吧！</p><div class="lb lc ez fb ld le"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hi fi z dy lj ea eb lk ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">medium.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls kv le"/></div></div></a></div></div></div>    
</body>
</html>