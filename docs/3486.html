<html>
<head>
<title>Lessons Learned Using Precision-Recall Curve in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中使用精度召回曲线的经验教训</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/lessons-learned-using-precision-recall-curve-in-python-df003a0db4eb?source=collection_archive---------1-----------------------#2022-09-10">https://medium.com/mlearning-ai/lessons-learned-using-precision-recall-curve-in-python-df003a0db4eb?source=collection_archive---------1-----------------------#2022-09-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d04e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章将讨论我参与的一个迷你项目，以及我从Python创建精确召回曲线中学到的经验。</p><p id="1760" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(注意:这篇文章的目的是展示这个项目的优点和缺点)</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/5c4d84885d641c462ef50d9d6348c9a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9rwmgIKSzaCeYM3WtCVIQ.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Dallas, Texas taken on November 22, 2021. Photo Credit: Muneeza Qureshi</figcaption></figure><p id="fa47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">我的迷你项目目的</em> </strong></p><p id="7671" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的迷你项目的目的是评估ICD-10编码的敏感性和阳性预测值，该编码用于将新冠肺炎病例与阳性聚合酶链式反应测试结果进行比较。公共健康的意义是新冠肺炎的风险。然而，迄今为止，很少有研究确定ICD-10编码在医院数据库中新冠肺炎病例中的敏感性和PPV。这些研究的一个例子是Wu等人的研究结果，该研究显示在加拿大郊区医院中一个10编码(U07.1)的估计有效性范围为49%至98%。这个范围是值得关注的，因为正确使用代码的有效性应该很高(超过80%)(1)。此外，很少有研究调查来自非医疗机构的大型公共患者人群数据库(如Optum数据库)的敏感性和PPV。该项目旨在填补这一知识空白。</p><p id="340e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">输入数据</em></p><p id="5dc6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">原始数据集COVID Optum数据库来自UTHealth。该数据集提供了许多重要的非识别患者信息，包括诊断代码、测试结果、测试日期、订单日期、测试名称和其他医疗信息。该数据集有大约100万个观察值，这对于最终项目来说是一个很大的数据集。因此，我通过随机抽样只使用了整个数据集的0.04%左右。这项研究包括8列近40，000个观察结果。SARS-新冠肺炎检验(1代表阳性，0代表阴性)作为响应变量属于二元分布。此外，2个可解释变量是分类变量。</p><p id="bf42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">预期输出数据</em></p><p id="84a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将计算没有分类器的混淆矩阵。响应或“y”变量将是阳性和阴性SARS-COVID19测试。预测变量或“X”变量将是U071的诊断代码和其他诊断代码。为了平衡混淆矩阵，逻辑回归混淆矩阵和精确回忆曲线将用于观察预测变量和反应变量之间的关系。用具有F1评分和AUC评分的逻辑回归(LR)模型评估整体模型拟合度。</p><p id="2b25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">编程组件</em> </strong></p><p id="3e3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤1:导入库</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/ecf1fb7dfdf3e4904870c39b943dfe0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FyAGIDeP_D5kiR-USqNJUA.png"/></div></div></figure><p id="3402" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤2:导入csv文件。该csv文件来自UTHealth COVID Optum数据库。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/5b1405633022afd515a3319003015910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q5JPvRaygLdvJZcdO04dOg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/81799bb45777394f438d86cc1e2994cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3T8OJfhm_AvyHMggEg_csQ.png"/></div></div></figure><p id="5fc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤3:将PTID指定为数字</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/464c897258b571f3dccfdf7a6a6fefbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQ1SuXzS955mvwvRwp-XiA.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/7800049678dfe98b5f75a9f058bf1ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFiW_KgEi0CxJCXEVLh_hA.png"/></div></div></figure><p id="186f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤4:在名为“TEST_RESULT_Dummy”的新列中，将“TEST_RESULT”重新编码为1表示阳性，0表示阴性</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ju"><img src="../Images/67ba3cff708d8bd550b12593dd24ce04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kbs4QA02khOvdTBWETKZqA.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/e0346af7b74ac5db1ef9d69e3142d747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTPXDccCYcQz9p5Y-IWHXA.png"/></div></div></figure><p id="c5b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤5:在新列“诊断_CD_Dummy”中将“诊断_CD”重新编码为U071的1和非U071的0</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/562fa5654c98254da8c56ba718df3de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7bVGnfMMLV_DvwcP51dASA.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/85a8a6444c157a0a6f00aecba7c78b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbKIAOSp04DkI8j6t8Yehg.png"/></div></div></figure><p id="c7a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤6:通过计算行数，从df计算灵敏度、PPV、NPV和特异性</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/fe90d75a855763528824fc4259545ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eoPHTbDa8Hae2p3X_8DOZA.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/ed85c2206f4ee83482006b47da59085e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9teBCfNbGLfL8u5Zt0gvwA.png"/></div></div></figure><p id="3656" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤7:使用代码df.info()查看每个变量的dtype</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/da5c13c6d75c15ea0a4a8af6cf5f1735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLsxKC2VvGatAKMr9c0gIQ.png"/></div></div></figure><p id="458b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤8:导入库来创建混淆矩阵</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jv"><img src="../Images/963bb5b6388ad4ee42219132dcfa6400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-s0vCCx0pQQ2nI5IT578Q.png"/></div></div></figure><p id="1d07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤9:画出没有任何分类器的原始混淆矩阵</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jw"><img src="../Images/6881104177db57029fb23330aca4fe23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWc5rOir5Cqxj78dC1h0Jw.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jx"><img src="../Images/f36076a3eca1cb6b9f4c6009866ae5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvYivD-oroWZTYoa_JN3ag.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/480bccdf26383d2e05c5fbc82b2210b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3fxbq40YVc9Dzd5GDDDVQ.png"/></div></div></figure><p id="6ffa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤10:创建逻辑回归混淆矩阵以适应模型</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jw"><img src="../Images/96a35e5629cdbf5a99af34957d517ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvYNRpsbdwRnIHYW6U5New.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jx"><img src="../Images/da3cf9725da42806c0fece64c3107b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHE8X8D1PX6P4UuhE21RIQ.png"/></div></div></figure><p id="8dc5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤11:计算精确度、召回率、阈值，绘制精确度-召回率曲线，并绘制具有F1分数和AUC的逻辑回归模型</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jy"><img src="../Images/b7bf63b960b36b90e3612533c90f1ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cBJ-qMQuhKwbkgR14yg6w.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/e311af5dfc94e5a403a98f096930dade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6k-NXDI7ykvCCDKtP57UEg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jx"><img src="../Images/73cf62c733aafdbb3e0808ec181fc1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mIc1CHkqfgFeTzxaY_4Eg.png"/></div></div></figure><p id="b2a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">吸取的经验教训</em></p><p id="2f56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建原始混淆矩阵和LR混淆矩阵的步骤是/可能是不正确的，因为LR模型显示它是一个坏模型。此外，在混淆矩阵之间和创建LR模型的过程中有(或可能有)遗漏的步骤。回过头来看，如果将代码分成更多的片段，而不是Python中每个单元的大片段，会更好。这将有助于增加更多的步骤来创建最佳拟合的精确召回曲线模型。</p><p id="44d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望你喜欢这篇文章。请随意在精确召回曲线上留下评论或任何建议。如果你想看到更多这样的内容，喜欢这个帖子，请给我一个关注！感谢您的阅读！</p><p id="46e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">参考资料:</p><ol class=""><li id="a618" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">Wu G，D'Souza A，Quan H，Southern D，Youngson E，Williamson T，Eastwood C，和Xu y . 10编码对在加拿大住院或急诊就诊的患者的有效性:一项回顾性队列研究。BMJ公开赛。2022;12(1):1–7.</li></ol><div class="ki kj ez fb kk kl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hi fi z dy kq ea eb kr ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">medium.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz jm kl"/></div></div></a></div></div></div>    
</body>
</html>