<html>
<head>
<title>Model monitoring using Tensor flow Data Validation in TFX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在TFX使用张量流数据验证的模式监测</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/model-monitoring-using-tensor-flow-data-validation-in-tfx-69d6dbc9da49?source=collection_archive---------2-----------------------#2021-05-23">https://medium.com/mlearning-ai/model-monitoring-using-tensor-flow-data-validation-in-tfx-69d6dbc9da49?source=collection_archive---------2-----------------------#2021-05-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="605d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">众所周知，ML模型在产品或产品功能的核心部分越来越多。因此，数据科学团队现在负责确保他们的模型在产品的大部分时间里都按照预期执行。</p><p id="754a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">需要实时监控模型的性能，以检测任何会影响最终用户体验的性能问题。必须开发早期识别机制，以便在问题开始影响底线或用户开始抱怨之前识别问题。</p><p id="3323" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在数据科学团队开发模型时，他们可能会使用准确性性能指标评估模型，实时跟踪相同的准确性指标是不可能的，因为:</p><p id="c1ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.<strong class="ig hi">模型干预:</strong>你所使用的模型可能会影响你所能做出的观察，因为在预测之后会采取行动。</p><p id="081b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如:如果你预测客户流失，你会采取措施留住你认为可能流失的客户。几个月后，当你衡量“基本事实”标签时，如果客户的标签没有变化，你不知道这是因为预测错误还是因为你采取的行动。</p><p id="427b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.<strong class="ig hi">预测和地面真实标签可用之间的长等待时间:</strong></p><p id="8c88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">想象一下，在信用卡欺诈中，案件可以在交易完成后90天内报告。因此，在做出预测和获得事实真相之间有3个月的延迟。如果准确性是用于跟踪模型性能的唯一指标，那么直到问题开始出现3个月后才能被发现。</p><p id="9682" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了使我们开发的最大似然模型在相当长的一段时间内做出可靠的预测，需要监控数据和可能影响模型性能的变化。</p><p id="85e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">监测数据</strong></p><p id="0e1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">人工智能应用程序的性能下降有两个主要原因:</p><ol class=""><li id="6f13" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">数据采集/处理管道中的问题:</strong></li></ol><p id="5c58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着提供给模型的数据不符合预期。这可能是因为您用来收集数据的API的更新包含重大更改。</p><p id="72a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，假设正在收集图像的传感器出现故障，并且刚刚开始发送代替图片的暗图像。</p><ol class=""><li id="00c9" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">数据性质/分布的变化:</strong></li></ol><p id="e911" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着输入和输出数据之间的关系会随着时间的推移而改变，这意味着未知的底层映射函数也会随之改变。</p><p id="f3e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，假设您创建了一个模型，它使用几个特征来预测用户是否是垃圾邮件发送者。在本季度末，您已经注意到，随着时间的推移，预测的结果发生了巨大的变化。在最好的情况下，这种变化可能是因为垃圾邮件发送者放弃了。或者，这是最坏的情况，这种变化是因为垃圾邮件发送者的概念已经演变。如果我们考虑最坏的情况，如果垃圾邮件发送者想出一个与训练时观察到的情况完全不同的不同情况会怎么样。换句话说，垃圾邮件发送者的概念已经漂移。</p><p id="6e1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的两个场景中，我们可以说，如果数据的分布在训练集和测试集之间发生了变化，那么在机器学习的世界中，它可以被称为<strong class="ig hi"> <em class="jl">数据偏移/数据漂移</em> </strong>，即Ptrain(y，x)≠Ptest(y，x)。它大致分为三种类型:</p><p id="0bf2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.协变量移位</p><p id="4d92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.先验概率转移</p><p id="4739" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.观念转变</p><p id="2817" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">协变量移位:</strong>协变量移位是<em class="jl">协变量</em>的分布变化，具体来说就是自变量的分布变化。协变量移位只出现在X→Y问题中，定义为<strong class="ig hi"> Ptrain(y|x) = Ptest(y|x)且Ptrain(x) ≠ Ptest(x) </strong>的情况。下图将清楚地说明我们的学习函数试图拟合训练数据。但是这里我们可以看到训练和测试的分布是不一样的，所以用这个学习过的函数来预测肯定会给我们错误的预测。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jm"><img src="../Images/313d55305f9edbd0fdfb2753cef6ebd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*PjmZEB5oongCZ9Z2HLbH3w.png"/></div></figure><p id="ba87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">协变量移位可能导致问题的例子:</p><p id="23e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">人脸识别算法主要针对较年轻的人脸进行训练，但数据集中有更大比例的老年人脸。</p><p id="a592" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将图像分类为猫或狗，并从训练集中省略在测试集中看到的某些物种。</p><p id="1131" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在进行交叉验证时，协变量移位会导致许多问题。交叉验证在没有协变量转移的情况下几乎是无偏的，但在协变量转移的情况下会有很大的偏差！</p><p id="a512" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">先验概率移位:</strong>先验概率移位可以认为是协变量移位的完全相反，协变量移位是指类变量<strong class="ig hi"> <em class="jl"> Y </em> </strong> <em class="jl">的分布发生变化，而</em><strong class="ig hi"><em class="jl"/></strong>X的分布保持不变<strong class="ig hi"> <em class="jl">。</em> </strong>先验概率移位只出现在Y→X问题中，定义为<strong class="ig hi"> Ptrain(x|y) = Ptest(x|y)且Ptrain(y) ≠ Ptest(y)的情况。</strong></p><p id="6122" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一种直观的思考方式可能是考虑一个不平衡的数据集。</p><p id="b5cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果训练集对您收到的垃圾邮件的数量具有相同的先验概率(即，一封电子邮件是垃圾邮件的概率是0.5)，那么我们预计50%的训练集包含垃圾邮件，50%包含非垃圾邮件。</p><p id="3ae2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果在现实中，只有90%的电子邮件是垃圾邮件(也许不是不可能的)，那么我们的类别变量的先验概率已经改变。这种想法与数据稀疏性和有偏差的特征选择有关，它们是导致协方差偏移的因素，但它们不是影响我们的输入分布，而是影响我们的输出分布。</p><p id="df55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个问题只出现在Y → X问题中，通常与朴素贝叶斯有关(因此出现了垃圾邮件示例，因为朴素贝叶斯通常用于过滤垃圾邮件)。</p><p id="3fce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">概念漂移:</strong>概念漂移不同于协变量和先验概率漂移，它与数据分布或类别分布无关，而是与输入和输出变量之间的关系变化有关，定义为<strong class="ig hi"> Ptrain(Y|X) ≠ Ptest(Y|X)。</strong>我们在<em class="jl">一节中讨论的数据性质/分布变化的例子</em>就属于这一概念。</p><h2 id="e20c" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">使用张量流数据验证实现数据移位</h2><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="6ba2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上代码和数据集可以在这里<a class="ae kr" href="https://github.com/ygkrishna/MLOps" rel="noopener ugc nofollow" target="_blank">下载。</a></p><blockquote class="ks kt ku"><p id="9823" class="ie if jl ig b ih ii ij ik il im in io kv iq ir is kw iu iv iw kx iy iz ja jb ha bi translated">以上文章是我通过探索Coursera中的多种资源，medium中的其他文章，cloud.google &amp; git资源等，对TFX使用TFDV进行数据移位/数据漂移识别的理解和实现。</p></blockquote></div></div>    
</body>
</html>