<html>
<head>
<title>Computer Vision with Unreal Engine: Generate Rich Object Detection Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用虚幻引擎的计算机视觉:生成丰富的对象检测数据</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/computer-vision-with-unreal-engine-generate-rich-object-detection-data-64c613e0121f?source=collection_archive---------2-----------------------#2022-09-21">https://medium.com/mlearning-ai/computer-vision-with-unreal-engine-generate-rich-object-detection-data-64c613e0121f?source=collection_archive---------2-----------------------#2022-09-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="67da" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">无需编写任何代码，即可在虚幻引擎中创建丰富、高度可定制的数据！</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/c50fa897a79204cacdea2fd88c4edbe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUnHATtsh6gm7qx9PcYkxw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">What we’ll be building by the end of this article</figcaption></figure><p id="3bb6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">虚幻引擎是一个绝对的发电站。虽然它将彻底改变游戏，但它也将推进计算机视觉。你看，为机器学习项目创建数据是很难的，特别是在计算机视觉领域，你必须考虑照明、天气、相机参数和其他一切。然而，使用虚幻引擎，您可以在计算机前通过几个步骤创建真实的数据。我会告诉你怎么做。</p><p id="5d25" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在本教程中，我们将从头开始生成高质量的对象检测数据。</p><p id="9d75" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在继续之前，我假设你已经设置了虚幻引擎，如果没有，你可以从<a class="ae ki" href="https://www.unrealengine.com/en-US" rel="noopener ugc nofollow" target="_blank">这里</a>得到它。我这里用的是4.27版本，但是任何更新的版本都可以。</p><p id="d7b8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">本文中使用的蓝图可以在<a class="ae ki" href="https://neeraj-public-bucket-for-files.s3.ap-south-1.amazonaws.com/object-detection-ue4/BP_OD.uasset" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="491d" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">好吧，我们开始吧。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="01dd" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">创建项目</h1><p id="ed32" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">启动引擎并创建一个空白项目。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ln"><img src="../Images/75343d5422aa83f3700a2755cd5cf67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_2gTvOP4Qpn8rlCShviVog.png"/></div></div></figure><p id="0b6f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在项目设置中选择Blueprint，并选择包含starter内容。可以将项目命名为<code class="du lo lp lq lr b">ObjectDetection</code>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/2b44190bbda162648402f2c9e96e9491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jGvh1XzXvghaQQUqUc7cg.png"/></div></div></figure><p id="8eb0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">窗口加载后，删除当前的起始网格，这样我们就可以从头开始了。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/ea05b0649188b71353e9966fdf568f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89U_POhqy6JTNFcM0imgHg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">The main editor</figcaption></figure><h1 id="49f2" class="kq kr hh bd ks kt lu kv kw kx lv kz la in lw io lc iq lx ir le it ly iu lg lh bi translated">创建演员</h1><p id="c077" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">虚幻引擎中的演员是可以放在关卡中的对象。我们可以给一个演员附加不同的组件，并定制它的行为。在本文中，我们将使用blue prints——unreal的可视化脚本系统来为演员添加行为。</p><p id="e9e7" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">打开内容浏览器并创建一个名为<code class="du lo lp lq lr b">Blueprints</code>的新文件夹。如果你没有在你的工作区看到它，去<code class="du lo lp lq lr b">Window -&gt; Content Browser</code>。在<code class="du lo lp lq lr b">Blueprints</code>文件夹中，右键单击并创建一个Actor类型的新蓝图类。你可以把它命名为<code class="du lo lp lq lr b">BP_OD</code>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lz"><img src="../Images/72eecf91c4b50d400c0d8a3d23ec7228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*04yxaOIB2KfEmqkzB8YuAw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Content Browser</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ma"><img src="../Images/873c6cfbc3a3f7455c71bf12f4d8a613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0HIEa6wQtQgftz4h7kYWqg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Create Blueprint class of type Actor</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mb"><img src="../Images/be2ad92f70c32883875130ab16a5ac36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2b7gINn5i-_KI-OCbgig1Q.png"/></div></div></figure><p id="2fce" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">双击这个蓝图打开编辑器。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/1c50886a6054870e3d60529ac537fbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJIzZWUPQjNQ1tMGPytlPQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Blueprint Editor</figcaption></figure><h1 id="9dca" class="kq kr hh bd ks kt lu kv kw kx lv kz la in lw io lc iq lx ir le it ly iu lg lh bi translated">添加静态网格组件</h1><p id="f5bb" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">在左边的组件部分，点击<code class="du lo lp lq lr b">Add Component</code>并选择<code class="du lo lp lq lr b">Static Mesh</code>。</p><p id="762f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这个想法是<code class="du lo lp lq lr b">BP_OD</code>的每个实例将有一个相关的静态网格，我们将在其上生成边界框。现在，我们希望能够为不同的实例选择不同的网格。因此，我们将创建一个变量来存储静态网格。</p><p id="4a6b" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在左侧的<code class="du lo lp lq lr b">My Blueprint</code>部分，点击<code class="du lo lp lq lr b">Add New</code>并选择<code class="du lo lp lq lr b">Variable</code>。这将创建一个变量，它的范围仅限于蓝图。它的属性可以在右边的<code class="du lo lp lq lr b">Details</code>部分。将变量重命名为<code class="du lo lp lq lr b">SM_Mesh</code>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/099da1cad53915899ab2eb052c3602f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyxArrszbLtik55UJ5YtUw.png"/></div></div></figure><p id="2db8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Blueprint是一种高度类型化的语言，所以我们需要显式地将变量类型设置为<code class="du lo lp lq lr b">Static Mesh</code>。勾选下面的<code class="du lo lp lq lr b">Instance Editable</code>框；这将确保我们可以在主编辑器中编辑变量。另外，将类别重命名为<code class="du lo lp lq lr b">Object Detection</code>。接下来点击顶部的编译按钮，你应该会看到<code class="du lo lp lq lr b">Default Value</code>部分被激活。将默认值设置为任意静态网格，比如<code class="du lo lp lq lr b">SM_Chair</code>，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mc"><img src="../Images/f060d438f87d233e0523473bd997eb61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHi623IKw3jYLEKTN3bBQw.png"/></div></div></figure><p id="3266" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">接下来是选项栏下面事件图标签旁边的<code class="du lo lp lq lr b">Construction Script</code>标签。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es md"><img src="../Images/6a306a9cd247d7756be073ef53f27d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMnAGuF4ixMNFNZwm03Qcw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Construction Script Editor</figcaption></figure><p id="581e" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">每当蓝图被实例化时，构造脚本就运行。在编辑器中，右键单击并在<code class="du lo lp lq lr b">Static Mesh</code>部分下创建<code class="du lo lp lq lr b">Set Static Mesh</code>节点。将<code class="du lo lp lq lr b">SM_Mesh</code>变量和<code class="du lo lp lq lr b">Static Mesh</code>组件拖到编辑器中，并将其分配给如下所示的节点，然后点击编译按钮。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es me"><img src="../Images/3146a179e1f57d6337a9e4bad3fa43ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mWMRk8iFlDT5Jr1fS-COw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Assign the static mesh stored in SM_Mesh variable to the static mesh component</figcaption></figure><p id="6e9a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这个想法是，一旦构造脚本执行，包含在<code class="du lo lp lq lr b">SM_Mesh</code>变量中的网格就被分配给角色的静态网格组件。</p><p id="050c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了测试这一点，回到主编辑器，将<code class="du lo lp lq lr b">BP_OD</code>类从内容浏览器拖到关卡，你会看到一把椅子。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mf"><img src="../Images/0e91e9958ea1daf362d6b5e889217914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0TdMPjSP0e24xNnwQRFCQ.png"/></div></div></figure><p id="d521" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">此外，我们可以在右侧细节面板下的<em class="mg">对象检测</em>部分的编辑器中更改网格。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mh"><img src="../Images/04a0d8b015d44c9814c8bee4b0a9a68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*BmQkrrH8dVLzsJO9egjGdA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Changing the mesh in the editor</figcaption></figure><p id="d3e0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">好了，我们已经摆好了物品。接下来让我们制作边界框。</p><p id="249c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意:确保你偶尔点击一下保存按钮，以避免在进程中丢失。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="b8d4" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">制作边界框</h1><p id="7a8f" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">我们将创建一个向静态网格组件添加边界框的函数。双击<code class="du lo lp lq lr b">BP_OD</code>并返回蓝图编辑器。在这里，点击<code class="du lo lp lq lr b">My Blueprint</code>部分的<code class="du lo lp lq lr b">Add New</code>并选择功能。将该功能重命名为<code class="du lo lp lq lr b">Get Bounding Points</code>。在<code class="du lo lp lq lr b">Details</code>部分的右侧可以看到功能细节。在这里，将类别设置为<code class="du lo lp lq lr b">Object Detection</code>并勾选<code class="du lo lp lq lr b">Pure</code>复选框。</p><p id="450f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">该函数应该将静态网格组件作为输入，并输出其在世界空间中的边界框坐标。在<code class="du lo lp lq lr b">Inputs</code>部分，点击<code class="du lo lp lq lr b">+New Parameter</code>，选择变量类型为<code class="du lo lp lq lr b">Static Mesh Component</code>，重命名为<code class="du lo lp lq lr b">Static Mesh Comp</code>。在其下方的<code class="du lo lp lq lr b">Outputs</code>部分，点击<code class="du lo lp lq lr b">+ New Parameter</code>，将其重命名为<code class="du lo lp lq lr b">Bounding Points</code>，选择变量类型为<code class="du lo lp lq lr b">Vector</code>，并选择其旁边的框，使其成为容器类型。这也将在编辑器中创建一个返回节点，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/a810ebe1e79fa37b195bc5fd664c01a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bJetyQGe1jqyzjXlzE5jDg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">The function node editor</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mi"><img src="../Images/0a4d39c5c6e596e00159be9a19675cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gaTgkoq0F8fbtwvS0b10tw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Function details</figcaption></figure><p id="8062" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">让我们给函数添加逻辑。你看，虚幻引擎有许多内置功能，足以满足我们的大部分需求。一个这样的函数叫做<code class="du lo lp lq lr b">Get Local Bounds</code>，它返回静态网格组件的最小<em class="mg">和最大</em>边界。然而，这些坐标是相对于网格本身的，而我们希望它们在世界框架中表示。因此，我们的想法是获取网格组件在世界中的位置和方向，并使用它们将局部边界转换为世界边界。</p><p id="f308" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">功能逻辑如下图所示，在此呈现<a class="ae ki" href="https://blueprintue.com/blueprint/x_fruq-0/" rel="noopener ugc nofollow" target="_blank">。你可以直接从网站上复制粘贴到你的编辑器里。</a></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mj"><img src="../Images/3f80ca9221d5c77628376e286baf5579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srxmMMyTrLfNw2KtVpqJvg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">logic for the function Get Bounding Points</figcaption></figure><p id="f193" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">蓝图的伟大之处在于你可以跟踪节点并理解逻辑。</p><p id="7be0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意这里我们使用一个名为<code class="du lo lp lq lr b">Transformed Points</code>的局部变量来存储最终的边界点。局部变量的范围受限于它的函数。除了必须在<code class="du lo lp lq lr b">My Blueprints</code>菜单底部的<code class="du lo lp lq lr b">Local Variable</code>部分创建之外，可以像普通变量一样创建局部变量。如果您已经复制了函数并得到了一个编译错误，创建一个新的局部变量并用现有的<code class="du lo lp lq lr b">Transformed Points</code>变量替换它。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mk"><img src="../Images/cb149d6a1f63d2502a1fd77220287f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*ywbK1E23OOVa5sK_ZQcjAA.png"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ml"><img src="../Images/b4e3b08aa34f6312b006ce630e0d434e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2oXHdVCVO4DG5zC2Qo_Fg.png"/></div></div></figure><p id="e551" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">还要注意我们在这里使用了另一个函数<code class="du lo lp lq lr b">Get Vector Permutations</code>。这是一个简单的函数，它将一个向量作为参数，并按照顺序返回它的排列<code class="du lo lp lq lr b">[(x, y, z), (x, y, -z), (x, -y, z), (x, -y, -z), (-x, -y, z), (-x, -y, -z), (-x, y, z), (-x, y, -z)]</code>。你可以从<a class="ae ki" href="https://blueprintue.com/blueprint/0_g8-7mu/" rel="noopener ugc nofollow" target="_blank">这里</a>复制过来。该函数还使用一个名为<code class="du lo lp lq lr b">Permutations Array</code>的局部变量来存储排列。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mm"><img src="../Images/a499c2f5fc4001c61669f76fec02a773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CE4BNUpuaBbIZ_xOe8Tqw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Get Vector Permutations</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mn"><img src="../Images/91d3f31b7a6df49bf21d8251d3a8a412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tN0KjDTLeevEQsuEe2wEnw.png"/></div></div></figure><p id="7060" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">就是这样。我们现在已经创建了一个函数，它接受一个静态网格组件，并返回它在世界空间中的边界框坐标。</p><p id="38c4" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">让我们想象一下边界框。虚幻引擎有一个我们可以使用的<code class="du lo lp lq lr b">Draw Debug Box</code>节点。它获取对象的位置、方向和比例，并在其周围绘制一个3D框。我创建了一个名为<code class="du lo lp lq lr b">Draw BBox</code>的函数，它使用这个节点来可视化盒子。你可以从<a class="ae ki" href="https://blueprintue.com/blueprint/-7lc337_/" rel="noopener ugc nofollow" target="_blank">这里</a>复制。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mo"><img src="../Images/dd14813c7e9f494669b3c8609e5ab8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-d2QOlUDjpfOO1Dl14DMg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Draw box around a static mesh</figcaption></figure><p id="8e0a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">返回到事件图并设置节点，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mp"><img src="../Images/805de7b2b4b7eee016905e3ef80acc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKBfeJ8zgITQaSll4kqUPg.png"/></div></div></figure><p id="a2d2" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">编译并点击play，你应该会看到边界框。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/0de35618d632456614953d5cc6f4e723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gFtZ_8W-OSGrJhcCQvH8BQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Bounding box on a static mesh object</figcaption></figure><p id="b9ef" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们还没完呢。在计算机视觉中，我们关心图像，所以我们需要捕捉图像并将边界框坐标投影到图像上。让我们先研究后者。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="61c6" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">投影边界框坐标</h1><p id="fae5" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">函数<code class="du lo lp lq lr b">Get Bounding Points</code>返回世界空间中的边界框坐标，但是我们需要它们在图像或屏幕空间中。</p><p id="37b6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">虚幻引擎有一个名为<code class="du lo lp lq lr b">Project World to Screen</code>的节点，它接受玩家控制器和一个点作为输入，并将该点投射到玩家视野的屏幕上。在屏幕空间中，左上角是原点。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mq"><img src="../Images/0a977615237e0f45c394d2e5b7d0a51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aghd6UD1Yn5jcgJVku5LvA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">The screen space</figcaption></figure><p id="c124" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在下面显示的事件图中，我们从函数<code class="du lo lp lq lr b">Get Bounding Points</code>中获得世界空间中的边界框坐标，然后使用<code class="du lo lp lq lr b">for loop</code>将每个点投影到屏幕空间，并将其附加到一个名为<code class="du lo lp lq lr b">Combined Points</code>的字符串数组中，您可以在<code class="du lo lp lq lr b">Variables</code>部分创建该数组。接下来，我们使用函数<code class="du lo lp lq lr b">Join String Array</code>将数组中的所有点合并成一个字符串。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mr"><img src="../Images/c79dae516fd3424e3a966f1f85ab6927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1E1LmPc7Y0yQ-Zj9WPkfA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Project bounding box coordinates to screen space</figcaption></figure><h2 id="7cf0" class="ms kr hh bd ks mt mu mv kw mw mx my la jv mz na lc jz nb nc le kd nd ne lg nf bi translated">写入文件</h2><p id="a096" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">接下来，我们需要将这些坐标写入一个文件。幸运的是，有一个很棒的插件叫做<code class="du lo lp lq lr b">Blueprint FileSDK</code>，你可以在虚幻市场<a class="ae ki" href="https://www.unrealengine.com/marketplace/en-US/product/blueprint-file-sdk?sessionInvalidated=true" rel="noopener ugc nofollow" target="_blank">这里</a>免费获得。将插件安装到引擎，然后转到<code class="du lo lp lq lr b">Edit -&gt; Plugins</code>并启用该插件。重新启动编辑器以使更改生效。</p><p id="95cd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">回到事件图，您现在应该在<code class="du lo lp lq lr b">File SDK</code>部分看到一个名为<code class="du lo lp lq lr b">Write String to File</code>的节点。该节点将要写入的字符串和文件路径作为参数。您可以创建一个变量来存储文件路径，也可以直接在节点中输入。小心，如果指定的路径不存在，编辑器会崩溃。然后对于<code class="du lo lp lq lr b">Content</code>参数，我们使用来自<code class="du lo lp lq lr b">Join String Array</code>节点的输出，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ng"><img src="../Images/59a6dbeefd19387ba6e7ae60b0427306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuC4PfE_TSb5_UD4IHl6SA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">save the coordinates to a file</figcaption></figure><p id="6434" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">记得在节点中检查<code class="du lo lp lq lr b">Append</code>。你可以从<a class="ae ki" href="https://blueprintue.com/blueprint/fe030y6c/" rel="noopener ugc nofollow" target="_blank">这里</a>复制代码。还要注意，我们在写入后清除数组，以避免内存泄漏。</p><p id="ca79" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果您点击compile然后play，您应该会看到填充了屏幕坐标的文本文件，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nh"><img src="../Images/b1864beac8047da248d9192688181710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8rJ5sjD9Muxid1OVynmM1w.png"/></div></div></figure><h1 id="471d" class="kq kr hh bd ks kt lu kv kw kx lv kz la in lw io lc iq lx ir le it ly iu lg lh bi translated">拍摄高分辨率截图</h1><p id="d44b" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">接下来我们需要从玩家视角截图。现在，如果场景中有多个对象，就没有必要对每个对象进行截图。所以我们不会在Actor蓝图中编写截图逻辑，而是使用关卡蓝图。一个关卡蓝图对每个关卡都是独一无二的。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ni"><img src="../Images/a7d1ad87110f1621a24fa15740ea504c.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*UrDfZD2GVnB8JUHI8CZZTA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Level Blueprint</figcaption></figure><p id="fa75" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了截屏，我们使用语法为<code class="du lo lp lq lr b">HighResShot Path resolution (X x Y)</code>的<code class="du lo lp lq lr b"><a class="ae ki" href="https://docs.unrealengine.com/4.27/en-US/WorkingWithMedia/CapturingMedia/TakingScreenshots/" rel="noopener ugc nofollow" target="_blank">HighResShot</a></code>命令，并在控制台中执行它。好在虚幻引擎有一个叫<code class="du lo lp lq lr b">Execute Console Command</code>的蓝图节点，可以直接在控制台执行命令。</p><p id="1dd4" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">打开关卡蓝图，进入事件图编辑器。在那里，创建如下所示的节点。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nj"><img src="../Images/eb602045e86c5f7204e57cc0ab424289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mi_EXaNLtxxNIAy6Rr5qww.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">capture screenshot</figcaption></figure><p id="300c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">游戏一开始，我们就通过<code class="du lo lp lq lr b">Execute Console Command</code>节点执行<code class="du lo lp lq lr b">HighResShot</code>命令，分辨率等于视口大小。</p><p id="4c1f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果你编译并点击play，你会在指定的路径中看到一个截图，并且边框坐标对应于文本文件中的坐标。</p><h1 id="5846" class="kq kr hh bd ks kt lu kv kw kx lv kz la in lw io lc iq lx ir le it ly iu lg lh bi translated">创建事件触发器</h1><p id="06d9" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">现在，当游戏开始时，<code class="du lo lp lq lr b">Begin Play</code>节点被触发，数据被捕获。这并没有给我们太多的控制。我们需要能够随时捕获数据，因此我们需要创建一个自定义触发器来执行代码。这里我们将创建一个<code class="du lo lp lq lr b">Key Pressed</code>触发器。</p><p id="f108" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">进入<code class="du lo lp lq lr b">BP_OD</code>类，在<code class="du lo lp lq lr b">Details</code>菜单下的<code class="du lo lp lq lr b">Input</code>部分，将<code class="du lo lp lq lr b">Auto Receive Input</code>从<code class="du lo lp lq lr b">Disabled</code>改为<code class="du lo lp lq lr b">Player 0</code>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nk"><img src="../Images/2a00288cf682cc1047fd833caeb4b1c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofGtkjDfSYbJKndyWChhrg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Input section of the BP_OD class</figcaption></figure><p id="4de6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">现在在<code class="du lo lp lq lr b">Keyboard Events</code>部分下创建一个按键节点，并用<code class="du lo lp lq lr b">Begin Play</code>节点替换它。在关卡蓝图中做同样的操作。</p><p id="97cf" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">现在，每当我们按下指定的键，屏幕截图和框坐标将被捕获和存储。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="5241" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">结论</h1><p id="3a25" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">你甚至可以添加多个<code class="du lo lp lq lr b">BP_OD</code>actor到这个级别，并且在不改变任何东西(除了文件路径)的情况下捕获他们的数据。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/c50fa897a79204cacdea2fd88c4edbe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUnHATtsh6gm7qx9PcYkxw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Multiple Actors</figcaption></figure><p id="f48a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">就是这样。只需几步，我们就在虚幻引擎中构建了一个可扩展、可定制的数据生成管道。然而，我们还可以做更多的事情！请继续关注深度学习和虚幻引擎中更酷的东西。</p><p id="2ca0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们来连线。你也可以通过<a class="ae ki" href="https://www.linkedin.com/in/neerajkrishnadev/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ki" href="https://twitter.com/WingedRasengan" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。如果你有任何疑问或建议，请告诉我。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h2 id="04f5" class="ms kr hh bd ks mt mu mv kw mw mx my la jv mz na lc jz nb nc le kd nd ne lg nf bi translated">图像制作者名单</h2><p id="88e9" class="pw-post-body-paragraph jm jn hh jo b jp li ii jr js lj il ju jv lk jx jy jz ll kb kc kd lm kf kg kh ha bi translated">本文展示的图片均为作者。</p><div class="nl nm ez fb nn no"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="np ab dw"><div class="nq ab nr cl cj ns"><h2 class="bd hi fi z dy nt ea eb nu ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nv l"><h3 class="bd b fi z dy nt ea eb nu ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nw l"><p class="bd b fp z dy nt ea eb nu ed ef dx translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jg no"/></div></div></a></div></div></div>    
</body>
</html>