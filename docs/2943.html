<html>
<head>
<title>💸 Trick: Almost-Free Jupyter Notebooks on the Cloud!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💸招数:云上几乎免费的Jupyter笔记本！</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/trick-almost-free-jupyter-notebooks-on-the-cloud-1eabcdda7914?source=collection_archive---------3-----------------------#2022-06-30">https://medium.com/mlearning-ai/trick-almost-free-jupyter-notebooks-on-the-cloud-1eabcdda7914?source=collection_archive---------3-----------------------#2022-06-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="1811" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">谷歌云提供了一个优秀的Jupyter笔记本托管服务，名为Vertex AI Workbench，价格相对较高。在某些情况下，我建议使用一个可以让你获得高达91%折扣的老技巧:使用标准模板在计算引擎Spot实例上托管Jupyter笔记本。这种<strong class="ak"> <em class="iw">简单</em> </strong>的解决方案产生了与谷歌托管笔记本服务几乎相同的体验，让您同样高效，并大幅降低成本。事实上，对于像EDA或模型实验这样的短ML任务，它可能是GCP上的最佳解决方案。然而，请注意这里的成本-SLA权衡。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/87dd4849660e393ad5a8d922060e4ecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g6YOnXvlyRGBug_n"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Emile Perron</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="aae0" class="jo jp hh bd jq jr js jt ju jv jw jx jy in jz io ka iq kb ir kc it kd iu ke kf bi translated">vertex work bench——高价位的绝佳体验！</h1><p id="ebfa" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">如果您是数据科学的新手，或者过去五年一直在火星上度过，Jupyter笔记本是最受欢迎的研究、EDAs和基本训练模型的编码环境。一些公司，如DataBricks和网飞，甚至建议在交互工具之外使用它，并将其集成到一些ML/Data管道中。💡</p><p id="a8bd" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">鉴于它们的实用性，谷歌云建立了一个名为Vertex AI Workbench的Jupyter笔记本托管版本。这项出色的服务将Jupyter笔记本电脑的启动时间缩短至60秒以下，并提供各种附加功能，让您的工作流程更加轻松。然而，该服务引入了管理费用，并且仅支持按需实例(并且不支持现场实例)，这使得它对于IMO的非关键任务来说过于昂贵。</p><h1 id="cba0" class="jo jp hh bd jq jr js jt ju jv jw jx jy in jz io ka iq kb ir kc it kd iu ke kf bi translated">深度学习虚拟机—经济高效的替代方案！</h1><p id="8df0" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">幸运的是，谷歌云有一个替代Vertex AI Workbench的产品，名为<a class="ae jn" href="https://cloud.google.com/deep-learning-vm" rel="noopener ugc nofollow" target="_blank">深度学习虚拟机</a>。该产品本质上是预装了ML/DL映像的计算引擎虚拟机，这些映像包括流行的数据科学python库、R、CUDA和TensorFlow。最重要的是，当启动虚拟机时，它会自动运行一个Jupyter实验室服务器，可以通过浏览器访问该服务器。</p><p id="8d45" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">由于DL-VM不是托管服务，因此它们更具可定制性，从而为执行成本优化创造了更多机会。当谈到云上的成本优化时，提到Spot实例是很重要的——事实上，DL-VMs支持这个特性！但是，当然，在用户体验和成本优化之间有一个权衡。要了解更多关于这种权衡的信息，<a class="ae jn" href="https://gadbenram.com/2022/06/27/what-is-the-best-cloud-jupyter-service-on-google/" rel="noopener ugc nofollow" target="_blank">你可以阅读另一篇关于在谷歌上使用不同笔记本服务的优缺点的博客文章</a>。</p><h1 id="d11e" class="jo jp hh bd jq jr js jt ju jv jw jx jy in jz io ka iq kb ir kc it kd iu ke kf bi translated">现货笔记本？</h1><p id="e21a" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">因为DL-VM本质上是具有映像的计算引擎，所以它们可以选择作为Spot实例启动，因此可以享受潜在的Spot折扣，并且不会产生额外的服务管理费用！</p><p id="f029" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">Spot实例是计算引擎虚拟机，与按需定价相比，提供高达<strong class="ki hi"> 91% </strong>的折扣。现货与按需等价物具有完全相同的规格，只有一个缺点:它们可能会突然关闭。Spot实例依赖于特定区域中可用的多余硬件；因此，当其他客户愿意支付全价请求访问时，谷歌会给予他们优先权，并在需求过高时将你从现货机中驱逐出去。使用Spot实例时，请记住:</p><ol class=""><li id="1f9d" class="lh li hh ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated">⚠️当机器<strong class="ki hi">突然关闭</strong>时<strong class="ki hi">突然关闭</strong>。你只能在事情发生前得到一个简短的通知。</li><li id="dadd" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">♻️机器关闭后<strong class="ki hi">可以重启</strong>；不需要创建新的。</li><li id="f066" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">保存在机器<strong class="ki hi">磁盘</strong>上的🗄️数据不会受到关机的影响——它将保留在那里。当机器关闭时，你也要为这些存储付费。</li><li id="e43e" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">😱关闭时，RAM将被清除—因此任何未保存的<strong class="ki hi"> <em class="lv">工作都将丢失</em></strong> :/</li><li id="91fa" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">📈如果您在该地区使用的实例类型有<strong class="ki hi">高需求</strong>，那么<strong class="ki hi">会增加频繁关闭的机会</strong>。</li></ol><p id="50a6" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">那么为什么不把Vertex AI Workbench只与现货机配合使用，获得91%的优惠呢？嗯，谷歌就是不允许。有道理。Spot实例并没有从SLA中受益，而且它违背了Google对可靠用户体验的深刻方法。您不会想到托管服务会因为停机而关闭，对吗？💁‍♂️</p><p id="c756" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">那么如何在现货机上使用Jupyter笔记本呢？让我们快速浏览一下。</p></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><h1 id="ae04" class="jo jp hh bd jq jr md jt ju jv me jx jy in mf io ka iq mg ir kc it mh iu ke kf bi translated">教程:启动Spot深度学习虚拟机</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h2 id="a658" class="mk jp hh bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated"><strong class="ak">第一步:使用安装了gcloud工具的shell(终端)</strong></h2><p id="5b00" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">你可以使用电脑的终端并安装<code class="du my mz na nb b">gcloud</code>命令工具，也可以使用谷歌的托管云外壳。</p><h2 id="f38f" class="mk jp hh bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated"><strong class="ak">第二步:选择您想要运行的图像</strong></h2><p id="e097" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">您可以阅读有关选择图像的内容，但以下是基本信息:</p><ul class=""><li id="b41e" class="lh li hh ki b kj lc km ld kp lj kt lk kx ll lb nc ln lo lp bi translated">跑数据科学？使用干净的<strong class="ki hi">普通</strong>图像</li><li id="62dc" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb nc ln lo lp bi translated">跑深度学习？使用<strong class="ki hi">张量流</strong> / <strong class="ki hi"> PyTorch </strong>图像</li></ul><h2 id="3395" class="mk jp hh bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated"><strong class="ak">步骤3:运行创建实例命令</strong></h2><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="f742" class="mk jp hh nb b fi nh ni l nj nk">export IMAGE_FAMILY="common-cpu"<br/>export ZONE="us-central1-b"<br/>export INSTANCE_NAME="notebook-vm-spot"<br/>export INSTANCE_TYPE="e2-standard-2"<br/>gcloud compute instances create $INSTANCE_NAME \ <br/>       --zone=$ZONE \<br/>       --image-family=$IMAGE_FAMILY \  <br/>       --image-project=deeplearning-platform-release \ <br/>       --maintenance-policy=TERMINATE \<br/>       --machine-type=$INSTANCE_TYPE \<br/>       --boot-disk-size=200GB \<br/>       --provisioning-model=SPOT \<br/>       --instance-termination-action=STOP</span></pre><h2 id="f713" class="mk jp hh bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated"><strong class="ak">第四步:保护电脑和服务器之间的连接</strong></h2><p id="0d69" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">为了确保对笔记本的所有访问都得到授权，谷歌屏蔽了与这台电脑的不安全连接。因此，您需要创建一个从您的设备到笔记本服务器的ssh隧道。听起来很难？不，只有一行代码。</p><p id="bc9b" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">在本地计算机上，运行以下命令:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="256e" class="mk jp hh nb b fi nh ni l nj nk">export PROJECT_ID="my-gcp-project-id"<br/>gcloud compute ssh \<br/> — project $PROJECT_ID \<br/> — zone $ZONE \<br/> $INSTANCE_NAME \<br/> — -L 8080:localhost:8080</span></pre><p id="08b3" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">让你的终端开着，否则连接会丢失😅。</p><h2 id="313d" class="mk jp hh bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated"><strong class="ak">第五步:在本地浏览器中打开Jupyter Lab</strong></h2><p id="794f" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko kp kq kr ks kt ku kv kw kx ky kz la lb ha bi translated">现在只要到你的浏览器打开<a class="ae jn" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>就行了。你可以在你的机器上工作。一定要记得偶尔保存你的工作！</p></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><h1 id="a4a3" class="jo jp hh bd jq jr md jt ju jv me jx jy in mf io ka iq mg ir kc it mh iu ke kf bi translated">提示和高级技巧</h1><ol class=""><li id="a12c" class="lh li hh ki b kj kk km kn kp nl kt nm kx nn lb lm ln lo lp bi translated"><strong class="ki hi">获得现货GPU的几率低</strong>。由于硅硬件的持续短缺，GPU是稀缺资源。如果你使用TensorFlow，考虑使用TPU(尤其是Spot )!</li><li id="1079" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated"><strong class="ki hi">小机器寿命更长</strong>——你的机器利用了多余的硬件。您的实例使用的内核和内存越多，为全价付费客户服务的机会就越大。</li><li id="928f" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">经常保存你的工作！不建议将Spot机器用于训练神经网络等长时间运行的任务。但是，如果您这样做了，请想办法保存您的工作，以便在机器重新启动时可以恢复它。例如:<a class="ae jn" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint" rel="noopener ugc nofollow" target="_blank">每隔几个时期创建一个回调来保存模型</a>。</li><li id="4c09" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated"><strong class="ki hi">定义一个</strong> <a class="ae jn" href="https://cloud.google.com/compute/docs/instances/create-use-spot#handle-preemption" rel="noopener ugc nofollow" target="_blank"> <strong class="ki hi">关闭脚本</strong> </a> — GCP允许您在实例关闭之前运行一个脚本。它可以让你优雅地完成和备份你的工作。</li><li id="ac54" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated"><strong class="ki hi">使用</strong> <a class="ae jn" href="https://cloud.google.com/blog/products/compute/google-compute-engine-gets-new-e2-vm-machine-types" rel="noopener ugc nofollow" target="_blank"> <strong class="ki hi"> E2机器类型</strong> </a>用于EDA和非计算繁重用例。如果您正在使用大型数据集，请使用e2-highmem组来获得每个CPU更多的RAM。</li><li id="d47b" class="lh li hh ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated"><em class="lv">高级提示:</em> <strong class="ki hi">使用GCP的</strong> <a class="ae jn" href="https://cloud.google.com/deployment-manager/docs/configuration/templates/create-basic-template" rel="noopener ugc nofollow" target="_blank"> <strong class="ki hi">部署管理器</strong> </a>创建一个模板，并从那里启动实例。</li></ol></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><p id="92c5" class="pw-post-body-paragraph kg kh hh ki b kj lc ii kl km ld il ko kp le kr ks kt lf kv kw kx lg kz la lb ha bi translated">你觉得这篇博文有帮助吗？欢迎随意转发分享！有什么意见吗？请在这里或在我们的<a class="ae jn" href="https://twitter.com/gadbenram" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我们分享。</p><div class="no np ez fb nq nr"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jh nr"/></div></div></a></div></div></div>    
</body>
</html>