<html>
<head>
<title>Time Series Regression on Walmart’s Stock Price Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">沃尔玛股价数据的时间序列回归</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/time-series-regression-on-walmarts-stock-price-data-13f8402e8437?source=collection_archive---------2-----------------------#2022-04-05">https://medium.com/mlearning-ai/time-series-regression-on-walmarts-stock-price-data-13f8402e8437?source=collection_archive---------2-----------------------#2022-04-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c80a74fb04eb8302ec69097cbca293d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iNe9OaN_1CrKod56FlvGQg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image by <a class="ae it" href="https://pixabay.com/photos/store-stacks-shelves-stock-5619201/" rel="noopener ugc nofollow" target="_blank">pixabay</a></figcaption></figure><p id="c254" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">时间序列分析将日期时间数据作为主要输入，将目标变量作为输出。</p><p id="b9cc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，分析将聚焦于沃尔玛2012年至2016年的股价，数据集可点击此处下载<a class="ae it" href="https://www.kaggle.com/code/kelvinprawtama/walmart-statistical-data-modeling/data" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a892" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据集包含日期时间值和基于条件(开盘、收盘、盘高和盘低)的不同价格。这里的主要目标是预测每天的收盘价。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="1527" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据定义:</p><ol class=""><li id="31ed" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">日期:股票价格的日期值</li><li id="e1d1" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">开盘价:股票市场在给定日期开盘时的开盘价</li><li id="d5b5" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">高:某一特定日期股票的最高价格</li><li id="104e" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">低:某一特定日期股票的最低价格</li><li id="e0c3" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">收盘价格:股票市场在某一特定日期收盘时的收盘价</li></ol><p id="89e7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">指导方针:</p><ol class=""><li id="56e6" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">数据准备</li><li id="7381" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">统计数据分析</li><li id="1cd4" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">模型开发和评估</li></ol><h2 id="4e65" class="kn ko hh bd kp kq kr ks kt ku kv kw kx jf ky kz la jj lb lc ld jn le lf lg lh bi translated"><strong class="ak"> 1。数据准备</strong></h2><p id="a8b0" class="pw-post-body-paragraph iu iv hh iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">在第一部分中，像往常一样，我们将进行几次数据检查，以查看数据集内部是否有任何异常。</p><p id="4ffb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我在以前的文章中已经多次这样做了，所以我不会在这里展示代码，在本文的结尾，我会发布一个链接，供大家参考我为本文编写的代码。</p><p id="2da3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是数据检查的总结。</p><div class="ln lo lp lq fd ab cb"><figure class="lr ii ls lt lu lv lw paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/ed68402cd880d93681531eb6f08d0621.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Bz2t7qz1iPeFUyKLM_8eYQ.png"/></div></figure><figure class="lr ii lx lt lu lv lw paragraph-image"><img src="../Images/319d78b64f3a85737740879cd425e51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*V-8DasiRAP3PZ2ZwyiFuQA.png"/></figure></div><p id="23a5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据集中只有1258行数据和7个唯一的列。毫不奇怪，Kaggle的数据不包含任何重复/空值，尤其是数据点数量较少的情况下。</p><p id="1b25" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是，由于“日期”列数据类型是一个对象，我们必须将其转换为日期时间数据类型，以便进行分析。</p><pre class="ln lo lp lq fd ly lz ma mb aw mc bi"><span id="ab32" class="kn ko hh lz b fi md me l mf mg">from datetime import datetime as dt<br/><br/>df['Date'] = pd.to_datetime(df['Date'])<br/>df['Month'] = df['Date'].dt.strftime('%Y-%m')<br/><br/>df.head()</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/7f7ea38f0919567df6ef01a387b5f3d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oozdQVuCutyfretSEWtFyg.png"/></div></div></figure><p id="fde5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一切都准备好了，我们准备对下一部分进行分析。</p><h2 id="961c" class="kn ko hh bd kp kq kr ks kt ku kv kw kx jf ky kz la jj lb lc ld jn le lf lg lh bi translated">2.统计数据分析</h2><div class="ln lo lp lq fd ab cb"><figure class="lr ii mi lt lu lv lw paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/b5022818ea49800373813fee5ea5e55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*1ykcyxRoXhCwK-lz1vHpAA.png"/></div></figure><figure class="lr ii mj lt lu lv lw paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/0c13374093b49a07d6a5d3526f2fdd9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iCyd3XfOBiPzCWiAPcV1Gw.png"/></div></figure></div><p id="97b3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以上面的图像是每个价格行为的价格分布。我们可以看到，沃尔玛的股价通常在70-80美元之间，80-90美元在较高区间，60美元在较低区间。</p><p id="b11a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由此我们可以得出结论，购买沃尔玛股票以获得最大利润，我们应该瞄准60美元区域，当它达到80-90美元区域时卖出。</p><p id="3333" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，如果价格停留在70美元左右，那么建议保持这个价格，直到随着时间的推移出现牛市。</p><div class="ln lo lp lq fd ab cb"><figure class="lr ii mk lt lu lv lw paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/e2b977d6d50a57e2d3bf6b53fa3223a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ssWWuFjVOmIC2e_uVoYj0g.png"/></div></figure><figure class="lr ii ml lt lu lv lw paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/e80d210f90ffb6aa1a76908c31c28cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*sOTq_MA7ELOD7isWDAkGnQ.png"/></div></figure></div><p id="3e87" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不同状态的模式或多或少类似，从2012年到2015年初呈上升趋势，随后在2016年暴跌。</p><p id="1e9b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">基于股票价格条件(假设历史重演)，那么基于当前的价格行为(2016年末约70美元)，做多是没问题的。由于价格分布图也表明70美元是最常见的数字，那么我们仍然可以投入一些美元美元，并持有直到它达到90美元的峰值(约20%的利润)，如果历史重演，这可能需要持有2年。</p><p id="25fd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，让我们用T检验来看看开盘价与收盘价、最高价与最低价之间的关系。我相信有了这个假设，我们可以安全地假设日内交易的价格结果。</p><p id="274a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">开盘价与收盘价的t检验结果:</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/513c8e927833253ac991e99b24c67cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5ctAg8nXzWXFn_jxH6HnQ.png"/></div></div></figure><p id="6bbd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于开盘价和收盘价，根据日线图，沃尔玛的开盘价和收盘价大致相同。那么单日买卖就不理想了(因为毕竟不会有什么区别)。</p><p id="e9c3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们来看看高价和低价:</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mn"><img src="../Images/75d06131cecb47aa895d96ff19e0c503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXPe8uuoR-f2i5pPQDVl2Q.png"/></div></div></figure><p id="d6d9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">很明显，即使没有T检验，也可以确定高价格和低价格是否有任何相似之处。</p><p id="8e2c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，沃尔玛股价在某一特定日期的高点和低点会有所不同，交易员可以利用这一点来获利。</p><h2 id="361e" class="kn ko hh bd kp kq kr ks kt ku kv kw kx jf ky kz la jj lb lc ld jn le lf lg lh bi translated">3.模型开发和评估</h2><p id="ba0a" class="pw-post-body-paragraph iu iv hh iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">在最后一节中，我将开发一个简单的线性回归模型来预测数据集的连续结果。</p><p id="6847" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但实际上我相信结果会产生一个很高的精度，并且它是过度拟合的(没有足够的数据点)。</p><p id="97e3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，如果你们中的任何人可能有一个更大的股票市场数据集，请随意复制粘贴代码，并根据您的数据集进行调整，越多越好。</p><pre class="ln lo lp lq fd ly lz ma mb aw mc bi"><span id="8669" class="kn ko hh lz b fi md me l mf mg"><em class="mo">#Regression Model for Time Series Data</em><br/>from sklearn.linear_model import LinearRegression<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.preprocessing import StandardScaler<br/>from sklearn.pipeline import Pipeline<br/>from sklearn.compose import ColumnTransformer<br/>from sklearn.metrics import accuracy_score, r2_score, mean_squared_error, mean_absolute_error<br/><br/>df['Month'] = df['Date'].dt.month<br/>df['Year'] = df['Date'].dt.year<br/>df['Day'] = df['Date'].dt.day<br/><br/><em class="mo">#Feature Engineering</em><br/>X,y = df[['Year','Month','Day','Open','High','Low','Volume']], df['Adj Close']<br/><br/>X_train,X_test,y_train,y_test = train_test_split(X,y,test_size = 0.2, random_state = 0)<br/><br/><em class="mo">#Data Preprocessing</em><br/>num_features = [x for x <strong class="lz hi">in</strong> range(len(X.columns))]<br/>num_transformer = Pipeline(steps = [<br/>    ('scale', StandardScaler())<br/>])<br/><br/>preprocessing = ColumnTransformer(transformers = [<br/>    ('preprocess', num_transformer, num_features)<br/>])<br/><br/>lr_model = Pipeline(steps = [<br/>    ('preprocessor',preprocessing),<br/>    ('LinearRegression', LinearRegression())<br/>])<br/><br/><em class="mo">#Train Model</em><br/>lr_model.fit(X,y)<br/>y_pred = lr_model.predict(X)<br/><br/>r2_score = r2_score(y,y_pred)<br/>RMSE = np.sqrt(mean_squared_error(y,y_pred))<br/>MAE = mean_absolute_error(y,y_pred)<br/>print(f'R2 Score : <strong class="lz hi">{</strong>round(r2_score,3)<strong class="lz hi">}</strong>')<br/>print(f'RMSE Score : <strong class="lz hi">{</strong>round(RMSE,3)<strong class="lz hi">}</strong>')<br/>print(f'MAE Score : <strong class="lz hi">{</strong>round(MAE,3)<strong class="lz hi">}</strong>')</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es mp"><img src="../Images/410f4567bd6c1a12fe1aa5b899e142b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*EIXHIjfsczZpzkIsT-Ei0Q.png"/></div></figure><p id="d1e3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我们从上面的模型中得到结果，这并不奇怪，因为该模型实际上读取了所有的数据点。</p><p id="4024" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了更清楚地看到过度拟合的样子，让我们画出结果。</p><pre class="ln lo lp lq fd ly lz ma mb aw mc bi"><span id="d685" class="kn ko hh lz b fi md me l mf mg"><em class="mo">#Let's try to plot the prediction results</em><br/><br/>train = pd.merge(X, y, right_index=True, left_index = True)<br/>train['Date'] = train['Year'].astype(str) + '-' + train['Month'].astype(str) + '-' + train['Day'].astype(str)<br/>train['Date'] = pd.to_datetime(train['Date'])<br/>train = train.drop(['Year','Month','Day'], axis = 1)<br/><br/>y_pred = pd.DataFrame(y_pred)<br/><br/>df_pred = pd.merge(X, y_pred, right_index = True, left_index = True)<br/>df_pred['Date'] = df_pred['Year'].astype(str) + '-' + df_pred['Month'].astype(str) + '-' + df_pred['Day'].astype(str)<br/>df_pred['Date'] = pd.to_datetime(df_pred['Date'])<br/>df_pred = df_pred.drop(['Year','Month','Day'],axis = 1)<br/>df_pred = df_pred.rename(columns = {0 : 'Close'})</span><span id="8192" class="kn ko hh lz b fi mq me l mf mg">actual = train[['Date','Adj Close']]<br/>actual_2 = actual.melt(id_vars = ['Date'])<br/>actual_2 = actual_2.set_index('Date')<br/><br/>predicted = df_pred[['Date','Close']]<br/>predicted_2 = predicted.melt(id_vars = ['Date'])<br/>predicted_2 = predicted_2.set_index('Date')<br/><br/>fig,ax = plt.subplots(1,1, figsize = (10,8))<br/>actual_2.plot(ax=ax, legend = 'Actual')<br/>predicted_2.plot(ax=ax, legend = 'Predicted')<br/>ax.set_title('Actual Vs Predicted')<br/>ax.set_xlabel('Year')<br/>ax.set_ylabel('Price')<br/>ax.legend(['Actual','Predicted'])</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/a5844cd60dadf501b9888596b1a2600a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zw8BWw81ew8U4oXLCPwSpg.png"/></div></div></figure><p id="0033" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以看到，预测结果与实际结果几乎完全吻合，这表明模型“读取”了数据点并导致过度拟合。</p><p id="9866" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了获得更好的结果，我们希望开发一个模型，它可以概括结果并显示趋势(可能80%的准确性就足够了)。</p><p id="a360" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，如果你有一个连续的目标变量，你可以创建一些简单的统计数据分析和回归模型。</p><p id="9731" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我希望你喜欢这篇文章，我想向所有支持我的文章并为我鼓掌的关注者和读者致意。</p><p id="2ae4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以，如果你有任何意见或问题，请随时联系我，我会尽力回答你们。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="e10b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">参考资料:</p><div class="ms mt ez fb mu mv"><a href="https://www.kaggle.com/code/kelvinprawtama/walmart-statistical-data-modeling" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hi fi z dy na ea eb nb ed ef hg bi translated">沃尔玛统计数据建模</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用2012-2016年沃尔玛库存数据</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">www.kaggle.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj in mv"/></div></div></a></div><div class="ms mt ez fb mu mv"><a href="https://www.statisticshowto.com/probability-and-statistics/statistics-definitions/discrete-vs-continuous-variables/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hi fi z dy na ea eb nb ed ef hg bi translated">离散变量与连续变量:如何区分</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">观看视频，或阅读下面的文章:在统计学入门课上，你首先要学习的是…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">www.statisticshowto.com</p></div></div><div class="ne l"><div class="nk l ng nh ni ne nj in mv"/></div></div></a></div><div class="ms mt ez fb mu mv"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hi fi z dy na ea eb nb ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">medium.com</p></div></div><div class="ne l"><div class="nl l ng nh ni ne nj in mv"/></div></div></a></div></div></div>    
</body>
</html>