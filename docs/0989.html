<html>
<head>
<title>Sentiment Classification Using Distil Bert on Custom Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于自定义数据集的提取Bert情感分类</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/sentiment-classification-using-distil-bert-on-custom-dataset-7ecc73b5cb0?source=collection_archive---------1-----------------------#2021-09-10">https://medium.com/mlearning-ai/sentiment-classification-using-distil-bert-on-custom-dataset-7ecc73b5cb0?source=collection_archive---------1-----------------------#2021-09-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/cf1264073bbad0574d538f0c33d9f2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CIk9eO9Xlspfbgp-.jpg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://www.google.com/search?q=space&amp;tbm=isch&amp;ved=2ahUKEwinsrbo3tjyAhUnnEsFHT7KDrUQ2-cCegQIABAA&amp;oq=space&amp;gs_lcp=CgNpbWcQAzIECAAQQzIECAAQQzIHCAAQsQMQQzIHCAAQsQMQQzIICAAQgAQQsQMyCAgAEIAEELEDMggIABCABBCxAzIICAAQgAQQsQMyCAgAEIAEELEDMggIABCABBCxAzoHCCMQ7wMQJzoLCAAQgAQQsQMQgwE6CAgAELEDEIMBOgUIABCABFDKXlibaWDbbGgAcAB4AIABjAGIAZwFkgEDMC41mAEAoAEBqgELZ3dzLXdpei1pbWfAAQE&amp;sclient=img&amp;ei=Ls4sYadjp7iu2g--lLuoCw&amp;bih=577&amp;biw=1280&amp;rlz=1C1CHBD_enIN956IN956#imgrc=H0wrkd5vAwHosM" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><blockquote class="iu iv iw"><p id="6d03" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated"><strong class="ja hi">概述</strong></p></blockquote><p id="5011" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">在这篇文章中，我们将学习端到端的NLP项目，从网站上提取数据，使用现代艺术技术进行情感分析。这还涉及文本清理、文本分析和文本的可视化表示和理解，然后将在云上部署该模型。在这篇文章的结尾，你将有足够的知识来处理几乎任何一种在嘈杂的数据集上的情感分类任务。</p><p id="ba1a" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">我一直在收集的数据集是对电子商务网站上任何特定产品的评论，然后将它们归类为不同的情绪，最后我们将发布测试数据，以检查我们的模型在检测情绪方面的效率。让我们开始吧</p><p id="73f9" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><strong class="ja hi">步骤1 :-构建定制数据集</strong></p><p id="d3e8" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">我们将从电子商务网站收集数据集，并将使用beautiful soup将所有数据集提取到我们的本地系统中。不用担心，我会向你展示使用美丽的汤提取数据的分步指南。</p><figure class="ka kb kc kd fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jz"><img src="../Images/7ff8ff6a86dfb93e039e6606b3ae230b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YiWkCYOvwrdEAzsV"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://www.google.com/search?q=scrapping&amp;rlz=1C1CHBD_enIN956IN956&amp;sxsrf=AOaemvIAs8Efiqjjd3NLVrItKLDmzmnTKg:1630829663489&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwjgu5_2sefyAhVJyzgGHXG4CUcQ_AUoAnoECAIQBA&amp;biw=1280&amp;bih=577#imgrc=pmv17fMwt1sW7M" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><blockquote class="iu iv iw"><p id="1832" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">导入必要的库</p></blockquote><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="8f59" class="kj kk hh kf b fi kl km l kn ko">import requests<br/>from bs4 import BeautifulSoup as bs<br/>from urllib.request import urlopen as uReq<br/>import numpy as np<br/>import pandas as pd</span></pre><p id="cf92" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><code class="du kp kq kr kf b">uReq</code>将要请求url。<code class="du kp kq kr kf b">BeautifulSoup</code>帮助解析html标签中的数据。在这里，我将实现产品链接的自动化，您只需输入自己选择的产品名称，就会弹出该特定产品的评论。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="b22e" class="kj kk hh kf b fi kl km l kn ko">print("Enter the product of your own chice")<br/>product_name=input()<br/>web_link='<a class="ae it" href="https://www.flipkart.com/search?q=" rel="noopener ugc nofollow" target="_blank">https://www.flipkart.com/search?q=</a>'<br/>url=web_link+product.replace(" ","")<br/>url_clinet=uReq(url) #clinet requesting to access the url from servr<br/>url=url_client.read()  #readng the url<br/>url.close() #closing the conncetion<br/>soup=bs(url,'html.parser')</span></pre><p id="e783" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在是时候从列出的产品中去掉一个产品来取消他们的评论了。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="d145" class="kj kk hh kf b fi kl km l kn ko">data_class=soup.find_all('div',{"class":"_1AtVbE col-12-12"})<br/>data=data_class[0] #it indicates we are taking first product from a <br/>                    complete given list present on UI<br/>#list of things i am going to scrap from website<br/>product_name=[] #name of product<br/>comment_header=[] #comment_heading<br/>comments=[] #full description of comment<br/>ratings=[]  #rating of product<br/>user_name=[] #person who has commented about product<br/>likes=[] #people aggreng with the comments<br/>dislikes=[] #people don't agree with comment<br/>region=[] #location from where user has commented</span></pre><p id="33e6" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在，我们将采取我们自己选择的产品自动化，然后将从网站上的美丽的汤的帮助下需要字段。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="8fca" class="kj kk hh kf b fi kl km l kn ko">import requests<br/>from urllib.request import urlopen as uReq<br/>from bs4 import BeautifulSoup<br/>import pandas as pd<br/>import numpy as np<br/>search_product=input()<br/>url="<a class="ae it" href="https://www.flipkart.com/search?q=" rel="noopener ugc nofollow" target="_blank">https://www.flipkart.com/search?q=</a>"+search_product.replace(" ","")<br/>uClient=uReq(url)   #opening the url<br/>url=uClient.read() #reading the url<br/>uClient.close()          #closing the connection this is must needed thing when we are doing scrapping<br/>soup=BeautifulSoup(url,"html.parser") #parsing the html file for given product page<br/>ratings=[]<br/>headings=[]<br/>user_comments=[]<br/>names=[]<br/>likes_count=[]<br/>region=[]<br/>n_data=soup.find_all("div",class_="_1AtVbE col-12-12")   #finding all the product present on requested page<br/>data=n_data[2]<br/>for page in range(1, 45):<br/>    click_data = "<a class="ae it" href="https://www.flipkart.com" rel="noopener ugc nofollow" target="_blank">https://www.flipkart.com</a>" + data.div.div.div.a["href"].format(page)  # clicking on that particular bject link<br/>    req = requests.get(click_data)<br/>    soup_next = BeautifulSoup(req.text, "html.parser")<br/>    comment_boxes = soup_next.find_all("div", class_="col _2wzgFH")<br/>    for comment in comment_boxes:<br/>        rating = comment.find("div", {"class": "_3LWZlK _1BLPMq"})<br/>        if rating is not None:  # if there will be some ratings<br/>            ratings.append(float(rating.text))<br/>        else:  # if the rating will be missing then will add null values<br/>            ratings.append(np.nan)<br/>        heading = comment.find("p", class_="_2-N8zT")<br/>        if heading is not None:<br/>            headings.append(heading.text)<br/>        else:<br/>            headings.append(np.nan)<br/>        user_comment = comment.find("div", class_="t-ZTKy")<br/>        if user_comment is not None:<br/>            user_comments.append(user_comment.text)<br/>        else:<br/>            user_comments.append(np.nan)<br/>        name = comment.find("p", class_="_2sc7ZR _2V5EHH")<br/>        if name is not None:<br/>            names.append(name.text)<br/>        else:<br/>            names.append(np.nan)<br/>        like_count = comment.find("span", class_="_3c3Px5")<br/>        if like_count is not None:<br/>            likes_count.append(like_count.text)<br/>        else:<br/>            likes_count.append(np.nan)<br/>        region=soup_updated.find_all('p',{"class":"_2mcZGG"})</span><span id="942a" class="kj kk hh kf b fi ks km l kn ko">dict1={"header":headings,"comments":user_comments,"user name":names,"number of likes":likes_count,"ratings":ratings} #saving all these data into dictionary file<br/>df=pd.DataFrame(dict1)<br/>df.to_csv("final_result1.csv")</span></pre><p id="b85f" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们创建字典，取出所有废弃的数据集，然后进一步将所有数据集转换为csv格式。</p><p id="3103" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在，我们已经成功构建了自己的自定义数据集。我们会将评级转换为0级或1级，其中0级为正常情绪(4和5级开始评级)，1级为负面情绪(1和2星)，并将忽略中性评级，因为中性评级不会帮助企业改进产品，并且无论是在赞赏还是批评的情况下都不会那么有效。</p><p id="d472" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><strong class="ja hi">第二步:-让我们了解数据</strong></p><p id="5efd" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">在spacy，nltk，textblob和python的帮助下，我制作了一个基本的实用程序文件来进行数据预处理。如果您有兴趣使用该文件，请单击此链接，通过简单的导入，您可以使用所有必要的预建预处理功能来清理和理解文本。</p><p id="ffb4" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">从数据集获取基本信息；</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2ced" class="kj kk hh kf b fi kl km l kn ko">data=pd.read_csv('custom_data.csv')<br/>data.head()</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kt"><img src="../Images/b40a4bb3fab10503a22eb2638653ce62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hby0UcPkb-lY9JQIeRMmg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 1</figcaption></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="c9f1" class="kj kk hh kf b fi kl km l kn ko">data.shape #number of rows and column in dataset<br/>[out]&gt;&gt; (1850, 5)</span></pre><p id="79c3" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">将评级4和5转换为正面评级，否则评级为负面。这可以使用应用功能来完成；</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="7686" class="kj kk hh kf b fi kl km l kn ko">def rating_into_sentiment(x):<br/>  if x&gt;3:<br/>    return 0<br/>  else:<br/>    return 1<br/>data['ratings']=data['ratings'].apply(rating_into_sentiment)<br/>data.head(10)</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ku"><img src="../Images/dd0b69635479485c023716bfa3eb5aa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_H_decs3u8AG7IyBRbSQg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 2</figcaption></figure><p id="b1e5" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们检查一下数据集中是否有空值，如果有，我们可能会删除该数据集。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ac0c" class="kj kk hh kf b fi kl km l kn ko">data.isnull().values.any()</span><span id="6ac3" class="kj kk hh kf b fi ks km l kn ko">[out]&gt;&gt; False</span></pre><p id="4dbc" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">导入已经创建并存储在实用程序文件中的所有基本函数。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="4655" class="kj kk hh kf b fi kl km l kn ko">from utils import char_count<br/>from utils import word_count<br/>from utils import stop_word_count<br/>from utils import email_removal<br/>from utils import mention_count<br/>from utils import numeric_digit_count<br/>from utils import upper_case_count<br/>from utils import lower_case_conversion<br/>from utils import cont_to_exp<br/>from utils import remove_mul_space,spelling_correction,remove_spec_char<br/>from utils import remove_stop_words,remove_ac_char<br/>from utils import base_root_form,remove_common_words,remove_rare_words</span></pre><p id="301f" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">应用上述导入的函数来了解更多关于数据的信息。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="b33e" class="kj kk hh kf b fi kl km l kn ko">data['cont_to_exp']=data['comments'].apply(cont_to_exp)<br/>data['upper_case_count']=data['comments'].apply(upper_case_count)<br/>data['stop_word_count']=data['comments'].apply(stop_word_count)<br/>data['word_count']=data['comments'].apply(word_count)<br/>data['char_count']=data['comments'].apply(char_count)<br/>data['comments']=data['comments'].apply(remove_mul_space)<br/>data['comments']=data['comments'].apply(remove_spec_char)<br/>data['comments']=data['comments'].apply(remove_stop_words)<br/>data['comments']=data['comments'].apply(remove_ac_char)<br/>data['comments']=data['comments'].apply(base_root_form)</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kv"><img src="../Images/593eedbbc6b725ff32243384f3aa2cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYOecr2cNG6OrK_r4kFZ2Q.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 3</figcaption></figure><p id="d4bf" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">在这里，我们可以看到我们能够从数据集中删除所有不需要的文本，现在我们的数据集已清理完毕，可以创建模型了，但在此之前，我们将进行一些探索性的数据分析，以了解文本的性质以及评论如何以及在何处影响评分。</p><p id="8734" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><strong class="ja hi">第三步:-探索性数据分析</strong></p><p id="e05e" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">导入文本可视化所需的必要库。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2253" class="kj kk hh kf b fi kl km l kn ko">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>from wordcloud import WordCloud</span></pre><p id="1c84" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">我们来看看评论中出现的赞数是如何影响情绪的。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="1bb5" class="kj kk hh kf b fi kl km l kn ko">sns.set_style('darkgrid')<br/>sns.kdeplot(data[data['ratings']==0]['number of likes'],shade=True,color='red')<br/>sns.kdeplot(data[data['ratings']==1]['number of likes'],shade=True,color='green')<br/>plt.title("like affecting the sentiment")<br/>plt.show()</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es kw"><img src="../Images/1cb7ba604901ea72f4b6ee61d281bd6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*4bju_7PaEN31ALV3FFCTzA.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 5</figcaption></figure><p id="7a57" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">如果我们看到上面的数字，我们可以理解，更多的人点击喜欢那些有利于产品的评论。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="b4b3" class="kj kk hh kf b fi kl km l kn ko">plt.figure(figsize=(6,8))<br/>sns.set_style("ticks")<br/>data['ratings'].value_counts().plot.pie(autopct='%0.2f%%')<br/>plt.title("Percentage Contribution")<br/>plt.xlabel("percent contribution")<br/>plt.ylabel("target")<br/>plt.show()</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es kx"><img src="../Images/83bd2801b07e3dd1f38f1cd75c6070dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*U9HWWDyJAdXJy7crV5W-LA.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 6</figcaption></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="0a63" class="kj kk hh kf b fi kl km l kn ko">sns.set_style('darkgrid')<br/>sns.kdeplot(data[data['ratings']==0]['char_count'],shade=True,color='red')<br/>sns.kdeplot(data[data['ratings']==1]['char_count'],shade=True,color='green')<br/>plt.title("like affecting the sentiment")<br/>plt.show()</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es kw"><img src="../Images/bd625c0ac81879fca39fc3a3d9147b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*Y3XHXvr8DhZ-0518ONa49g.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 7</figcaption></figure><p id="0c9a" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">评论的长度表明了评级的性质。评论越长，获得产品正面反馈的机会就越大。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="bdea" class="kj kk hh kf b fi kl km l kn ko">sns.set_style('darkgrid')<br/>sns.countplot(data['ratings'])<br/>plt.show()</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/77e30fd0ed4d1cc4ed2fe6dfffaef134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*BsmcnyO5wWEot9B-H8BGMg.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 8</figcaption></figure><p id="33d3" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">数据集偏向于正面评价，这意味着更多的人对购买感到满意。</p><p id="b7a8" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们对肯定句和否定句进行词云可视化，观察在肯定句和否定句中常见的词有哪些。</p><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es kz"><img src="../Images/ff724443c9900d59009c6a6ad917b571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*RGgIfS6fkDZX0U6pazZK1g.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 8</figcaption></figure><p id="b4bb" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">显然，我已经对realme手机进行了评级，上面的单词云中的单词也显示了ram、电池、备份等单词。</p><p id="9734" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在我们已经完成了清理和可视化，我们将准备在文本中应用SOTA模型，以获得更好的预测。</p><p id="bced" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><strong class="ja hi">第四步:-模型构建</strong></p><p id="3181" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">我们将使用KTrain wrapper构建keras，使用tensorflow构建SOTA模型。我们将80%的原始数据用于训练集，20%的数据用于验证集。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="c25a" class="kj kk hh kf b fi kl km l kn ko">from sklearn.model_selection import train_test_split<br/>data_train,data_test = <br/>              train_test_split(data,test_size=0.2,random_state=1)</span></pre><p id="982c" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们使用KTrain文本构建情感分类器模型。现在，我们将通过使用distil bert预处理来进行预处理或将文本嵌入到数值中。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="38e0" class="kj kk hh kf b fi kl km l kn ko">(x_train,y_train),(x_test,y_test),preprocess=<br/>      text.texts_from_df(data=data_train,text_column='comments',<br/>                         label_columns='ratings',    <br/>                        'preprocess_mode='distilbert')</span></pre><p id="e7e2" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们建立KTrain模型，第一步将是选择我们想要用于情感分析的模型。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2206" class="kj kk hh kf b fi kl km l kn ko">train,test,preprocess=text.texts_from_df(data_train,text_column <br/>                      ='comments',label_columns='ratings' <br/>                       ,preprocess_mode='distilbert',maxlen=100)</span></pre><p id="e232" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在，我们将根据我们的定制数据对distil bert模型进行微调，然后在我们微调的权重的帮助下，我们将预测购物网站上提供的评论的情绪。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="0fe2" class="kj kk hh kf b fi kl km l kn ko">model=text.text_classifier('distilbert',train_data=train,preproc <br/>                   =preprocess,verbose=1)</span></pre><p id="304c" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">现在我们将借助<code class="du kp kq kr kf b">ktrain.learner </code>对模型进行包装，并进一步用于模型的预测。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2e88" class="kj kk hh kf b fi kl km l kn ko">learner=ktrain.get_learner(model,train_data=train,val_data=test, <br/>                           batch_size=32)<br/>learner.fit_onecycle(lr=2e-5,epochs=4)</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/25f0472f56e97f213dccc29f5a76fb1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*333CelwWcmqBcgPfXpY2Lw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 9</figcaption></figure><p id="f13a" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">由于数据集很小，并且以良好的方式进行了预处理，所以我能够获得100%的准确率，这在具有各种评论和未清理且杂乱数据的大型数据集的情况下是不可能的。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="33d9" class="kj kk hh kf b fi kl km l kn ko">predictor=ktrain.get_predictor(learner.model,preprocess)</span></pre><p id="8620" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们将模型保存在google drive中，以便它可以进一步用于预测结果。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="82ab" class="kj kk hh kf b fi kl km l kn ko">from google.colab import drive<br/>drive.mount('/content/drive')<br/>predictor.save('/content/drive/MyDrive/distilbert')</span></pre><p id="e4ea" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">让我们获取一些文本数据，然后根据我们根据自己构建的定制数据调整的模型来预测评论的情绪。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="4e7f" class="kj kk hh kf b fi kl km l kn ko">data='''Let me get straight to the point.From day 1 this phone hangs.multitasking performance is very bad.. sometimes wifi gets disconnected automatically..apps like whatsapp take 15 seconds to open.and flipkart 20-25 seconds.In the time of usb type c,we are getting micro usb.charging takes a long time..and 2 gb ram is not sufficient to run apps..phone is good for just to make calls..and do light works.not meant for multi tasking'''</span></pre><p id="b15e" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">创建一个帮助函数来帮助我们预测结果。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="1731" class="kj kk hh kf b fi kl km l kn ko">def prediction(data):<br/>    if predictor.predict([data])=='rating':<br/>        return 'Positive Sentiment'<br/>    else:<br/>        return 'Negative Sentiment'<br/>prediction(data)</span></pre><figure class="ka kb kc kd fd ii er es paragraph-image"><div class="er es lb"><img src="../Images/4502c7f7f169196d89aa3df1f6466202.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*lSDDglJSkBH2cUCtG0Gj6A.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">figure 10</figcaption></figure><p id="bce1" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">就像上面flipkart的一个realme产品的评论一样，用户给出了一个星级，这肯定意味着用户对产品不满意，并且给出了对产品不利的评论，是的，我们的模型能够正确预测结果。</p><p id="d3a0" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated"><strong class="ja hi">结论:- </strong></p><p id="b435" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">如果你对这个博客的改进有任何建议，这都是我的观点。感谢您抽出宝贵的时间阅读这篇博客。不断学习，不断探索………。</p></div></div>    
</body>
</html>