<html>
<head>
<title>Continuous Machine Learning on Huggingface Transformer with DVC including Weights &amp; Biases implementation and Converting weights to ONNX.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DVC对Huggingface Transformer进行连续机器学习，包括权重和偏差实现以及将权重转换为ONNX。</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/continuous-machine-learning-on-huggingface-transformer-with-dvc-including-weights-biases-6a909983e48e?source=collection_archive---------6-----------------------#2022-01-26">https://medium.com/mlearning-ai/continuous-machine-learning-on-huggingface-transformer-with-dvc-including-weights-biases-6a909983e48e?source=collection_archive---------6-----------------------#2022-01-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="d668" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">作者</h1><p id="fe65" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">纳巴润巴鲁阿</strong></p><p id="b7cc" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae kf" href="https://github.com/nabarunbaruaAIML" rel="noopener ugc nofollow" target="_blank">Git</a>/<a class="ae kf" href="https://www.linkedin.com/in/nabarun-barua-aiml-engineer/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>/<a class="ae kf" rel="noopener" href="/@nabarun.barua">towards data science</a></p><p id="cf3d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">阿尔琼·库姆巴克拉</strong></p><p id="57fe" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae kf" href="https://github.com/arjunKumbakkara" rel="noopener ugc nofollow" target="_blank">Git</a>/<a class="ae kf" href="https://www.linkedin.com/in/arjunkumbakkara/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>/<a class="ae kf" rel="noopener" href="/@arjunkumbakkara">towards data science</a></p><h1 id="4d8d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">简介:</h1><blockquote class="kg kh ki"><p id="a1d5" class="jc jd kj je b jf ka jh ji jj kb jl jm kk kc jp jq kl kd jt ju km ke jx jy jz ha bi translated">这个项目的主要思想是解释如何在NLP项目中实现CML，因此这个项目的主要重点是解释如何实现CML。我们假设用户很熟悉🤗变形金刚，DVC，ONNX &amp; Weights &amp; bias(Wandb)实施。</p></blockquote><p id="6f7b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下面是用于构建这个项目的在线资源。</p><p id="4f79" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下面是用于构建这个项目的在线资源。</p><ul class=""><li id="8d86" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz ks kt ku kv bi translated"><a class="ae kf" href="https://www.youtube.com/playlist?list=PL7WG7YrwYcnDBDuCkFbcyjnZQrdskFsBz" rel="noopener ugc nofollow" target="_blank"> DVC Youtube播放列表</a>和<a class="ae kf" href="https://cml.dev/doc/self-hosted-runners?tab=AWS" rel="noopener ugc nofollow" target="_blank"> DVC CML官方文档</a></li><li id="0ffb" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated">官方拥抱脸网站</li><li id="dc11" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated"><a class="ae kf" href="https://docs.wandb.ai/guides/integrations/huggingface" rel="noopener ugc nofollow" target="_blank">权重&amp;偏向公文</a></li></ul><p id="cf07" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在我们开始会话之前，需要设置以下几项内容:</p><ul class=""><li id="30fc" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz ks kt ku kv bi translated">一个具有EC2和S3开发人员访问权限的AWS IAM用户</li><li id="d2a9" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated">存储数据集的S3存储桶</li><li id="3ed1" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated">如果没有提前完成，则需要提前请求第二个EC2 Spot实例。</li></ul><p id="7807" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">请遵循这些在线资源AWS相关信息</p><ul class=""><li id="15f7" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz ks kt ku kv bi translated"><a class="ae kf" href="https://www.youtube.com/watch?v=rYHt0gtRKFg&amp;t=180s" rel="noopener ugc nofollow" target="_blank"> Youtube资源1 </a></li><li id="8d12" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated"><a class="ae kf" href="https://www.youtube.com/watch?v=GCt-cymgdvo" rel="noopener ugc nofollow" target="_blank"> Youtube资源2 </a></li><li id="b914" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz ks kt ku kv bi translated"><a class="ae kf" href="https://towardsdatascience.com/choosing-the-right-gpu-for-deep-learning-on-aws-d69c157d8c86" rel="noopener" target="_blank">用于右GPU选择</a>和同一个<a class="ae kf" href="https://www.youtube.com/watch?v=4bVrIbgGWEA" rel="noopener ugc nofollow" target="_blank"> Youtube链接</a></li></ul><p id="6dfb" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi lb translated"><span class="l lc ld le bm lf lg lh li lj di">在</span>这个项目中，我们希望为<a class="ae kf" href="https://www.kaggle.com/hassanamin/atis-airlinetravelinformationsystem" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a>实现变压器分类，想法是实现DVC，以便我们可以从DVC工作室做实验，而在变压器权重&amp;偏差有一个内置的实现，允许保存最佳模型的权重&amp;矩阵。</p><p id="2851" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我们可以使用DVC进行度量跟踪，但需要进行进一步的更改和实施。另一方面，Weights &amp; Biases只需要对任何transformer代码进行最小化的修改就可以开始跟踪。<strong class="je hi">我认为使用权重&amp;偏差的一个主要优点是，它保存了最佳模型，否则我们必须在每次实验后进行。</strong></p><p id="11ce" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现在，我相信我们已经完成了这个项目的目标和清晰的愿景。</p><p id="edb8" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">让我们从点击并进入这个<a class="ae kf" href="https://github.com/nabarunbaruaAIML/project-template-with-DVC" rel="noopener ugc nofollow" target="_blank">模板库</a>开始</p><p id="c952" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">一旦进入模板库，请点击按钮<strong class="je hi">使用此模板</strong>。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lk"><img src="../Images/75906ff631e585a273a9c6b740ed3880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*enMjJ0ZooH8txpac.jpg"/></div></div></figure><p id="9749" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">然后填写详细信息，并根据模板创建存储库。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lw"><img src="../Images/61f53d050e3a1d2fb1f1b3cb2f68fc7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hJecGYUHGvSS-DED.jpg"/></div></div></figure><h1 id="3b46" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">概述:</h1><p id="e837" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">为什么是DVC？</strong></p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es lx"><img src="../Images/a31cfdd7986bde523e5cbc18278e4b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/0*Od_0wyypEfGbV0yD.png"/></div></figure><p id="91f2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">对于大多数用例，数据处理或ML管道通常从大型原始数据集开始，包括中间特征化和训练阶段。然后，这最终产生最终的调整模型以及所需的准确性度量。仅仅对这些大型数据文件和目录进行版本控制是不够的。我们还需要理解数据是如何被过滤、转换、丰富(如果是这样的话)，或者最终用于训练ML模型的？DVC引入了一种机制来捕捉和监控这些数据管道——产生最终结果(最终状态为图形)的一系列数据过程。DVC管道及其数据也可以很容易地版本化(使用Git)。这可以让你更好地组织你的项目，并在需要的时间和地点重现你的工作流程，结果完全可以超越它！</p><p id="26bf" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">为什么是S3？</strong></p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ly"><img src="../Images/45cf7f51e51e5ef8e77d76d0e4761f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OD8dMJS-H7vneGZX.jpg"/></div></div></figure><p id="2e9d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Amazon S3 is what we have used as a remote storage for Data .Firstly, starting with the platform github, we have restrictions storing data at scale in github (limit being as little as 100mb) .Secondly, as part of best practices , it is never considered safe to store data on Code repositories (be is privately hostel Github,Gitlab,Bitbucket etc) As the enterprise softwares thes days have a prerequisite to be GDPR compliant. The secrecy of data is of high importance. Now, Amazon S3 being one of the most reliable and secure storage , we chose it for our use case too. S3 is also highly agile and has the all-time availability trait.We may for the most part find it difficult to sometimes store and manage data, however, with S3 its such a breeze to manage data at such low costs. (You can also refer the Boto-core section above for integration information) So head over to amazon S3 setup the account and create a bucket with a decent storage. This bucker can then be connected to for file transferring using tools like Putty,MobaXterm,FileZilla etc. This way you can place the files and get the location .</p><p id="38c7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">Why EC2?</strong></p><p id="708f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">EC2 is a cost efficient virtual server in Amazon’s Elastic Compute Cloud for Amazon Web Services . Its highly elastic, scalable and reliable when it comes to Failover management and information security.There are out of the box features such as Elastic Load balancing which automatically distributes the traffic to the active instances and recovers the unhealthy instances. However , we would be using these features only during out deployment pipeline. So, to perform the model training, you would have to have an instance of the below kind at the least:</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lz"><img src="../Images/13949190b76e8dd92dd68ca0b5e215dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VJlYt8EqpXSbuqbf.png"/></div></div></figure><p id="a2f2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Because, as we know, Transformers are resource-intensive .</p><p id="a00a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">Is there a Rigid File Structure for DVC?</strong></p><p id="a271" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Yes, More than rigidity it means a standard which way it becomes very easy for organization and continuous iterations of change</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es ma"><img src="../Images/8a122d23cc18f7ccce96319e72a9e336.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/0*_VBSiZZU_B5dLfRl.png"/></div></figure><p id="f62d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">As seen above, stage_01_load_save.py , stage_02_prepare_dataset.py , stage_03_train.py, stage_04_onnx.py &amp; stage_05_Model_Evalution.py are the stages of the DAG or the DVC pipeline. yaml files such as dvc.yaml( <strong class="je hi">This File controls the Pipeline</strong>) , params.yaml ( <strong class="je hi">This file Contains all the Parameters which are needed to perform experiments on Training Pipeline via DVC Studio</strong>) and config.yaml( <strong class="je hi">This file contains all the configurations for the training pipeline</strong>) carries the major mandatory configurations. dvc.yaml being the control file here with all the Stage details like follows :</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es mb"><img src="../Images/7de485ef3481af42bd24322628c920f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/0*6NVkRBqT7CS0hUDg.png"/></div></figure><p id="3786" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">The all_utils.py can be seen as a collection of operational python functions which is such that it is modular and reusable which constitutes File operations etc</p><p id="a22e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">Architecture:</strong></p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mc"><img src="../Images/4172a5997fef68de3a7b3e2732b3aed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZea4ksJvW76EqlHiAME_Q.jpeg"/></div></div></figure><p id="f13a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">The architecture of this entire project is broadly divided into three</p><ol class=""><li id="6739" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz md kt ku kv bi translated">Training</li><li id="c43b" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">Deployment and</li><li id="db05" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">然而，与这个库相关的架构可以在下面的章节中看到。</li></ol><h1 id="8bc3" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">DVC的阶段和标准文件:</h1><p id="f309" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">阶段:</strong></p><p id="58c5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在这个培训管道中，我们有三个线性排列的主要阶段。</p><ol class=""><li id="6078" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz md kt ku kv bi translated">加载并保存数据(stage_01_load_save.py):在这里，从S3存储桶加载数据，并完成tockenization。</li><li id="9aac" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">数据集的准备(stage_02_prepare_dataset.py)这里的训练测试拆分，为模型训练进行数据的预处理。</li><li id="f8e0" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">训练模型(stage_03_train.py)此处，模型使用所需的超参数和回调进行训练。最后，模型权重将保存在wandb(权重和偏差)中。可以使用wandb api获取。(有关更多详细信息，请参考相应的文档)</li><li id="3a86" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">将模型转换为Onnx (Stage_04_Onnx.py)这里我们将权重转换为Onnx运行时框架。标准的Transformer Onnx convertion是可用的，但我们认为它不可用于序列分类，因此我们使用自己的逻辑将权重转换为Onnx运行时框架。除了转换之外，我们还量化Onnx模型，并将其推至权重和偏差以及S3桶，原因是如果组织不使用权重和偏差，那么个人仍可以获得S3桶中的权重，同时考虑到信息安全合规性，这是当前的需要。建议将砝码存放在安全的地方，如S3等。我们从txtai 的这款<a class="ae kf" href="https://colab.research.google.com/github/neuml/txtai/blob/master/examples/18_Export_and_run_models_with_ONNX.ipynb#scrollTo=XMQuuun2R06J" rel="noopener ugc nofollow" target="_blank">笔记本中获取了开发参考。如果你是Onnx的新手，那么请参考来自</a><a class="ae kf" href="https://www.youtube.com/watch?v=7nutT3Aacyw" rel="noopener ugc nofollow" target="_blank"> Abhishek Thakur </a>的视频来了解Onnx的基础知识。他尽可能简单地解释了这件事。我们在实施时面临的一个问题是Albert Transformer模型，它的大小为46 MB，转换为Onnx时为341 MB，这对我们来说很奇怪，我们实施的Onnx团队给出了解决方案。关于<a class="ae kf" href="https://github.com/arjunKumbakkara/onnx_model_size_compression" rel="noopener ugc nofollow" target="_blank">的解释</a>，请参考该知识库。【ONNX团队关于解决方案正确性的摘录:作为BERT优化的一部分，ALBERT模型在各层之间共享权重。随着模型尺寸变大，export torch.onnx.export将权重输出到不同的张量。使用<a class="ae kf" href="https://github.com/arjunKumbakkara/onnx_model_size_compression/blob/main/weight_onnx_runtime_compression.py" rel="noopener ugc nofollow" target="_blank"> Repo </a>的python脚本，我们可以删除重复的权重，并减少模型大小，即，比较每对初始值设定项，当它们相同时，只需删除一个初始值设定项，并将它的所有引用更新到另一个初始值设定项。</li><li id="2bcc" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">在stage _ 05 _ Model _ Evalution.py中，我们正在进行Onnx模型评估，并将重量和日志转移到S3桶和重量和偏差。</li></ol><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mc"><img src="../Images/facba37e6150fc6ec3c8760e75c11799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXPWXsT28WMwzXGYS3jh5A.jpeg"/></div></div></figure><p id="60c2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">标准文件:</strong></p><ol class=""><li id="168e" class="kn ko hh je b jf ka jj kb jn kp jr kq jv kr jz md kt ku kv bi translated">DVC . YAML——它充当支点文件，以线性或其他方式组织定义在其中的阶段。标记“deps”(这些是该阶段的依赖文件)、“params”(params . YAML中与该阶段相关的所有参数)、“outs”(该阶段运行后的输出文件)。)dvc.yaml基本上容纳了构成阶段的DAG关系。</li><li id="e301" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">params.yaml —该文件存放了所有需要随时更改的可配置参数。这在实验管理中有很大的帮助。例如，如果你通过DVC工作室登录，这个文件的参数可以单独改变，管道可以作为实验运行。</li><li id="e9c7" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">config.yaml —目录、文件名等配置保存在这里，以便随时更改。</li><li id="438b" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">ci-cd.yml —这是定义github动作工作流的地方。这里我们定义了挂钩事件(推送、重置基础、部署等)和下面的事件链。亮点是它能够从所有主要的云服务提供商(AWS、Azure、GCP、Digital Ocean或任何自定义云实例)注册一个cloud runner实例，只需将API访问键配置为环境变量。自定义命令字符串也可以配置为在每个作业的文件的run部分下运行。</li><li id="9508" class="kn ko hh je b jf kw jj kx jn ky jr kz jv la jz md kt ku kv bi translated">all_utils.py —这是所有实用程序方法的集合，例如使用Shutil的高级文件操作、加载、解析、json转储、yaml等。</li></ol><h1 id="9a17" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">现在，按照以下步骤启动项目:</h1><p id="972f" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">步骤01-在克隆使用模板Repo后新创建的存储库后，创建本地存储库。如果使用windows系统，我们可以使用git bash进行克隆。如果Linux/Mac OS，那么终端将工作。</strong></p><p id="6940" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤02——在打开存储库invscode后创建一个conda环境</strong></p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="3b69" class="mj if hh mf b fi mk ml l mm mn">conda create --prefix ./env python=3.7 -y</span></pre><p id="c62c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">通过执行以下命令激活VSCode中的环境:</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="23a5" class="mj if hh mf b fi mk ml l mm mn">conda activate ./env</span></pre><p id="1c4d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">运筹学</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="b319" class="mj if hh mf b fi mk ml l mm mn">source activate ./env</span></pre><p id="1087" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤03-安装需求</strong></p><p id="e261" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在执行以下命令之前，在此取消对<strong class="je hi"> DVC </strong>的注释</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="ec31" class="mj if hh mf b fi mk ml l mm mn">pip install -r requirements.txt</span></pre><p id="cad3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">执行上述命令后，请<strong class="je hi">在requirements.txt文件中注释DVC </strong></p><p id="1ef2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤04-初始化dvc项目</strong></p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="3e85" class="mj if hh mf b fi mk ml l mm mn">dvc init</span></pre><p id="33f5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">本地测试:</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="41d4" class="mj if hh mf b fi mk ml l mm mn">dvc repro</span></pre><p id="c0cc" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这可用于在没有CML启用的github操作的情况下运行管道。这也将满足整个管道。然而，在这种情况下，代码命令需要从基于实例的代码内部运行，比如Ec2或带有适当GPU的本地linux/win系统。如果这需要在cpu上完成，确保将requirements.txt中的transformer依赖项更新为CPU版本。(请参考官方文件)</p><p id="cc66" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤05-启动EC2实例</strong></p><p id="9da2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">由于我们没有使用aws EC2 Spot实例，因此我们没有在ci-cd.yml文件中创建实例。因此，我们需要一个支持GPU的EC2实例，并在EC2的终端中执行以下命令。</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="9111" class="mj if hh mf b fi mk ml l mm mn">docker run --gpus all dvcorg/cml-py3 nvidia-smi</span></pre><p id="0a97" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">然后</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="acc2" class="mj if hh mf b fi mk ml l mm mn">docker run --name myrunner -d --gpus all \<br/>    -e RUNNER_IDLE_TIMEOUT=1800 \<br/>    -e RUNNER_LABELS=cml,gpu \<br/>    -e RUNNER_REPO="https://github.com/USER_ID/REPO_NAME" \<br/>    -e repo_token=REPO_Token \<br/>    dvcorg/cml-py3</span></pre><p id="b4fb" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">保持EC2实例运行，以便我们可以在GitHub操作中使用它。工作流完成后，您可以关闭或终止EC2实例。此外，可以在github的cloud runner部分找到与Github存储库锁在一起的同一个实例，它被列为runner。</p><p id="1c86" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤06——提交并将变更推送到远程存储库</strong></p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="9e32" class="mj if hh mf b fi mk ml l mm mn">git add .<br/>git commit -m "Detailed Commit for further reference"<br/>git push origin master    # Branch of choice</span></pre><p id="4150" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤07-流水线推送操作触发器</strong></p><p id="fbe1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果所有必需的API键和配置都以相同的顺序就位，推送操作将触发整个训练管道，如上所述。</p><p id="450f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤08-推送为Github事件:</strong></p><p id="6bf3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Github通过github工作流将Push作为一个事件来监听。然后，这将启动工作流中定义的管道，如下面的Actions选项卡所示</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mo"><img src="../Images/73928aad1a56d17a8edb350df155de94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D-a6l9T8MZ-lP-bb.png"/></div></div></figure><p id="c267" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">配置的DVC阶段现在在EC2( Ubuntu 18 OS)配置的实例(我们的例子)中一个接一个地执行，否则如果实例没有配置，那么github在内部的spot实例上运行这些，并且在整个管道完成之后，它还清理所利用的资源，只给我们留下保存的指标和最佳模型。</p><p id="d893" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如前所述，各阶段的执行顺序如下:</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mp"><img src="../Images/2e76f6c43cd57d16bc39d7b0aacac78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yAEyjsnX5RS-YbkV.png"/></div></div></figure><p id="5edc" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">同样的详细日志也可以通过点击以下步骤找到:现在如下所示，培训开始和结束</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mq"><img src="../Images/424bbf4a83a8e69097086296c5e5f8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qT9G-nFtyQEYurJY.png"/></div></div></figure><p id="b442" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果我们使用Github的专用实例而不是spot实例，自定义级别的日志(info、debug、error)也可以从EC2实例定制和访问。</p><p id="978a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤09-实验管理:</strong></p><p id="ca30" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">DVC工作室— <a class="ae kf" href="https://studio.iterative.ai" rel="noopener ugc nofollow" target="_blank"> DVC工作室</a>这有助于我们进行ML实验跟踪、可视化和协作(同时一组开发人员处理不同的实验)。DVC工作室也自动记账。见下文:</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mr"><img src="../Images/c8867f7111eea2d49bb1d41c778f5820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nPyQayN5xZKvAM_L.jpeg"/></div></div></figure><p id="bdef" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">由于DVC工作室与github顺利集成，我们可以审查和挑选每个与实验相关的提交，这提供了很大的灵活性。</p><p id="be1c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤10-评估指标管理:</strong></p><p id="6cba" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">wandb-权重和偏差<a class="ae kf" href="https://wandb.ai/site" rel="noopener ugc nofollow" target="_blank"> Wandb </a>虽然，DVC工作室这有助于我们进行ML实验跟踪、可视化、协作和最佳模型(如果使用的话)，但权重和偏差(Wandb)通过记录评估指标和提供图形洞察使其变得更加容易。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mr"><img src="../Images/7b8d16a644781fa5c05f0adf7d4157d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*caoC4GZH19Zv0x_t.jpeg"/></div></div></figure><p id="6408" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">第11步-最佳模型选择:</strong></p><p id="d892" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Wandb-权重和偏差<a class="ae kf" href="https://wandb.ai/site" rel="noopener ugc nofollow" target="_blank"> Wandb </a>如下图所示，是我们在不同实验中获得的最佳权重。这是一个非常有用的功能，因为寻找最佳重量有时会很麻烦。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es ms"><img src="../Images/62bd97647c5e90650a1ad0eaf22ebede.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/0*F_iHKlF4hKdR4Mrr.png"/></div></figure><p id="5687" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">步骤12-结束注释:</strong></p><p id="7b17" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">当所有步骤完成后，cml工作流中的最后一个事件被执行，它是对线程的注释。</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="0a7e" class="mj if hh mf b fi mk ml l mm mn">cml-send-comment report.md</span></pre><p id="7cd9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">当这种情况发生时，消息通知将弹出在用户横幅上，如您所见。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mt"><img src="../Images/8316964caf61e12f4e7b1073c88c34da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s1iivwm1Um41GSy4.jpeg"/></div></div></figure><p id="2342" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">完整的培训日志也可以在report.md中找到，因为我们已经在cml工作流文件(ci-cd.yaml)中配置了以下步骤</p><p id="5830" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">见下文:</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mu"><img src="../Images/caa52663216c93aa6e49cec423e39498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M0nJPDgqp-EbwYRG.jpeg"/></div></div></figure><h1 id="b7d7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">W.I.P:“部署管道”将很快跟进这个存储库</h1><p id="f4c4" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">采用Kubernetes编排的Dockerized容器应用集群</strong></p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es mv"><img src="../Images/9480cba9dbe2e4c86b54c6ef79decf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*-nqm36cdF49hU1xqpwTtwA.jpeg"/></div></figure><p id="96be" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下面的存储库的架构如上</p><p id="b1c0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">跟随此库获取更新:<a class="ae kf" href="https://github.com/arjunKumbakkara/NLP_CML_Deployment_Pipeline_On_Kubernetes" rel="noopener ugc nofollow" target="_blank">Dockerized _ CML _ Application _ On _ KubernetesCluster</a></p><p id="5da3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">@misc{Transformer，wandb，DVC &amp; ONNX，title = {使用DVC在Huggingface Transformer上进行连续机器学习，包括权重和偏差实现以及将权重转换为ONNX}，年份= {2022}，作者= {Nabarun Barua，Arjun Kumbakkara}，}</p></div><div class="ab cl mw mx go my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ha hb hc hd he"><p id="7f30" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><em class="kj">原载于</em><a class="ae kf" href="https://github.com/nabarunbaruaAIML/CML_with_DVC_on_Transformer_NLP" rel="noopener ugc nofollow" target="_blank">https://github . com/nabarunbaraaiml/CML _ with _ DVC _ on _ Transformer _ NLP</a><em class="kj">。</em></p><div class="nd ne ez fb nf ng"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hi fi z dy nl ea eb nm ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu lu ng"/></div></div></a></div></div></div>    
</body>
</html>