<html>
<head>
<title>Implementing a Linear Regression Model from Scratch with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python从头开始实现线性回归模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/implementing-a-linear-regression-model-from-scratch-with-python-3a0712c7bc3d?source=collection_archive---------2-----------------------#2022-01-18">https://medium.com/mlearning-ai/implementing-a-linear-regression-model-from-scratch-with-python-3a0712c7bc3d?source=collection_archive---------2-----------------------#2022-01-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c31a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将在不使用任何库的情况下，用Python实现一个非常简单但功能强大的机器学习模型。我们将尝试从一个人的身高和体重来预测他的身体质量指数(<a class="ae jc" href="https://en.wikipedia.org/wiki/Body_mass_index" rel="noopener ugc nofollow" target="_blank">身体质量指数</a>)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ffaedd0edc7dc74a08ae90922cbb78bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgIj3njMLxAKMlCmlNvSvw.png"/></div></div></figure><h1 id="fe34" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="6c11" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我们将要建立的模型被称为线性回归，在我们的例子中，它实际上只不过是一个线性函数，将两个值<strong class="ig hi"> x </strong>和<strong class="ig hi"> y </strong>作为输入，并给出一个新值<strong class="ig hi"> z </strong>作为输出。</p><blockquote class="ks kt ku"><p id="a12a" class="ie if kv ig b ih ii ij ik il im in io kw iq ir is kx iu iv iw ky iy iz ja jb ha bi translated"><strong class="ig hi"> f </strong> (x，y)=a <strong class="ig hi"> x </strong> +b <strong class="ig hi"> y </strong> +c</p></blockquote><p id="a77b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中<em class="kv"> a </em>、<em class="kv"> b </em>和<em class="kv"> c </em>是我们的模型必须“学习”的函数的(可训练)参数。</p><p id="2395" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里的基本思想非常简单:我们的模型将以体重-身高对的形式给出一堆例子，<strong class="ig hi"> x </strong>和<strong class="ig hi"> y </strong>，以及相应的输出<strong class="ig hi"> z </strong>，算法将需要调整参数a、b、c，以便在给出新的输入时做出最准确的预测。这个过程叫做<em class="kv">训练</em>。但是我们如何定义“准确”呢？我们如何调整这些参数？</p><h1 id="c1bc" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">失败</h1><p id="9e8e" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我们需要一种方法来量化我们的模型的准确性，也就是模型预测输出的好坏。一个非常简单但有效的方法是定义一个函数(<em class="kv"> loss </em>)来计算真实输出<strong class="ig hi"> z </strong>和我们的模型预测值之间的差异。</p><blockquote class="ks kt ku"><p id="aab9" class="ie if kv ig b ih ii ij ik il im in io kw iq ir is kx iu iv iw ky iy iz ja jb ha bi translated">损耗= ∑(预测值-z) /n</p></blockquote><p id="e438" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个特定的损失函数被称为<em class="kv">均方误差。</em></p><h1 id="758c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">培养</h1><p id="00a6" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我们算法的目标基本上是最小化当真实值为<strong class="ig hi"> z </strong>时通过预测值<strong class="ig hi"> f(x，y) </strong>产生的误差，这意味着我们想要最小化损失函数。为此，我们将计算关于a、b和c的损失函数的<em class="kv">偏导数</em>，以便我们可以知道如何修改参数以减少损失。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/96789acef60f393b5ee1c16934755757.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*vwKcWegQB6UJMugmzZeDPg.png"/></div></figure><p id="71e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，损失对<em class="kv"> a </em>的偏导数告诉我们，当我们修改参数<em class="kv"> a </em>时，损失如何变化。更准确地说，它给了我们损失函数最大上升的方向，所以我们可以反过来得到最大下降的方向。</p><h1 id="fc82" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">密码</h1><p id="2a45" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我想是时候进入代码了。</p><h2 id="6bba" class="la jq hh bd jr lb lc ld jv le lf lg jz ip lh li kd it lj lk kh ix ll lm kl ln bi translated">图书馆</h2><p id="e76f" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">仅有的两个库是<strong class="ig hi"> pandas </strong>和<strong class="ig hi"> numpy，</strong>可以让我们在处理数据集和数组时更加轻松。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="5db3" class="la jq hh lp b fi lt lu l lv lw">import pandas as pd<br/>import numpy as np</span></pre><h2 id="07bc" class="la jq hh bd jr lb lc ld jv le lf lg jz ip lh li kd it lj lk kh ix ll lm kl ln bi translated">资料组</h2><p id="c8e9" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">数据集是用来训练我们的模型的数据集合。它通常以. csv文件的形式给出，以列和行的形式组织，类似于电子表格。你可以在这里下载我在这个例子中使用的那个<a class="ae jc" href="https://www.kaggle.com/yersever/500-person-gender-height-weight-bodymassindex" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="8b7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们来读一下数据集:</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="2b18" class="la jq hh lp b fi lt lu l lv lw">filename = "500_Person_Gender_Height_Weight_Index"<br/>df = pd.read_csv(f"{filename}.csv", usecols=[1,2,3], header=0,          names=["height", "weight", "index"])</span></pre><p id="64a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我指定了参数<em class="kv"> usecols </em>，因为我只对读取第1、2、3列(分别是身高、体重和bmi)感兴趣。</p><p id="80cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步是将数据集分成两部分，一部分用于训练，一部分用于测试我们的模型。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="5042" class="la jq hh lp b fi lt lu l lv lw">def split_train_test(df, p):<br/>  n = int(p*len(df))<br/>  train = df.iloc[0:n, :] <br/>  test = df.iloc[n:len(df), :]<br/>  return train, test</span><span id="a23e" class="la jq hh lp b fi lx lu l lv lw">train_df, test_df = split_train_test(df, 0.5)</span></pre><p id="93c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们从训练集中创建三个numpy数组，两个用于输入，一个用于输出。每个数组表示数据集的相应列。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="99a7" class="la jq hh lp b fi lt lu l lv lw">x_train = np.array(train_df[“height”])<br/>y_train = np.array(train_df[“weight”])<br/>z_train = np.array(train_df[“index”])</span></pre><p id="7579" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们对测试集做同样的事情:</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="15a5" class="la jq hh lp b fi lt lu l lv lw">x_test = np.array(test_df["height"])<br/>y_test = np.array(test_df["weight"])<br/>z_test = np.array(test_df["index"])</span></pre><h2 id="14ce" class="la jq hh bd jr lb lc ld jv le lf lg jz ip lh li kd it lj lk kh ix ll lm kl ln bi translated">培养</h2><p id="3797" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">训练基本上是寻找我们的函数(a，b，c)的参数的过程，以便它用以前看不见的输入做出准确的预测。</p><p id="96db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里的想法是，我们迭代训练数据集很多次，每次我们改变“一点”参数，以便损失函数逐渐减少。(记住，损失函数量化了预测输出与实际输出的差异程度)。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="94e9" class="la jq hh lp b fi lt lu l lv lw"><em class="kv"># set initial values for learnable parameters</em><br/>a = 1<br/>b = 1<br/>c = 0</span><span id="515e" class="la jq hh lp b fi lx lu l lv lw">lr = 0.000005 <em class="kv"># learning rate</em><br/>epochs = 1000 <em class="kv"># number of iterations</em></span><span id="fca3" class="la jq hh lp b fi lx lu l lv lw">n = len(z_train) <em class="kv"># number of inputs</em></span><span id="8ef8" class="la jq hh lp b fi lx lu l lv lw">for i in range(epochs):<br/>  z_predicted = a*x_train + b*y_train + c <em class="kv"># make a prediction</em><br/>  error = z_predicted - z_train <em class="kv"># calculate the error</em><br/>  loss = np.sum(error**2)/n <em class="kv"># calculate the loss</em><br/>  <em class="kv"># partial derivatives</em><br/>  loss_a = 2*np.sum(error*x_train)/n <br/>  loss_b = 2*np.sum(error*y_train)/n<br/>  loss_c = 2*np.sum(error)/n<br/>  <em class="kv"># adjust the parameters</em><br/>  a = a - loss_a*lr <br/>  b = b - loss_b*lr<br/>  c = c - loss_c*lr<br/>  print(f"loss: {loss}  \t({i+1}/{epochs})")</span></pre><h2 id="f544" class="la jq hh bd jr lb lc ld jv le lf lg jz ip lh li kd it lj lk kh ix ll lm kl ln bi translated">测试</h2><p id="88fd" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">此时，我们的模型已经找到了最佳参数值，我们可以在测试集上测试它。为了做到这一点，我们从<em class="kv"> sklearn </em>包中使用了一个名为<strong class="ig hi"> <em class="kv"> r2_score </em> </strong>的函数。R2分数是一种衡量回归模型性能的指标，它返回一个介于0和1之间的值，1表示完美，0表示差。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="44b4" class="la jq hh lp b fi lt lu l lv lw">from sklearn.metrics import r2_score</span><span id="3f90" class="la jq hh lp b fi lx lu l lv lw">z_prediction = a*x_test + b*y_test + c <em class="kv">#compute predictions</em><br/>print(f"R2 Score: {r2_score(z_test, z_prediction)}")</span></pre><p id="9116" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的模型应该已经表现得很好了，R2分数应该在0.7左右</p><h2 id="8be6" class="la jq hh bd jr lb lc ld jv le lf lg jz ip lh li kd it lj lk kh ix ll lm kl ln bi translated">结论</h2><p id="f867" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">这篇文章想提出一种基本的方法，将机器学习的基本理论概念直接翻译成代码。</p><p id="0001" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里查看完整的代码:</p><p id="897f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://github.com/sfabio01/machine-learning-project" rel="noopener ugc nofollow" target="_blank">SFA bio 01/machine-learning-project:我正在尝试使用Python(github.com)从头开始创建一个机器学习模型</a></p><div class="ly lz ez fb ma mb"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hi fi z dy mg ea eb mh ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">medium.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp jn mb"/></div></div></a></div></div></div>    
</body>
</html>