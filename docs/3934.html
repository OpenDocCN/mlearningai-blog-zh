<html>
<head>
<title>Modelling psychophysical functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟心理物理功能</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/modelling-psychophysical-functions-70ca69d18b87?source=collection_archive---------4-----------------------#2022-11-12">https://medium.com/mlearning-ai/modelling-psychophysical-functions-70ca69d18b87?source=collection_archive---------4-----------------------#2022-11-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="9931" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">贝叶斯认知建模</h2></div><p id="5c63" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇博文中，我将使用Lee &amp; Wagemakers所著的《<a class="ae js" href="https://bayesmodels.com/" rel="noopener ugc nofollow" target="_blank">贝叶斯认知建模</a>》一书中的另一个例子。这本书充满了认知心理学的例子，可以用贝叶斯方法来处理。由于这些例子大多是通过<strong class="iy hi"> WinBUGS </strong>完成的，我想看看我是否能使用<em class="jt"> brms </em>和<em class="jt"> stan </em>来重现它。所以，这就是这篇博文的内容。(我知道这本书也提供了stan代码，但我想看看我能用<em class="jt"> brms </em>走多远，它的功能比base <strong class="iy hi"> STAN </strong>或<strong class="iy hi"> WinBUGS </strong>要少)。</p><p id="0a7a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个例子中，我将模拟心理物理功能，就像前面的<a class="ae js" rel="noopener" href="/mlearning-ai/modelling-memory-retention-3f68d1bbe131">例子</a>一样，与多少刺激被正确识别有关(许多认知心理学测试是这样的:接受一个刺激，等一会儿，看看会发生什么)。</p><p id="c3cf" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我将从作者那里获得数据争论的第一部分，以创建我自己的适合于<em class="jt"> brms </em>的数据集(作者使用<em class="jt"> WinBUGS </em>，它采用另一种方法来加载数据)。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="86b6" class="kd ke hh jz b be kf kg l kh ki"># clears workspace:  <br/>rm(list=ls()) <br/><br/># sets working directories:<br/>library(dplyr)<br/>library(ggplot2)<br/>library(brms)<br/>library(bayesplot)<br/>library(tidybayes)<br/>library(marginaleffects)<br/><br/>x       &lt;- matrix(NA,8,28)<br/>x[]     &lt;- as.matrix(read.table("CaseStudies/PsychophysicalFunctions/data_x.txt",sep="\t"))<br/>n       &lt;- matrix(NA,8,28)<br/>n[]     &lt;- as.matrix(read.table("CaseStudies/PsychophysicalFunctions/data_n.txt",sep="\t"))<br/>r       &lt;- matrix(NA,8,28)<br/>r[]     &lt;- as.matrix(read.table("CaseStudies/PsychophysicalFunctions/data_r.txt",sep="\t"))<br/>rprop   &lt;- matrix(NA,8,28)<br/>rprop[] &lt;- as.matrix(read.table("CaseStudies/PsychophysicalFunctions/data_rprop.txt",sep="\t"))<br/><br/>xmean &lt;- c(318.888,311.0417,284.4444,301.5909,296.2000,305.7692,294.6429,280.3571)<br/>nstim &lt;- c(27, 24, 27, 22, 25, 26, 28, 28)<br/>nsubjs &lt;- 8<br/><br/>x&lt;-as.data.frame(x)<br/>d &lt;- x<br/>subject &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(subject,d)<br/>df_long&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=V1:V28,<br/>                      names_to = "Time",<br/>                      values_to = "Interval")<br/>df_long$Time&lt;-NULL</span></pre><div class="ju jv jw jx fd ab cb"><figure class="kj kk kl km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/c006ee82b1a9597c3cd93a1bf091b2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1750/format:webp/1*6vA57K03PQpTTShUdbGlOQ.png"/></div></figure><figure class="kj kk kw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/84bf6ef1f4564715c9b7c2c34ea72b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:252/format:webp/1*2QsGZ_ubUdyTWqD_0FitXg.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lb di lc ld">The interval data in wide and long format.</figcaption></figure></div><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="f7a8" class="kd ke hh jz b be kf kg l kh ki">rprop&lt;-as.data.frame(rprop)<br/>d &lt;- rprop<br/>subject &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(subject,d)<br/>df_long2&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=V1:V28,<br/>                      names_to = "Time",<br/>                      values_to = "Proportion")<br/>df_long2$Time&lt;-NULL<br/>df&lt;-cbind(df_long, df_long2$Proportion)<br/>colnames(df)[3]&lt;-"Proportion"</span></pre><div class="ju jv jw jx fd ab cb"><figure class="kj kk le km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/9dc3af1b133d32dd715aa005a44a4f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1732/format:webp/1*jByE2Y0vO4fYsJx9fzJyxg.png"/></div></figure><figure class="kj kk lf km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/b79277db43b862e099a67da787e597ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:270/format:webp/1*9qN7VvGT4lHOtyoJkcmauA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lg di lh ld">The proportion data in wide format (left), and combined with the interval data per subject in long format (right).</figcaption></figure></div><p id="8e69" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面的数据集足以进行建模，但是如果我想使用二项式方法对数据进行建模，我将需要做一些额外的数据争论。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="40cf" class="kd ke hh jz b be kf kg l kh ki">r&lt;-as.data.frame(r)<br/>d &lt;- r<br/>subject &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(subject,d)<br/>r_long&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=V1:V28,<br/>                      names_to = "Time",<br/>                      values_to = "Correct")<br/>r_long$Time&lt;-NULL<br/>n&lt;-as.data.frame(n)<br/>d &lt;- n<br/>subject &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(subject,d)<br/>n_long&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=V1:V28,<br/>                      names_to = "Time",<br/>                      values_to = "Trials")<br/>n_long$Time&lt;-NULL<br/>df&lt;-cbind(df_long, n_long$Trials)<br/>df&lt;-cbind(df, r_long$Correct)<br/>colnames(df)[3]&lt;-"Trials"<br/>colnames(df)[4]&lt;-"Correct"<br/>df$Proportion&lt;-df$Correct/df$Trials<br/>head(df)</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div class="er es li"><img src="../Images/7dad728dd7cb381dcdfde596d69e25dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*QTlgSlSvOPXuKKmi8aBlYw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">The dataset, containing intervals, trials, correct specified, and the proportion correct per subject in long format. THIS will be dataset from which to model.</figcaption></figure><p id="0241" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们画出我们到底有什么</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="d082" class="kd ke hh jz b be kf kg l kh ki">ggplot(df, aes(x=Interval, y=Proportion, group=subject, col=subject))+<br/>  geom_point()+<br/>  theme_bw()<br/><br/>ggplot(df, aes(x=Interval, y=Proportion, group=subject, col=subject))+<br/>  geom_point()+<br/>  theme_bw()+<br/>  facet_wrap(~subject)</span></pre><div class="ju jv jw jx fd ab cb"><figure class="kj kk lj km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/3795e9a7ba1a6467c91c6d539d708d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*dO9j3H-Y1zB85luwWib9Hg.png"/></div></figure><figure class="kj kk lj km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/d64d4d4ca2071e4b62b851f6f652b889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*O4i4quc_m4bg2CN_wdgpsA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lk di ll ld">To the left we see all the data, to the right the data per subject. The sigmoidal curve is quite clear and so the data will unlikely pose any challenge to model.</figcaption></figure></div><p id="bc2c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看看模型的规格，从一些非常简单的先验知识开始。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="3252" class="kd ke hh jz b be kf kg l kh ki">get_prior(Correct | trials(Trials) ~ <br/>                Interval + (1|subject), <br/>              data = df,<br/>              family=binomial(link = "logit"))<br/><br/>fit&lt;-brms::brm(Correct | trials(Trials) ~ <br/>                  Interval + (1|subject), <br/>                data = df,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(normal(0, 1), class=b, coef=Interval ),<br/>                  prior(normal(0, 1), class=Intercept),<br/>                  prior(gamma(1, 1), class=sd, coef=Intercept, group=subject)), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit)<br/>plot(fit)<br/>pp_check(fit, ndraws=500)</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div class="er es lm"><img src="../Images/3f67d5be078ccee37d89c2cf5c1e6c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*YrHMKrRCwqOJFlE2QSZ4Bw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Good convergence.</figcaption></figure><div class="ju jv jw jx fd ab cb"><figure class="kj kk ln km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/5b1d5f2052f870dabce346c33396bdb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*ZSgrZIh1B7mesgCY7AzcYg.png"/></div></figure><figure class="kj kk lo km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/0321c8612e6910c9f45e7054f2d70a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*JcSqdXo169Qlt4ymyLbZLw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lp di lq ld">Sampling went well.</figcaption></figure></div><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="154d" class="kd ke hh jz b be kf kg l kh ki">ce&lt;-conditional_effects(fit, surface = TRUE)<br/>pl_ce&lt;-plot(ce, rug=TRUE, theme=theme_bw())</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lr"><img src="../Images/dc0abedfb732864eb54a8bcbf4771520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8qlP1CBb3308-GilqMXNQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Conditional plot shows the expected sigmoidal curve.</figcaption></figure><p id="b543" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们做一些额外的分析，看看每个受试者在一段时间内正确的刺激数量的后验概率。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="5fef" class="kd ke hh jz b be kf kg l kh ki">df%&gt;%<br/>  tidyr::drop_na()%&gt;%<br/>  add_epred_draws(fit, <br/>                  ndraws=100) %&gt;%<br/>  ggplot(aes(x = Interval, <br/>             y = Correct, <br/>             group=subject)) +<br/>  geom_line(aes(y = .epred, group = paste(subject, .draw)), alpha = 0.25) +<br/>  geom_point(data = df, color="black")+<br/>  facet_wrap(~subject)+<br/>  theme_bw()</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lr"><img src="../Images/a5996d1756eac851ac1eb3199ab4347b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jy_nMg3wMk2Ij7cDZ_08Fg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Looks good! As you can see, plotting the data without the denominator gives a somewhat skewed look.</figcaption></figure><p id="79f2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们也可以画出预测值。与先前值的不同之处在于，这些值来自后验拟合。考虑到使用的数据将是相同的，预测的抽奖将具有相同的形状，但更大的不确定性。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="1743" class="kd ke hh jz b be kf kg l kh ki">df%&gt;%<br/>  tidyr::drop_na()%&gt;%<br/>  add_predicted_draws(fit, <br/>                  ndraws=100) %&gt;%<br/>  ggplot(aes(x = Interval, <br/>             y = Correct, <br/>             group=subject)) +<br/>  geom_line(aes(y = .prediction, group = paste(subject, .draw)), alpha = 0.25) +<br/>  geom_point(data = df, color="black")+<br/>  facet_wrap(~subject)+<br/>  theme_bw()</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lr"><img src="../Images/6084946666e7258cbd01e92d6c1d8490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XezaTYpbkv4jHZR76ezFvQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Looking good — indeed more uncertain.</figcaption></figure><p id="e602" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有另一种方法通过<em class="jt">预测</em>函数从模型拟合中获得预测。该方法自动提供可信区间。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="d553" class="kd ke hh jz b be kf kg l kh ki">pred &lt;- predictions(fit)<br/>ggplot(pred)+<br/>  geom_line(aes(x=Interval, y=predicted, group=subject), lty=2, col="black")+<br/>  geom_ribbon(aes(x=Interval, ymin=conf.low, ymax=conf.high, group=subject), <br/>              alpha=0.5, fill="gray")+<br/>  geom_point(aes(x=Interval, y=Correct), col="red")+<br/>  theme_bw()+<br/>  facet_wrap(~subject)</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lr"><img src="../Images/395a1a44583abce57179aa4a754d0112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXejF2gFzBtv_7bkgfajQQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The predicted values on top of the observed values.</figcaption></figure><p id="fdd1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们也可以通过将预测值除以试验次数，在概率尺度上绘制数据。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="d7ee" class="kd ke hh jz b be kf kg l kh ki">ggplot(pred)+<br/>  geom_line(aes(x=Interval, y=predicted/Trials, group=subject), lty=2, col="black")+<br/>  geom_ribbon(aes(x=Interval, ymin=conf.low/Trials, ymax=conf.high/Trials, group=subject), <br/>              alpha=0.5, fill="gray")+<br/>  geom_point(data=df, aes(x=Interval, y=Proportion), col="red")+<br/>  theme_bw()+<br/>  facet_wrap(~subject)</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lr"><img src="../Images/454ebf0a5062040c1d937a288a53d49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1RiD1I3qyfCu4SWo9CdJw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">This will give us the sigmoidal curve we saw from the beginning.</figcaption></figure><p id="f48d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从预测中，我们还可以得到后验概率。这将增加更多的不确定性。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="5bb0" class="kd ke hh jz b be kf kg l kh ki">pred &lt;- posteriordraws(pred)<br/>ggplot(pred)+<br/>  geom_line(aes(x=Interval, <br/>                y=draw, <br/>                group = paste(subject, drawid)), <br/>            lty=2, col="black")+<br/>  geom_point(aes(x=Interval, y=Correct), col="red")+<br/>  theme_bw()+<br/>  facet_wrap(~subject)</span></pre><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ls"><img src="../Images/5392b5efda90f9f4aeb24d9e95bb52cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1uaj8vU4QjbDq6qfT3rJg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">As you can see, the model still looks good, but also a bit more uncertain. This is inherent to sampling from predictions.</figcaption></figure><p id="e02c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是一篇关于如何使用贝叶斯层次模型和<em class="jt"> brms </em>对心理物理功能建模的短文。</p><p id="205e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你有任何问题，请告诉我！</p><div class="lt lu ez fb lv lw"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">medium.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk ku lw"/></div></div></a></div></div></div>    
</body>
</html>