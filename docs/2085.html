<html>
<head>
<title>How to Use Beautiful Soup to Parse Text for NLP Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用漂亮的Soup为NLP项目解析文本</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-use-beautiful-soup-to-parse-text-for-nlp-projects-48acc9145f89?source=collection_archive---------2-----------------------#2022-03-05">https://medium.com/mlearning-ai/how-to-use-beautiful-soup-to-parse-text-for-nlp-projects-48acc9145f89?source=collection_archive---------2-----------------------#2022-03-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5866ca757640be808fa0dd14a495e5b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98oi3MiaiMaJHKUGKDNnvQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@moniqa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Monika Grabkowska</a> on <a class="ae it" href="https://unsplash.com/s/photos/soup?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="736f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">互联网上充斥着词汇，在每个网页背后，这些词汇都隐藏在HTML标签的层次结构中。Beautiful Soup是一个Python库，可以使用这些标签从网页中提取文本，一旦有了文本，就可以将其用作自然语言处理或其他数据科学项目的数据。</p><p id="9c7f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我开始概述它是如何工作的之前，我觉得有必要回答这个问题，<em class="js">为什么这个库被称为美丽的汤？</em>根据<a class="ae it" href="https://en.wikipedia.org/wiki/Tag_soup" rel="noopener ugc nofollow" target="_blank">维基百科</a>，“‘标签汤’是一个贬义词，指为网页编写的语法或结构不正确的HTML，”这个库显然是从术语“标签汤”得名的</p><h1 id="43a5" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">从新闻网站提取标题</h1><p id="e6ce" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">为了给出一个漂亮的Soup如何工作的一般例子，我将使用它从一个虚构的新闻网站的首页提取所有标题。(我在这个例子中使用了一个虚构的站点，因为许多站点不允许网络抓取。)</p><p id="0b90" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦你在你的机器上安装了Beautiful Soup(见<a class="ae it" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-beautiful-soup" rel="noopener ugc nofollow" target="_blank">文档</a>)，启动一个Jupyter笔记本，只需输入它的URL就可以把网站拉进去。但是注意不能在美人汤直接访问网站。你需要用<code class="du kw kx ky kz b">requests</code>获取网页背后的文档，然后使用<code class="du kw kx ky kz b">requests</code>的<code class="du kw kx ky kz b">content</code>属性和一个HTML解析器将该文档放入漂亮的汤里。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="3f72" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">回到浏览器，使用浏览器的检查器来查看网页背后的HTML。根据浏览器的不同，检查器的名称略有不同，但键盘快捷键在基于Windows的浏览器中是<em class="js"> control-shift-I </em>，在Safari中是<em class="js"> command-option-I </em>。从那里，我可以看到主页上的所有标题都在一个<code class="du kw kx ky kz b">&lt;h3&gt;</code>标签内。</p><p id="ffb6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们来看看前三个使用<code class="du kw kx ky kz b">findAll()</code>的人。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="dbe0" class="lk ju hh kz b fi ll lm l ln lo">[&lt;h3 class="rr562" size="300"&gt;Russia's Invasion of Ukraine Enters New Phase&lt;div class="jk500"&gt;&lt;/div&gt;&lt;/h3&gt;,<br/> &lt;h3 class="rr562" size="300"&gt;Big Tech Firm Launching New Product&lt;/h3&gt;,<br/> &lt;h3 class="rr562" size="400"&gt;Five Tips for Tax Season&lt;/h3&gt;]</span></pre><p id="3e43" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你看，我得到了所有的HTML和CSS语法以及标题，而我只想要真正的标题。但是我可以把美汤的<code class="du kw kx ky kz b">text</code>属性(或者它的<code class="du kw kx ky kz b">get_text()</code>功能)的文字隔离出来。这里，我使用一个<code class="du kw kx ky kz b">for</code>循环来列出主页上的所有标题，然后我将显示前四个:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="db81" class="lk ju hh kz b fi ll lm l ln lo">['Russia's Invasion of Ukraine Enters New Phase',<br/> 'Big Tech Firm Launching New Product',<br/> 'Five Tips for Tax Season',<br/> 'Biden Announces Initiative']</span></pre><p id="daee" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就是这样！我从这个虚构的网站上抓取了当天的头条，并用Python把它们做成字符串列表。</p><h1 id="e72b" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">用漂亮的汤做一个数据框</h1><p id="7f94" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">对于一个自然语言处理项目，我以类似的方式使用了Beautiful Soup。我的数据集包含了1987年出现在路透社新闻专线上的大约22，000篇商业新闻文章。这些文章以SGM文件的形式提供，这是一种降价形式。</p><p id="a806" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">(以下示例中使用的数据集称为“Reuters-21578，Distribution 1.0。”可以在这里找到<a class="ae it" href="http://www.daviddlewis.com/resources/testcollections/reuters21578/" rel="noopener ugc nofollow" target="_blank">，并且已经提供给公众使用。自述文件这里是</a><a class="ae it" href="http://www.daviddlewis.com/resources/testcollections/reuters21578/readme.txt" rel="noopener ugc nofollow" target="_blank">这里是</a>。)</p><p id="e1e5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">每篇文章都可以贴上135个主题中的一个或多个，通常是关于商品的(燕麦、谷物、黄金等)。)，但有些根本没有被贴上任何话题的标签。我的项目的目标是为主题<strong class="iw hi"> <em class="js"> earn </em> </strong>开发一个NLP分类器，表明文章涉及一个企业的收益。</p><p id="aebe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这里，我正在读取其中一个数据文件，并检查前1000个字符。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="42df" class="lk ju hh kz b fi ll lm l ln lo">'&lt;!DOCTYPE lewis SYSTEM "lewis.dtd"&gt;\n&lt;REUTERS TOPICS="YES" LEWISSPLIT="TRAIN" CGISPLIT="TRAINING-SET" OLDID="5544" NEWID="1"&gt;\n&lt;DATE&gt;26-FEB-1987 15:01:01.79&lt;/DATE&gt;\n&lt;TOPICS&gt;&lt;D&gt;cocoa&lt;/D&gt;&lt;/TOPICS&gt;\n&lt;PLACES&gt;&lt;D&gt;el-salvador&lt;/D&gt;&lt;D&gt;usa&lt;/D&gt;&lt;D&gt;uruguay&lt;/D&gt;&lt;/PLACES&gt;\n&lt;PEOPLE&gt;&lt;/PEOPLE&gt;\n&lt;ORGS&gt;&lt;/ORGS&gt;\n&lt;EXCHANGES&gt;&lt;/EXCHANGES&gt;\n&lt;COMPANIES&gt;&lt;/COMPANIES&gt;\n&lt;UNKNOWN&gt; \n&amp;#5;&amp;#5;&amp;#5;C T\n&amp;#22;&amp;#22;&amp;#1;f0704&amp;#31;reute\nu f BC-BAHIA-COCOA-REVIEW   02-26 0105&lt;/UNKNOWN&gt;\n&lt;TEXT&gt;&amp;#2;\n&lt;TITLE&gt;BAHIA COCOA REVIEW&lt;/TITLE&gt;\n&lt;DATELINE&gt;    SALVADOR, Feb 26 - &lt;/DATELINE&gt;&lt;BODY&gt;Showers continued throughout the week in\nthe Bahia cocoa zone, alleviating the drought since early\nJanuary and improving prospects for the coming temporao,\nalthough normal humidity levels have not been restored,\nComissaria Smith said in its weekly review.\n    The dry period means the temporao will be late this year.\n    Arrivals for the week ended February 22 were 155,221 bags\nof 60 kilos making a cumulative total for the season of 5.93\nmln against 5.81 at the sa'</span></pre><p id="f465" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这很难读懂，但你可以在那里认出一些尖括号标签，独特的标签如<code class="du kw kx ky kz b">&lt;companies&gt;</code>、<code class="du kw kx ky kz b">&lt;topics&gt;</code>和<code class="du kw kx ky kz b">&lt;exchanges&gt;</code>。这种格式似乎不是HTML，而是允许定制标签的XML。美丽的汤有一个XML解析器。我将在这里使用它来解析文档，然后使用Beautiful Soup的<code class="du kw kx ky kz b">prettify()</code>函数来提高可读性。在这里，我将打印前300个字符。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="92a5" class="lk ju hh kz b fi ll lm l ln lo">&lt;!DOCTYPE lewis SYSTEM "lewis.dtd"&gt;<br/>&lt;html&gt;<br/> &lt;body&gt;<br/>  &lt;reuters cgisplit="TRAINING-SET" lewissplit="TRAIN" newid="1" oldid="5544" topics="YES"&gt;<br/>   &lt;date&gt;<br/>    26-FEB-1987 15:01:01.79<br/>   &lt;/date&gt;<br/>   &lt;topics&gt;<br/>    &lt;d&gt;<br/>     cocoa<br/>    &lt;/d&gt;<br/>   &lt;/topics&gt;<br/>   &lt;places&gt;<br/>    &lt;d&gt;<br/>     el-salvador<br/>    &lt;/d&gt;<br/>    &lt;d&gt;</span></pre><p id="c5d0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">啊，这样看起来容易多了。使用这种技术并检查更多的数据，我发现每篇文章都用一个<code class="du kw kx ky kz b">&lt;reuters&gt;</code>标签来划分，主题在<code class="du kw kx ky kz b">&lt;topics&gt;</code>标签下，所有文章内容都在<code class="du kw kx ky kz b">&lt;text&gt;</code>标签中。</p><p id="8234" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了创建我的数据框架以输入机器学习模型，首先，我找到所有的<code class="du kw kx ky kz b">&lt;topics&gt;</code>。我创建了一个漂亮的Soup对象，类似于字符串列表。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="c181" class="lk ju hh kz b fi ll lm l ln lo">[&lt;topics&gt;&lt;d&gt;cocoa&lt;/d&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;d&gt;grain&lt;/d&gt;&lt;d&gt;wheat&lt;/d&gt;&lt;d&gt;corn&lt;/d&gt;&lt;d&gt;barley&lt;/d&gt;&lt;d&gt;oat&lt;/d&gt;&lt;d&gt;sorghum&lt;/d&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;d&gt;veg-oil&lt;/d&gt;&lt;d&gt;linseed&lt;/d&gt;&lt;d&gt;lin-oil&lt;/d&gt;&lt;d&gt;soy-oil&lt;/d&gt;&lt;d&gt;sun-oil&lt;/d&gt;&lt;d&gt;soybean&lt;/d&gt;&lt;d&gt;oilseed&lt;/d&gt;&lt;d&gt;corn&lt;/d&gt;&lt;d&gt;sunseed&lt;/d&gt;&lt;d&gt;grain&lt;/d&gt;&lt;d&gt;sorghum&lt;/d&gt;&lt;d&gt;wheat&lt;/d&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;d&gt;earn&lt;/d&gt;&lt;/topics&gt;,<br/> &lt;topics&gt;&lt;d&gt;acq&lt;/d&gt;&lt;/topics&gt;]</span></pre><p id="70ae" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">和第一个例子中混乱的HTML和CSS一样，我需要去掉所有的XML标签，制作一个新的、看起来干净的列表。我可以用美汤的<code class="du kw kx ky kz b">text</code>属性做到这一点。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><pre class="la lb lc ld fd lg kz lh li aw lj bi"><span id="fcbb" class="lk ju hh kz b fi ll lm l ln lo">[['cocoa'],<br/> [],<br/> [],<br/> [],<br/> ['grain', 'wheat', 'corn', 'barley', 'oat', 'sorghum'],<br/> ['veg-oil',<br/>  'linseed',<br/>  'lin-oil',<br/>  'soy-oil',<br/>  'sun-oil',<br/>  'soybean',<br/>  'oilseed',<br/>  'corn',<br/>  'sunseed',<br/>  'grain',<br/>  'sorghum',<br/>  'wheat'],<br/> [],<br/> [],<br/> ['earn'],<br/> ['acq']]</span></pre><p id="bb8a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我让函数拉出<strong class="iw hi"> <em class="js">赚</em> </strong>题目，这是我的初级分类器。如果文章被单独标记为<strong class="iw hi"><em class="js"/></strong>或<strong class="iw hi"><em class="js"/></strong>带任何其他主题，则被归类为<strong class="iw hi"><em class="js"/></strong>。如果不包括<strong class="iw hi"> <em class="js">赚</em> </strong>，我就叫它<strong class="iw hi"> <em class="js">其他</em> </strong>。有些文章没有被指定任何主题。在项目的这一点上，我不确定为什么，所以我保留那些并将那些<strong class="iw hi"> <em class="js">称为空白</em> </strong>。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="e3ad" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我用主题列创建我的数据框架。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><figure class="la lb lc ld fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/86fed817ef89e7f783f23d1f6a9b974c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-KgRco5TRz8MrgQKSjEkA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image by author</figcaption></figure><p id="84cd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">看起来不错。对于所有文章的内容，我都遵循类似的流程。我在美丽的Soup对象中找到所有带有<code class="du kw kx ky kz b">&lt;text&gt;</code>标签的东西，以创建一个美丽的Soup元素。然后，我创建一个空列表并遍历元素，将每篇文章的文本作为单个字符串添加。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="8b42" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我可以将这个列表添加到我的数据框架中。</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><figure class="la lb lc ld fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/f6e1ac94ba3213e8dd8d2bfbb2f9e093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kkVOyxl_ErKZoZDx51hgug.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image by author</figcaption></figure><p id="7940" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个数据框是我想要创建的。现在，我可以执行为NLP建模准备文本所需的其他任务，比如执行探索性数据分析、删除停用词、标记文章的文本，等等。</p><h1 id="463a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">总结</strong></h1><ul class=""><li id="3c44" class="lr ls hh iw b ix kr jb ks jf lt jj lu jn lv jr lw lx ly lz bi translated">将数据放入一个漂亮的Soup对象中并解析它</li><li id="acf4" class="lr ls hh iw b ix ma jb mb jf mc jj md jn me jr lw lx ly lz bi translated">检查漂亮的汤对象以找到有用的标签</li><li id="c4e1" class="lr ls hh iw b ix ma jb mb jf mc jj md jn me jr lw lx ly lz bi translated">用标签制作新的漂亮汤品</li><li id="4b36" class="lr ls hh iw b ix ma jb mb jf mc jj md jn me jr lw lx ly lz bi translated">使用<code class="du kw kx ky kz b">text</code>属性或<code class="du kw kx ky kz b">get_text()</code>函数只提取文本</li><li id="1498" class="lr ls hh iw b ix ma jb mb jf mc jj md jn me jr lw lx ly lz bi translated">使用循环创建要添加到数据帧中的列表</li></ul><div class="mf mg ez fb mh mi"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mj ab dw"><div class="mk ab ml cl cj mm"><h2 class="bd hi fi z dy mn ea eb mo ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mp l"><h3 class="bd b fi z dy mn ea eb mo ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mq l"><p class="bd b fp z dy mn ea eb mo ed ef dx translated">medium.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw in mi"/></div></div></a></div></div></div>    
</body>
</html>