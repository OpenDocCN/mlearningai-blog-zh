<html>
<head>
<title>Setting up a Local MLOps dev environment — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置本地MLOps开发环境—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/setting-up-a-local-mlops-dev-environment-part-2-50ded3ecd447?source=collection_archive---------4-----------------------#2022-04-17">https://medium.com/mlearning-ai/setting-up-a-local-mlops-dev-environment-part-2-50ded3ecd447?source=collection_archive---------4-----------------------#2022-04-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0843" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个由两篇文章组成的系列中，我分享了在裸机Ubuntu工作站上从头开始设置本地MLOps开发环境的经验。这一部分是关于在Kubernetes集群上安装Kubeflow部署，我们已经在Ubuntu工作站上安装了Kubernetes集群，如<a class="ae jc" rel="noopener" href="/@vishalgarg652/setting-up-a-local-mlops-dev-environment-part-1-a8b468329819"> <em class="jd">第1部分</em> </a>所述。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/55dfe00a2fbe68d23f7aec21d5adf4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PQCmO_-V7uTp6YNv"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae jc" href="https://unsplash.com/@fletcher_pride?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fletcher Pride</a> on <a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="0353" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">设置默认存储类别</h2><p id="4039" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">作为先决条件，Kubeflow需要一个带有默认存储类的Kubernetes集群。每当PVC要求永久卷时，存储类提供永久卷的动态供应。简而言之，它抽象了下划线存储，并为管理员提供了一种描述他们提供的存储类别的方式。参考<em class="jd"><a class="ae jc" href="https://kubernetes.io/docs/concepts/storage/storage-classes/" rel="noopener ugc nofollow" target="_blank"><em class="jd">存储类</em> </a> <em class="jd"> </em>了解更多。</em></p><p id="0f3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出于我们的目的，将Ceph作为存储后端的Rook应使用CSI进行调配。Rook为Kubernetes提供开源的云原生存储，而Ceph是一个分布式、可扩展的开源存储解决方案，用于块、对象和共享文件系统存储。想了解更多关于Rook和Ceph的知识，参考这个<a class="ae jc" href="https://rook.io/docs/rook/v1.9/" rel="noopener ugc nofollow" target="_blank"> <em class="jd">链接</em> </a>。</p><h2 id="e78a" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">先决条件</h2><ul class=""><li id="61ce" class="ku kv hh ig b ih kp il kq ip kw it kx ix ky jb kz la lb lc bi translated">一个有效的Kubernetes集群，我们已经提供了。</li><li id="9c18" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">可以访问Kubernetes集群的机器上的Kubectl安装，将该集群配置为主集群。</li><li id="280e" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">能够在安装了<em class="jd"> kubectl </em>的机器上克隆Rook GitHub库</li><li id="0b3a" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">对于测试部署—单节点集群或单个主节点和单个工作节点集群，集群中的每个节点都需要一个已装载的未格式化卷，并且必须安装LVM，允许主节点上的工作负载:已启用，CNI: Calico</li></ul><p id="2da0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">至少需要以下本地存储选项之一:</p><ul class=""><li id="8766" class="ku kv hh ig b ih ii il im ip li it lj ix lk jb kz la lb lc bi translated">原始设备(没有分区或格式化的文件系统)</li><li id="75ca" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">原始分区(没有格式化的文件系统)</li><li id="e6e5" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">数据块模式下存储类中可用的PVs</li></ul><p id="6497" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确认是否有可用于配置Ceph的分区或设备。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="841f" class="ju jv hh lm b fi lq lr l ls lt">lsblk<br/>lsblk -f</span></pre><p id="f2b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果FSTYPE字段不为空，则在相应的设备上有一个文件系统。在这个例子中，我们可以将<em class="jd"> sdb </em>用于Ceph，而不能使用<em class="jd"> sda </em>或其分区。</p><h2 id="4407" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">步骤1 —安装LVM</h2><p id="dac8" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">为了避免在原始设备上设置Ceph时出现任何问题，请通过在所有服务器/工作站上运行以下命令来安装LVM。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="b902" class="ju jv hh lm b fi lq lr l ls lt">sudo apt-get install -y lvm2</span></pre><h2 id="c9a2" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">步骤2-克隆Rook Github Repo</h2><p id="31e3" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">将Rook Github repo克隆到一个空目录中，如下所示。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="ae85" class="ju jv hh lm b fi lq lr l ls lt">mkdir rook-single-node<br/>cd rook-single-node<br/>git clone --single-branch --branch release-1.5 <a class="ae jc" href="https://github.com/rook/rook.git" rel="noopener ugc nofollow" target="_blank">https://github.com/rook/rook.git</a></span></pre><h2 id="598f" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">步骤3 —安装车</h2><p id="3385" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">首先，安装CRDs</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="c691" class="ju jv hh lm b fi lq lr l ls lt">cd rook/cluster/examples/kubernetes/ceph<br/>kubectl create -f crds.yaml -f common.yaml -f operator.yaml</span></pre><p id="176b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其次，创建集群。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="f400" class="ju jv hh lm b fi lq lr l ls lt">kubectl create -f cluster-test.yaml</span></pre><p id="3d2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证安装。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="8d2b" class="ju jv hh lm b fi lq lr l ls lt">kubectl -n rook-ceph get pod</span></pre><p id="0010" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为这个过程的一部分，将有许多吊舱被部署，这需要时间，所以只需等待一段时间，直到所有吊舱都处于运行状态。</p><h2 id="b5a1" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">步骤4 —调配存储类</h2><p id="a43c" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">使用Rook Github repo(Rook/cluster/examples/kubernetes/ceph/CSI/rbd)中提供的storageclass-test.yaml为最小安装配置存储类。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="63bd" class="ju jv hh lm b fi lq lr l ls lt">kubectl apply -f storageclass-test.yaml</span></pre><h1 id="c708" class="lu jv hh bd jw lv lw lx ka ly lz ma ke mb mc md kh me mf mg kk mh mi mj kn mk bi translated">步骤5 —将存储类别设为默认类别</h1><p id="27c0" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">最后，将存储类设为“默认”。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="493f" class="ju jv hh lm b fi lq lr l ls lt">kubectl patch sc rook-ceph-block -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</span></pre><h2 id="2ebf" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">步骤6 —安装Kubeflow</h2><p id="489e" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">请参考以下通过清单方法部署Kubeflow的先决条件。</p><h2 id="3e08" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">先决条件</h2><ul class=""><li id="535b" class="ku kv hh ig b ih kp il kq ip kw it kx ix ky jb kz la lb lc bi translated"><code class="du ml mm mn lm b">Kubernetes</code>(最高为<code class="du ml mm mn lm b">1.21</code>)，默认为<a class="ae jc" href="https://kubernetes.io/docs/concepts/storage/storage-classes/" rel="noopener ugc nofollow" target="_blank">存储类</a>。️ Kubeflow 1.5.0与1.22及更高版本不兼容。</li><li id="1eb5" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated"><code class="du ml mm mn lm b">kustomize</code>(版本<code class="du ml mm mn lm b">3.2.0</code> ) ( <a class="ae jc" href="https://github.com/kubernetes-sigs/kustomize/releases/tag/v3.2.0" rel="noopener ugc nofollow" target="_blank">下载链接</a>)。Kubeflow 1.5.0与kustomize 4.x的最新版本不兼容。</li><li id="9c91" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated"><code class="du ml mm mn lm b">kubectl</code></li></ul><h2 id="0e86" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">用一个命令安装Kubeflow</h2><p id="2ef1" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">参考Kubeflow清单报告中建议的<a class="ae jc" href="https://github.com/kubeflow/manifests#installation" rel="noopener ugc nofollow" target="_blank">安装</a>方法。基本上，有两种方法，</p><ol class=""><li id="ff31" class="ku kv hh ig b ih ii il im ip li it lj ix lk jb mo la lb lc bi translated"><code class="du ml mm mn lm b">apps</code>和<code class="du ml mm mn lm b">common</code>下所有组件的单命令安装</li><li id="6d2d" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb mo la lb lc bi translated"><code class="du ml mm mn lm b">apps</code>和<code class="du ml mm mn lm b">common</code>的多命令、单个组件安装</li></ol><p id="55ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选项1旨在方便最终用户的部署。<br/>选项2针对定制和挑选单个组件的能力。</p><p id="5fdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为在我的例子中，我将安装Kubeflow的所有组件，所以我选择了选项1，并按如下方式进行。</p><p id="378e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下载<code class="du ml mm mn lm b">kustomize. </code>(版本<code class="du ml mm mn lm b">3.2.0</code>)并从<a class="ae jc" href="https://github.com/kubeflow/manifests" rel="noopener ugc nofollow" target="_blank">https://github.com/kubeflow/manifests</a>克隆清单回购。</p><p id="dd2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从清单目录中执行以下命令。</p><pre class="jf jg jh ji fd ll lm ln lo aw lp bi"><span id="2210" class="ju jv hh lm b fi lq lr l ls lt">while ! kustomize build example | kubectl apply -f -; do echo "Retrying to apply resources"; sleep 10; done</span></pre><p id="f61d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将需要一些时间来调配所有需要的K8s资源。同时保持对pod、pv、pvc的监视，因为这将需要相当长的时间来使它们都处于健康和运行状态。</p><p id="c94e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦一切安装成功，您就可以通过登录您的集群来访问Kubeflow中央仪表盘<a class="ae jc" href="https://github.com/kubeflow/manifests#connect-to-your-kubeflow-cluster" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e6f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi mp translated"><span class="l mq mr ms bm mt mu mv mw mx di">如果</span> <strong class="ig hi">你想看所有日志&amp;输出的所有动作，参考这个视频。</strong></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="my mz l"/></div></figure><h2 id="b25a" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated">结论</h2><p id="ae1d" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">作为这两篇文章的一部分，我们刚刚看到了如何在裸机Ubuntu工作站上建立本地MLOps开发环境。稍后，我们将讨论如何建立MLOps的其他透视图，如特征库、数据管道等。，并从头到尾查看一些示例。请提供您的反馈/意见，并让我知道您的观点。</p><div class="na nb ez fb nc nd"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ne ab dw"><div class="nf ab ng cl cj nh"><h2 class="bd hi fi z dy ni ea eb nj ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nk l"><h3 class="bd b fi z dy ni ea eb nj ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nl l"><p class="bd b fp z dy ni ea eb nj ed ef dx translated">medium.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr jo nd"/></div></div></a></div></div></div>    
</body>
</html>