<html>
<head>
<title>Mining Fanfics on AO3 — Part 2: Exploratory Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AO3矿业研究第二部分:探索性数据分析</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/mining-fanfics-on-ao3-part-2-exploratory-data-analysis-7260cf35ee8a?source=collection_archive---------3-----------------------#2021-03-05">https://medium.com/mlearning-ai/mining-fanfics-on-ao3-part-2-exploratory-data-analysis-7260cf35ee8a?source=collection_archive---------3-----------------------#2021-03-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c87f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将所有数据收集在一个地方，现在我们可以进行各种探索性数据分析(EDA)。因为我对这个项目没有一个固定的计划，所以我只是试着回答我感兴趣的各种问题。</p><p id="98b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种分析有两个不同的部分:第一个是对小说的简介信息及其与“表现”或“反应”统计数据的相互作用的初步探索——更多的数字方面；第二部分涉及大量的文本数据，需要不同的技巧来解开。我们将在第3部分继续讨论后者。</p><p id="f76a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我将介绍我在这个过程中尝试过的一些可能性，但它们绝不是详尽无遗的。对于第一部分，由<a class="jd je ge" href="https://medium.com/u/fa1913854e95?source=post_page-----7260cf35ee8a--------------------------------" rel="noopener" target="_blank"> Destin Gong </a>编写的这个漂亮的<a class="ae jc" href="https://towardsdatascience.com/semi-automated-exploratory-data-analysis-eda-in-python-7f96042c9809" rel="noopener" target="_blank"> EDA流程布局</a>为我提供了一个关于使用seaborn进行可视化的坚实结构和指导。然而，我不想用一种方法论的方式来展示这些发现(Destin的文章足以说明这一点)，我想让这个流程主要由问题/好奇心驱动。matplotlib/seaborn和Tableau都用于可视化。</p><p id="cc46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，我的例子仅限于为某个特定爱好者收集的数据，而探索的问题可能适用于任何爱好者。</p><p id="1005" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是依赖性:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="4e84" class="jo jp hh jk b fi jq jr l js jt">import pandas as pd<br/>import seaborn as sns <br/>import matplotlib.pyplot as plt <br/>import numpy as np <br/>from pandas.api.types import is_string_dtype, is_numeric_dtype<br/>import scipy.stats<br/># import matplotlib.font_manager<br/># from matplotlib.font_manager import FontProperties</span></pre><p id="5a59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ju">最后两个被注释掉了，因为它们没有帮助我解决在seaborn图表中打印非英语字符的问题。我以后可能会解决这个问题。欢迎建议。</em></p><p id="211e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，对我拥有的不同类型的变量进行总结很有帮助:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="5527" class="jo jp hh jk b fi jq jr l js jt">num_cols = []<br/>str_cols = []<br/>others = []<br/>for col in df.columns:<br/>    if is_numeric_dtype(df[col]):<br/>        num_cols.append(col)<br/>    elif is_string_dtype(df[col]):<br/>        str_cols.append(col)<br/>    else:<br/>        others.append(col)<br/>print(num_cols)<br/>print(str_cols)<br/>print(others)<br/></span><span id="6972" class="jo jp hh jk b fi jv jr l js jt">Output:<br/>&gt;&gt;&gt;['Word_count', 'Num_chapters', 'Num_comments', 'Num_kudos', 'Num_bookmarks', 'Num_hits', 'Success'] # numerical columns<br/>&gt;&gt;&gt;['Title', 'Author', 'ID', 'Rating', 'Pairing', 'Warning', 'Complete', 'Language'] # categorical columns # 'ID' were converted to string<br/>&gt;&gt;&gt;['Date_updated', 'Date_published'] # date columns</span></pre></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><h1 id="4634" class="kd jp hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">分类X分类/数值</h1><h2 id="54d7" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">1.评级构成</h2><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="98ed" class="jo jp hh jk b fi jq jr l js jt">df.Rating.value_counts().plot.pie()</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div class="er es ln"><img src="../Images/f1130fc57cc3830a8527b5522411a219.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*dlMl-dv7YK29zAkj67hHjQ.png"/></div></figure><h2 id="16fc" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">2.语言构成</h2><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lr"><img src="../Images/3707f24c63acbc7b092e00287b92a053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1D6dkzLiFrgmZB8k70EZw.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Switched to Tableau due to the character printing issue and also for prettier formatting</figcaption></figure><p id="7faf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很明显，这个粉丝圈子里的大多数粉丝都是用英语写的，而中国作家贡献了另外四分之一。下面的分析将集中在这两种语言上。</p><h2 id="6648" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">3.语言与评级的互动</h2><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ma"><img src="../Images/b33a7a0eff0720116f6f5bafde1fd49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvct88lSY2Qp8tXGIxa1Ug.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Frequency Distribution</figcaption></figure><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mb"><img src="../Images/15beb2de4ab40b0df315894d82f1270b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLm6EbZpgIq6MJN6I9TNzQ.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Fiction Length</figcaption></figure><p id="994d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，“每章字数”是我在Tableau中创建的计算字段。我用的是聚合函数SUM([字数])/SUM([章节数])，而不是先计算每部作品的[字数]/[章节数]，然后取平均值。这实际上得出一个加权平均值，它不会被极端值扭曲。</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mc"><img src="../Images/3046ad097576b1d0729d774ae51f6b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzbXxYYLmFVHpLBIoQFT8Q.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Percentage of WIP</figcaption></figure><p id="ef10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于那些感兴趣的人，我们可以通过快速表格计算，在Tableau中制作这样的百分比堆积条形图。我们将计算限制在“完成”维度，而不是整个表中的百分比</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es md"><img src="../Images/a512effa06e13b446ad839a2e6195e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*BUvOsDUvHBr8eFUV9o-9Aw.png"/></div></div></figure><p id="2bb0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可能还会问一些问题，比如评级如何影响读者的反应？比较百分位数可能会给我们一些提示。</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es me"><img src="../Images/12d407ee85ade9a91a93f07dcdba3272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qsm1mYYAQlk2WIcc6NTKLw.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">The “Reactions” variable is created using the sum of comments, kudos, and bookmarks.</figcaption></figure><p id="cdb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于评级本质上是一个顺序变量，如果按照其内在级别而不是字母顺序排序会更好。我使用默认属性&gt;排序，然后手动来实现这一点。</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div class="er es mf"><img src="../Images/a62e30c21d549227fb70690b0220758b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*y9Yd8n6Vnd1PlfVuWxHHVg.png"/></div></figure></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><h1 id="3ddd" class="kd jp hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">数字X数字</h1><h2 id="1a05" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">1.与热图的相关性</h2><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="bc51" class="jo jp hh jk b fi jq jr l js jt">correlation = df.iloc[:,:-1].corr() # eliminate the last 'Success' column which was added for later classification purposes, which is essentially a categorical variable</span><span id="6ce2" class="jo jp hh jk b fi jv jr l js jt">sns.heatmap(correlation, cmap='GnBu', annot=True)</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div class="er es mg"><img src="../Images/b5cb49b9a38283f6f59c484cfc299447.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*btwlIs65NC1FiYRw1qcSWA.png"/></div></figure><p id="fcf0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">看起来书签的数量和荣誉是高度相关的，而其他的只是稍微正相关。</p><h2 id="f378" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">2.散点图的相关性和分布</h2><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="bceb" class="jo jp hh jk b fi jq jr l js jt">sns.pairplot(df.drop(['ID','Success'], axis=1))</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mh"><img src="../Images/e9b0ed74d25a11ae6a60c4477b117a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gstvKMm3wJALJLu-dXZ3cA.png"/></div></div></figure><p id="2528" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也可以加入一个分类变量来观察组间的差异，例如—</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="4d60" class="jo jp hh jk b fi jq jr l js jt">sns.pairplot(df.drop(['ID','Success'], axis=1), hue = 'Complete')</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mi"><img src="../Images/55127744b3763b84f9a53d7cc9fb0dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lS0qIyhxnT08QPupJMVpw.png"/></div></div></figure><p id="3b70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很明显，许多有价值的数字是高度倾斜的。我对这些变量使用了对数变换:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="cebe" class="jo jp hh jk b fi jq jr l js jt">dic = {}<br/>for col in df.drop(['ID','Success'], axis=1).columns:<br/>    if is_numeric_dtype(df[col]):<br/>        key = '{}_log'.format(col)<br/>        dic[key] = np.log(df[col].values+1)<br/>    else:<br/>        dic[col] = df[col].values</span><span id="38bc" class="jo jp hh jk b fi jv jr l js jt">df2 = pd.DataFrame.from_dict(dic)</span></pre><p id="92ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">转换后，这种关系变得更加清晰:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="1d58" class="jo jp hh jk b fi jq jr l js jt">sns.pairplot(df2, hue = 'Rating', plot_kws={'alpha': 0.3}) # alpha is for transparency since groups overlap severely</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mj"><img src="../Images/96bcfdf8f8d012a9489011c447cc2dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjQ-wyml3LjLA0wdrnTwaw.png"/></div></div></figure><p id="4d4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事实上，相关性也变得更强，尤其是对于反应指标:</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/c7be5d01601140899987b1044054c083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMKCd-AdHGF-0l3DLgYdAA.png"/></div></div></figure><p id="5dca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不出所料，点击率、声望、书签之间有很强的相关性。更多的荣誉或书签确实会带来更多的评论，而点击数并不能很好地预测评论。</p><p id="0d36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同样，对于写更长的小说是否会赢得更多的反应这个问题，答案是肯定的“不会”</p><h2 id="0897" class="jo jp hh bd ke la lb lc ki ld le lf km ip lg lh kq it li lj ku ix lk ll ky lm bi translated">3.斯皮尔曼秩序相关</h2><p id="72e6" class="pw-post-body-paragraph ie if hh ig b ih ml ij ik il mm in io ip mn ir is it mo iv iw ix mp iz ja jb ha bi translated">在这种高度倾斜数据的情况下，Spearman的等级顺序相关性可能是一个合理的选择，因为等级不会受到异常值的影响。</p><p id="a053" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果类似于对数变换后的皮尔逊相关矩阵:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="075e" class="jo jp hh jk b fi jq jr l js jt">corr_matrix, p_matrix = scipy.stats.spearmanr(df)<br/>spearman_corr = pd.DataFrame(corr_matrix, columns = list(df.columns), index = list(df.columns))</span><span id="ecc3" class="jo jp hh jk b fi jv jr l js jt">plt.figure(figsize=(13,10))<br/>sns.heatmap(spearman_corr.iloc[9:15,9:15], cmap='GnBu', annot=True)</span></pre><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mq"><img src="../Images/74c67ac15590db38b4ac40ffc9b75238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pnbg7J4IVeVsY77pNALYLg.png"/></div></div></figure></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><h1 id="76d6" class="kd jp hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">时间序列</h1><p id="00f6" class="pw-post-body-paragraph ie if hh ig b ih ml ij ik il mm in io ip mn ir is it mo iv iw ix mp iz ja jb ha bi translated">有了日期变量，我们还可以探索x轴上的时间模式。</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mr"><img src="../Images/4127abcbe968ae281d29b4a420905d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gv31DKg13ROmzEqrp2VHg.png"/></div></div></figure><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lr"><img src="../Images/91924e48ee54f984d43bfa83d45b9255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XteM2WKDzlBs4sKj7lhiqw.png"/></div></div></figure><p id="2bf8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者，我们可以通过绘制出版日期和最后更新日期之间的时间段来了解写作过程。例如，这可以告诉你谁是最稳定的作者，或者一个作者是否中途放弃了作品。</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ms"><img src="../Images/d42de110b7cfc8df382a41db836a4768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8eGJQ_zQRuHNKXpsSIoMNQ.png"/></div></div></figure><p id="fddc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该甘特图包括为这两个日期之间的差异创建一个计算字段，将其用作大小(标签可以更改为小说标题或其他)，并指定id或其他唯一标识符作为详细信息。(这个想法来自网上一位好心的投稿人，但我再也找不到那个来源了。)</p><figure class="jf jg jh ji fd lo er es paragraph-image"><div class="er es mt"><img src="../Images/67bfd3199e04d43b91f58e2588189b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*xvUqNWTZmTSyhZrQ8wY_vQ.png"/></div></figure></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><p id="b4b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同样，根据项目目标，有无限的可能性。我将在这里结束我的EDA，并在即将到来的帖子中进行一些文本分析！</p></div></div>    
</body>
</html>