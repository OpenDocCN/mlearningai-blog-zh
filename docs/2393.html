<html>
<head>
<title>Intro to Post-deployment model performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署后模型性能介绍</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/intro-to-post-deployment-model-performance-eeecc6930aa5?source=collection_archive---------0-----------------------#2022-04-26">https://medium.com/mlearning-ai/intro-to-post-deployment-model-performance-eeecc6930aa5?source=collection_archive---------0-----------------------#2022-04-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="834d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jc translated"><span class="l jd je jf bm jg jh ji jj jk di">到</span>时间机器学习模型被部署，它们面对现实<strong class="ig hi">和</strong>它随时间进化<strong class="ig hi"> </strong>。<strong class="ig hi">性能下降</strong>是一种机器学习现象，一旦机器学习模型被部署到生产中，就会发生这种现象，并且可以定义为其<strong class="ig hi">随着时间的推移而贬值或恶化</strong>:这是一个复杂而令人兴奋的挑战，因为总体而言，它对业务问题具有重大影响，并且是<strong class="ig hi">无声的。</strong></p><blockquote class="jl jm jn"><p id="209c" class="ie if jo ig b ih ii ij ik il im in io jp iq ir is jq iu iv iw jr iy iz ja jb ha bi translated"><em class="hh">通常，当我们可以将预测值-y_hat-与真实标签-y或实际值进行比较时，通常会检测到性能下降</em><strong class="ig hi"><em class="hh"/></strong><em class="hh">……那么，我们如何在<strong class="ig hi">缺少目标</strong>的情况下测量性能评估呢？使用开源的NannyML。</em></p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/5288c819f35f15387e5c139057f86047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*V81F2ulQijclxRLhQWSVVw.gif"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fig 1. The business challenge example we will be working on. We predict<strong class="bd kj"> if a worker will work from home in a binary classification scenario on a given day. </strong>Each Dataset row contains a unique identified observation about a worker on a day of the week and considers several features, such as the distance from the office, transportation costs, and if the worker worked from home the previous day.</figcaption></figure><h1 id="dddd" class="kk kl hh bd kj km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">机器学习模型为什么会失败？</h1><p id="9829" class="pw-post-body-paragraph ie if hh ig b ih lh ij ik il li in io ip lj ir is it lk iv iw ix ll iz ja jb ha bi translated">机器学习模型通常基于历史或静态数据进行训练。但是，环境和关键条件会导致数据发生变化，从而导致数据的模式发生变化，导致模型的预测随着时间的推移而降低。机器学习模型失败有两个主要原因:</p><ul class=""><li id="dd30" class="lm ln hh ig b ih ii il im ip lo it lp ix lq jb lr ls lt lu bi translated"><strong class="ig hi">数据漂移</strong>:我们可以将其定义为模型将推断的特征中编码的数据输入分布的不可预测<strong class="ig hi">变化。它可能会影响拟合函数或分类器的准确度。尽管这在小型数据集中可能很容易发现，但当我们在大规模数据集中有数百个要素时，这可能是一个挑战。</strong></li><li id="1ac1" class="lm ln hh ig b ih lv il lw ip lx it ly ix lz jb lr ls lt lu bi translated"><strong class="ig hi">概念漂移</strong>:输入和目标之间的<strong class="ig hi">决策边界或整体分类器模式</strong>的变化。分类器捕捉这种关系的快照，但是随着概念的改变，这种快照变得越来越不准确。所以换句话说，分类器的行为没有改变，但潜在的模式改变了，这种模式不再是现实的良好代表。[1]</li></ul><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ma"><img src="../Images/735aabd7f16f200669c2850a3aed01fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6DOiyLxn22vNjlFaJptjA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fig 2. Concept drift and Data drift. Factors like seasonality can cause Data Drift, and one of the ways to detect concept drift is to plot feature importance for the classifier: one example of Data drift in work from Home prediction challenge is that we recently hired some people who work far from the office or a later initiative of pizza Fridays that make workers return.</figcaption></figure><blockquote class="jl jm jn"><p id="656b" class="ie if jo ig b ih ii ij ik il im in io jp iq ir is jq iu iv iw jr iy iz ja jb ha bi translated">数据漂移和概念漂移之间的主要<strong class="ig hi">差异</strong>在于<strong class="ig hi">数据漂移</strong>与自变量的统计特性<strong class="ig hi">的变化相关，而概念漂移是因变量<strong class="ig hi">的统计特性发生重大变化时，与<strong class="ig hi">分类器</strong>或<strong class="ig hi"> </strong>相关的输入和输出之间模式的变化。</strong><a class="ae js" href="https://github.com/NannyML/nannyml" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">NannyML</strong></a><strong class="ig hi"/>性能评估<strong class="ig hi"> </strong>重点检测<strong class="ig hi">数据漂移</strong>和<strong class="ig hi">多元数据漂移</strong></strong></p></blockquote><h1 id="f970" class="kk kl hh bd kj km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated"><strong class="ak">在NannyML中是如何工作的？</strong></h1><p id="e2ba" class="pw-post-body-paragraph ie if hh ig b ih lh ij ik il li in io ip lj ir is it lk iv iw ix ll iz ja jb ha bi translated">在现实世界的问题中，我们通常会面临这样的挑战:在事实标签和预测之间有一段时间的间隔，或者甚至没有实际的标签。因此，非常高级的想法是<strong class="ig hi">基于与概率估计相关的阈值进行预测</strong>和<strong class="ig hi">比较来自分析分区和参考分区的数据，以检测数据漂移。</strong></p><p id="ea1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该库提供了一个概率估计算法。然而，为了在NannyML中运行性能评估，我们应该考虑一些事情:</p><ul class=""><li id="0221" class="lm ln hh ig b ih ii il im ip lo it lp ix lq jb lr ls lt lu bi translated"><strong class="ig hi">分区</strong>:数据集被分成参考和分析分区。<strong class="ig hi">参考分区</strong>设置期望值，需要真标签(y)，它代表一个数据周期，在这个周期内我们确信<strong class="ig hi">模型表现良好；</strong>如果模型还没有部署<strong class="ig hi">，</strong>我们可以使用这里的测试集<strong class="ig hi">来测试基线模型。</strong><strong class="ig hi">分析分区</strong>不需要真正的标签:NannyML基于置信度的性能评估算法方法是在分析阶段完成的。</li></ul><blockquote class="jl jm jn"><p id="c2cb" class="ie if jo ig b ih ii ij ik il im in io jp iq ir is jq iu iv iw jr iy iz ja jb ha bi translated"><strong class="ig hi">参考分区</strong>将具有<strong class="ig hi">真实预测标签</strong>和<strong class="ig hi">预测概率</strong>，我们应该知道它是与良好模型性能相关的数据。分析分区将只有<strong class="ig hi">预测概率，没有真实目标标签。</strong>查看<a class="ae js" href="https://docs.nannyml.com/latest/guides/data_drift.html#data-drift-partitions" rel="noopener ugc nofollow" target="_blank">数据分区</a>文档。</p></blockquote><ul class=""><li id="6658" class="lm ln hh ig b ih ii il im ip lo it lp ix lq jb lr ls lt lu bi translated">需要正类的<strong class="ig hi">得分/预测概率</strong> ( <em class="jo">预测_proba </em>或<em class="jo">决策_函数</em> Sklearn方法，取决于分类器)作为数据集内的列，每个观察的<strong class="ig hi">唯一标识符</strong>，以及在这种情况下观察发生的<strong class="ig hi">时间戳</strong>。</li></ul><p id="9926" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了适合分类器，我们需要提取元数据，并且需要声明目标列名</p><pre class="ju jv jw jx fd mb mc md me aw mf bi"><span id="0bcb" class="mg kl hh mc b fi mh mi l mj mk">occurred.metadata = nml.extract_metadata(reference)<br/>metadata.target_column_name = ‘work_home_actual’</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ml"><img src="../Images/a814af23b9d56fdca9c8b4e0a648775e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-MK6FgsUNTP79Ueso0izg.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fig3. How the metadata looks like. NannyML will automatically detect some of them, but you might want to double check them here. If you have separated reference and analysis datasets, you need an extra column with a categorical partition name.</figcaption></figure><p id="bdd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，让我们来拟合基于置信度的性能估计器！</p><pre class="ju jv jw jx fd mb mc md me aw mf bi"><span id="c6c4" class="mg kl hh mc b fi mh mi l mj mk">cbpe = nml.CBPE(model_metadata=metadata, chunk_period="D")<br/>cbpe.fit(reference_data=reference)</span></pre><blockquote class="jl jm jn"><p id="253f" class="ie if jo ig b ih ii ij ik il im in io jp iq ir is jq iu iv iw jr iy iz ja jb ha bi translated"><strong class="ig hi">数据块</strong>。我们基于<strong class="ig hi">时间间隔</strong>创建块，但是需要根据业务案例来理解数据块:如果没有指定，NannyML将自动对引用分区进行分块。请注意这一点，因为它可能会影响性能估计器。</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mm"><img src="../Images/78969214e85069476ed4eb34387e6b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUmcNcxGQjsgq_8iikBcSg.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fig4. [2] Call the <em class="mn">Confidence-based performance estimator</em>, and interpret model decay, including it in timing and performance threshold. The graph represents the estimated ROC AUC curve over time in between an acceptable threshold. The <strong class="bd kj">blue</strong> and <strong class="bd kj">purple</strong> plotted lines refer to the reference(access to the label ) and analysis( not access to the label ) partitions. Regarding p<strong class="bd kj">erformance threshold</strong>, and given that a good AUC is near 1, it does make sense that the optimal threshold might be in between the given range. The model shows a model decay since late 2019.</figcaption></figure><blockquote class="jl jm jn"><p id="d9a4" class="ie if jo ig b ih ii ij ik il im in io jp iq ir is jq iu iv iw jr iy iz ja jb ha bi translated">此时，我们可能知道2019年性能下降，但我们如何知道发生了什么？</p></blockquote><div class="ju jv jw jx fd ab cb"><figure class="mo jy mp mq mr ms mt paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><img src="../Images/52557bfe03b96b449bed195f06189d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*_sB7FOohgwH2T6UWWgHaTA.png"/></div></figure><figure class="mo jy mu mq mr ms mt paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><img src="../Images/192bfc19683033fbb590dc295efa5f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*PG40Oif2JMp-HX2PuQrOcA.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx mv di mw mx">Fig5. [2] The framework plots the distribution of continuous and categorical features in reference and analysis partitions and can print alerts for data drift in a dataset . At this point, we can see a change with respect to the distribution of the work from home previous day feature and distance from the office. The first figure shows that there has been a change in how far workers are from the office, tending to live farther, causing model decay . In the second figure, the boolean distribution of the feature work from home previous day.</figcaption></figure></div><p id="05b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<a class="ae js" href="https://www.meetup.com/PyData-Madrid/events/284942321/" rel="noopener ugc nofollow" target="_blank"> PyData Madrid meetup </a>中，我们分享了一个真实的商业案例，这是一个使用真实世界数据的真实世界挑战。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es my"><img src="../Images/8a5fde3ee9b8aba69b9f2332440d4eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tyX-mp3kWOKcoO3q"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fig6.Business challenge example we will be working with at PyData Madrid meetup . We predict<strong class="bd kj"> a subscription after a one-month trial for a mobile recipes dessert app</strong>.<strong class="bd kj"> There is a one-month time-lapse between the real label (y) and the predicted label(y_hat).</strong> Therefore, we have an absence of the ground truth for a month.<strong class="bd kj"> How can we know that our model is performing well without losing customers</strong>? The app includes four main activities, with historical data from one month, with device and geolocation information about the user. The base binary classifier model ( xgboost ), in which <strong class="bd kj">label 1 </strong>represents the positive class(that the user converts) and label 0 represents that the user does not convert: we deployed into production shows an ACC of 0.766 of and F1 score of and will be the model we will use for <strong class="bd kj">performance estimation</strong>.</figcaption></figure><p id="f1b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="c9bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[1]感谢<a class="ae js" href="https://www.nannyml.com/" rel="noopener ugc nofollow" target="_blank"> NannyML </a>联合创始人反馈修正！</p><p id="edaf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[2]数字来自NannyML docs</p><div class="mz na ez fb nb nc"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hi fi z dy nh ea eb ni ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">medium.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq kd nc"/></div></div></a></div></div></div>    
</body>
</html>