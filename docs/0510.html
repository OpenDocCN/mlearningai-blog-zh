<html>
<head>
<title>Aggregation in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫的聚集</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/aggregation-in-pandas-d6cd37008752?source=collection_archive---------5-----------------------#2021-05-05">https://medium.com/mlearning-ai/aggregation-in-pandas-d6cd37008752?source=collection_archive---------5-----------------------#2021-05-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e605" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我总是将数据操作视为乐高游戏——理解小片段将帮助你创建你想要的模型！</p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><p id="a97d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jk translated"><span class="l jl jm jn bm jo jp jq jr js di"/>聚合是基于某些标准收集/拆分数据的过程(1)，然后对其应用统计方法，以便每个组都以一个数字表示(2)。(1)确定数据范围，(2)进行数学运算。本文将在Pandas中解释这些步骤，Pandas是Python中操作数据最流行的库之一。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/3abdac71a54abc20a3f8bae04dcd142e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n_JXsHXs2SpL4KnK"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Photo by <a class="ae kj" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><h1 id="daab" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">(1) —一切都与数据有关</h1><p id="dac5" class="pw-post-body-paragraph ie if hh ig b ih li ij ik il lj in io ip lk ir is it ll iv iw ix lm iz ja jb ha bi translated">如果我们想要聚合整个数据或特定的列，这一步没有太多的工作:我们通过从数据帧或序列中直接调用聚合函数来立即执行步骤(2)。不幸是，我们通常需要更多:我们希望通过数据组来计算这些统计数据。本文更侧重于这一步，通过对熊猫内置函数<strong class="ig hi"> stack </strong>、<strong class="ig hi"> unstack </strong>、<strong class="ig hi"> groupby </strong>、<strong class="ig hi"> pivot </strong>、<strong class="ig hi"> pivot_table </strong>、<em class="jc"> when </em>我们应该使用哪些<em class="jc"/>然后给大家展示一些它们的常见组合。</p><p id="8c25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc"> stack() </em> —最里面的列级别成为最里面的索引。如果只有一层列，则返回一个序列，否则返回一个数据帧。</p><p id="1c85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc"> unstack() </em> —与<em class="jc"> stack() </em>相反，你最里面的索引变成了你最里面的列级。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ln"><img src="../Images/95d0b26a8b7fb57f159801cb7edb96bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sq1_Cm6n-gCb9uZN7LirpQ.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Stack/Unstack Example</figcaption></figure><p id="758d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc"> groupby() </em> —顾名思义，帮助您按一个或多个列值或列级别对数据进行分组。它<strong class="ig hi">不会</strong>重塑您的数据——相反，它会创建一个<em class="jc"> DataFrameGroupBy </em>类型的实例来存储关于找到的组及其相关列/索引的所有细节。然后，您可以从特定组恢复数据，或者对它们应用聚合函数。您应该注意，数据的后续更改会影响表示和聚合结果，而不是组本身。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lo"><img src="../Images/a6e503ee88f22e5ad94c76ff47dcb10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*KrPkCdty2yeYWNu6TYiAtw.jpeg"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Groupby Example</figcaption></figure><p id="0fe6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc"> pivot(index，columns，values) — </em> <strong class="ig hi">根据列值对数据</strong>进行整形，并返回新的DataFrame。假设<em class="jc"> groupby() </em>可以重塑数据，我们可以把这个函数理解为一个<em class="jc"> groupby(index，columns) </em>后跟一系列<em class="jc"> unstack(columns[i]) </em>函数的组合，然后只选择<em class="jc">值</em>列来显示。该函数<strong class="ig hi">不支持聚合。</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lp"><img src="../Images/b560bec7775021fd75db7994a981d1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rSw6ajP55v99cBvTY2cew.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Pivot Example</figcaption></figure><p id="cbc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个例子中，如果我们添加参数<em class="jc"> values=('A1 '，' C2') </em>，那么结果将只显示这一列的数据。</p><p id="d48e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc"> pivot_table() </em> —我们可以把它理解为pivot()函数的一个聚合支持版本。</p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><p id="2949" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好了，现在我们知道它们是什么了，下面是一些常见的组合。</p><ol class=""><li id="3393" class="lq lr hh ig b ih ii il im ip ls it lt ix lu jb lv lw lx ly bi translated">groupby()和unstack() <br/>在用Pandas分析数据时，我们可以大量使用这种组合。当根据列值对数据进行分组时，聚合结果按行返回，很难在它们之间进行其他计算。请记住，Pandas是围绕DataFrame工作的，data frame是一种列数据结构，所以最好是使用列。</li><li id="e018" class="lq lr hh ig b ih lz il ma ip mb it mc ix md jb lv lw lx ly bi translated">stack()和unstack() <br/>当我们需要对一个列值进行聚合并以基于列的方式显示结果时，这很有用。用<em class="jc"> groupby(轴=1) </em>和<em class="jc"> unstack() </em>可以达到同样的效果。</li></ol></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><h1 id="6f22" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">(2)关于聚合的一点看法</h1><p id="0d01" class="pw-post-body-paragraph ie if hh ig b ih li ij ik il lj in io ip lk ir is it ll iv iw ix lm iz ja jb ha bi translated">根据步骤(1)，我们有不同的方法对数据应用聚合函数。</p><ol class=""><li id="610a" class="lq lr hh ig b ih ii il im ip ls it lt ix lu jb lv lw lx ly bi translated">直接从DataFrame、Series或GroupBy对象调用聚合函数。还有很多内置函数像<em class="jc"> sum()、mean()、median()等。</em></li><li id="341d" class="lq lr hh ig b ih lz il ma ip mb it mc ix md jb lv lw lx ly bi translated">对于GroupBy，我们有其他选择:<br/> - <em class="jc"> apply() </em>:从技术上讲，我们将<em class="jc">每个组</em>传递到函数中，并将它们的结果组合在一起。如果可能的话，考虑使用<em class="jc"> pipe() </em>，因为<em class="jc"> apply() </em>在很多情况下并没有很好的性能。<br/> - <em class="jc"> pipe(): </em>将<em class="jc"> GroupBy </em>对象传递到函数中，这样所有的组上下文都可以从函数中访问。当我们需要做一系列的聚合时，管道也是有用的，一个的输出是另一个的输入。<br/> - <em class="jc"> transform() </em>:类似于<em class="jc"> apply </em>，但是一旦完成，它会用聚合数据替换原始数据。</li><li id="268a" class="lq lr hh ig b ih lz il ma ip mb it mc ix md jb lv lw lx ly bi translated">用<em class="jc"> pivot_table() </em>，我们直接定义<em class="jc">我们要在<em class="jc">什么</em>列上执行哪些函数</em>作为参数。</li></ol><p id="8a51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的收获:</p><blockquote class="me mf mg"><p id="b2bc" class="ie if jc ig b ih ii ij ik il im in io mh iq ir is mi iu iv iw mj iy iz ja jb ha bi translated">基于列级别/索引重塑数据，尝试堆叠/拆分。</p><p id="6eef" class="ie if jc ig b ih ii ij ik il im in io mh iq ir is mi iu iv iw mj iy iz ja jb ha bi translated">基于列值重塑数据，想想透视。使用pivot_table处理重复。</p><p id="0fb2" class="ie if jc ig b ih ii ij ik il im in io mh iq ir is mi iu iv iw mj iy iz ja jb ha bi translated">如果只做聚合，可以考虑groupby。</p><p id="ad2a" class="ie if jc ig b ih ii ij ik il im in io mh iq ir is mi iu iv iw mj iy iz ja jb ha bi translated">Pivot/pivot_table是丰富的函数。如果您认为groupby+stack+unstack太复杂而无法转换数据，请尝试一下。</p></blockquote></div></div>    
</body>
</html>