<html>
<head>
<title>Hive part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蜂巢第二部分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/hive-part-2-3e521e200f30?source=collection_archive---------3-----------------------#2021-09-14">https://medium.com/mlearning-ai/hive-part-2-3e521e200f30?source=collection_archive---------3-----------------------#2021-09-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3c6e3342e7fa6112a0f5d657321e8aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Pq1Pb2FgUAyaSciIizvEg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://www.linkedin.com/company/mlearning-ai/" rel="noopener ugc nofollow" target="_blank">MLearning.ai collaborates with over 500 researchers from 6 continents</a></figcaption></figure><h1 id="4412" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">1.配置单元数据类型</h1><p id="55d0" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">配置单元数据类型分为数字类型、字符串类型、杂项类型和复杂类型。下面给出了配置单元数据类型的列表。</p><h2 id="e119" class="kq iv hh bd iw kr ks kt ja ku kv kw je kd kx ky ji kh kz la jm kl lb lc jq ld bi translated">a.数字类型</h2><ul class=""><li id="b55c" class="le lf hh ju b jv jw jz ka kd lg kh lh kl li kp lj lk ll lm bi translated">TINYINT (1字节有符号整数，从-128到127)</li><li id="4545" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">SMALLINT (2字节有符号整数，从-32，768到32，767)</li><li id="10c0" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">INT (4字节有符号整数，从-2，147，483，648到2，147，483，647)</li><li id="4666" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">BIGINT (8字节有符号整数，从-9，223，372，036，854，775，808到9，223，372，036，854，775，807)</li><li id="d45b" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">FLOAT (4字节单精度浮点数)</li><li id="be35" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">DOUBLE (8字节双精度浮点数)</li><li id="8d67" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">十进制(Hive 0.13.0引入了用户可定义的精度和标度)</li></ul><h2 id="d088" class="kq iv hh bd iw kr ks kt ja ku kv kw je kd kx ky ji kh kz la jm kl lb lc jq ld bi translated">b.日期/时间类型</h2><ul class=""><li id="b3a5" class="le lf hh ju b jv jw jz ka kd lg kh lh kl li kp lj lk ll lm bi translated">时间戳</li><li id="082a" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">日期</li></ul><h2 id="e241" class="kq iv hh bd iw kr ks kt ja ku kv kw je kd kx ky ji kh kz la jm kl lb lc jq ld bi translated">c.字符串类型</h2><ul class=""><li id="2cfe" class="le lf hh ju b jv jw jz ka kd lg kh lh kl li kp lj lk ll lm bi translated">线</li><li id="2599" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">可变长字符串</li><li id="1f53" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">茶</li></ul><h2 id="5315" class="kq iv hh bd iw kr ks kt ja ku kv kw je kd kx ky ji kh kz la jm kl lb lc jq ld bi translated">d.杂项类型</h2><ul class=""><li id="ad6e" class="le lf hh ju b jv jw jz ka kd lg kh lh kl li kp lj lk ll lm bi translated">布尔型</li><li id="016a" class="le lf hh ju b jv ln jz lo kd lp kh lq kl lr kp lj lk ll lm bi translated">二进制的</li></ul><h2 id="47e0" class="kq iv hh bd iw kr ks kt ja ku kv kw je kd kx ky ji kh kz la jm kl lb lc jq ld bi translated">e.复杂类型</h2><ul class=""><li id="1279" class="le lf hh ju b jv jw jz ka kd lg kh lh kl li kp lj lk ll lm bi translated"><strong class="ju hi">数组:</strong></li></ul><p id="190e" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">它是使用从零开始的整数进行索引的相似类型的值的集合。</p><ul class=""><li id="b258" class="le lf hh ju b jv ls jz lt kd lx kh ly kl lz kp lj lk ll lm bi translated"><strong class="ju hi">地图:</strong></li></ul><p id="34d6" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">它包含使用数组表示法访问字段的键值元组。</p><ul class=""><li id="0d20" class="le lf hh ju b jv ls jz lt kd lx kh ly kl lz kp lj lk ll lm bi translated"><strong class="ju hi">结构:</strong></li></ul><p id="21cb" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">Hive中的复杂数据类型，可以存储一组不同数据类型的字段。</p><h1 id="1303" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">2.桌子</h1><p id="6c7c" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">在Hive中，我们可以使用类似于SQL的约定来创建一个表。它支持存储表的数据文件的广泛的灵活性。它提供了两种类型的表格:-</p><p id="be94" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-内部表</p><p id="5f5b" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-外部表</p><h1 id="72cc" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">内部表</h1><p id="da31" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">内部表也称为托管表，因为它们的数据生命周期是由配置单元控制的。默认情况下，这些表存储在hive.metastore.warehouse.dir定义的目录下的子目录中(即/user/hive/warehouse)。内部表不够灵活，无法与Pig等其他工具共享。如果我们试图删除内部表，Hive会删除表模式和数据。</p><h1 id="eeda" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">外部表</h1><p id="6872" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">外部表允许我们从外部创建和访问表和数据。<strong class="ju hi"> external </strong>关键字用于指定外部表，而<strong class="ju hi"> location </strong>关键字用于确定加载数据的位置。</p><p id="6e1c" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">因为表是外部的，所以数据不存在于Hive目录中。因此，如果我们尝试删除该表，该表的元数据将被删除，但数据仍然存在。</p><h1 id="f4b4" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">3.划分</h1><p id="33ac" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">Hive中的分区意味着根据特定列(如日期、课程、城市或国家)的值将表分成几个部分。分区的优点是，由于数据存储在片上，查询响应时间变得更快。</p><p id="2448" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">Hive中的分区可以通过两种方式执行</p><p id="73c1" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-静态分区</p><p id="a50d" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-动态分区</p><h1 id="c094" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">I .蜂巢静态分区</h1><p id="6770" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">-在静态或手动分区中，需要在将数据加载到表中时手动传递分区列的值。因此，数据文件不包含分区列。</p><p id="4142" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-如果要在hive中使用静态分区，应该在hive-site.xml中设置属性集<strong class="ju hi">hive . mapred . mode = strict</strong>该属性默认设置</p><p id="aaed" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-静态分区处于严格模式。</p><h1 id="bb36" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">二。蜂巢动态划分</h1><p id="717d" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">动态分区为我们提供了灵活性，并根据我们插入到表中的数据自动创建分区。</p><p id="c7cb" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">要使用DP，我们首先需要实现:</p><p id="3dc6" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-hive &gt; set hive . exec . dynamic . partition = true；</p><p id="c004" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">-hive &gt; set hive . exec . dynamic . partition . mode = non strict；</p><p id="08fa" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">如果您想要对许多列进行分区，但是不知道有多少列，那么动态分区也是合适的。</p><h1 id="d791" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">4.视角</h1><p id="0437" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">基本上，Apache Hive视图类似于Hive表，是根据需求生成的。</p><p id="46af" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">用途1:过滤数据</p><p id="8766" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">用途2:降低复杂性</p><h1 id="5be7" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">5.水桶</h1><p id="6b48" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">配置单元中的分桶概念是将数据分成多个范围，这些范围称为桶，为数据提供额外的结构，以便可以用于更高效的查询。存储桶的范围由数据集中一个或多个列的哈希值决定</p><p id="1b7c" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">当分区更加困难时，我们使用分桶的概念。</p><p id="5778" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">分桶表还可以更有效地利用整体资源；当在存储桶级别进行连接，而不是对其中一个表进行完整的广播连接时，内存利用率很低。桶的数量越多，需要的内存就越少——但是太多的桶会产生不必要的并行性。一开始可能需要做一些实验，但最终，您会找到高效扫描数据集的理想存储桶数。</p><p id="6e0a" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">分桶的概念基于散列技术。</p><p id="ebbf" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">这里，计算当前列值和所需桶数的模(假设F(x) % 3)。</p><p id="119c" class="pw-post-body-paragraph js jt hh ju b jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp ha bi translated">现在，基于结果值，数据被存储在相应的桶中。</p></div></div>    
</body>
</html>