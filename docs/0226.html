<html>
<head>
<title>ImageDataGenerator Boon to TensorFlow Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ImageDataGenerator是TensorFlow用户的福音</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/imagedatagenerator-boon-to-tensorflow-users-9c555130dd67?source=collection_archive---------6-----------------------#2021-03-06">https://medium.com/mlearning-ai/imagedatagenerator-boon-to-tensorflow-users-9c555130dd67?source=collection_archive---------6-----------------------#2021-03-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7dfc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如何处理大型数据集</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/644b88adeed1f3c5f2f8b6f91916fe37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CsxQtiSSvt4Jpist.jpg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx"><a class="ae js" href="https://www.google.com/search?q=lord+krishna&amp;tbm=isch&amp;ved=2ahUKEwj9jf780pnvAhV_zHMBHebTDR0Q2-cCegQIABAA&amp;oq=lord+krishna&amp;gs_lcp=CgNpbWcQAzIFCAAQsQMyBQgAELEDMgUIABCxAzIFCAAQsQMyBQgAELEDMgUIABCxAzIFCAAQsQMyAggAMgIIADICCAA6BAgjECc6CAgAELEDEIMBOgYIABAFEB46BggAEAoQGDoHCCMQ6gIQJzoECAAQQ1DmrQFYnekBYIfrAWgHcAB4AIAB0gGIAawVkgEGMC4xNy4ymAEAoAEBqgELZ3dzLXdpei1pbWewAQrAAQE&amp;sclient=img&amp;ei=cGZCYP2VNP-Yz7sP5qe36AE&amp;bih=625&amp;biw=1366#imgrc=eUYOIqrkZMO4QM" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="4e29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设您正在处理具有100个类的图像数据集，每个类包含1000个图像，如果我们将在低配置设备上训练模型，它将耗尽内存。那么问题是我们该怎么办？这里Keras wrapper带有一个<strong class="ig hi"> ImageDataGenerator的想法。</strong>我们将把数据分成批次，然后将批次的图像数据输入网络，用于图像分类或各种CNN应用，而不是借助ImageDataGenerator获取整个数据集。请阅读tensorflow的文档，相信我，无论我要进一步解释什么，它都会给你更多的洞察力。让我们开始吧……</p><h2 id="b52e" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">类型I:-当我们在本地系统的目录中有数据时</h2><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ko"><img src="../Images/794e9cc3f811e01bc0264be509802e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*_G5HFohrGBhm8hpsU6Nmkg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Picture 1</figcaption></figure><p id="85f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">导入图像数据生成器</strong></p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="09ca" class="jt ju hh kq b fi ku kv l kw kx">from tensorflow.keras.preprocessing.image import ImageDataGenerator</span></pre><p id="12c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">增强:- </strong>该技术用于扩展图像的大小，以便我们的卷积层可以从中提取越来越多的特征。重要的一点要记住，我们不应该在测试图像上做增强。这使得我们的模型更加一般化。</p><p id="f40d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图像放大就像将图像重新缩放到一定的范围，水平翻转图像，改变图像的角度等。</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="05a3" class="jt ju hh kq b fi ku kv l kw kx">&gt;&gt; train_datagen=ImageDataGenerator(rescale=1./255.,<br/>                 validation_split=0.2,rotation_range=30,<br/>                 width_shift_range=0.2, height_shift_range=0.2,<br/>                 horizontal_flip=<strong class="kq hi">True</strong>, vertical_flip=<strong class="kq hi">True</strong>)                                              <br/>&gt;&gt; train_images =train_datagen.flow_from_directory(directory="Parent <br/>                 Folder/train",target_size=(256, 256) ,<strong class="kq hi">seed=1</strong><br/>                 color_mode='rgb', class_mode='categorical' ,<br/>                 batch_size=32 , shuffle=<strong class="kq hi">True</strong>, subset="training")<br/>&gt;&gt; val_images =  train_datagen.flow_from_directory(directory="Parent <br/>                 Folder/train",target_size=(256, 256),shuffle=<strong class="kq hi">False,<br/>                 </strong>color_mode='rgb',class_mode='categorical',<strong class="kq hi">seed=1</strong><br/>                 batch_size=32, subset="validation")              <br/>&gt;&gt; test_datagen =ImageDataGenerator(rescale=1./255., <br/>                 validation_split=0.2)<br/>&gt;&gt; test_images = test_datagen.flow_from_directory(directory="Parent <br/>                 Folder/test",target_size=(256, 256),<br/>                 color_mode='rgb', class_mode='categorical',<br/>                 batch_size=32, shuffle=<strong class="kq hi">False</strong>)</span></pre><p id="f2d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">rescale=1./255.</code>因为我们知道每个像素的范围在<code class="du ky kz la kq b">0–255</code>之间，所以我们需要将所有像素归一化到相同的比例。</p><p id="8fe4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">validation_split</code>将训练目录分为训练集和验证集，其中验证集将预测在给定训练集上训练的模型的准确性。</p><p id="b867" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">flow_from_directory</code>访问本地目录中的数据。</p><p id="38d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">class_mode=”categorical”</code>最常用于多类分类。它将以一种热编码形式接收多类数据。</p><p id="b028" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">target_size</code>图像将被调整的尺寸。默认情况下，它将被视为<code class="du ky kz la kq b">(256,256)</code></p><p id="b193" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">seed=1</code>确保数据在训练集和验证集中平均分布</p><p id="bef4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi lb translated"><span class="l lc ld le bm lf lg lh li lj di"> N </span>注:-我们将采用两个不同的数据元，即:- <code class="du ky kz la kq b">train_datagen</code>在这种情况下，我们将对其应用数据扩充，而<code class="du ky kz la kq b">test_datagen</code>我们不会对其应用数据扩充。</p><h2 id="5d49" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">类型II :-当我们有csv格式的数据时</h2><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lk"><img src="../Images/2484739eac1014a5efb1190063fb727d.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*N0vKkqz7RFPCQKqYR4MDNA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Picture 2</figcaption></figure><p id="349e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们想从csv文件中访问图像数据时，我们必须使用<code class="du ky kz la kq b">datagen.flow_from_dataframe()</code>。</p><p id="bbac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">csv文件的工作方式与目录不同，因为在csv文件的情况下，所有影像数据都以单个要素的形式呈现，而另一个要素则代表其类别。</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="f38f" class="jt ju hh kq b fi ku kv l kw kx"># importing necessary libraries to deal with csv image files<br/>&gt;&gt; from sklearn.model_selection import train_test_split<br/>&gt;&gt; import pandas as pd</span></pre><p id="cea0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里，我们将数据集分为三个部分，即:-训练集、验证集和测试。</p><p id="f460" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">train set:-</code>我们将训练我们的模型的数据，<code class="du ky kz la kq b">validation set</code>我们将检查我们的模型有多准确(最常见的是检查模型的准确性)，而<code class="du ky kz la kq b">test set</code>将预测未知(<code class="du ky kz la kq b">test</code>)数据的结果。</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="1c75" class="jt ju hh kq b fi ku kv l kw kx">df=pd.read_csv("/parent.csv",dtype=str)<br/>df_train,df_test=train_test_split(df,test_size=0.1,random_state=1)</span></pre><p id="14fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种分割将把每类数据分成80%的训练集和20%的测试集。</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="42c6" class="jt ju hh kq b fi ku kv l kw kx">train_datagen=ImageDataGenerator(rescale=1./255,validation_split=0.2<br/>          rotation_range=30,width_shift_range=0.2,<br/>          height_shift_range=0.2,horizontal_flip=<strong class="kq hi">True</strong>,<br/>          vertical_flip=<strong class="kq hi">True)<br/></strong>test_datagen=ImageDataGenerator(rescale=1/255,validation_split=0.2)<br/>train_images=train_datagen.flow_from_dataframe(dataframe=df_train,<br/>             directory="Parent Folder/images",x_col='image',<br/>             y_col='class',target_size=(256, 256),color_mode='rgb',<br/>             class_mode='categorical', batch_size=32, <strong class="kq hi">shuffle=True</strong>,<br/>             <strong class="kq hi">subset="training"</strong>, seed=42)<br/>val_images=train_datagen.flow_from_dataframe(dataframe=df_train,<br/>             directory="Parent Folder/images",x_col='image',<br/>             y_col='class',target_size=(256, 256),color_mode='rgb',<br/>             class_mode='categorical', batch_size=32, <strong class="kq hi">shuffle=True</strong>,<br/>             <strong class="kq hi">subset="validation"</strong>, seed=42)<br/>test_images=train_datagen.flow_from_dataframe(dataframe=df_test,<br/>             directory="Parent Folder/images",x_col='image',<br/>             y_col='class',target_size=(256, 256),color_mode='rgb',<br/>             class_mode='categorical', batch_size=32, <strong class="kq hi">shuffle=False</strong>,<br/>            seed=42)</span></pre><p id="fd95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">directory</code>:-保存csv文件的路径。</p><p id="1d8f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">x_col,y_col</code> :-分别包含图像及其类别的csv文件的列</p><p id="a8fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ky kz la kq b">shuffle</code> <strong class="ig hi"> </strong> :-我们将混洗训练测试、验证集的数据，对于测试集，我们将保持原样。</p><p id="39a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi lb translated">注意:-无论何时你将在目录文件夹中获得自定义数据，尝试将其转换为csv格式，然后应用图像分类。你会从中受益匪浅。</p><p id="45fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:- </strong></p><p id="fc30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望这篇文章能帮助你解决这么多问题。请在下面评论你想在我以后的博客中看到的任何建议和改进。不断学习，不断探索……</p></div></div>    
</body>
</html>