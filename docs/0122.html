<html>
<head>
<title>Building ML Pipelines to Learn from Data in Real-time (Survey)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建ML管道以实时学习数据(调查)</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-ml-pipelines-for-learning-from-data-in-real-time-b6dbbe9b07ce?source=collection_archive---------0-----------------------#2021-02-13">https://medium.com/mlearning-ai/building-ml-pipelines-for-learning-from-data-in-real-time-b6dbbe9b07ce?source=collection_archive---------0-----------------------#2021-02-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="2436" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">在本系列中，作者分享了他使用可用的开源工具构建实时ML管道的亲身经历，并记录了一路上的困难。</p></blockquote><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/4e43a65704520eb6dd2177d3c5f63a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FYjr4tDikAKAP66I"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">How much value can you generate by updating models with real-time streams? Photo by <a class="ae jw" href="https://unsplash.com/@ttrapani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Todd Trapani</a> on <a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fe20" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">在<a class="ae jw" href="https://huyenchip.com/2020/12/27/real-time-machine-learning.html" rel="noopener ugc nofollow" target="_blank">机器学习正在走向实时</a>中，作者Chip Huyen将实时机器学习系统分为两个级别:</p><ul class=""><li id="adf8" class="ka kb hh ik b il im ip iq jx kc jy kd jz ke jf kf kg kh ki bi translated">第一级:能够进行实时预测的人工智能系统(在线预测)</li><li id="48c9" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf kf kg kh ki bi translated">第二级:能够不断学习新数据并实时更新模型的ML系统(在线学习)</li></ul><p id="cb4f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">第一层中的系统能够做出相关/及时的预测，例如广告排名、跌倒检测、欺诈检测等。实时预测股票价值比一个月后更有价值，对吗？但是对于Level 1 ML系统来说，<a class="ae jw" href="https://huyenchip.com/2020/12/27/real-time-machine-learning.html#online_predictions_challenges" rel="noopener ugc nofollow" target="_blank">的技术挑战</a>大多是通过成熟的开源工具解决的，比如<a class="ae jw" href="https://flink.apache.org" rel="noopener ugc nofollow" target="_blank"> Apache Flink </a>(流处理)<a class="ae jw" href="https://kafka.apache.org" rel="noopener ugc nofollow" target="_blank"> Kafka </a>(事件驱动架构)<a class="ae jw" href="https://github.com/topics/model-compression" rel="noopener ugc nofollow" target="_blank">模型压缩</a><a class="ae jw" href="https://www.kubeflow.org" rel="noopener ugc nofollow" target="_blank">kube flow</a>(工作流管理)和<a class="ae jw" href="https://github.com/SeldonIO/seldon-core" rel="noopener ugc nofollow" target="_blank"> Seldon </a>(自动缩放模型服务)。<strong class="ik hi">所有这些</strong> <strong class="ik hi">工具都有清晰的开发路线图</strong>，不断提高模型推理速度，简化流水线开发。</p><p id="517f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">然而，更困难的部分是实现能够进行在线学习并实时用新数据更新模型的2级ML系统。在如何构建它们的问题上，MLOps社区几乎没有讨论和共识。事实上，CDFoundation的SIG MLOps将<a class="ae jw" href="https://github.com/cdfoundation/sig-mlops/blob/master/roadmap/2020/MLOpsRoadmap2020.md" rel="noopener ugc nofollow" target="_blank">在线学习列为“必需研究”</a>直到2024年。那么，用目前的开源工具建立一个实时的机器学习管道有多容易呢？</p><h1 id="69d6" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">1.在线学习的好处</h1><p id="aba3" class="pw-post-body-paragraph ih ii hh ik b il lm in io ip ln ir is jx lo iv iw jy lp iz ja jz lq jd je jf ha bi translated">等等，在我们进一步探讨之前，我们到底为什么要进行在线学习呢？近年来，流处理器的成熟允许DataOps)以可扩展的方式处理实时数据(2)统一批处理和流处理，从Lamba架构转移到更简单的<a class="ae jw" href="https://milinda.pathirage.org/kappa-architecture.com/" rel="noopener ugc nofollow" target="_blank"> Kappa架构</a>。它们为我们的管道提供了源源不断的实时数据，这让我们不禁要问:我们能从这些实时数据中获取更多价值吗？</p><p id="96d8" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">答案(你可能已经猜到了):是的，我们可以。在线学习更频繁地更新我们的ML模型，以处理社交媒体上的趋势内容、罕见事件(黑色星期五)甚至冷启动期间(新用户行为)等情况。当您需要提高模型性能以快速响应动态数据时，它会大放异彩。因此，值得一问:<strong class="ik hi">通过增加模型更新的频率</strong>，你能产生多少价值？</p><h1 id="0a3c" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">2.实时ML流水线的体系结构</h1><p id="cb22" class="pw-post-body-paragraph ih ii hh ik b il lm in io ip ln ir is jx lo iv iw jy lp iz ja jz lq jd je jf ha bi translated">好了，现在我们明白了好处，那么我们应该如何设计实时ML管道呢？网上有一些行业参考资料，不出所料，这些公司拥有大量实时用户交互数据。在查看它们之前，有必要回顾一下离线ML管道，因为将它们发展到在线仍然涉及相同的流程，只是它<strong class="ik hi">变成了一个长期运行的连续循环——</strong>摄取、培训和部署。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lr"><img src="../Images/7b93f30923124ee53fc072b206f57cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5ZWkyUra-TNe2fCiOKryw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">(from: <a class="ae jw" href="https://www.oreilly.com/library/view/building-machine-learning/9781492053187/ch01.html" rel="noopener ugc nofollow" target="_blank">https://www.oreilly.com/library/view/building-machine-learning/9781492053187/ch01.html</a>; Online ML Pipelines update model continuously, although may have some delay in deployment to validate models)</figcaption></figure><p id="c710" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">在<a class="ae jw" href="https://www.ververica.com/blog/flink-for-online-machine-learning-and-real-time-processing-at-weibo" rel="noopener ugc nofollow" target="_blank"> Flink Forward Virtual 2020 </a>期间，微博(社交媒体平台)分享了WML的设计，他们的实时ML架构和管道。本质上，他们已经通过Apache Flink将以前分离的离线和在线模型培训整合到一个统一的管道中。本次演讲的重点是Flink如何通过将离线数据(社交帖子、用户资料等)与多个实时交互事件流(点击流、阅读流等)和提取的多媒体内容特征相结合，来生成用于培训的样本数据。没有提到具体的模型架构，但他们正在进行在线培训DNN。</p><div class="jh ji jj jk fd ab cb"><figure class="ls jl lt lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/223e6e0e162438b230be1bf0738911d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*DxtrPc865-My2cApqaDFPw.png"/></div></figure><figure class="ls jl lt lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/6b7fbe47014222db96bfad4a8e9679e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*S7BXP17y7M_dX9FrmYoXGQ.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx ly di lz ma"><strong class="bd kq">(Left)</strong> Unified pipeline using Flink for both online &amp; offline | <strong class="bd kq">(Right) </strong>Online Model Training (from: <a class="ae jw" href="https://www.ververica.com/blog/flink-for-online-machine-learning-and-real-time-processing-at-weibo" rel="noopener ugc nofollow" target="_blank">https://www.ververica.com/blog/flink-for-online-machine-learning-and-real-time-processing-at-weibo</a>)</figcaption></figure></div><p id="134e" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">与此同时，PAI(人工智能平台)是阿里云(云供应商)的产品，允许用户通过拖放视觉UI建立在线机器学习管道。2019年初，他们<a class="ae jw" href="https://developer.aliyun.com/article/741004" rel="noopener ugc nofollow" target="_blank">在平台上发布了FTRL(跟随正规化的领导者)在线学习模块</a>，以支持推荐器用例，如新闻推荐。那年晚些时候，在阿里巴巴的(电子商务)<a class="ae jw" href="https://web.archive.org/web/20200815083452/https://developer.aliyun.com/article/688613" rel="noopener ugc nofollow" target="_blank">工程博客</a>上，他们分享了如何利用在线训练来预测光棍节期间的点击率(CTR)和转化率(CVR)。</p><p id="d81e" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">由于影响CTR/CVR的因素很多，如促销、季节等，模型采用了“多层多频”的方式。它是从XNN演化而来的，模型的一部分使用冻结嵌入的检查点，而另一部分使用改变嵌入/改变权重。管道执行在线训练和实时模型更新(A/B测试)。他们使用AUC进行在线评估，将模型准确性与10分钟前的样本进行比较。(阿里巴巴还开源了在线FTRL，作为Alink的一部分，这将在下一节中提到。)</p><div class="jh ji jj jk fd ab cb"><figure class="ls jl mb lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/d2de1405c51f110ba9b3679c45491776.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/1*8knC3fZuBJzlx82jgBIRZQ.gif"/></div></figure><figure class="ls jl mc lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/84a49a0638094db234fbba81d20fb34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*p537uMIgDAcFg8bg8Nllaw.jpeg"/></div><figcaption class="js jt et er es ju jv bd b be z dx md di me ma"><strong class="bd kq">(Left)</strong> PAI drag-and-drop visual builder for FTRL module (from: <a class="ae jw" href="https://web.archive.org/web/20200815083452/https:/developer.aliyun.com/article/688613" rel="noopener ugc nofollow" target="_blank">https://web.archive.org/web/20200815083452/https://developer.aliyun.com/article/688613</a>) <strong class="bd kq">(Right)</strong> Model architecture for predicting Click Through Rate and Conversion Rate, with part of the model updated in real-time (from: <a class="ae jw" href="https://developer.aliyun.com/article/741004" rel="noopener ugc nofollow" target="_blank">https://developer.aliyun.com/article/741004</a>)</figcaption></figure></div><p id="fa8d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">几乎同一时间，爱奇艺(视频流媒体)<a class="ae jw" href="https://www.infoq.cn/article/lthcdazelzgc639p1p5q" rel="noopener ugc nofollow" target="_blank">分享了他们在线培训广&amp;深度DNN流媒体推荐系统</a>的经验。他们使用了一种“lambda”方法:对过去7天的数据进行离线训练模型，并使用该检查点作为日常在线模型实时摄取的开始。在线培训只有一遍，然后每小时部署一次模型。使用这种体系结构的原因是，当在线模型过度适应本地模式并观察到很有可能出现OOV(超出词汇表)的性能下降时，要对其进行校正。下一步，他们正在探索替换Adam优化器和部署频率。</p><div class="jh ji jj jk fd ab cb"><figure class="ls jl mf lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/bc3048a7d73ba64bcfeb43d7f8e7af06.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*s1JLg5gyMbqeYbbBXIGBVQ.png"/></div></figure><figure class="ls jl mg lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/8bae12509e1e5a26159b6d99e3002ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*_nQJE09C8jUygj-ryKJMAQ.png"/></div></figure><figure class="ls jl mh lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/c8c0d0e5323abccb7555dec2b37fb1dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*uXtU5_voMuFe4WV-TNkF6w.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx mi di mj ma">(Left) Online &amp; Offline ML Pipeline Design (Middle) Model Architecture for Streaming Recommender System (Right) AUC performance improvement (yellow and orange are online trained-models) (from: <a class="ae jw" href="https://www.infoq.cn/article/lthcdazelzgc639p1p5q" rel="noopener ugc nofollow" target="_blank">https://www.infoq.cn/article/lthcdazelzgc639p1p5q</a>)</figcaption></figure></div><p id="beea" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">从上面的例子来看，有几个趋势很明显:</p><ol class=""><li id="4259" class="ka kb hh ik b il im ip iq jx kc jy kd jz ke jf mk kg kh ki bi translated">公司正在统一线下和线上培训的MLOps渠道</li><li id="3261" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf mk kg kh ki bi translated">他们也正与DNN一起走向在线培训的更深层次模式</li><li id="5451" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf mk kg kh ki bi translated">并试验用<strong class="ik hi">更频繁的模型部署</strong> ( &lt; 10分钟，甚至实时！)</li></ol><h1 id="096d" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">3.工具和库</h1><p id="fcc9" class="pw-post-body-paragraph ih ii hh ik b il lm in io ip ln ir is jx lo iv iw jy lp iz ja jz lq jd je jf ha bi translated">有几组开源库用于在ML管道中实现在线培训。一些构建在Flink之上，而一些使用Spark流。大多数都需要Java在流处理器上运行，但有些提供API，甚至在Python上原生运行(对来自Python深度学习生态系统的开发者更友好！).</p><ul class=""><li id="b6af" class="ka kb hh ik b il im ip iq jx kc jy kd jz ke jf kf kg kh ki bi translated"><a class="ae jw" href="https://github.com/online-ml/river" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi">河流</strong> </a> <strong class="ik hi"> — </strong>完全为在线训练而设计:它可以通过单次观察更新模型，包含用于构建预处理管道和流数据评估指标的实用程序。唯一拥有最多在线学习算法的库，包括Tree/FM/Linear/Naive Bayes/KNN分类器&amp;回归器、K-means聚类和半空间树异常检测。它的SKLearn风格的API对很多人来说是非常熟悉的，如果你喜欢Python，这是最好的选择！</li><li id="8c31" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf kf kg kh ki bi translated"><strong class="ik hi"> FlinkML — </strong>提供了<a class="ae jw" href="https://ci.apache.org/projects/flink/flink-docs-release-1.2/dev/libs/ml/index.html" rel="noopener ugc nofollow" target="_blank">几个ML算法</a>，但是在Flink 1.9中放弃了较老的库。目前正在重新开发中，利用Flink Table API提供<a class="ae jw" href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-39+Flink+ML+pipeline+and+ML+libs" rel="noopener ugc nofollow" target="_blank">管道接口</a>和<a class="ae jw" href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-23+-+Model+Serving" rel="noopener ugc nofollow" target="_blank">模型服务</a>。进度可以在这里<a class="ae jw" href="https://github.com/apache/flink/tree/master/flink-ml-parent" rel="noopener ugc nofollow" target="_blank">获得</a>(在撰写本文时只有几个界面)。</li><li id="a1b3" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf kf kg kh ki bi translated"><a class="ae jw" href="https://github.com/alibaba/Alink" rel="noopener ugc nofollow" target="_blank"><strong class="ik hi">Alink</strong></a><strong class="ik hi">——</strong>阿里巴巴发布的基于ML算法的操作符集合，构建在FlinkML新管道接口之上。它同时拥有Python和Java API。但是，FTRL是唯一的在线训练算法，其他的都是批处理算法。如果你喜欢Flink生态系统，这是最好的选择。</li><li id="500a" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf kf kg kh ki bi translated"><a class="ae jw" href="https://spark.apache.org/docs/latest/streaming-programming-guide.html#mllib-operations" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> Spark Mllib的流式算法</strong></a><strong class="ik hi">——</strong>类似于提供了几种流式ML算法的FlinkML，但是在Spark流式生态系统上。它同时拥有Python和Scala API来构建管道和导出PMML模型。从Spark 2.0开始也在重新开发，以利用DataFrame API。旧的库包含在线Kmeans聚类和线性回归。</li><li id="7020" class="ka kb hh ik b il kj ip kk jx kl jy km jz kn jf kf kg kh ki bi translated"><a class="ae jw" href="https://github.com/OryxProject/oryx" rel="noopener ugc nofollow" target="_blank"><strong class="ik hi">Oryx</strong></a><strong class="ik hi">——</strong>一个lambda架构开发平台，使用Kafka和Spark。它提供批处理、速度和服务层来管理模型训练和更新(PMML)。目前包含ALS推荐、K-means聚类和随机森林分类/回归流算法。可惜2019年以来没有大的发展。</li></ul><p id="d4d2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">总的来说，所有的库仍在开发中，大多数优先考虑批量/离线训练算法。River是唯一一个优先考虑使用最多算法的在线培训的库，而其他从离线培训开始的库可能更适合在生产中部署。</p><h1 id="f155" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">4.未来的挑战</h1><p id="415e" class="pw-post-body-paragraph ih ii hh ik b il lm in io ip ln ir is jx lo iv iw jy lp iz ja jz lq jd je jf ha bi translated">本文探讨了用于构建实时机器学习管道的通用架构和开源工具的当前状态，重点关注实现和工程视角。在后续系列中，我将构建实时ML管道，并不断探索改进它们的思路，如比较检查点+在线训练和100%在线训练、实时模型部署等。</p><p id="6e7a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated">接下来:第2部分(即将推出)</p><p id="39bd" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jx iu iv iw jy iy iz ja jz jc jd je jf ha bi translated"><em class="ij">如果您喜欢此内容，请点击</em>👏<em class="ij">所以会有更多人看到这一点。</em></p></div></div>    
</body>
</html>