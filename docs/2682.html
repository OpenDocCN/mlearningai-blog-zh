<html>
<head>
<title>Fast machine learning model deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速机器学习模型部署</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/fast-machine-learning-model-deployment-465973dff40a?source=collection_archive---------9-----------------------#2022-05-29">https://medium.com/mlearning-ai/fast-machine-learning-model-deployment-465973dff40a?source=collection_archive---------9-----------------------#2022-05-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/213e801fadeb4cb73c4bc4284bd725a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2jRmsBVPeMJzCig2sPrJA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image by KEHN HERMANO: <a class="ae it" href="https://www.pexels.com/th-th/photo/3881034/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/th-th/photo/3881034/</a></figcaption></figure><h1 id="f8da" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">❓为什么模型部署很重要？</h1><p id="9a8a" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi kq translated">在完成机器学习模型训练后，是时候说明模型如何工作了。您可以将您的代码或模型pickle文件发送给其他人运行，但这可能不太方便，尤其是对于您不熟悉编码的客户。等待软件开发人员创建网站/应用程序并连接到模型API可能会花费大量时间和精力。</p><p id="a9d1" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">展示您的机器学习模型的最快方法之一是创建一个简单的网站来自行部署您的模型。听起来很麻烦，但是试着读一下这篇文章，你会发现使用<a class="ae it" href="https://docs.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hi"> Streamlit </strong> </a>并没有那么难。</p><h1 id="3637" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">🌎结果</h1><p id="be2f" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">写完这篇文章后，这就是我希望你能做的。</p><p id="5090" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">一个<strong class="ju hi">交互式网站</strong>，用户可以在其中输入值，模型的结果将同时显示相应的输入值。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/fef73e6a15ed87bc457517922d45e5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGux-tk1nFKzWBtIJ3gmFA.png"/></div></div></figure><h1 id="90f7" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">💽数据集和模型</h1><p id="4ed9" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">在本文中，我使用下一篇文章中的数据集来训练模型。</p><div class="lj lk ez fb ll lm"><a href="https://yannawut.medium.com/data-analysis-job-change-of-data-scientist-685f3de0a983" rel="noopener follow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">数据分析——数据科学家的工作变化</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">哪些因素导致一个人离开现在的工作？让我们用Power BI来探索数据。</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">yannawut.medium.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma in lm"/></div></div></a></div><p id="f63b" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">我创建了一个数据管道来训练模型。然后，我将管道保存为joblib文件，如下面链接的第8步所述。</p><div class="lj lk ez fb ll lm"><a rel="noopener follow" target="_blank" href="/mlearning-ai/neat-data-preprocessing-with-pipeline-and-columntransformer-2a0468865b6b"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">使用管道和ColumnTransformer进行整洁的数据预处理</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">创建一个管道，您可以在其中输入任何数据，这些数据将在训练机器学习之前进行转换…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">medium.com</p></div></div><div class="lv l"><div class="mb l lx ly lz lv ma in lm"/></div></div></a></div><p id="31ef" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">不看上面的文章也能看懂这篇文章。当您向模型输入数据时，只要知道这是一项分类任务，就会返回此人转到数据科学工作的概率。</p><h1 id="c60f" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">📤部署</h1><p id="ce69" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">我将使用Streamlit部署模型。</p><h1 id="70c6" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">1.安装细流</h1><p id="5985" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">如果使用Anaconda，打开Anaconda提示符(可以使用窗口搜索)。然后，键入下面一行。</p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="7e20" class="mh iv hh md b fi mi mj l mk ml">pip install streamlit</span></pre><p id="d3b3" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">测试安装是否有效</p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="9900" class="mh iv hh md b fi mi mj l mk ml">streamlit hello</span></pre><p id="826e" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">你可以访问这个网站了解更多细节</p><h1 id="a397" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">2.创建新的Python文件(。py)</h1><p id="6bc6" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">我在与模型joblib文件相同的文件夹中创建了一个web.py文件(如果您愿意，也可以创建一个pickle文件)。</p><p id="be98" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">这是web.py中的全部代码。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/39684f0762ebf43bb303556be06493e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ousGtCV50a33jz05mCS_g.png"/></div></div></figure><p id="b695" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">让我们一步一步地检查代码</p><p id="f135" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi"> 1。导入库</strong></p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="92cb" class="mh iv hh md b fi mi mj l mk ml">import streamlit as st<br/>import pandas as pd<br/>import joblib</span></pre><p id="f4e9" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi"> 2。加载训练好的模型管道</strong></p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="8d96" class="mh iv hh md b fi mi mj l mk ml">clf_pipeline = joblib.load("pipe.joblib")</span></pre><p id="db63" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">使用joblib.load加载已保存的joblib文件，并将其另存为clf_pipeline。</p><p id="83c9" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">如果您的joblib或pickle文件位于另一个文件夹中，请指定该文件的位置。</p><p id="9795" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi"> 3。蒸汽点燃部分</strong></p><p id="e96e" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">streamlit的优势在于，你可以在没有任何UX/UI知识的情况下创建一个漂亮(足够)的网站，因为它就像一个块模板。</p><p id="81ff" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">在这段代码中，我只使用了4个streamlit命令</p><ul class=""><li id="f023" class="mn mo hh ju b jv kz jz la kd mp kh mq kl mr kp ms mt mu mv bi translated">streamlit.write:在屏幕上打印文本</li><li id="98fe" class="mn mo hh ju b jv mw jz mx kd my kh mz kl na kp ms mt mu mv bi translated">streamlit.sidebar.header:侧栏的标题</li><li id="df89" class="mn mo hh ju b jv mw jz mx kd my kh mz kl na kp ms mt mu mv bi translated">streamlit.sidebar.slider:数字特性的滑块。输入最小值、最大值、值和步长。</li><li id="a277" class="mn mo hh ju b jv mw jz mx kd my kh mz kl na kp ms mt mu mv bi translated">streamlit . sidebar . select _ Slider:分类要素的滑块。输入选项列表。</li></ul><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="c45e" class="mh iv hh md b fi mi mj l mk ml">st.write("Change job prediction")</span><span id="02fa" class="mh iv hh md b fi nb mj l mk ml"># Sidebar - Collects user input features to perform prediction<br/>with st.sidebar.header('Input your data'):<br/>    city_development_index = st.sidebar.slider('city_development_index', 0.0, 1.0, 0.0, 0.01)<br/>    relevent_experience = st.sidebar.select_slider('relevent_experience', options=[0, 1])<br/>    experience = st.sidebar.slider('experience', min_value=0, max_value=21, step=1)  <br/>    last_new_job = st.sidebar.slider('last_new_job', min_value=0, max_value=5, step=1)<br/>    training_hours = st.sidebar.slider('training_hours', min_value=0, max_value=300, step=1)<br/>    gender = st.sidebar.select_slider('gender', options=['Male', 'Female', 'Other'])<br/>    enrolled_university = st.sidebar.select_slider('enrolled_university', options=['no_enrollment', 'Full time course', 'Part time course'])<br/>    education_level = st.sidebar.select_slider('education_level', options=['Graduate', 'Masters', 'High School', 'Phd', 'Primary School'])<br/>    major_discipline = st.sidebar.select_slider('major_discipline', options=['STEM', 'Business Degree', 'Arts', 'Humanities', 'No Major', 'Other'])<br/>    company_size = st.sidebar.select_slider('company_size', options=['50-99', '&lt;10', '10000+', '5000-9999', '1000-4999', '10/49', '100-500', '500-999'])<br/>    company_type = st.sidebar.select_slider('company_type', options=['Pvt Ltd', 'Funded Startup', 'Early Stage Startup', 'Other', 'Public Sector'])</span></pre><p id="59d9" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi">注意:</strong>这是简化的代码，便于理解Streamlit。可以进行许多调整来增强用户体验。</p><p id="2137" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">这段代码的结果将是这样的。(阅读步骤3中的“如何跑步”)</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nc"><img src="../Images/5a73a7e7af1ee64aef17c0f746c3f735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5BtOSXCdOFcbjB8edFIMw.png"/></div></div></figure><p id="7d59" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">用户可以通过改变侧边栏上的滑块向模型输入值。然后，输入的值将保存在变量中，以输入到模型中。</p><p id="5b3b" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi"> 4。预测</strong></p><p id="2822" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">我的管道的输入数据的格式是dataframe，因此用户输入在输入到模型之前将被转换为dataframe。</p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="c63a" class="mh iv hh md b fi mi mj l mk ml">num_cols = ['city_development_index','relevent_experience', 'experience','last_new_job', 'training_hours']<br/>cat_cols = ['gender', 'enrolled_university', 'education_level', 'major_discipline', 'company_size', 'company_type']</span><span id="02cb" class="mh iv hh md b fi nb mj l mk ml">prediction_proba = clf_pipeline.predict_proba(pd.DataFrame\<br/>                   (data=[[city_development_index,\     <br/>                           relevent_experience, experience,\<br/>                           last_new_job, training_hours,\<br/>                           gender, enrolled_university,\     <br/>                           education_level, major_discipline,\   <br/>                           company_size, company_type]]\                                                    <br/>                    ,columns=num_cols+cat_cols))</span></pre><p id="3f74" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">clf_pipeline.predict_proba用于预测此人转到数据科学工作的概率。</p><p id="cf34" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated"><strong class="ju hi"> 5。打印预测结果</strong></p><p id="9a60" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">打印从步骤4获得的概率</p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="c824" class="mh iv hh md b fi mi mj l mk ml">st.write(f"Probability of this person changing to a data science job is {round(prediction_proba[0,1]*100,2)}%")</span></pre><h1 id="cfc1" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">3.运行细流</h1><p id="42e3" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">表演时间到了！！</p><p id="8235" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">打开Anaconda提示符，键入每个命令，然后按Enter键。</p><p id="eada" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">CD<strong class="ju hi"><em class="nd">your _ folder _ location</em></strong></p><p id="524a" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">streamlit <strong class="ju hi"> <em class="nd">运行您的_文件名</em> </strong></p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="0bb1" class="mh iv hh md b fi mi mj l mk ml">cd C:\Project\Job_Change_of_Data Scientists<br/>streamlit run web.py</span></pre><p id="eb51" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">你会看到2个网站网址:<br/>本地网址只能从你的电脑打开。<br/>其他设备可以访问网络URL。</p><pre class="lf lg lh li fd mc md me mf aw mg bi"><span id="56b9" class="mh iv hh md b fi mi mj l mk ml">Local URL: <a class="ae it" href="http://localhost:8501" rel="noopener ugc nofollow" target="_blank">http://localhost:8501</a><br/>Network URL: <a class="ae it" href="http://192.168.1.104:8501" rel="noopener ugc nofollow" target="_blank">http://192.168.1.104:8501</a></span></pre><p id="65b8" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">浏览器将自动打开您的Streamlit网站。如果没有，可以自己输入网址。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ne"><img src="../Images/047e381c3f8a64b31e1c91c769f914e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TImcaxqUX-dFcKwwgmmL-A.png"/></div></div></figure><p id="b55d" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">改变侧边栏上的值时，概率也会改变。</p><p id="53ca" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">搞定了。！！</p><p id="1357" class="pw-post-body-paragraph js jt hh ju b jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl ld kn ko kp ha bi translated">注意:如果您的型号需要长时间运行，它会在右上角显示一个运行图标。你必须等到程序运行完毕才能看到结果。</p><h1 id="2759" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">结论</h1><p id="de57" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">为了快速显示机器学习模型结果，您可以使用Streamlit创建一个演示网站，用户可以在其中输入值并观察模型的预测。</p><div class="lj lk ez fb ll lm"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">medium.com</p></div></div><div class="lv l"><div class="nf l lx ly lz lv ma in lm"/></div></div></a></div></div></div>    
</body>
</html>