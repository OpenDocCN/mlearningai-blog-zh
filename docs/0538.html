<html>
<head>
<title>Anomaly Detection with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于机器学习的异常检测</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/anomaly-detection-with-machine-learning-8fa942fb5adc?source=collection_archive---------0-----------------------#2021-05-12">https://medium.com/mlearning-ai/anomaly-detection-with-machine-learning-8fa942fb5adc?source=collection_archive---------0-----------------------#2021-05-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2ad8bde3e7ef989572a5f7a2101f0480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0TOtKD7Yb848eUyb9Dcgg.jpeg"/></div></div></figure><h1 id="4e03" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="7b7d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">一般来说，每个数据科学家或机器学习工程师都不止一次地做过异常检测分析。很多时候，我们需要在数据集中找到异常和不寻常的值或数据点。别担心，这本指南会告诉你如何开始——我们到底在说什么？</p><h1 id="85b3" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">什么是异常检测？</h1><p id="bbc9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">异常检测是一种数据预处理技术，可以发现数据集的异常值，即那些不属于数据集的数据点。识别这些数据点可以达到多种目的，例如</p><ol class=""><li id="8c8b" class="kl km hh jp b jq kn ju ko jy kp kc kq kg kr kk ks kt ku kv bi translated">在拟合机器学习模型之前移除训练集中的异常值。</li><li id="6ff9" class="kl km hh jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">分析一组观察结果，以确定流程是否有问题。例如，是否有任何异常服务器日志<em class="lb">可能</em>指示安全漏洞，指向异常网络流量。</li></ol><p id="6aa7" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">判断事物是否异常的应用分为两类，<strong class="jp hi">异常值</strong>或<strong class="jp hi">新奇检测</strong>。这两个术语经常被混为一谈，但确实有不同的定义。</p><p id="7bd0" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">异常值检测:</strong>识别显著偏离其余观测值的过程。用包含离群值的数据集来训练离群值检测模型；它并不“干净”。该模型学习一个点可以偏离多少来被分类为异常值。</p><p id="6a9c" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">新颖度检测:</strong>通过用未被离群值“污染”的数据集训练模型来识别新颖点的过程。该模型学习包含所有正常/常规点的一个或多个边界。任何位于这些边界之外的点都是新的，因此是新颖的。</p><p id="170e" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">区别是微妙的，但某些算法被称为异常值或新奇检测。然而，在实践中，无论应用程序是纯粹的新奇还是离群点检测，这两个类都可以很好地工作。说了这么多，让我们开始吧——准备好了吗？</p><h1 id="255a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">scikit中的实现-学习</h1><p id="009a" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在scikit-learn中，异常检测算法是无监督的学习器。我们将在“scikit-learn”中讨论两种异常检测模型，<strong class="jp hi"> <em class="lb">一类</em></strong><strong class="jp hi"><em class="lb">SVM</em></strong>和<strong class="jp hi"> <em class="lb">隔离林</em> </strong>。两者都是无监督学习模型，具有相似的界面；两种主要方法是:</p><p id="7660" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">拟合(X): </strong>用数据集‘X’拟合/训练模型。<br/> <strong class="jp hi"> predict(X) </strong>:确定‘X’中的观察值是内联值‘1’还是界外值‘1’。<br/><strong class="jp hi">decision _ function(X)</strong>:用于确定一个点是否为内/界外点的得分/度量。对“决策函数”方法的输出的解释是特定于算法的。</p><h1 id="4c97" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">单类支持向量机</h1><p id="6a48" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">一类分类方法用于检测数据集中的异常值和异常值。基于支持向量机(SVM)评估，一级SVM应用一级分类方法进行<strong class="jp hi">新颖性检测</strong>。这是我对模型的简单理解。点击了解更多关于<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.OneClassSVM.html" rel="noopener ugc nofollow" target="_blank">一级SVM的详情。</a></p><p id="e324" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">根据我的知识，让我们使用单级SVM来看看它是如何工作的。</p><p id="4c75" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">我们将使用scikit-learn提供的<strong class="jp hi">葡萄酒数据集</strong>。数据集的细节并不重要，只是它有178个观察值和13个数字特征。</p><p id="acd7" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">让我们采取以下步骤:</p><h1 id="e7bb" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">1.导入模块和数据集</h1><p id="f87c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">导入numpy，pandas，matplotlib，modules。让我们导入<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank"> StandardScaler </a>来缩放我们的数据，导入<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html" rel="noopener ugc nofollow" target="_blank"> PCA </a>来对葡萄酒数据进行降维，导入<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"> Pipeline </a>来组装几个步骤，这些步骤可以在设置不同参数的同时进行交叉验证。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lg"><img src="../Images/07e0751db6930d1a0961c9a7daf4b640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*Rvd1sFodYDrA9YF_rCvizA.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx">(Image Source: Author)</figcaption></figure><p id="bbf9" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">我们不需要知道葡萄酒数据的细节。</p><p id="ec76" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">让我们把我们的分析形象化</p><h1 id="78c0" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">2.形象化</h1><p id="f26a" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">加载数据，<strong class="jp hi"> X </strong>。缩放数据，通过设置PCA<strong class="jp hi"><em class="lb">n _ components</em></strong>= 2来使用两个变量。将整个流程封装在一个管道中。生成一些随机点<strong class="jp hi"> X_test </strong>，以代表异常值。在相同的轴上绘制葡萄酒数据X的散点图和X_test的散点图。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/da260707576a3777a4956d99a2d2e382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWCqd5Gq0IoLSdiYSxbtXQ.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx">(Image Source: Author)</figcaption></figure><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/86c80d3ad9ecb7ea410da657629b8afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33FZqnb5Yxk94vfhMlrPag.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx">(Image Source: Author)</figcaption></figure><p id="538d" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">所以蓝点代表我们的训练点。红色的代表异常值。我们注入了这些新的异常值，因此它们倾向于存在于我们的蓝点空间的外围(外部边界)。</p><p id="a676" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">现在，让我们训练一个单类SVM模型来学习一些决策边界，学习内联者位于何处，边界之外的一切都是离群值——红苹果！</p><p id="be3b" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">下面的可视化图绘制了数据以及确定某个点是否被视为新颖的边界。图中的填充轮廓线表示一类SVM的决策函数值。<strong class="jp hi"><em class="lb">decision _ function</em></strong>方法报告点和超平面之间的有符号距离(负表示在错误的一侧)。可视化允许你修改<strong class="jp hi"> <em class="lb"> v </em> </strong>，假阳性率的上限。你也可以把<strong class="jp hi"> <em class="lb"> v </em> </strong>看作是在定义正则点的区域之外有一个新的但是正则的观测的概率。随着<strong class="jp hi"> <em class="lb"> v </em> </strong>的减小，包含规则点的区域增大。与标准的内核化SVM一样，您可以更改内核函数，但是<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.kernels.RBF.html" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi"><em class="lb">RBF</em></strong></a>通常效果最好。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/267789fabb904d836a91003b9bed87a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hl9MYbAc7X2Ts3y9noByNA.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx">(Image Source: Author)</figcaption></figure><h1 id="542f" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">隔离森林</h1><p id="ca3a" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">隔离林是一种使用决策树的异常值检测算法。隔离林的工作原理是，离群点是具有与其他数据(内联者)显著不同的特征的点。</p><p id="afe3" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">隔离林通过随机选择一个要素，然后随机选择所选要素的最大值和最小值之间的拆分值来“隔离”观察值。详情请点击<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi">此处隔离林</strong> </a> <strong class="jp hi">。</strong></p><h2 id="0d95" class="ls iq hh bd ir lt lu lv iv lw lx ly iz jy lz ma jd kc mb mc jh kg md me jl mf bi translated">形象化</h2><p id="1510" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">让我们想象一下在葡萄酒数据集上使用隔离森林的结果。</p><p id="014b" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">导入模型</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es mg"><img src="../Images/553ed39221b48b156b9463409e086818.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*okn1iKPUpzGgLvl549FwrA.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx">(Image Source: Author)</figcaption></figure><p id="54b2" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">让我们使用训练数据X，异常值X_test。绘制散点图和等高线图。让我们设置<strong class="jp hi"> <em class="lb"> n_estimator </em> </strong>参数，集合中基本估计量的数量，以及<strong class="jp hi"> <em class="lb">污染</em> </strong>参数，数据集的污染量，即数据集中异常值的比例。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/4614d61f13db4f79ebb72712b9dfcc9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9vsMU4qv6nTTjsrLbyF8SA.png"/></div></div></figure><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/3cb983df117339bb06b53f3366aa4975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xICVj_ltA9hFzA0PkilRKg.png"/></div></div></figure><p id="242c" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">等高线图向我们揭示了价值决定函数，因此负值将是异常值。</p><p id="8422" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">黑线代表边界。里面的所有东西都将被归类为内层，外面的所有东西都将被归类为外层。</p><p id="6444" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">我们将<strong class="jp hi"> <em class="lb">污染</em> </strong>参数或数据集中异常值的比例设置为10%或0.1的分数。当我们用这个污染分数训练模型时，我们的训练集的10%将被标记为异常值。</p><p id="3994" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">如果我们将污染分数(滑块)增加到0.28(我们训练数据的28%)，我们会注意到边界(黑线)后退，这是意料之中的，因为我们说我们的训练数据中有很大一部分异常值，因此边界应该缩小，这样它就不会覆盖太多的训练观察值。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/85628ca2ee4a35c30de3d4048e78f05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dm1a2jZi7keHeJflJeultg.png"/></div></div></figure><h1 id="1353" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">问题</h1><ol class=""><li id="c945" class="kl km hh jp b jq jr ju jv jy mk kc ml kg mm kk ks kt ku kv bi translated">隔离森林和一类SVM哪个算法的训练时间复杂度更好？什么影响了你的决定？</li><li id="2df7" class="kl km hh jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">决策树在隔离林算法中还有哪些优势？</li></ol><h1 id="8933" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">一级SVM与隔离林的比较</h1><p id="423f" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">以下是一级SVM和隔离森林之间需要注意的一些事项。</p><ol class=""><li id="87c7" class="kl km hh jp b jq kn ju ko jy kp kc kq kg kr kk ks kt ku kv bi translated">这两种算法都能够正确地建模多模态数据集。</li><li id="8683" class="kl km hh jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">当训练数据没有被离群值污染时，一类SVM对离群值敏感，使得它更适合于新颖性检测。</li><li id="cd0e" class="kl km hh jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">由于决策树的分裂是随机选择的，所以隔离林的训练速度更快。</li><li id="21f2" class="kl km hh jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">总的来说，SVM的训练速度很慢，尤其是在训练规模方面。</li></ol><p id="30b0" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated">此外，这两种方法继承了其父算法的优缺点。scikit-learn中还有其他异常值和新颖性检测算法，此处列出了其他方法的比较和概述。</p><h1 id="a133" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">完整代码:GitHub</h1><figure class="lh li lj lk fd ii"><div class="bz dy l di"><div class="mn mo l"/></div></figure><h1 id="d8ea" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">异常检测的应用</h1><p id="dcd9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><strong class="jp hi">入侵检测:</strong>监控网络或系统的恶意活动或违反政策的行为</p><p id="934a" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">欺诈检测:</strong>通过收集大量金融数据，结合预测分析或取证分析，使用电子数据重建或检测金融欺诈，来检测大规模欺诈活动。</p><h1 id="fada" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">结论</strong></h1><p id="1e6b" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我们已经注意到，我们还没有经历所有的步骤，这两种异常检测方法背后的数学。有益的是，我在下面添加了一些教程，详细解释了这两种方法</p></div><div class="ab cl mp mq go mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ha hb hc hd he"><h2 id="6e3a" class="ls iq hh bd ir lt lu lv iv lw lx ly iz jy lz ma jd kc mb mc jh kg md me jl mf bi translated">资源:</h2><p id="a0b0" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><strong class="jp hi">【1】</strong><a class="ae lf" href="https://www.youtube.com/watch?v=0dngOGhv5Mc" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi">一班SVM </strong> </a></p><p id="f4be" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">【2】</strong><a class="ae lf" href="https://www.youtube.com/watch?v=rNGtj2iEw6g" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi">一类SVM | 6个内核，随机森林|模式识别</strong> </a></p><p id="6ff8" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">【3】</strong><a class="ae lf" href="https://www.youtube.com/watch?v=TP3wdwD8JVY" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi">异常检测用隔离林</strong> </a></p><p id="a997" class="pw-post-body-paragraph jn jo hh jp b jq kn js jt ju ko jw jx jy lc ka kb kc ld ke kf kg le ki kj kk ha bi translated"><strong class="jp hi">【4】</strong><a class="ae lf" href="https://www.youtube.com/watch?v=OnpFWVN601Q" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi">隔离林——异常检测</strong> </a></p></div></div>    
</body>
</html>