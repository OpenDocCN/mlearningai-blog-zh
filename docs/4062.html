<html>
<head>
<title>Use TorchServe and Flask to Deploy your Model as a Web App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨TorchServeå’ŒFlaskå°†æ‚¨çš„æ¨¡å‹éƒ¨ç½²ä¸ºWebåº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/mlearning-ai/use-torchserve-and-flask-to-deploy-your-model-as-a-web-app-6d612eccdcd7?source=collection_archive---------1-----------------------#2022-12-03">https://medium.com/mlearning-ai/use-torchserve-and-flask-to-deploy-your-model-as-a-web-app-6d612eccdcd7?source=collection_archive---------1-----------------------#2022-12-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="4662" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">ä¸ºæ‚¨çš„PyTorchæ¨¡å‹å¼€å‘ä¸€ä¸ªç®€å•çš„Webåº”ç”¨ç¨‹åº</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/61ee892f5ff8d3e5104419f28fa6658a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9UpiM9L-24HPZb1v"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@sushioutlaw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brian McGowan</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ad91" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">ä»‹ç»</h2><p id="5cf1" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">è¿™æ˜¯å›´ç»•ç”¨TorchServeæœåŠ¡æ‚¨çš„PyTorchæ¨¡å‹çš„ç³»åˆ—æ–‡ç« çš„ç¬¬å››ç¯‡ã€‚åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨TorchServeæœåŠ¡æ¨¡å‹çš„ä¸€èˆ¬å·¥ä½œæµç¨‹ã€‚</p><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/mlearning-ai/understanding-the-workflow-of-torchserve-using-densenet-c4d93458c19"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">ğŸ”¥ä½¿ç”¨Densenetäº†è§£TorchServeçš„å·¥ä½œæµç¨‹</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">éƒ¨ç½²PyTorchæ¨¡å‹çš„TorchServeç¬¬ä¸€éƒ¨åˆ†</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jg lh"/></div></div></a></div><p id="5297" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç ”ç©¶äº†TorchServeæä¾›çš„BaseHandlerç±»ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»æ¥æä¾›å…³äºé¢„å¤„ç†ã€æ¨ç†å’Œåå¤„ç†çš„æ‰€æœ‰ä¿¡æ¯:</p><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/@pumalinML/understanding-torchserves-basehandler-4d139d12b5f9"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">ğŸ”¥äº†è§£TorchServeçš„BaseHandler</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">éƒ¨ç½²PyTorchæ¨¡å‹çš„Torchserveç¬¬äºŒéƒ¨åˆ†</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="mb l ls lt lu lq lv jg lh"/></div></div></a></div><p id="526e" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">ç„¶åæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å®šåˆ¶<a class="ae jm" href="https://pytorch.org/serve/custom_service.html" rel="noopener ugc nofollow" target="_blank"> BaseHandler </a>ç±»ï¼Œå¹¶ä½¿ç”¨<a class="ae jm" href="http://yann.lecun.com/exdb/mnist/" rel="noopener ugc nofollow" target="_blank"> MNISTæ•°æ®é›†</a>å’Œä¸€ä¸ªç®€å•çš„CNNåº”ç”¨å‰é¢è®¨è®ºçš„æ¦‚å¿µæ¥é¢„æµ‹æ•°å­—:</p><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/mlearning-ai/use-torchserve-with-a-customized-handler-script-f7d329e78ba4"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">ğŸ”¥ä½¿ç”¨å¸¦æœ‰è‡ªå®šä¹‰å¤„ç†ç¨‹åºè„šæœ¬çš„TorchServe</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">éƒ¨ç½²PyTorchæ¨¡å‹çš„Torchserveç¬¬ä¸‰éƒ¨åˆ†</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="mc l ls lt lu lq lv jg lh"/></div></div></a></div><p id="c6f6" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ç”¨Pythonå¼€å‘ä¸€ä¸ªåº”ç”¨äº†æˆ‘ä»¬çš„æ¨¡å‹çš„webåº”ç”¨ç¨‹åºã€‚æœ‰ä¸åŒçš„å¯èƒ½æ€§å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae jm" href="https://flask.palletsprojects.com/en/2.2.x/" rel="noopener ugc nofollow" target="_blank">çƒ§ç“¶</a>ã€‚æˆ‘ä»¬å°†ç”¨<a class="ae jm" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>å°†å·¥ä½œæµå®¹å™¨åŒ–ã€‚ä½ å¯ä»¥åœ¨<a class="ae jm" href="https://github.com/froukje/mnist-deployment/tree/master/deployment" rel="noopener ugc nofollow" target="_blank"> github </a>ä¸Šæ‰¾åˆ°å®Œæ•´çš„ä»£ç å’Œç¤ºä¾‹å›¾ç‰‡ã€‚</p><h1 id="4639" class="md jo hh bd jp me mf mg jt mh mi mj jx in mk io kb iq ml ir kf it mm iu kj mn bi translated">çƒ§ç“¶ç®€ä»‹</h1><p id="6f7d" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">Flaskæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„webæ¡†æ¶ã€‚webæ¡†æ¶æŒ‡çš„æ˜¯åº“å’Œæ¨¡å—çš„é›†åˆï¼Œå®ƒä½¿å¾—å¼€å‘webåº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ï¼Œè€Œä¸å¿…æ‹…å¿ƒåº•å±‚ç»†èŠ‚ã€‚Flaskæ›´ç¡®åˆ‡åœ°è¯´æ˜¯ä¸€ä¸ª<em class="mo">å¾®æ¡†æ¶ï¼Œ</em>è¿™æ„å‘³ç€å®ƒä¸éœ€è¦å…¶ä»–å·¥å…·æˆ–åº“ã€‚å®ƒæ˜¯ç”¨æ¥è®¾è®¡å’Œåˆ›å»ºç½‘ç»œåº”ç”¨ç¨‹åºçš„ã€‚Flaskæ˜¯ä¸€ä¸ªWSGI(å‘éŸ³ä¸º:â€œå¨å£«å¿Œâ€)æ¡†æ¶ã€‚è¿™ä»£è¡¨webæœåŠ¡å™¨ç½‘å…³æ¥å£ï¼Œå®ƒæ˜¯webæœåŠ¡å™¨å‘Webåº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¼ é€’è¯·æ±‚çš„ä¸€ç§æ–¹å¼ã€‚</p><p id="1786" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">åœ¨å®ç°æˆ‘ä»¬çš„å°åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»<a class="ae jm" href="https://flask.palletsprojects.com/en/2.2.x/quickstart/" rel="noopener ugc nofollow" target="_blank"> Flaskæ–‡æ¡£</a>ä¸­çš„æœ€å°ç¤ºä¾‹å¼€å§‹ã€‚</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="934f" class="mu jo hh mq b be mv mw l mx my">from flask import Flask<br/><br/>app = Flask(__name__)<br/><br/>@app.route("/")<br/>def hello_world():<br/>    return "&lt;p&gt;Hello, World!&lt;/p&gt;"</span></pre><p id="ce68" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">ä»<a class="ae jm" href="https://flask.palletsprojects.com/en/2.2.x/quickstart/" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£é¡µ</a>ä¸­å¤åˆ¶çš„ç•¥çŸ­çš„è§£é‡Šã€‚</p><ol class=""><li id="4bf4" class="mz na hh kn b ko lw kr lx jy nb kc nc kg nd ld ne nf ng nh bi translated">å¯¼å…¥<code class="du ni nj nk mq b"><a class="ae jm" href="https://flask.palletsprojects.com/en/2.2.x/api/#flask.Flask" rel="noopener ugc nofollow" target="_blank"><strong class="kn hi">Flask</strong></a></code>ç±»ã€‚è¿™ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹æ˜¯æˆ‘ä»¬çš„WSGIåº”ç”¨ç¨‹åºã€‚</li><li id="b4ea" class="mz na hh kn b ko nl kr nm jy nn kc no kg np ld ne nf ng nh bi translated">åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨ç¨‹åºçš„æ¨¡å—æˆ–åŒ…çš„åç§°ã€‚<code class="du ni nj nk mq b">__name__</code>æ˜¯é€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µçš„å¿«æ·æ–¹å¼ã€‚å®ƒå‘Šè¯‰Flaskåœ¨å“ªé‡Œå¯»æ‰¾åƒæ¨¡æ¿å’Œé™æ€æ–‡ä»¶è¿™æ ·çš„èµ„æºã€‚</li><li id="8dd3" class="mz na hh kn b ko nl kr nm jy nn kc no kg np ld ne nf ng nh bi translated">ä½¿ç”¨<code class="du ni nj nk mq b"><a class="ae jm" href="https://flask.palletsprojects.com/en/2.2.x/api/#flask.Flask.route" rel="noopener ugc nofollow" target="_blank"><strong class="kn hi">route()</strong></a></code>è£…é¥°å™¨å‘Šè¯‰Flaskå“ªä¸ªURLåº”è¯¥è§¦å‘è¿™ä¸ªå‡½æ•°ã€‚</li><li id="63f5" class="mz na hh kn b ko nl kr nm jy nn kc no kg np ld ne nf ng nh bi translated">è¯¥å‡½æ•°è¿”å›æˆ‘ä»¬å¸Œæœ›åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„æ–‡æœ¬ã€‚(é»˜è®¤çš„å†…å®¹ç±»å‹æ˜¯HTMLï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ä¸­çš„HTMLå°†ç”±æµè§ˆå™¨å‘ˆç°ã€‚)</li></ol><p id="7a30" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">å°†è„šæœ¬å¦å­˜ä¸º<code class="du ni nj nk mq b">hello.py.</code>è¦è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨:</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="c0c2" class="mu jo hh mq b be mv mw l mx my">$ flask --app hello run<br/> * Serving Flask app 'hello'<br/> * Running on http://127.0.0.1:5000 (Press CTRL+C to quit)</span></pre><p id="86c6" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">â€œ-appâ€é€‰é¡¹å‘Šè¯‰Flaskåº”ç”¨ç¨‹åºåœ¨å“ªé‡Œã€‚ç„¶åä½ å¯ä»¥è¿›å…¥â€œlocalhost:5000â€æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¾“å‡ºâ€œHello Worldâ€ã€‚</p><h1 id="222f" class="md jo hh bd jp me mf mg jt mh mi mj jx in mk io kb iq ml ir kf it mm iu kj mn bi translated">MNISTåº”ç”¨</h1><h2 id="393e" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">æ¦‚è§‚</h2><p id="e8cf" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">æˆ‘ä»¬çš„MNISTåº”ç”¨ç¨‹åºåº”è¯¥æœ‰ä»¥ä¸‹åŠŸèƒ½ã€‚è¯¥åº”ç”¨ç¨‹åºåº”è¯¥åŒ…å«ä¸€ä¸ªä¸Šä¼ å›¾åƒçš„è¡¨å•å’Œä¸€ä¸ªæŒ‰é’®ï¼Œåº”è¯¥æŒ‰ä¸‹ä»¥è¿›è¡Œé¢„æµ‹ã€‚æˆ‘ä»¬å°†ä¿æŒå¸ƒå±€éå¸¸ç®€çº¦ï¼Œä¸“æ³¨äºåŠŸèƒ½ã€‚htmlè¡¨å•å°†å­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºâ€œindex.htmlâ€çš„æ–‡ä»¶ä¸­ã€‚è¯¥æ–‡ä»¶éœ€è¦å­˜å‚¨åœ¨åä¸ºâ€œtemplatesâ€çš„å­æ–‡ä»¶å¤¹ä¸­ã€‚å­æ–‡ä»¶å¤¹éœ€è¦æœ‰è¿™ä¸ªåå­—ï¼Œå¦åˆ™Flaskæ‰¾ä¸åˆ°å®ƒã€‚åº”ç”¨ç¨‹åºæœ¬èº«å°†å­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºâ€œapp.pyâ€çš„æ–‡ä»¶ä¸­ã€‚åœ¨ä¸»æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºâ€œappâ€çš„å­æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å­˜å‚¨äº†åŒ…å«æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å†…å®¹:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nq"><img src="../Images/44626f7f206efc42fb427526dbbe5edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*b1spFwMUrnZI8AOuu3sIHg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Structure of the subfolder of the web app</figcaption></figure><h2 id="9eca" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">HTMLæ–‡ä»¶</h2><p id="55c0" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">HTMLæ–‡ä»¶éå¸¸ç®€å•ã€‚åœ¨æ ‡é¢˜ä¹‹åï¼ŒåŒ…å«ä¸€ä¸ªæ ·å¼è¡¨é“¾æ¥ï¼Œç”¨äºä»<a class="ae jm" href="https://getbootstrap.com/docs/5.1/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>åŠ è½½cssè®¾è®¡ã€‚æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªç®€çŸ­çš„javascriptå‡½æ•°ï¼Œå½“å›¾ç‰‡ä¸Šä¼ æ—¶å°±ä¼šè¢«è§¦å‘ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªä»£è¡¨å›¾åƒçš„URLï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°æ˜¾ç¤ºå›¾åƒã€‚æ›´å¤šç»†èŠ‚ï¼Œæ¯”å¦‚Espen Hovlandsdalåœ¨<a class="ae jm" href="https://schibsted.com/blog/the-magic-of-createobjecturl/" rel="noopener ugc nofollow" target="_blank">schnipsed.com</a>ä¸Šæä¾›äº†å¾ˆå¥½çš„è§£é‡Šã€‚</p><p id="9bb5" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">åŒ…å«å¸¦æœ‰å›¾åƒå’ŒæŒ‰é’®çš„å®é™…è¡¨å•ï¼Œå®ƒè§¦å‘é¢„æµ‹ã€‚è¡¨å•æœ‰â€œmethod=POSTâ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Pythonè„šæœ¬ä¸­çš„â€œrequestâ€æ¥è®¿é—®ä¸Šä¼ çš„å›¾åƒã€‚ç„¶åï¼Œé¢„æµ‹ç”±æ¨¡å‹è®¡ç®—å¹¶æ‰“å°å‡ºæ¥ã€‚ä½¿ç”¨<a class="ae jm" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>è¯­æ³•è®¿é—®é¢„æµ‹ã€‚</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="f90f" class="mu jo hh mq b be mv mw l mx my">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;My Machine Learning Model&lt;/title&gt;<br/><br/>  &lt;!--CSS using bootstrap--&gt;<br/>  &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"&gt;<br/>  &lt;script&gt;<br/>     var loadFile = function(event) {<br/>     var image = document.getElementById('output');<br/>     image.src = URL.createObjectURL(event.target.files[0]);<br/>     };<br/>  &lt;/script&gt;<br/>&lt;/head&gt;<br/><br/>&lt;body&gt;<br/>  &lt;br&gt;<br/>  &lt;br&gt;<br/>  &lt;form method="post" action="{{url_for('predict')}}" enctype="multipart/form-data"&gt;<br/>    &lt;p&gt;<br/>    &lt;input type="file"  accept="image/png" name="file" id="file" onchange="loadFile(event)" style="display: none;"&gt;<br/>    &lt;/p&gt;<br/>    &lt;p&gt;<br/>    &lt;label for="file" style="cursor: pointer;"&gt;Upload Image&lt;/label&gt;<br/>    &lt;/p&gt;<br/>    &lt;img id="output" width="200" /&gt;<br/>    &lt;br&gt;<br/>    &lt;br&gt;<br/>    &lt;button type="submit" class="btn btn-primary btn-block btn-large"&gt;Predict Value!&lt;/button&gt;<br/>  &lt;/form&gt;<br/>  &lt;br&gt;<br/>  &lt;br&gt;<br/>  &lt;b&gt; {{ prediction_text }} &lt;/b&gt;<br/> &lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h2 id="0911" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">çƒ§ç“¶è„šæœ¬</h2><p id="83d4" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹Flaskè„šæœ¬ã€‚åœ¨å®ä¾‹åŒ–æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåï¼Œæˆ‘ä»¬å°†ä¸Šä¼ å›¾åƒçš„æ–‡ä»¶è·¯å¾„è®¾ç½®ä¸ºå½“å‰ç›®å½•ï¼Œè¯¥ç›®å½•ä¸â€œstaticâ€æ–‡ä»¶å¤¹ç›¸è¿æ¥ã€‚æˆ‘ä»¬çš„è„šæœ¬è¿›ä¸€æ­¥ç”±ä¸¤ä¸ªå‡½æ•°â€œhomeâ€å’Œâ€œpredictâ€ç»„æˆã€‚ä¸¤è€…éƒ½æœ‰ä¸€ä¸ªâ€œroute()â€è£…é¥°å™¨,â€œpredictâ€å‡½æ•°è¢«è·¯ç”±åˆ°â€œpredictâ€å­é¡µã€‚â€œhomeâ€å‡½æ•°åªæ˜¯è¿”å›â€œindex.htmlâ€é¡µé¢ï¼Œè€Œâ€œpredictâ€å‡½æ•°æ¥æ”¶æ¥è‡ªhtmlè¡¨å•çš„è¾“å…¥å¹¶è¿›è¡Œé¢„æµ‹ã€‚</p><p id="4fae" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹â€œé¢„æµ‹â€åŠŸèƒ½ã€‚ä»…å½“â€œrequest . method = = POSTâ€â€”â€”å³å½“â€œé¢„æµ‹å€¼ï¼â€æŒ‰é’®â€”è®¡ç®—å¹¶æ‰“å°é¢„æµ‹ã€‚åœ¨æ£€æŸ¥æ–‡ä»¶åä¸ä¸ºç©ºä¹‹åï¼Œç”Ÿæˆå›¾åƒè·¯å¾„ï¼Œæˆ‘ä»¬éœ€è¦å®ƒæ¥è¯·æ±‚é¢„æµ‹ã€‚æ–‡ä»¶åæ˜¯ä½¿ç”¨â€œwerkzeug.utilsâ€ä¸­çš„â€œsecure_filenameâ€æ–¹æ³•ç”Ÿæˆçš„ã€‚è¿™å°†æ–‡ä»¶è·¯å¾„ç®€åŒ–ä¸ºå¹³é¢æ–‡ä»¶åã€‚è¿™æ ·åšæ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ›´å¤šç»†èŠ‚è¯·çœ‹Miguel Grinbergçš„åšå®¢å…³äºæ–‡ä»¶ä¸Šä¼ ã€‚ç„¶åï¼Œæ‰€è¯·æ±‚çš„é¢„æµ‹è¢«è¿”å›å¹¶æ‰“å°åœ¨ç½‘ç«™ä¸Šã€‚æœ¬ä¾‹ä¸­çš„è¯·æ±‚URLæ˜¯ä»å®˜æ–¹torchserveæ˜ åƒåˆ›å»ºçš„Dockeræ˜ åƒï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è€ƒè™‘ã€‚</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="9f52" class="mu jo hh mq b be mv mw l mx my">import os<br/>import requests<br/>from flask import Flask, request, render_template, redirect<br/>import pickle<br/>from werkzeug.utils import secure_filename <br/><br/>app = Flask(__name__)<br/><br/>app.config['IMAGE_UPLOADS'] = os.path.join(os.getcwd(), 'static')<br/><br/>@app.route('/', methods=['POST', 'GET'])<br/>def home():<br/>    return render_template('index.html')<br/><br/>@app.route('/predict',methods=['POST', 'GET'])<br/>def predict():<br/>    """Grabs the input values and uses them to make prediction"""<br/>    if request.method == 'POST':<br/>        print(os.getcwd()) <br/>        image = request.files["file"]<br/>        if image.filename == '':<br/>            print("Filename is invalid")<br/>            return redirect(request.url)<br/><br/>        filename = secure_filename(image.filename)<br/><br/>        basedir = os.path.abspath(os.path.dirname(__file__))<br/>        img_path = os.path.join(basedir, app.config['IMAGE_UPLOADS'], filename)<br/>        image.save(img_path)<br/>        res = requests.post("http://torchserve-mar:8080/predictions/mnist", files={'data': open(img_path, 'rb')})<br/>        prediction = res.json()<br/>    return render_template('index.html', prediction_text=f'Predicted Number: {prediction}')<br/><br/>if __name__ == "__main__":<br/>    app.run(debug=True, host="0.0.0.0", port=9696)</span></pre><h1 id="a1ea" class="md jo hh bd jp me mf mg jt mh mi mj jx in mk io kb iq ml ir kf it mm iu kj mn bi translated">ç”¨Dockerå°†åº”ç”¨å®¹å™¨åŒ–</h1><p id="3eff" class="pw-post-body-paragraph kl km hh kn b ko kp ii kq kr ks il kt jy ku kv kw kc kx ky kz kg la lb lc ld ha bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<a class="ae jm" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>å¯åŠ¨è¯¥åº”ç”¨ç¨‹åºï¼Œå®ƒåŒ…å«ä¸¤ä¸ªæœåŠ¡ã€‚ä¸€ä¸ªç”¨äºtorchserveï¼Œä¸€ä¸ªç”¨äºappã€‚docker-compose.yamlæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="dd85" class="mu jo hh mq b be mv mw l mx my">version: '3.7'<br/><br/>services:<br/>  torchserve-mar: # container-name<br/>    image: torchserve-mar:v1<br/>    ports:<br/>      - "8080:8080"<br/>      - "8081:8081" <br/>  mnistapp:<br/>    build: app/<br/>    ports:<br/>      - "9696:9696"</span></pre><p id="afbc" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">è¿™ä¸¤é¡¹æœåŠ¡è¢«ç§°ä¸ºâ€œtorchserve-marâ€å’Œâ€œmnistappâ€ã€‚â€œtorchserve-marâ€æœåŠ¡æ˜¯ä¸€ä¸ªDockeræ˜ åƒï¼Œå»ºç«‹åœ¨å®˜æ–¹torchserveæ˜ åƒçš„åŸºç¡€ä¸Šï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬â€œæ¨¡å‹å­˜å‚¨â€æ–‡ä»¶å¤¹ã€‚marâ€æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨torchserveã€‚å¦‚ä½•åˆ›é€ è¿™ä¸ªâ€ã€‚marâ€åœ¨<a class="ae jm" rel="noopener" href="/mlearning-ai/use-torchserve-with-a-customized-handler-script-f7d329e78ba4">ä»¥å‰çš„å¸–å­</a>ä¸­è®¨è®ºè¿‡ã€‚æ–‡ä»¶Dockerfileçœ‹èµ·æ¥å¦‚ä¸‹:</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="4ca8" class="mu jo hh mq b be mv mw l mx my">FROM pytorch/torchserve:latest<br/><br/>COPY ["./model-store", "./model-store"]<br/><br/>CMD ["torchserve", "--start", "--model-store", "model-store", "--models", "mnist=mnist.mar"]</span></pre><p id="1c87" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºDockeræ˜ åƒ:</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="bcb7" class="mu jo hh mq b be mv mw l mx my">build -t torchserve-mar:v1</span></pre><p id="13ec" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">ç¬¬äºŒä¸ªæœåŠ¡ç›´æ¥æ„å»ºDockeræ˜ åƒã€‚å…³è”çš„Dockerfileå­˜å‚¨åœ¨â€œappâ€å­æ–‡ä»¶å¤¹ä¸­ï¼Œå…¶ç»“æ„å¦‚ä¸‹ã€‚</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="06fa" class="mu jo hh mq b be mv mw l mx my"># baseimage<br/>FROM python:3.9<br/><br/># install pipenv<br/>RUN pip install pipenv<br/><br/># creates directory "app" and moves there<br/>WORKDIR /app<br/><br/># copy Pipfile and Pifile.lock to current directory<br/>COPY ["Pipfile", "Pipfile.lock", "./"]<br/><br/># create virtual environment directly on the system<br/>RUN pipenv install --system --deploy<br/><br/># copy the python script we need<br/>COPY . ./<br/><br/># expose the port<br/>EXPOSE 9696<br/><br/># define entrypoint<br/>ENTRYPOINT ["gunicorn", "--bind=0.0.0.0:9696", "app:app"]</span></pre><p id="c3f3" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">å®ƒä»Pipenvè™šæ‹Ÿç¯å¢ƒä¸­å¤åˆ¶å¹¶å®‰è£…æ‰€éœ€çš„åŒ…ï¼Œç„¶åå¯åŠ¨åº”ç”¨ç¨‹åºã€‚</p><p id="574c" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">å…³äºç¡®åˆ‡çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œè¯·å‚è€ƒ<a class="ae jm" href="https://github.com/froukje/mnist-deployment/tree/master/deployment" rel="noopener ugc nofollow" target="_blank"> github repo </a>ã€‚è¦è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¯·ç§»åŠ¨åˆ°å­˜å‚¨docker-compose.yamlæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨:</p><pre class="ix iy iz ja fd mp mq mr bn ms mt bi"><span id="8758" class="mu jo hh mq b be mv mw l mx my">docker-compose up</span></pre><p id="ef30" class="pw-post-body-paragraph kl km hh kn b ko lw ii kq kr lx il kt jy ly kv kw kc lz ky kz kg ma lb lc ld ha bi translated">ç„¶ååœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°localhost:9696ï¼ŒæŸ¥çœ‹å¹¶ä½¿ç”¨webåº”ç”¨ç¨‹åºã€‚</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nr"><img src="../Images/83eb4b28355d7615c7362483744531ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZhQOcPUy2fjf8vMjhRzfJA.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshots of the app running on localhost:9696</figcaption></figure><h1 id="9e0c" class="md jo hh bd jp me mf mg jt mh mi mj jx in mk io kb iq ml ir kf it mm iu kj mn bi translated">å‚è€ƒ</h1><ul class=""><li id="ed21" class="mz na hh kn b ko kp kr ks jy ns kc nt kg nu ld nv nf ng nh bi translated">çƒ§ç“¶æ˜¯ä»€ä¹ˆï¼ŸMatthew Deeryï¼Œ2022ï¼Œcareerfoundryï¼Œ<a class="ae jm" href="https://careerfoundry.com/en/blog/web-development/what-is-flask/" rel="noopener ugc nofollow" target="_blank">https://career foundry . com/en/blog/we b-development/what-is-flask/</a></li><li id="1cf9" class="mz na hh kn b ko nl kr nm jy nn kc no kg np ld nv nf ng nh bi translated">Pythonæ•™ç¨‹ï¼Œ2021ï¼Œã€https://pythonbasics.org/what-is-flask-python/ T2ã€‘</li><li id="a05a" class="mz na hh kn b ko nl kr nm jy nn kc no kg np ld nv nf ng nh bi translated">ç”¨Flaskå¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ŒMiguel Grinbergï¼Œ<a class="ae jm" href="https://blog.miguelgrinberg.com/post/handling-file-uploads-with-flask/page/3" rel="noopener ugc nofollow" target="_blank"> 2020ï¼Œhttps://blog . Miguel Grinberg . com/post/handling-File-Uploads-with-Flask/page/3</a></li></ul><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/@frauke.albrecht/subscribe"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">æ¯å½“å¼—åŠ³å…‹Â·é˜¿å°”å¸ƒé›·ç‰¹å‡ºç‰ˆæ—¶ï¼Œå°±æ”¶åˆ°ä¸€å°ç”µå­é‚®ä»¶ã€‚</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">æ¯å½“å¼—åŠ³å…‹Â·é˜¿å°”å¸ƒé›·ç‰¹å‡ºç‰ˆæ—¶ï¼Œå°±æ”¶åˆ°ä¸€å°ç”µå­é‚®ä»¶ã€‚é€šè¿‡æ³¨å†Œï¼Œæ‚¨å°†åˆ›å»ºä¸€ä¸ªä¸­å‹å¸æˆ·ï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰â€¦</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="nw l ls lt lu lq lv jg lh"/></div></div></a></div><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/@frauke.albrecht/membership"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥åª’ä½“</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">é˜…è¯»Frauke Albrechtçš„æ¯ä¸€ä¸ªæ•…äº‹(ä»¥åŠåª’ä½“ä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œå®¶)ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒâ€¦</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="nx l ls lt lu lq lv jg lh"/></div></div></a></div><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">Mlearning.aiæäº¤å»ºè®®</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">å¦‚ä½•æˆä¸ºMlearning.aiä¸Šçš„ä½œå®¶</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="ny l ls lt lu lq lv jg lh"/></div></div></a></div></div></div>    
</body>
</html>