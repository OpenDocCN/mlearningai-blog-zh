<html>
<head>
<title>Process Video and convert to frame and store as data in Azure Machine learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理视频并转换为帧，然后作为数据存储在Azure机器学习中</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/process-video-and-convert-to-frame-and-store-as-data-in-azure-machine-learning-e6fe75dd2788?source=collection_archive---------5-----------------------#2022-10-08">https://medium.com/mlearning-ai/process-video-and-convert-to-frame-and-store-as-data-in-azure-machine-learning-e6fe75dd2788?source=collection_archive---------5-----------------------#2022-10-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="47cd" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">在Azure机器学习中处理视频并转换为帧和存储为数据</h1><h1 id="8980" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="3a07" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure机器学习工作区</li><li id="4645" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储帐户</li><li id="8455" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">要使用的视频</li></ul><h1 id="fa83" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">本教程的目标</h1><ul class=""><li id="1c00" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">展示如何拍摄视频并转换为帧</li><li id="296f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">一旦帧是图像格式，在Azure机器学习中创建一个数据集</li><li id="17d8" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">上传图片</li><li id="9e78" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后我们可以使用数据标记来标记图像</li></ul><h1 id="36cd" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">密码</h1><ul class=""><li id="5239" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">确保我们将视频手动上传到笔记本文件夹</li><li id="f099" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建笔记本</li><li id="d441" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">我选择python 3.10和SDK V2</li><li id="096b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">要使用使用Azure ML SDK V2</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e88b" class="ki if hh ke b fi kj kk l kl km">import cv2<br/>import time<br/>import os</span><span id="c7f4" class="ki if hh ke b fi kn kk l kl km">from matplotlib import pyplot as plt</span><span id="3bc3" class="ki if hh ke b fi kn kk l kl km">time_start = time.time()</span></pre><ul class=""><li id="bd8d" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">创建一个函数来一帧一帧地写回jpg格式</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="3740" class="ki if hh ke b fi kj kk l kl km">filename = "pinballframe"</span><span id="3293" class="ki if hh ke b fi kn kk l kl km">def video_to_frames(input_loc, output_loc):<br/>    """Function to extract frames from input video file<br/>    and save them as separate frames in an output directory.<br/>    Args:<br/>        input_loc: Input video file.<br/>        output_loc: Output directory to save the frames.<br/>    Returns:<br/>        None<br/>    """<br/>    try:<br/>        os.mkdir(output_loc)<br/>    except OSError:<br/>        pass<br/>    # Log the time<br/>    time_start = time.time()<br/>    # Start capturing the feed<br/>    cap = cv2.VideoCapture(input_loc)<br/>    # Find the number of frames<br/>    video_length = int(cap.get(cv2.CAP_PROP_FRAME_COUNT)) - 1<br/>    print ("Number of frames: ", video_length)<br/>    count = 0<br/>    print ("Converting video..\n")<br/>    # Start converting the video<br/>    while cap.isOpened():<br/>        # Extract the frame<br/>        ret, frame = cap.read()<br/>        if not ret:<br/>            continue<br/>        # Write the results back to output location.<br/>        #cv2.imwrite(output_loc + "/%#05d.jpg" % (count+1), frame)<br/>        cv2.imwrite(output_loc + filename + "%d.jpg" % (count+1), frame)<br/>        #cv2.imshow("Tracking", frame)<br/>        count = count + 1<br/>        # If there are no more frames left<br/>        if (count &gt; (video_length-1)):<br/>            # Log the time again<br/>            time_end = time.time()<br/>            # Release the feed<br/>            cap.release()<br/>            # Print stats<br/>            print ("Done extracting frames.\n%d frames extracted" % count)<br/>            print ("It took %d seconds forconversion." % (time_end-time_start))<br/>            break</span></pre><ul class=""><li id="80bf" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">现在用文件夹和视频文件名调用上面的函数</li><li id="926d" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">提供存储图像的目录名</li><li id="ed0a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">我用的是带mp4分机的弹子球视频</li><li id="7153" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于input_loc，更改视频文件所在的位置</li><li id="e257" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">output_loc是代码将单个帧保存为图像的地方</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="29ed" class="ki if hh ke b fi kj kk l kl km">if __name__=="__main__":</span><span id="379b" class="ki if hh ke b fi kn kk l kl km">    input_loc = 'pinballvideo/WIN_20220809_19_57_13_Pro.mp4'<br/>    output_loc = 'pinballimages1/'<br/>    video_to_frames(input_loc, output_loc)</span></pre><ul class=""><li id="9aef" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">可能需要一些时间，这取决于处理了多少帧</li><li id="2233" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">等待它完成</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="1f0e" class="ki if hh ke b fi kj kk l kl km">Done extracting frames.<br/>11293 frames extracted<br/>It took 1118 seconds forconversion.</span></pre><ul class=""><li id="7edb" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">处理11293帧大约需要18分钟c</li></ul><h1 id="5074" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">注册数据集</h1><ul class=""><li id="ffae" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">现在我们必须创建一个数据集</li><li id="9c1a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将图像上传到数据集</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e2ac" class="ki if hh ke b fi kj kk l kl km">from azure.ai.ml.entities import Data<br/>from azure.ai.ml.constants import AssetTypes</span></pre><ul class=""><li id="234a" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">调用工作空间ml客户端来连接和利用工作空间</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="448d" class="ki if hh ke b fi kj kk l kl km">from azure.identity import DefaultAzureCredential<br/>from azure.ai.ml import MLClient</span><span id="689d" class="ki if hh ke b fi kn kk l kl km">credential = DefaultAzureCredential()<br/>ml_client = None<br/>try:<br/>    #ml_client = MLClient.from_config(credential)<br/>    subscription_id = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"<br/>    resource_group = "rgname"<br/>    workspace = "wkspacename"<br/>    ml_client = MLClient(credential, subscription_id, resource_group, workspace)<br/>except Exception as ex:<br/>    print(ex)<br/>    # Enter details of your AzureML workspace<br/>    subscription_id = "xxxxxxxxxxxxxxxxxxxxxxxxxxxx"<br/>    resource_group = "rgname"<br/>    workspace = "wkspacename"<br/>    ml_client = MLClient(credential, subscription_id, resource_group, workspace)</span></pre><ul class=""><li id="bb3a" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">现在创建数据集并上传</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="dbad" class="ki if hh ke b fi kj kk l kl km">my_path = 'pinballimages1'</span><span id="74ca" class="ki if hh ke b fi kn kk l kl km">my_data = Data(<br/>    path=my_path,<br/>    type=AssetTypes.MLTABLE,<br/>    description="Pin Ball Images for AI Hackathon",<br/>    name="pinballimages1",<br/>    version='1'<br/>)</span><span id="44aa" class="ki if hh ke b fi kn kk l kl km">ml_client.data.create_or_update(my_data)</span></pre><ul class=""><li id="4c72" class="jc jd hh je b jf ko jh kp jj kq jl kr jn ks jp jq jr js jt bi translated">等待上传完成</li><li id="1608" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">仅上传最大100MB的文件。</li></ul><h1 id="9123" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">下一步是什么(尚未实施)</h1><ul class=""><li id="a6c3" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">使用数据标记工具来标记图像</li><li id="cf3c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">为图像创建标签</li><li id="7982" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">一旦在azure机器学习中完成数据标记</li><li id="74d2" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">注册为ML数据集</li><li id="d7a3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">为vision创建一个自动化的ML项目并运行该作业。</li></ul><p id="9c2a" class="pw-post-body-paragraph kt ku hh je b jf ko kv kw jh kp kx ky jj kz la lb jl lc ld le jn lf lg lh jp ha bi translated">原文—<a class="ae li" href="https://github.com/balakreshnan/Samples2022/blob/main/AzureMLV2/ProccessVidframedata.md" rel="noopener ugc nofollow" target="_blank">samples 2022/proccessvidframedata . MD at main balakreshnan/samples 2022(github.com)</a></p><div class="lj lk ez fb ll lm"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">medium.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma mb lm"/></div></div></a></div></div></div>    
</body>
</html>