<html>
<head>
<title>Human Segmentation using U-Net — with source code — Easiest Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用U-Net进行人体分割——带源代码——最简单的方法</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/human-segmentation-using-u-net-with-source-code-easiest-way-f78be6e238f9?source=collection_archive---------0-----------------------#2022-01-01">https://medium.com/mlearning-ai/human-segmentation-using-u-net-with-source-code-easiest-way-f78be6e238f9?source=collection_archive---------0-----------------------#2022-01-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3759" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，在今天的博客中，我们将看到我们如何使用<a class="ae jc" href="https://arxiv.org/abs/1505.04597" rel="noopener ugc nofollow" target="_blank"> U-Net </a>进行人体分割。<a class="ae jc" href="https://arxiv.org/abs/1505.04597" rel="noopener ugc nofollow" target="_blank"> U-Net </a>是一个非常特殊的CNN架构，主要是为医疗领域的细分而专门设计的。它被称为<a class="ae jc" href="https://arxiv.org/abs/1505.04597" rel="noopener ugc nofollow" target="_blank"> U形网</a>是因为它的特殊结构，形状像U形，所以没有进一步的名称。</p><p id="6ef9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在这里阅读带源代码的整篇文章—</strong><a class="ae jc" href="https://machinelearningprojects.net/human-segmentation-using-u-net/" rel="noopener ugc nofollow" target="_blank">https://machine learning projects . net/human-segmentation-using-u-net/</a></p><h1 id="e15a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">让我们开始吧…</h1><h2 id="1058" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤1-导入所需的库。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="df07" class="kb je hh ku b fi ky kz l la lb">import tensorflow as tf<br/>import numpy as np<br/>import os<br/>from skimage.io import imread,imshow<br/>from skimage.transform import resize<br/>from skimage import color<br/>from tensorflow.keras.models import load_model<br/>import matplotlib.pyplot as plt<br/>import cv2<br/>from sklearn.model_selection import train_test_split</span></pre><h2 id="c415" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤2-创建X和y数组。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1ae5" class="kb je hh ku b fi ky kz l la lb">IMG_HEIGHT = 256<br/>IMG_WIDTH  = 256<br/>CHANNELS = 3<br/><br/><br/>training_images_names = os.listdir('data/Training_Images/')<br/>training_masks_names = os.listdir('data/masks/')<br/><br/>X = np.zeros((len(training_images_names),IMG_HEIGHT,IMG_WIDTH,CHANNELS),dtype='uint8')<br/>y = np.zeros((len(training_masks_names),IMG_HEIGHT,IMG_WIDTH,1))</span></pre><ul class=""><li id="cef5" class="lc ld hh ig b ih ii il im ip le it lf ix lg jb lh li lj lk bi translated">这里我们只是创建用0初始化的X和y数组。</li><li id="4994" class="lc ld hh ig b ih ll il lm ip ln it lo ix lp jb lh li lj lk bi translated">下一步，我们将填充这些数组。</li></ul><h2 id="b9eb" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤3-填充X和y数组。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="c0c6" class="kb je hh ku b fi ky kz l la lb">for i,n in enumerate(training_images_names):<br/>    img = imread(f'data/Training_Images/{n}')<br/>    img = resize(img,(IMG_HEIGHT,IMG_WIDTH,CHANNELS),mode='constant',preserve_range=True)<br/>    fn = str(n.split('.')[0]) + '.png'<br/>    mask = imread(f'data/masks/{fn}')<br/>    mask = resize(mask,(IMG_HEIGHT,IMG_WIDTH,1),mode='constant')<br/>    <br/>    X[i] = img<br/>    y[i] = mask<br/>    <br/>X[0].shape</span></pre><ul class=""><li id="8042" class="lc ld hh ig b ih ii il im ip le it lf ix lg jb lh li lj lk bi translated">在这一步，我们将填充X和y数组。</li><li id="038d" class="lc ld hh ig b ih ll il lm ip ln it lo ix lp jb lh li lj lk bi translated">在X中，我们将填充256*256大小的图像。</li><li id="0a08" class="lc ld hh ig b ih ll il lm ip ln it lo ix lp jb lh li lj lk bi translated">在y中，我们将填充256*256个调整大小的遮罩。</li></ul><figure class="kp kq kr ks fd lr er es paragraph-image"><div class="er es lq"><img src="../Images/6a9e7297eb0aaa682bc230d6786e9805.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/0*oto52jOPinxpz1Hp.png"/></div></figure><h2 id="7fd8" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤4-随机绘制图像及其蒙版。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="696c" class="kb je hh ku b fi ky kz l la lb">i = np.random.randint(0,len(X))<br/>fig,(a1,a2)=plt.subplots(1,2)<br/>a1.imshow(X[i])<br/>a2.imshow(y[i].reshape(y[i].shape[:-1]),cmap='gray')</span></pre><ul class=""><li id="4d16" class="lc ld hh ig b ih ii il im ip le it lf ix lg jb lh li lj lk bi translated">取一个随机索引并绘制其图像和掩码。</li></ul><figure class="kp kq kr ks fd lr er es paragraph-image"><div class="er es lu"><img src="../Images/1535d2ce275714cad3d6691d20d356a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/0*rVLszmoZOo_LFRsi.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx">Human Segmentaion using UNet</figcaption></figure><h2 id="86ad" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤5——建立U-Net。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="f657" class="kb je hh ku b fi ky kz l la lb">inputs = tf.keras.layers.Input((IMG_HEIGHT,IMG_WIDTH,CHANNELS))<br/>s = tf.keras.layers.Lambda(lambda x:x/255)(inputs)<br/><br/>#contracting path<br/>c1 = tf.keras.layers.Conv2D(16,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(s)<br/>c1 = tf.keras.layers.Dropout(0.1)(c1)<br/>c1 = tf.keras.layers.Conv2D(16,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c1)<br/>p1 = tf.keras.layers.MaxPooling2D((2,2))(c1)<br/><br/><br/>c2 = tf.keras.layers.Conv2D(32,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(p1)<br/>c2 = tf.keras.layers.Dropout(0.1)(c2)<br/>c2 = tf.keras.layers.Conv2D(32,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c2)<br/>p2 = tf.keras.layers.MaxPooling2D((2,2))(c2)<br/><br/><br/>c3 = tf.keras.layers.Conv2D(64,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(p2)<br/>c3 = tf.keras.layers.Dropout(0.2)(c3)<br/>c3 = tf.keras.layers.Conv2D(64,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c3)<br/>p3 = tf.keras.layers.MaxPooling2D((2,2))(c3)<br/><br/><br/>c4 = tf.keras.layers.Conv2D(128,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(p3)<br/>c4 = tf.keras.layers.Dropout(0.2)(c4)<br/>c4 = tf.keras.layers.Conv2D(128,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c4)<br/>p4 = tf.keras.layers.MaxPooling2D((2,2))(c4)<br/><br/><br/>c5 = tf.keras.layers.Conv2D(256,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(p4)<br/>c5 = tf.keras.layers.Dropout(0.3)(c5)<br/>c5_1 = tf.keras.layers.Conv2D(256,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c5)<br/>c5_1 = tf.keras.layers.Dropout(0.3)(c5_1)<br/>c5_2 = tf.keras.layers.Conv2D(256,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(c5_1)<br/>c5_3 = tf.keras.layers.Conv2D(256,(3,3),activation='relu',kernel_initializer='he_normal',padding='same',dilation_rate=2)(c5_2)<br/>c5_4 = tf.keras.layers.Conv2D(512,(3,3),activation='relu',kernel_initializer='he_normal',padding='same',dilation_rate=2)(c5_3 )<br/>c5_5 = tf.keras.layers.concatenate([c5_1,c5_4])<br/><br/><br/>#expanding path<br/>u4 = tf.keras.layers.Conv2DTranspose(128,(2,2),strides=(2,2),padding='same')(c5_5)<br/>u4 = tf.keras.layers.concatenate([u4,c4])<br/>u4 = tf.keras.layers.Conv2D(128,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u4)<br/>u4 = tf.keras.layers.Dropout(0.2)(u4)<br/>u4 = tf.keras.layers.Conv2D(128,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u4)<br/><br/><br/>u3 = tf.keras.layers.Conv2DTranspose(64,(2,2),strides=(2,2),padding='same')(u4)<br/>u3 = tf.keras.layers.concatenate([u3,c3])<br/>u3 = tf.keras.layers.Conv2D(64,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u3)<br/>u3 = tf.keras.layers.Dropout(0.2)(u3)<br/>u3 = tf.keras.layers.Conv2D(64,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u3)<br/><br/><br/>u2 = tf.keras.layers.Conv2DTranspose(32,(2,2),strides=(2,2),padding='same')(u3)<br/>u2 = tf.keras.layers.concatenate([u2,c2])<br/>u2 = tf.keras.layers.Conv2D(32,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u2)<br/>u2 = tf.keras.layers.Dropout(0.2)(u2)<br/>u2 = tf.keras.layers.Conv2D(32,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u2)<br/><br/><br/>u1 = tf.keras.layers.Conv2DTranspose(16,(2,2),strides=(2,2),padding='same')(u2)<br/>u1 = tf.keras.layers.concatenate([u1,c1])<br/>u1 = tf.keras.layers.Conv2D(16,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u1)<br/>u1 = tf.keras.layers.Dropout(0.2)(u1)<br/>u1 = tf.keras.layers.Conv2D(16,(3,3),activation='relu',kernel_initializer='he_normal',padding='same')(u1)<br/><br/>output = tf.keras.layers.Conv2D(1,(1,1),activation='sigmoid')(u1)<br/><br/>model = tf.keras.Model(inputs=[inputs],outputs=[output])<br/>model.compile(optimizer='adam',loss='binary_crossentropy',metrics=['accuracy'])<br/>model.summary()</span></pre><ul class=""><li id="61f9" class="lc ld hh ig b ih ii il im ip le it lf ix lg jb lh li lj lk bi translated">在这里，我们只是简单地建立了U-Net结构。</li></ul><figure class="kp kq kr ks fd lr er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/aa954cd7451cf0e1f296d2cdfef7dc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kwAAvHGhqyHcOzDz.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">U net</figcaption></figure><figure class="kp kq kr ks fd lr er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es me"><img src="../Images/e4fecd1532697cfffeb4da64c6c0945c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s2Q4686yeOpytiUg.png"/></div></div></figure><figure class="kp kq kr ks fd lr er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/499891cb79e28f50b7fa2b42abb54723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SUUzYoch5onMMpBO.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">U net model</figcaption></figure><h2 id="d131" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤6-训练测试分割数据。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="82d3" class="kb je hh ku b fi ky kz l la lb">X_train, X_test, y_train, y_test = train_test_split(X,  y, test_size=0.1, random_state=42)</span></pre><h2 id="8375" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤7-训练和保存模型。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="e8ad" class="kb je hh ku b fi ky kz l la lb">results = model.fit(X_train,y_train,batch_size=16,epochs=100)<br/>model.save('models/human_segmentation_non-aug_100_v2.h5')</span></pre><figure class="kp kq kr ks fd lr er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/b3b6a832fccbd4dd4b3338e9f5449e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ULaRT1J6Mc6Lwopd.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">UNet Training</figcaption></figure><h2 id="4f73" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">第8步—绘制损耗和精度曲线。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="6a34" class="kb je hh ku b fi ky kz l la lb">fig,(a1,a2) = plt.subplots(1,2,figsize=(17,8))<br/>a1.plot(np.arange(0,100),results.history['loss'],label = 'loss')<br/>a2.plot(np.arange(0,100),results.history['accuracy'],label='accuracy')<br/>a1.legend()<br/>a2.legend()<br/>plt.savefig('losses_and_accuracies_100_v2.png')</span></pre><figure class="kp kq kr ks fd lr er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/beb08cdd325f58f7d9dd44f2d894931a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zrjatz7TlBSkJPIQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">plot curves</figcaption></figure><h2 id="7f5f" class="kb je hh bd jf kc kd ke jj kf kg kh jn ip ki kj jr it kk kl jv ix km kn jz ko bi translated">步骤9——可视化输出。</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="948e" class="kb je hh ku b fi ky kz l la lb">k=np.random.randint(0,len(X_test))<br/>fig,(a1,a2) = plt.subplots(1,2)<br/><br/>a1.imshow(X_test[k])<br/><br/>(h,w,c) = X_test[k].shape<br/>i = X_test[k].reshape((1,h,w,c))<br/><br/>pred = model.predict(i)<br/><br/>a2.imshow(pred.reshape(pred.shape[1:-1]),cmap='gray')</span></pre><ul class=""><li id="1f29" class="lc ld hh ig b ih ii il im ip le it lf ix lg jb lh li lj lk bi translated">在这里，我们检查我们的模型的性能。</li><li id="6407" class="lc ld hh ig b ih ll il lm ip ln it lo ix lp jb lh li lj lk bi translated">而且看它表现的很好(明显不是很好:)。</li></ul><figure class="kp kq kr ks fd lr er es paragraph-image"><div class="er es mf"><img src="../Images/eafc3d12a71a5843ffd5febc305c4e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/0*2YclZOkPrdBIhdp_.png"/></div></figure><p id="ab1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果对牛奶产量预测有任何疑问，请通过电子邮件或LinkedIn联系我。你也可以在下面评论任何问题。</p><p id="2ffd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mg">探索更多机器学习、深度学习、计算机视觉、NLP、Flask项目访问我的博客— </em> </strong> <a class="ae jc" href="https://machinelearningprojects.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> <em class="mg">机器学习项目</em> </strong> </a></p><p id="8818" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">如需进一步的代码解释和源代码，请访问此处</strong>—<a class="ae jc" href="https://machinelearningprojects.net/human-segmentation-using-u-net/" rel="noopener ugc nofollow" target="_blank">https://machine learning projects . net/human-segmentation-using-u-net/</a></p><p id="1dce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mg">所以这就是我写给这个博客的所有内容，感谢你阅读它，我希望你在阅读完这篇文章后会有所收获，直到下一次……</em></p><p id="8517" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mg">阅读我以前的帖子:</em> </strong> <a class="ae jc" href="https://machinelearningprojects.net/milk-production-prediction-for-next-year/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> <em class="mg">利用LSTM </em> </strong> </a>对明年产奶量进行预测</p><div class="mh mi ez fb mj mk"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hi fi z dy mp ea eb mq ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">medium.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ls mk"/></div></div></a></div></div></div>    
</body>
</html>