<html>
<head>
<title>A Simple Tutorial of Hyperparameter Tuning Using Microsoft NNI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用微软NNI软件调整超参数的简单教程</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/a-simple-tutorial-of-hyperparameter-tuning-using-microsoft-nni-fe42e7859b7d?source=collection_archive---------0-----------------------#2021-08-24">https://medium.com/mlearning-ai/a-simple-tutorial-of-hyperparameter-tuning-using-microsoft-nni-fe42e7859b7d?source=collection_archive---------0-----------------------#2021-08-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c744" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">新奇的想法却没有了<strong class="ig hi"> S </strong>泰特<strong class="ig hi"> O </strong> f <strong class="ig hi"> T </strong>何<strong class="ig hi"> A </strong> rt？别担心，你只需要一个叫做NNI的工具来帮助你找到你的模型的最佳超参数……</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/a7b3053f29ec8f0d9900b8a3ee67be21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*0HVwP4mmki3OQcvMg-z5kQ.jpeg"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">Source of image: <a class="ae jo" href="https://miro.medium.com/max/1264/1*hOyYrXiDL5v965xIq8PTIQ.jpeg" rel="noopener">https://miro.medium.com/max/1264/1*hOyYrXiDL5v965xIq8PTIQ.jpeg</a></figcaption></figure><h1 id="0813" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/a1f62acc136ea7d7ffd6f5bf238f4b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NJ0bQOu0V_UPOfbp"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">Source of image: <a class="ae jo" href="https://miro.medium.com/max/2400/0*Vpssl5-F-MFe5wAX" rel="noopener">https://miro.medium.com/max/2400/0*Vpssl5-F-MFe5wAX</a></figcaption></figure><blockquote class="ks kt ku"><p id="a3d7" class="ie if kv ig b ih ii ij ik il im in io kw iq ir is kx iu iv iw ky iy iz ja jb ha bi translated"><strong class="ig hi"> NNI(神经网络智能)</strong>是一个轻量级但功能强大的工具包，帮助用户自动化<a class="ae jo" href="https://nni.readthedocs.io/en/stable/FeatureEngineering/Overview.html" rel="noopener ugc nofollow" target="_blank">特征工程</a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/NAS/Overview.html" rel="noopener ugc nofollow" target="_blank">神经架构搜索</a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Tuner/BuiltinTuner.html" rel="noopener ugc nofollow" target="_blank">超参数调整</a>和<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Compression/Overview.html" rel="noopener ugc nofollow" target="_blank">模型压缩</a>。</p><p id="d44d" class="ie if kv ig b ih ii ij ik il im in io kw iq ir is kx iu iv iw ky iy iz ja jb ha bi translated">该工具管理自动机器学习(AutoML)实验，调度并运行由调整算法生成的实验的试验作业，以在不同的训练环境中搜索最佳的神经架构和/或超参数，如<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/LocalMode.html" rel="noopener ugc nofollow" target="_blank">本地机器</a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/RemoteMachineMode.html" rel="noopener ugc nofollow" target="_blank">远程服务器</a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/PaiMode.html" rel="noopener ugc nofollow" target="_blank"> OpenPAI </a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/KubeflowMode.html" rel="noopener ugc nofollow" target="_blank"> Kubeflow </a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/FrameworkControllerMode.html" rel="noopener ugc nofollow" target="_blank">K8S上的framework controller(AK等。)</a>，<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/DLTSMode.html" rel="noopener ugc nofollow" target="_blank"> DLWorkspace(又名。DLTS) </a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/AMLMode.html" rel="noopener ugc nofollow" target="_blank"> AML (Azure机器学习)</a>、<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/AdaptDLMode.html" rel="noopener ugc nofollow" target="_blank"> AdaptDL(又名。ADL) </a>，其他云选项甚至<a class="ae jo" href="https://nni.readthedocs.io/en/stable/TrainingService/HybridMode.html" rel="noopener ugc nofollow" target="_blank">混合模式</a>。</p></blockquote><h2 id="d103" class="kz jq hh bd jr la lb lc jv ld le lf jz ip lg lh kd it li lj kh ix lk ll kl lm bi translated">基本概念</h2><p id="6b82" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">首先，我们需要预定义一个<strong class="ig hi">搜索空间</strong>(作为参数组合集查看)，然后我们使用<code class="du ls lt lu lv b">nni.get_next_parameter()</code>命令从搜索空间获取一个参数作为<strong class="ig hi">配置</strong>对象。其次，我们使用配置对象运行我们的代码一段时间，称为<strong class="ig hi">试验</strong>。第三，我们使用包含一些优化算法的<strong class="ig hi">调谐器</strong>为下一个<strong class="ig hi">试验</strong>产生新的<strong class="ig hi">配置</strong>，同时使用<strong class="ig hi">评估器</strong>评估中间结果以决定是否应该中止当前试验。最后，我们可以使用<code class="du ls lt lu lv b">nnictl</code>命令与<strong class="ig hi"> Web UI </strong>进行交互，查看运行状态等。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lw"><img src="../Images/80d11bd9d9b550287fc609fe13fe4855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4R6wHQAjyT7Yx2ewS49_-g.jpeg"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">Source of image: https://upload-images.jianshu.io/upload_images/5319108-27307edae0b2fe86?imageMogr2/auto-orient/strip|imageView2/2/format/webp</figcaption></figure><h1 id="85be" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">快速启动(仅3步)</h1><p id="43f4" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated"><strong class="ig hi">第一步:</strong>在<strong class="ig hi"> YAML或JSON </strong>文件中定义一个<code class="du ls lt lu lv b">Search Space</code>，包括你要搜索的所有超参数的<code class="du ls lt lu lv b">name</code>和<code class="du ls lt lu lv b">distribution</code> ( <strong class="ig hi">离散值或连续值</strong>)。更多细节可以在<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Tutorial/SearchSpaceSpec.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">这里</strong> </a>找到。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">search_space.yaml</figcaption></figure><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">search_space.json</figcaption></figure><p id="88f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第二步:</strong>将我们的代码修改为<code class="du ls lt lu lv b">Trial</code>代码，这样它就可以从NNI获取超参数集，并将最终结果报告给NNI。</p><ol class=""><li id="bdc3" class="lz ma hh ig b ih ii il im ip mb it mc ix md jb me mf mg mh bi translated">当<code class="du ls lt lu lv b">main</code>函数需要字典对象中的<code class="du ls lt lu lv b">args</code>时，我们可以直接使用下面的例子来获取参数。</li></ol><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="f312" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.当<code class="du ls lt lu lv b">main </code>函数需要来自<code class="du ls lt lu lv b">argparse.ArgumentParser()</code>对象的<code class="du ls lt lu lv b">args</code>时，我们需要用下面的例子来传递。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="e593" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第三步:</strong>在YAML文件中定义一个<code class="du ls lt lu lv b">Config</code>来指定实验的关键信息，如试验文件、调优算法【8】、最大试验次数、最大持续时间等。更多细节可以在<a class="ae jo" href="https://nni.readthedocs.io/en/stable/reference/experiment_config.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">这里找到</strong> </a>。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx ly l"/></div></figure><h1 id="dc39" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">启动和查看</h1><blockquote class="ks kt ku"><p id="45d3" class="ie if kv ig b ih ii ij ik il im in io kw iq ir is kx iu iv iw ky iy iz ja jb ha bi translated"><code class="du ls lt lu lv b">nnictl</code>是一个命令行工具，可以用来控制实验，如<strong class="ig hi">启动/停止/恢复</strong>一个实验，启动/停止NNIBoard等。点击<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Tutorial/Nnictl.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">此处</strong> </a>了解<code class="du ls lt lu lv b">nnictl</code>的更多用法。而<code class="du ls lt lu lv b">WebUI</code>更详细的用法，请参考本<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Tutorial/WebUI.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">文档</strong> </a>。</p></blockquote><ul class=""><li id="a914" class="lz ma hh ig b ih ii il im ip mb it mc ix md jb mi mf mg mh bi translated">Linux、macOS和Windows -&gt;启动</li></ul><pre class="jd je jf jg fd mj lv mk ml aw mm bi"><span id="03a9" class="kz jq hh lv b fi mn mo l mp mq">nnictl create --config config.yaml -p xxxx</span></pre><p id="9de3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">等待命令行中的消息<code class="du ls lt lu lv b">INFO: Successfully started experiment!</code>。此消息表明您的实验已经成功开始。这是我们期望得到的:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mr"><img src="../Images/78c6951ab12d1a91e1edc0e3b2c62032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KzVhNAGGpqYliWwfKHfi1g.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">The successfully started experiment message output, and copy ‘The Web UI urls’ in your browser.</figcaption></figure><ul class=""><li id="0b06" class="lz ma hh ig b ih ii il im ip mb it mc ix md jb mi mf mg mh bi translated">在你的浏览器中复制<code class="du ls lt lu lv b">Web UI urls</code>-&gt;视图</li></ul><p id="755d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在浏览器中打开<code class="du ls lt lu lv b">Web UI urls</code>(显示在命令行界面中)，可以查看实验的详细信息以及所有提交的试用作业，如下图所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ms"><img src="../Images/758a1901d60fd9dc39453e433386de1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIIZJS2S-KXT7-qb3jkdPw.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">The different experiment pages.</figcaption></figure><h1 id="bdd5" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考</h1><p id="13ce" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">[0]https://github.com/microsoft/nni微软-NNI <a class="ae jo" href="https://github.com/microsoft/nni" rel="noopener ugc nofollow" target="_blank"/></p><p id="d779" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[1]在NVIDIA A100 GPUs上加速tensor flow<a class="ae jo" href="https://developer.nvidia.com/blog/accelerating-tensorflow-on-a100-gpus" rel="noopener ugc nofollow" target="_blank">https://developer . NVIDIA . com/blog/Accelerating-tensor flow-on-A100-GPU</a></p><p id="6fc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[2]微软发布用于AutoML算法和训练的NNI v 1.3<a class="ae jo" rel="noopener" href="/syncedreview/microsoft-releases-nni-v1-3-for-automl-algorithms-and-training-9f6eb57476e0">https://medium . com/synced review/Microsoft-Releases-nni-v1-3-for-AutoML-Algorithms-and-Training-9 F6 EB 57476 E0</a></p><p id="9b41" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[3]使用AdaptDL和NNI进行高性价比的超参数调整<a class="ae jo" rel="noopener" href="/casl-project/cost-effective-hyper-parameter-tuning-using-adaptdl-with-nni-e55642888761">https://medium . com/casl-project/Cost-effective-Hyper-parameter-Tuning-using-AdaptDL-with-nni-e 55642888761</a></p><p id="124b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[4]NNI快速入门<a class="ae jo" href="https://nni.readthedocs.io/en/stable/Tutorial/QuickStart.html" rel="noopener ugc nofollow" target="_blank">https://nni . readthedocs . io/en/stable/Tutorial/quick start . html</a></p><p id="ef9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[5]Microsoft NNI入门 <a class="ae jo" href="https://www.jianshu.com/p/0e622a97e20c" rel="noopener ugc nofollow" target="_blank">https://www.jianshu.com/p/0e622a97e20c</a></p><p id="aaad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[6]微软自动调参工具 — NNI — 安装与使用教程（附错误解决） <a class="ae jo" href="https://blog.csdn.net/weixin_43653494/article/details/101039198" rel="noopener ugc nofollow" target="_blank">https://blog.csdn.net/weixin_43653494/article/details/101039198</a></p><p id="56d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[7]使用NNI进行自动超参数调优 <a class="ae jo" href="https://blog.csdn.net/csdn_yi_e/article/details/110428270" rel="noopener ugc nofollow" target="_blank">https://blog.csdn.net/csdn_yi_e/article/details/110428270</a></p><p id="ab7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[8]微软新工具 NNI 使用指南之 Tuner 篇 <a class="ae jo" href="https://www.jianshu.com/p/3587b24f1a6d" rel="noopener ugc nofollow" target="_blank">https://www.jianshu.com/p/3587b24f1a6d</a></p><p id="7a1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[9]错误:Restful服务器启动失败！无法创建日志目录:范围错误:无效时间值<a class="ae jo" href="https://github.com/microsoft/nni/issues/4083" rel="noopener ugc nofollow" target="_blank">https://github.com/microsoft/nni/issues/4083</a></p><p id="13fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[10] <a class="ae jo" href="https://blog.csdn.net/qq_40263477/article/details/104289758?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162979868216780264045993%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=162979868216780264045993&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-3-104289758.pc_v2_rank_blog_default&amp;utm_term=conda&amp;spm=1018.2226.3001.4450" rel="noopener ugc nofollow" target="_blank">Anaconda使用总结</a></p><p id="8cd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">[11]<a class="ae jo" href="https://blog.csdn.net/qq_40263477/article/details/104290133?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162979868216780264045993%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=162979868216780264045993&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-1-104290133.pc_v2_rank_blog_default&amp;utm_term=conda&amp;spm=1018.2226.3001.4450" rel="noopener ugc nofollow" target="_blank">pip和conda批量导出、安装包</a></p><p id="8e8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[12] <a class="ae jo" href="https://stackoverflow.com/questions/47717317/valueerror-variable-embedding-already-exists-disallowed-did-you-mean-to-set-r" rel="noopener ugc nofollow" target="_blank">值错误:变量嵌入已经存在，不允许。你的意思是在VarScope中设置reuse=True吗？原定义</a><a class="ae jo" href="https://stackoverflow.com/questions/47717317/valueerror-variable-embedding-already-exists-disallowed-did-you-mean-to-set-r" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/47717317/value error-variable-embedding-already-exists-disallowed-do-you-mean-to-set-r</a></p></div></div>    
</body>
</html>