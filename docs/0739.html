<html>
<head>
<title>How to build an auto-complete model with tensorflow.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用tensorflow.js构建自动完成模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-build-an-auto-complete-model-with-tensorflow-js-56c027cafc2f?source=collection_archive---------0-----------------------#2021-07-02">https://medium.com/mlearning-ai/how-to-build-an-auto-complete-model-with-tensorflow-js-56c027cafc2f?source=collection_archive---------0-----------------------#2021-07-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/11c6d8c37f1dcf9f5cea6c30e483e9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLYzsDiMG_zCkxqkqSDKng.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Demo link: <a class="ae it" href="https://ohyicong.github.io/portfolio/autocomplete_model.html" rel="noopener ugc nofollow" target="_blank">https://ohyicong.github.io/portfolio/autocomplete_model.html</a></figcaption></figure><p id="5475" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">自动完成是每部手机和电脑都内置的一个基本功能，它可以从你的打字习惯中学习，并神奇地将新单词添加到字典中。有时候，它是如此的直观，以至于我们忘记了它的存在。</p><p id="cf6b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是你想知道它是如何工作的吗？我做到了。</p><p id="ea93" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">出于好奇，我做了一些研究，并意识到没有一个简单的教程来实现机器学习的自动完成模型。所以我决定写这篇文章来分享和解释我构建、训练和部署自动完成模型的过程。</p><p id="f50c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了让每个人都能跟上我的教程，我决定使用Tensorflow.js来实现。这是一个令人惊叹的javascript库，允许您在Edge、Chrome和Firefox等web浏览器上开发您的机器学习(ML)模型。</p><p id="365f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以任何有网络浏览器和文本编辑器的人都可以跟随我的教程。</p><h2 id="0142" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">自动完成直觉</h2><p id="14d0" class="pw-post-body-paragraph iu iv hh iw b ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn kr jp jq jr ha bi translated">一般来说，理想的自动完成功能具有以下特征。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ks"><img src="../Images/2e0851463973150634d7f28cafff8fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LU4zTx4jOQlHYfKJXQFERQ.png"/></div></div></figure><p id="f4b9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">选择机器学习模型</strong></p><p id="3cdf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有许多可用的ML模型，但并不是所有都适合我们的环境。我们必须选择一个模型，它能够从一系列输入中进行处理和推断，以预测最可能的输出。</p><p id="2613" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">考虑到这一点，我选择了长短期记忆(LSTM)模型。LSTM模型具有递归神经网络架构，允许其从<em class="kx"> t-0到t-n </em>推断输入，其中<em class="kx"> t </em>表示当前时间步长，<em class="kx"> n </em>表示序列号。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/a1fd11dfcea15730273aa13e3d82e869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*_d67EKDgYlME_6V7CW6evw.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Simplified Overview of an LSTM Model</figcaption></figure><p id="c133" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">创建数据集</strong></p><p id="899e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">选定模型后，我们需要弄清楚什么样的数据适合训练。以下是一些有助于你思考的问题:</p><ol class=""><li id="f8e7" class="kz la hh iw b ix iy jb jc jf lb jj lc jn ld jr le lf lg lh bi translated">有什么特点和标签？</li><li id="0939" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">有哪些数据限制？</li><li id="0cca" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">需要哪种数据格式？</li><li id="48c8" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">数据形状是什么？</li></ol><p id="bc3b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Qn 1:有什么特点和标签？</p><p id="0a39" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要决定培训的特点和标签，把自己放在英语老师的位置上。想想你可以用什么方法教一个蹒跚学步的孩子英语。</p><p id="0ba3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">其中一种方法是“填空”，其中一些字符模糊不清，幼儿被训练写下正确的字符组成一个单词。</p><p id="1286" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">同样，这种方法可以应用于创建数据集来训练我们的模型。</p><p id="32fa" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，为了训练模型识别单词“apple”，我们可以从左到右模糊该单词中的字符，如下表所示。</p><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="f695" class="js jt hh lo b fi ls lt l lu lv">Dataset<br/>+------------+------------+<br/>|  features  |   labels   |<br/>+------------+------------+<br/>| a          | apple      |<br/>| ap         | apple      |<br/>| app        | apple      |<br/>| appl       | apple      |<br/>| apple      | apple      |<br/>+------------+------------+</span></pre><p id="1c5b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Qn2:数据限制是什么？</p><p id="dbc2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您应该注意两个数据限制。</p><ol class=""><li id="14e5" class="kz la hh iw b ix iy jb jc jf lb jj lc jn ld jr le lf lg lh bi translated">最大单词长度<em class="kx">(这个数字由你决定，对于本教程，我将使用10) </em></li><li id="466c" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">仅字母<em class="kx">(数据集中不应包含任何数字和特殊字符)</em></li></ol><p id="34ef" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为最大长度是10，我们需要用零填充空白，如下表所示。</p><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="4a64" class="js jt hh lo b fi ls lt l lu lv">Dataset<br/>+------------+------------+<br/>|  features  |   labels   |<br/>+------------+------------+<br/>| a000000000 | apple00000 |<br/>| ap00000000 | apple00000 |<br/>| app0000000 | apple00000 |<br/>| appl000000 | apple00000 |<br/>| apple00000 | apple00000 |<br/>+------------+------------+</span></pre><p id="ad78" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Qn3:什么样的数据格式？</p><p id="4810" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于计算机只和数字打交道，我们需要找到一种方法把字符转换成数字。一种简单的方法是使用整数编码，其中padding=0，a=1，b=2，c=3 … z=27，这将产生如下所示的输出。</p><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="0f65" class="js jt hh lo b fi ls lt l lu lv">apple00000 = 1,16,16,12,5,0,0,0,0,0</span></pre><p id="b95f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">即使我们可以使用这个数据集来训练模型，它也可能不会产生好的结果。这是因为每个字符的整数表示不公平，其中ML模型假设字符“z”比“a”具有更高的优先级，因为表示“z”的整数具有更高的值。</p><p id="7a87" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">抵消优先效应的一个简单方法是使用一键编码，用1和0的数组来表示字符。请参见下面的一键编码输出。</p><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="2557" class="js jt hh lo b fi ls lt l lu lv">apple00000 = <br/>[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]<br/>[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]<br/>[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]<br/>[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]</span></pre><p id="92ae" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Qn4:什么是数据形状？</p><p id="b7c8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用零填充和一键编码，每个单词的结果形状将是(10，27):(最大单词长度:字母数+ 1)。</p><p id="a7d9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">建立机器学习模型</strong></p><p id="97cb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我们终于到了激动人心的部分，您将为这个应用程序构建ML模型。</p><p id="9e01" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">模型架构由两层组成:</p><ol class=""><li id="67d3" class="kz la hh iw b ix iy jb jc jf lb jj lc jn ld jr le lf lg lh bi translated">LSTM层(输入)。它用于从顺序输入中得出推论。</li><li id="428f" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">Softmax密集层(输出)。它用于一次性编码预测。</li></ol><p id="0e43" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">创建这两层之后，您需要定义输入和输出形状。这是非常重要的一步，因为指定错误的数字会导致“形状不匹配”的错误。</p><p id="2c28" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">按照之前的计算，形状将是(10，27)。因此，我们应该定义max_len = 10，alpha_len = 27。</p><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="ad94" class="js jt hh lo b fi ls lt l lu lv">// code for building auto-complete model<br/>const max_len = 10;<br/>const alpha_len = 27;<br/>var model = tf.sequential();<br/>model.add(tf.layers.lstm({<br/>  units:alpha_len*2,<br/>  inputShape:[max_len,alpha_len],<br/>  dropout:0.2,<br/>  recurrentDropout:0.2,<br/>  useBias: true,<br/>  returnSequences:true,<br/>  activation:"relu"<br/>}))<br/>model.add(tf.layers.timeDistributed({<br/>   layer: tf.layers.dense({<br/>    units: alpha_len,<br/>    dropout:0.2,<br/>    activation:"softmax"<br/>  })<br/>}));</span></pre><p id="81df" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">训练机器学习模型</strong></p><p id="c27c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了训练模型，我们需要决定几个参数:</p><ol class=""><li id="17c1" class="kz la hh iw b ix iy jb jc jf lb jj lc jn ld jr le lf lg lh bi translated">优化器。adam优化器用于训练我们的模型，因为它可以很好地处理稀疏数据，并具有有效训练模型的自适应学习率。</li><li id="85ec" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">损失函数。当模型需要预测具有分类数据类型的一键编码中的结果时，使用分类交叉熵。</li><li id="488c" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">新纪元。默认设置为250，应根据数据集大小进行调整。</li><li id="7da1" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">批量大小。默认设置为32，应根据数据集大小进行调整。</li><li id="1a57" class="kz la hh iw b ix li jb lj jf lk jj ll jn lm jr le lf lg lh bi translated">评估指标。由于损失函数的性质，使用均方误差(MSE)。</li></ol><pre class="kt ku kv kw fd ln lo lp lq aw lr bi"><span id="f8d3" class="js jt hh lo b fi ls lt l lu lv"># code to train the model<br/>model.compile({<br/>  optimizer: tf.train.adam(),<br/>  loss: 'categoricalCrossentropy',<br/>  metrics: ['mse'] <br/>})<br/>model.fit(train_features, train_label, {<br/>  epochs,<br/>  batch_size,<br/>  shuffle: true,<br/>  callbacks: tfvis.show.fitCallbacks(<br/>    { name: 'Training' },<br/>    ['loss', 'mse'],<br/>    { height: 200, callbacks: ['onEpochEnd'] }<br/>  )<br/>});</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/98b9a5098f1c402b36e3536d29352df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*uY0BA-PCFKlqfDjImTqhLg.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Adam optimizer minimizing MSE over 250 iterations.</figcaption></figure><p id="9f5c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">示威游行</strong></p><p id="aa4b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">培训之后，你将能够创建自己的用户界面并测试ML模型！</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/595cf7ef1d6724d9e35fac70eeef183a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gy7fuhnjueyama1qRHapPQ.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Prediction capability after training the model</figcaption></figure><p id="42f2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">资源</strong></p><p id="b94d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">演示链接:<a class="ae it" href="https://ohyicong.github.io/portfolio/autocomplete_model.html" rel="noopener ugc nofollow" target="_blank">https://ohyi cong . github . io/portfolio/autocomplete _ model . html</a></p><p id="d20c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">源代码:<a class="ae it" href="https://gist.github.com/ohyicong/b1e9dab5eec6371b404dbe603ac4685d" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/oh yi cong/B1 e 9 dab 5 EEC 6371 b 404 DBE 603 AC 4685d</a></p></div></div>    
</body>
</html>