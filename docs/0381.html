<html>
<head>
<title>Surprising behaviour of the average nearest neighbour distance in a cluster of points</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">点群中平均最近邻距离的惊人行为</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/surprising-behaviour-of-the-average-nearest-neighbour-distance-in-a-cluster-of-points-dce671b86c3b?source=collection_archive---------2-----------------------#2021-04-02">https://medium.com/mlearning-ai/surprising-behaviour-of-the-average-nearest-neighbour-distance-in-a-cluster-of-points-dce671b86c3b?source=collection_archive---------2-----------------------#2021-04-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="a6b9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="9244" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我盯着点缀着不同密度的椒盐噪声的图像。一些很自然的问题在我脑海里蹦了出来——当这些点越来越拥挤时，它们之间的距离会发生什么变化？如果我们要定义一个度量来衡量点与点之间的接近程度，比如说<em class="ka">平均最近邻距离</em>，那么这个度量随着点密度的增加会如何表现呢？</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es kb"><img src="../Images/c467537fe5c7e7913b1e45fc99f684d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/0*UZh9K-4JbAzVaw1D.png"/></div></figure><p id="bde9" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><em class="ka">椒盐比例=0.6的图像</em></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es kb"><img src="../Images/eb1df3e935d8c996e348dbf662ee46ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/0*PeA1R3gJaMfXfOWU.png"/></div></figure><p id="1e01" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><em class="ka">椒盐比例=0.90的图像</em></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es kb"><img src="../Images/0f2bcc723b61622af874f890193d2e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/0*Dk_r4u7BcDi13UR_.png"/></div></figure><p id="0198" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><em class="ka">椒盐比例=0.99的图像</em></p><p id="cb3a" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated">盐和胡椒的比例被定义为随机选择的像素颜色为白色(盐)的概率。该值越高，黑色像素的数量就越少，因此这些点看起来相距更远。椒盐噪声只能应用于任何图像，即彩色或灰度。我们将限制我们的例子，只有单色图像。像素只能是白色或黑色。</p></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="bd09" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">了解最近邻距离</h1><p id="6ba3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">请考虑此图像中显示的点。根据定义，每个点都有一个最近的点。您可能有多个等距的点，因此有多个最近的邻居。但是对于这个讨论，我们将选择最近的邻居。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es la"><img src="../Images/684715dce41fa8f6dde79614b99ad31c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/0*3gzFnNcEX0_KhpBn.png"/></div></figure><ol class=""><li id="3025" class="lb lc hh je b jf kj jj kk jn ld jr le jv lf jz lg lh li lj bi translated">点2是点1的最近邻</li><li id="6356" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated">点2是点4的最近邻，反之亦然</li><li id="da12" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated">点4是点3的最近邻点</li><li id="2ee5" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated">点4是点5的最近邻点</li></ol><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/cfe8ded5215ed9c8b7e69bdb512810a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bj6OpP0sveL-_-4Z.png"/></div></div></figure></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="b0f7" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">从单位正方形中的两点开始</h1><p id="6bf1" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这是一个经典问题。在一个边长为1的正方形中，随机选择的两个点之间的预期距离是多少？</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lu"><img src="../Images/9198a1811028389478102656335bd75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QaiLyqyClRJz_dss.png"/></div></div></figure><p id="579a" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated">这个问题的数学解并不简单，我将不再讨论细节。关于这个主题的精彩论文可以在这里找到。根据同一篇文章，我给出了下面的等式，这是我们问题的解决方案。预期距离结果为<strong class="je hi"> 0.5214 </strong>。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es lw"><img src="../Images/4bb73f9502f1a6bf4941a5fcf1576708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/0*BrAeNnsX_eGzKeYW.png"/></div></figure></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="d29c" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">计算随机两点间期望距离的蒙特卡罗方法</h1><pre class="kc kd ke kf fd lx ly lz ma aw mb bi"><span id="e9d9" class="mc if hh ly b fi md me l mf mg">import datetime<br/>import math<br/>import numpy as np<br/>import random<br/>import statistics<br/></span><span id="2469" class="mc if hh ly b fi mh me l mf mg">#<br/>#Pick 2 randmom points, compute the distance and repeat several times. <br/>#Compute average of all distances<br/>#<br/>def compute_expected_distance_between_2points_n_trials(max_trials:int):<br/>    seed=datetime.datetime.now().second<br/>    random.seed(seed)<br/>    distances=[]<br/>    for i in range(0,max_trials):<br/>        x1=random.random()<br/>        y1=random.random()<br/>        x2=random.random()<br/>        y2=random.random()</span><span id="d456" class="mc if hh ly b fi mh me l mf mg">        distance=math.sqrt( (x1-x2)**2 + (y1-y2)**2 )<br/>        distances.append(distance)<br/>    return statistics.mean(distances)</span><span id="e0b3" class="mc if hh ly b fi mh me l mf mg">iterations=100000<br/>average=compute_expected_distance_between_2points_n_trials(10000)<br/>print("Average=%f after iterations=%d" % (average,iterations))</span></pre><p id="8890" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated">在这个简单的Python程序中，我们生成随机点对，并使用毕达哥拉斯定理计算距离。用100000次迭代运行上述程序，我得到的值是0.522079，非常接近理论值0.5214</p></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="c86b" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">如果我们增加点数会发生什么？</h1><p id="f284" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们不会试图创造一个理论模型。相反，我们将编写一个简单的Python程序，用不同密度的点进行蒙特卡罗模拟。我们将逐渐增加点数，在每个阶段，我们将生成N个随机点。我们将使用<em class="ka"> scitkit-learn </em>的<em class="ka"> KDTree </em>类来计算平均最近邻距离。对于每个N，我们将重复试验并计算平均值。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mi"><img src="../Images/73fa81d865fb7e2365ff55f014f5dd1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lG2UamjKHtWsg_zn.png"/></div></div></figure><pre class="kc kd ke kf fd lx ly lz ma aw mb bi"><span id="a274" class="mc if hh ly b fi md me l mf mg">#<br/>#We will select N randmon points in an unit square and then compute the mean nearest-neighbour distance<br/>#We will then plot the mean NN distance vs N<br/>#<br/>#</span><span id="0ac0" class="mc if hh ly b fi mh me l mf mg">from typing import List<br/>import numpy as np<br/>import os<br/>import random<br/>from numpy.core.fromnumeric import mean<br/>from skimage import io<br/>from sklearn.neighbors import KDTree<br/>import math<br/>import statistics<br/>import matplotlib.pyplot as plt<br/></span><span id="767e" class="mc if hh ly b fi mh me l mf mg">class NearestNeighbourDistance(object):<br/>    """docstring for NearestNeighbourDistance."""<br/>    def __init__(self, squaresize:float,point_count:int, iterations:int):<br/>        super(NearestNeighbourDistance, self).__init__()<br/>        self.__squaresize=squaresize<br/>        self.__point_count=point_count<br/>        self.__iterations=iterations<br/>    <br/>    def compute_mean(self):<br/>        means_across_iterations=[]<br/>        for iteration in range(0,self.__iterations):<br/>            random_array=np.random.random((self.__point_count,2))<br/>            tree = KDTree(random_array)<br/>            nearest_dist, nearest_ind = tree.query(random_array, k=2)  # k=2 nearest neighbors where k1 = identity<br/>            mean_distances_current_iterations=list(nearest_dist[0:,1:].flatten())<br/>            mean=statistics.mean(mean_distances_current_iterations)<br/>            means_across_iterations.append(mean)<br/>        return statistics.mean(means_across_iterations)</span><span id="385d" class="mc if hh ly b fi mh me l mf mg">def plot(points_count:List,  means:List):<br/>    plt.scatter(points_count,means, marker='.', s=5)<br/>    plt.grid(b=True, which='major', color='#666666', linestyle='-')</span><span id="3861" class="mc if hh ly b fi mh me l mf mg">    plt.show()<br/>    pass<br/></span><span id="dc71" class="mc if hh ly b fi mh me l mf mg">lst_pointcount=[]<br/>lst_meandistance=[]<br/>iterations=50<br/>for point_count in range(2,1000):<br/>    nn=NearestNeighbourDistance(squaresize=1,point_count=point_count,iterations=iterations)<br/>    mean_distance=nn.compute_mean()<br/>    lst_pointcount.append(point_count)<br/>    lst_meandistance.append(mean_distance)<br/>    print("Computed mean NN distance of %f for %d points" % (mean_distance,point_count))</span><span id="2b8b" class="mc if hh ly b fi mh me l mf mg">plot(lst_pointcount, lst_meandistance)</span></pre></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="4d0e" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">为什么平均邻居距离呈现这样的分布？</h1><p id="839a" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们可以看到，在N=2时，平均值为<em class="ka"> 0.5214 </em>。随着N的增加，平均距离迅速下降，然后趋于平稳。我们能设计出一个简单的数学模型来解释这种行为吗？</p></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="4309" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">找到一个简单的数学模型</h1><p id="c17c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们将做一些近似。考虑一个N=4点，N=9点的正方形。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mj"><img src="../Images/4c11fda9df30f6142f4ef49dcdc1eed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F0ENEVLyD7v2oWHx.png"/></div></div></figure><p id="b974" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><em class="ka"> N=4，平均最近邻距离=1/3 </em></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mk"><img src="../Images/6424575850b8550632f7b1c79eb7f42c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BgzJKziw3Gv9rUGL.png"/></div></div></figure><p id="4919" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><em class="ka"> N=9，平均最近邻距离=1/4 </em></p><p id="4bea" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated">从上面推断，我们可以看到下面的模式出现。显然，这对于<em class="ka"> n=2 </em>是不成立的，因为我们有一个之前讨论过的严格公式。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ml"><img src="../Images/12c6a10812494b10b11b18dd109fc620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9JcB0wQ82VFVpXUw.png"/></div></div></figure></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h1 id="4d2f" class="ie if hh bd ig ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb bi translated">绘制简单数学模型与点数(N)的关系</h1><p id="064c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们可以清楚地看到，这条曲线展示了我们从蒙特卡罗模拟中获得的相同特征，即急剧下降，然后变平。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mi"><img src="../Images/87925858cd63e66629d6be9e88515d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*La4ES7S3gYX_CLXS.PNG"/></div></div></figure><pre class="kc kd ke kf fd lx ly lz ma aw mb bi"><span id="e9f2" class="mc if hh ly b fi md me l mf mg">from typing import List<br/>import numpy as np<br/>import math<br/>import matplotlib.pyplot as plt<br/></span><span id="6fb0" class="mc if hh ly b fi mh me l mf mg">def plot(points_count:List,  means:List):<br/>    plt.ylim([0, 0.5])<br/>    plt.scatter(points_count,means, marker='.', s=5)<br/>    plt.grid(b=True, which='major', color='#666666', linestyle='-')</span><span id="5987" class="mc if hh ly b fi mh me l mf mg">    plt.show()<br/>    pass</span><span id="eb26" class="mc if hh ly b fi mh me l mf mg">lst_pointcount=[]<br/>lst_meandistance=[]<br/>for point_count in range(2,2000):<br/>    mean_distance=1/(math.sqrt(point_count)+1)<br/>    lst_pointcount.append(point_count)<br/>    lst_meandistance.append(mean_distance)<br/>    print("Computed mean NN distance of %f for %d points" % (mean_distance,point_count))</span><span id="d4ea" class="mc if hh ly b fi mh me l mf mg">plot(lst_pointcount, lst_meandistance)</span></pre><h1 id="f68f" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">吸取的教训和结论</h1><p id="90a4" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们最初的任务是什么？ <br/>我们检查了带有椒盐噪声的图像，并着手了解最近邻距离如何随着点密度的增加而变化</p><p id="ed79" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><strong class="je hi">单位正方形中的2个随机点会发生什么？</strong> <br/>数学已经给了我们一个强有力的理论模型，证明这个距离是<em class="ka"> 0.5214 </em>。我们也将通过蒙特卡洛模拟得出这个数字</p><p id="2611" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated"><strong class="je hi">N个随机点会怎么样？</strong> <br/>我们做了一个蒙特卡洛模拟。然后我们创建了一个近似模型。这两个模型显示了相同的趋势。</p><p id="a22d" class="pw-post-body-paragraph jc jd hh je b jf kj jh ji jj kk jl jm jn kl jp jq jr km jt ju jv kn jx jy jz ha bi translated">我们如何计算一个点的最近邻距离？<br/>sci kite-learn库的<em class="ka"> KDtree </em>类使这变得非常简单和高效。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mk"><img src="../Images/90bf306a05221b218b31c08a53b409d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yuo0ftPKv7t2XY8s.png"/></div></div></figure></div></div>    
</body>
</html>