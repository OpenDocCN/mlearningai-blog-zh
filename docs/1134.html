<html>
<head>
<title>💪Using Bicep to create and attach an Azure Kubernetes Cluster to Azure Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Bicep创建Azure Kubernetes集群并将其附加到Azure机器学习</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/using-bicep-to-create-and-attach-an-azure-kubernetes-cluster-to-azure-machine-learning-eb6c691df3c7?source=collection_archive---------4-----------------------#2021-10-08">https://medium.com/mlearning-ai/using-bicep-to-create-and-attach-an-azure-kubernetes-cluster-to-azure-machine-learning-eb6c691df3c7?source=collection_archive---------4-----------------------#2021-10-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="65bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">了解如何利用Bicep为Azure机器学习创建Azure Kubernetes集群。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/b27af341b2a251d44a3668baf4b983af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TSayZ-M35KkKV7EOtK-QA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Using Bicep to create and attach an Azure Kubernetes Cluster to Azure Machine Learning</figcaption></figure></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="f860" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你已经在使用Azure机器学习服务，你可以将一个训练好的模型部署到Azure Kubernetes服务。</p><p id="790b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Azure Machine Learning </strong>是一款用于加速和管理机器学习项目生命周期的云服务。</p><p id="f937" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在以前的文章中描述了如何使用Bicep部署使用Azure机器学习所需的所有组件。您需要具备:</p><ul class=""><li id="50f3" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">一个蔚蓝色的机器学习<a class="ae ki" rel="noopener" href="/codex/using-bicep-to-create-workspace-resources-and-get-started-with-azure-machine-learning-bcc57fd4fd09?source=user_profile---------2----------------------------">工作区</a></li><li id="59ab" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">Azure机器学习<a class="ae ki" rel="noopener" href="/codex/create-an-azure-machine-learning-compute-instance-using-azure-bicep-491783578656?source=user_profile---------1----------------------------">计算节点</a>用于您的开发环境</li><li id="75cf" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated"><a class="ae ki" rel="noopener" href="/codex/create-an-azure-machine-learning-compute-cluster-using-azure-bicep-dd43f367f36a?source=user_profile---------0----------------------------">计算集群</a>用于提交训练运行。</li><li id="958f" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">你的模特。点击查看如何训练TensorFlow模型<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-train-tensorflow?WT.mc_id=AZ-MVP-5000671" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="c569" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在这里了解Azure机器学习<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-azure-machine-learning-architecture?WT.mc_id=AZ-MVP-5000671" rel="noopener ugc nofollow" target="_blank">的架构和概念。</a></p><p id="b993" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了AzureMachine Learning的高级架构参考:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ko"><img src="../Images/5b5e5bca1c52c406eff4fed5f27e466b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRAcBV-FaKfFf5-hOdi6hw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx"><a class="ae ki" href="https://docs.microsoft.com/en-us/azure/machine-learning/media/concept-azure-machine-learning-architecture/architecture.svg?WT.mc_id=AZ-MVP-5000671" rel="noopener ugc nofollow" target="_blank">MS Docs — Azure Machine Learning Architecture</a></figcaption></figure><p id="e8c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文旨在向您展示如何将Azure Kubernetes集群部署到Azure机器学习服务中。</p><p id="8a91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要部署Azure Kubernetes集群，我们有两个选择:我们可以从Azure机器学习工作区创建一个新的Azure Kubernetes集群，或者附加一个现有的Azure Kubernetes集群。</p><p id="e7a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了这个用例，我们将创建一个新的Azure Kubernetes集群。</p><p id="ac29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将执行以下操作:</p><ul class=""><li id="4106" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">创建Azure机器学习工作区。</li><li id="bcaa" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">创建一个新的Azure Kubernetes集群，并将其附加到工作区</li></ul><h1 id="6d1c" class="kp kq hh bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">创建Azure机器学习工作区。</h1><p id="172c" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">我们将使用下面的代码来创建我们的Azure机器学习工作区。详细流程可以参考这篇<a class="ae ki" href="https://blog.azinsider.net/using-bicep-to-create-workspace-resources-and-get-started-with-azure-machine-learning-bcc57fd4fd09" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><p id="2017" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是部署Azure机器学习工作区的完整Bicep代码:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="5b0e" class="lx kq hh lt b fi ly lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the name of the deployment.')<br/>param name string</span><span id="a7ce" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the name of the environment.')<br/>param environment string</span><span id="36c9" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the location of the Azure Machine Learning workspace and dependent resources.')<br/>param location string = resourceGroup().location</span><span id="9cba" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies whether to reduce telemetry collection and enable additional encryption.')<br/>param hbi_workspace bool = false</span><span id="47fa" class="lx kq hh lt b fi mc lz l ma mb">var tenantId = subscription().tenantId<br/>var storageAccountName_var = 'st${name}${environment}'<br/>var keyVaultName_var = 'kv-${name}-${environment}'<br/>var applicationInsightsName_var = 'appi-${name}-${environment}'<br/>var containerRegistryName_var = 'cr${name}${environment}'<br/>var workspaceName_var = 'mlw${name}${environment}'<br/>var storageAccount = storageAccountName.id<br/>var keyVault = keyVaultName.id<br/>var applicationInsights = applicationInsightsName.id<br/>var containerRegistry = containerRegistryName.id</span><span id="d8e0" class="lx kq hh lt b fi mc lz l ma mb">resource storageAccountName 'Microsoft.Storage/storageAccounts@2021-01-01' = {<br/>  name: storageAccountName_var<br/>  location: location<br/>  sku: {<br/>    name: 'Standard_RAGRS'<br/>  }<br/>  kind: 'StorageV2'<br/>  properties: {<br/>    encryption: {<br/>      services: {<br/>        blob: {<br/>          enabled: true<br/>        }<br/>        file: {<br/>          enabled: true<br/>        }<br/>      }<br/>      keySource: 'Microsoft.Storage'<br/>    }<br/>    supportsHttpsTrafficOnly: true<br/>  }<br/>}</span><span id="d04f" class="lx kq hh lt b fi mc lz l ma mb">resource keyVaultName 'Microsoft.KeyVault/vaults@2021-04-01-preview' = {<br/>  name: keyVaultName_var<br/>  location: location<br/>  properties: {<br/>    tenantId: tenantId<br/>    sku: {<br/>      name: 'standard'<br/>      family: 'A'<br/>    }<br/>    accessPolicies: []<br/>    enableSoftDelete: true<br/>  }<br/>}</span><span id="d242" class="lx kq hh lt b fi mc lz l ma mb">resource applicationInsightsName 'Microsoft.Insights/components@2020-02-02' = {<br/>  name: applicationInsightsName_var<br/>  location: (((location == 'eastus2') || (location == 'westcentralus')) ? 'southcentralus' : location)<br/>  kind: 'web'<br/>  properties: {<br/>    Application_Type: 'web'<br/>  }<br/>}</span><span id="fc69" class="lx kq hh lt b fi mc lz l ma mb">resource containerRegistryName 'Microsoft.ContainerRegistry/registries@2019-12-01-preview' = {<br/>  sku: {<br/>    name: 'Standard'<br/>  }<br/>  name: containerRegistryName_var<br/>  location: location<br/>  properties: {<br/>    adminUserEnabled: true<br/>  }<br/>}</span><span id="1ff8" class="lx kq hh lt b fi mc lz l ma mb">resource workspaceName 'Microsoft.MachineLearningServices/workspaces@2021-07-01' = {<br/>  identity: {<br/>    type: 'SystemAssigned'<br/>  }<br/>  name: workspaceName_var<br/>  location: location<br/>  properties: {<br/>    friendlyName: workspaceName_var<br/>    storageAccount: storageAccount<br/>    keyVault: keyVault<br/>    applicationInsights: applicationInsights<br/>    containerRegistry: containerRegistry<br/>    hbiWorkspace: hbi_workspace<br/>  }<br/>  dependsOn: [<br/>    storageAccountName<br/>    keyVaultName<br/>    applicationInsightsName<br/>    containerRegistryName<br/>  ]<br/>}</span></pre><p id="bb7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，我们定义了以下资源:</p><ul class=""><li id="d6c4" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">存储帐户</li><li id="7184" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">钥匙库</li><li id="6a1f" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">应用洞察</li><li id="da05" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">集装箱登记处</li><li id="6f7f" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">机器学习服务工作空间</li></ul><p id="62f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们将使用下面的命令部署上面的Bicep文件来创建我们的Azure机器学习工作区:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="5a95" class="lx kq hh lt b fi ly lz l ma mb">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName AzInsiderML -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="b574" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意我们添加了标志-C来预览我们的部署。一旦部署有效，我们就可以执行它。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/a8a78216d39d2e7f8b9e1c2984a778b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSXvto7GLb498ga0dQkVMw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Machine Learning Workspace — Deployment preview</figcaption></figure><p id="c217" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了部署输出:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/0c0c1308feb479e4fb7fd66f00f4d326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vaz8aIa9zFnePzLCW3zo_g.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Machine Learning Workspace — Deployment output</figcaption></figure><p id="c811" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了创建的资源:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mf"><img src="../Images/e5ddbdff3539824ddc33647dc9157f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s4TLBaTkmCRjhcOfvWFJ5A.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Machine Learning Workspace deployment</figcaption></figure><p id="a1a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步是创建一个新的Azure Kubernetes集群，并将其附加到工作区。</p><h1 id="4609" class="kp kq hh bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">创建一个新的Azure Kubernetes集群，并将其附加到工作区</h1><p id="637d" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">我们需要传递两个参数值:Azure机器学习工作区的名称和Azure Kubernetes集群的名称。</p><p id="7e31" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面的代码显示了我们将在部署时传递的参数文件的定义:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="9790" class="lx kq hh lt b fi ly lz l ma mb">{<br/>    "$schema": "<a class="ae ki" href="https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</a>",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>      "workspaceName": {<br/>        "value": "YOUR-WORKSPACE-NAME"<br/>      },<br/>      "computeName": {<br/>        "value": "COMPUTE-NAME"<br/>      }<br/>    }<br/>  }</span></pre><p id="b533" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将定义二头肌模板。在这个文件中，我们将定义以下参数:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="a9f4" class="lx kq hh lt b fi ly lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param computeName string</span><span id="c2d7" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param dnsServiceIP string = ''</span><span id="45a9" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the resource group which holds the VNET to which you want to inject your compute in.')<br/>param vnetResourceGroupName string = ''</span><span id="ed60" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the vnet which you want to inject your compute in.')<br/>param vnetName string = ''</span><span id="98de" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the subnet inside the VNET which you want to inject your compute in.')<br/>param subnetName string = ''</span><span id="67bf" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param location string = resourceGroup().location</span><span id="9beb" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param dockerBridgeCidr string = ''</span><span id="f564" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param serviceCidr string = ''</span><span id="8541" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The Azure VM size of the agent VM nodes. This cannot be changed once the cluster is created.')<br/>param agentVmSize string = 'Standard_D4_v3'</span><span id="740a" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The number of agent nodes in the Container Service..')<br/>param agentCount int = 6</span><span id="8155" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The SSL cert data in PEM format encoded as base64 string')<br/>param cert string = ''</span><span id="cf77" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The SSL key data in PEM format encoded as base64 string.')<br/>param key string = ''</span><span id="483d" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The CName of the cert.')<br/>param cname string = ''</span><span id="1e0e" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The leaf domain label of public endpoint.')<br/>param leafDomainLabel string = ''</span><span id="1075" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Value indicating whether to overwrite existing domain label.')<br/>param overwriteExistingDomain bool = false</span><span id="3899" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Value indicating whether to renew certificate.')<br/>param renew bool = false</span><span id="39f6" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/allowed" rel="noopener ugc nofollow" target="_blank">@allowed</a>([<br/>  'Enabled'<br/>  'Disabled'<br/>  'Auto'<br/>])<br/><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('SSL status. Allowed values are Enabled and Disabled.')<br/>param sslStatus string = 'Disabled'</span><span id="9e34" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param workspaceName string</span></pre><p id="5227" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将定义两个变量:</p><ul class=""><li id="45b8" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">网络配置的变量</li><li id="3372" class="jz ka hh ig b ih kj il kk ip kl it km ix kn jb ke kf kg kh bi translated">SSL配置的变量</li></ul><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="1cf1" class="lx kq hh lt b fi ly lz l ma mb">var aksNetworkingConfiguration = {<br/>  subnetId: resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)<br/>  serviceCidr: serviceCidr<br/>  dnsServiceIP: dnsServiceIP<br/>  dockerBridgeCidr: dockerBridgeCidr<br/>}<br/>var sslConfiguration = {<br/>  status: sslStatus<br/>  cert: cert<br/>  key: key<br/>  cname: cname<br/>  leafDomainLabel: leafDomainLabel<br/>  overwriteExistingDomain: overwriteExistingDomain<br/>  renew: renew<br/>}</span></pre><p id="2b30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们将定义Azure Kubernetes集群:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="f9cd" class="lx kq hh lt b fi ly lz l ma mb">resource workspaceName_computeName 'Microsoft.MachineLearningServices/workspaces/computes@2021-01-01' = {<br/>  name: '${workspaceName}/${computeName}'<br/>  location: location<br/>  properties: {<br/>    computeType: 'AKS'<br/>    properties: {<br/>      agentVmSize: agentVmSize<br/>      agentCount: agentCount<br/>      sslConfiguration: ((sslStatus == 'Disabled') ? json('null') : sslConfiguration)<br/>      aksNetworkingConfiguration: (((!empty(vnetResourceGroupName)) &amp;&amp; (!empty(vnetName)) &amp;&amp; (!empty(subnetName)) &amp;&amp; (!empty(serviceCidr)) &amp;&amp; (!empty(dnsServiceIP)) &amp;&amp; (!empty(dockerBridgeCidr))) ? aksNetworkingConfiguration : json('null'))<br/>    }<br/>  }<br/>}</span></pre><p id="4a97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们不提供工作区的名称和属性来定义Azure Kubernetes集群。</p><p id="79da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将创建一个新的资源组，它将包含与Azure Kubernetes集群相关的所有资源。</p><p id="a01c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是创建Azure Kubernetes集群并将其附加到Azure机器学习的完整Bicep模板:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="f1f1" class="lx kq hh lt b fi ly lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param computeName string</span><span id="0e59" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param dnsServiceIP string = ''</span><span id="9f00" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the resource group which holds the VNET to which you want to inject your compute in.')<br/>param vnetResourceGroupName string = ''</span><span id="ce4a" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the vnet which you want to inject your compute in.')<br/>param vnetName string = ''</span><span id="4f1d" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the subnet inside the VNET which you want to inject your compute in.')<br/>param subnetName string = ''</span><span id="c610" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param location string = resourceGroup().location</span><span id="616e" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param dockerBridgeCidr string = ''</span><span id="86a3" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param serviceCidr string = ''</span><span id="d2c8" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The Azure VM size of the agent VM nodes. This cannot be changed once the cluster is created.')<br/>param agentVmSize string = 'Standard_D4_v3'</span><span id="e569" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The number of agent nodes in the Container Service..')<br/>param agentCount int = 6</span><span id="35df" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The SSL cert data in PEM format encoded as base64 string')<br/>param cert string = ''</span><span id="fe8b" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The SSL key data in PEM format encoded as base64 string.')<br/>param key string = ''</span><span id="2371" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The CName of the cert.')<br/>param cname string = ''</span><span id="35cb" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The leaf domain label of public endpoint.')<br/>param leafDomainLabel string = ''</span><span id="a1c4" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Value indicating whether to overwrite existing domain label.')<br/>param overwriteExistingDomain bool = false</span><span id="751b" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Value indicating whether to renew certificate.')<br/>param renew bool = false</span><span id="db28" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/allowed" rel="noopener ugc nofollow" target="_blank">@allowed</a>([<br/>  'Enabled'<br/>  'Disabled'<br/>  'Auto'<br/>])<br/><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('SSL status. Allowed values are Enabled and Disabled.')<br/>param sslStatus string = 'Disabled'</span><span id="d3a2" class="lx kq hh lt b fi mc lz l ma mb"><a class="ae ki" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The exposed port for the compute instance.')<br/>param workspaceName string</span><span id="7838" class="lx kq hh lt b fi mc lz l ma mb">var aksNetworkingConfiguration = {<br/>  subnetId: resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)<br/>  serviceCidr: serviceCidr<br/>  dnsServiceIP: dnsServiceIP<br/>  dockerBridgeCidr: dockerBridgeCidr<br/>}<br/>var sslConfiguration = {<br/>  status: sslStatus<br/>  cert: cert<br/>  key: key<br/>  cname: cname<br/>  leafDomainLabel: leafDomainLabel<br/>  overwriteExistingDomain: overwriteExistingDomain<br/>  renew: renew<br/>}</span><span id="7557" class="lx kq hh lt b fi mc lz l ma mb">resource workspaceName_computeName 'Microsoft.MachineLearningServices/workspaces/computes@2021-01-01' = {<br/>  name: '${workspaceName}/${computeName}'<br/>  location: location<br/>  properties: {<br/>    computeType: 'AKS'<br/>    properties: {<br/>      agentVmSize: agentVmSize<br/>      agentCount: agentCount<br/>      sslConfiguration: ((sslStatus == 'Disabled') ? json('null') : sslConfiguration)<br/>      aksNetworkingConfiguration: (((!empty(vnetResourceGroupName)) &amp;&amp; (!empty(vnetName)) &amp;&amp; (!empty(subnetName)) &amp;&amp; (!empty(serviceCidr)) &amp;&amp; (!empty(dnsServiceIP)) &amp;&amp; (!empty(dockerBridgeCidr))) ? aksNetworkingConfiguration : json('null'))<br/>    }<br/>  }<br/>}</span></pre><p id="6730" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们将使用以下命令部署该资源:</p><pre class="jd je jf jg fd ls lt lu lv aw lw bi"><span id="6782" class="lx kq hh lt b fi ly lz l ma mb">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName AzInsiderML -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="7f7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意我们添加了标志-C来预览我们的部署。一旦部署有效，我们就可以执行它。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mg"><img src="../Images/5156a5afd3499e241aa90f9ae2cf4ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIQks-QFoXjQwGv5VJzyoQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Machine Learning- Azure Kubernetes Cluster— Deployment preview</figcaption></figure><p id="e9d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建Azure Kubernetes集群可能需要几分钟时间。然后，您应该会看到新资源组中的资源，以及Azure Machine Learning Studio门户中的通知。</p><p id="04da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了部署的输出:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/a66bc1a99c3bd5e9ced1e712f5306d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HvJD83C6u4FsTl57E-qddQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Kubernetes Cluster — Deployment output</figcaption></figure><p id="a968" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了Azure Machine Learning Studio中的通知，即已经创建了一个新的Azure Kubernetes集群。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mi"><img src="../Images/2ee6c655d93440fbe464dfae8ab62e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQOG-KzuC13cEVTwtCg41A.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Machine Learning Studio- Compute provisioning succeeded.</figcaption></figure><p id="82d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们检查此通知，您将看到有关Kubernetes服务的分配和计算类型的详细信息。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/f148791c3e27b7890d2eced3fa887e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6amMppdk9KA1WLrT81iIw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Kubernetes Cluster in Azure Machine Learning Studio</figcaption></figure><p id="d71c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您还可以验证与Azure Kubernetes群集相关的资源是否位于不同的资源组中。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mk"><img src="../Images/d82f76139eae1b37ae4864ebef97e70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2fvfxjZ_F0cTvTAZqUZkA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Azure Resource Group — Azure Kubernetes Cluster resources</figcaption></figure><p id="af7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望这能帮助你自动化你的Azure机器学习计算资源。</p><p id="4b22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae ki" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="ml">在此加入</em><strong class="ig hi"><em class="ml">azin sider</em></strong><em class="ml">邮箱列表。</em>T9】</a></p><p id="1d06" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ml">-戴夫·r·</em></p></div></div>    
</body>
</html>