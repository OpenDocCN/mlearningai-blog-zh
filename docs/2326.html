<html>
<head>
<title>Switching between TensorFlow and PyTorch with ONNX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ONNX在TensorFlow和PyTorch之间切换</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/switching-between-tensorflow-and-pytorch-with-onnx-86f0b1b4cff9?source=collection_archive---------1-----------------------#2022-04-15">https://medium.com/mlearning-ai/switching-between-tensorflow-and-pytorch-with-onnx-86f0b1b4cff9?source=collection_archive---------1-----------------------#2022-04-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="3596" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">无限制地使用你喜欢的人工智能框架</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/89c0ef62b82c2e4cb1479e7cc3da730a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YqarLZ5N8lqFh0lg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@herfrenchness?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clarisse Croset</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4f7d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">随着机器学习模型变得越来越大，越来越复杂，建立模型的时间和材料成本往往要求你的项目在一个框架下保持一致。<a class="ae jm" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>和<a class="ae jm" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>是人工智能和机器学习领域最流行的两个框架，尤其是对于深度学习社区。</p><p id="82ce" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Tensorflow和PyTorch之间的选择通常可以归结为您对每个框架或公司和行业标准中的开发和生产流程的熟悉程度。然而，从易用性和部署基础设施到可用的生态系统支持，每个框架都有一定的优势。</p><p id="bc87" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Tensorflow较老，对其他语言(Tensorflow.js、Swift)有更多支持，内置API和生产工具，如TFServing、TFX和TFLite，可简化跨本地、云、物联网和移动平台的模型部署。Tensorflow还拥有更广泛的生态系统，其中包含特定于用例的深度学习应用程序(文本、图像、音频和视频)，可以跨平台集成。</p><p id="522b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">PyTorch显然更容易学习和使用，至少对于Python程序员来说是这样。它有一个更快的模型开发过程，其CUDA后端和有效的内存使用。这使得它成为大多数研究人员或OpenAI等开源组织构建模型的首选。这反过来意味着更多预先训练的最先进的模型是PyTorch独有的。</p><p id="0c6a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">普遍的看法是，如果你在研究领域构建模型，PyTorch是适合你的框架，而如果你在行业内工作或想以任何方式部署你的模型，Tensorflow是理想的选择。但是，可以使用PyTorch进行开发，使用<a class="ae jm" href="https://onnx.ai/" rel="noopener ugc nofollow" target="_blank"> ONNX </a>使用Tensorflow进行部署。</p><p id="4e12" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">本文展示了使用ONNX在框架之间转换模型的能力。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="5008" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">ONNX简介</h1><p id="fdcb" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">开放神经网络交换(ONNX)是一个开源生态系统，它使AI开发人员能够为他们的项目使用最有效的工具，而不用担心生产兼容性和下游部署。它为您的人工智能模型提供了一种通用格式，无论是深度学习还是其他方式，实现了不同框架和硬件优化之间的互操作性。</p><p id="add6" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">ONNX抽象了框架之间的相似性，创建了一个带有内置操作符和数据类型的标准模型定义。该平台目前支持几个人工智能框架来构建、部署、优化和可视化你的模型。</p><h2 id="9531" class="ln kr hh bd ks lo lp lq kw lr ls lt la jw lu lv lc ka lw lx le ke ly lz lg ma bi translated">使用ONNX</h2><p id="c051" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">作为一名从事计算机视觉项目的研究人员，该项目旨在对处于不同健康阶段的植物进行分类。您可能希望利用PyTorch的易用性和速度来迭代深度学习模型的开发过程。但是，您当前的后端模型部署流程仅限于利用Tensorflow服务的广泛性的Tensorflow特定格式，</p><p id="b6fe" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">您可以使用PyTorch训练您的模型，并使用“torch.save”功能保存模型</p><pre class="ix iy iz ja fd mb mc md me aw mf bi"><span id="3c85" class="ln kr hh mc b fi mg mh l mi mj">torch.save(your_model.state_dict(), ‘your_model.pth’)</span></pre><p id="868a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后利用PyTorch的内置<a class="ae jm" href="https://pytorch.org/docs/stable/onnx.html" rel="noopener ugc nofollow" target="_blank"> ONNX exporter </a>以包含模型架构和参数的ONNX格式表示您的模型。</p><pre class="ix iy iz ja fd mb mc md me aw mf bi"><span id="e8c3" class="ln kr hh mc b fi mg mh l mi mj">trained_model = model()<br/>trained_model.load_state_dict(torch.load(your_model.pth’))</span><span id="9848" class="ln kr hh mc b fi mk mh l mi mj">dummy_input = Variable(torch.randn(1,3,128,128))</span><span id="af54" class="ln kr hh mc b fi mk mh l mi mj">torch.onnx.export(trained_model, dummy_input, “your_model.onnx”)</span></pre><p id="34b4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">注意</strong> : ONNX不仅仅是一种方便的模型格式，你可以通过<a class="ae jm" href="https://onnxruntime.ai/" rel="noopener ugc nofollow" target="_blank"> ONNXRuntime </a>来利用这种格式的模型进行更快的重新训练和推理过程。</p><p id="36fc" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下一步是将模型从ONNX格式转换为Tensorflow模型格式。您可以使用<a class="ae jm" href="https://github.com/onnx/onnx-tensorflow" rel="noopener ugc nofollow" target="_blank"> ONNX Tensorflow后端</a>包，该包支持ONXX到Tensorflow的兼容性。</p><pre class="ix iy iz ja fd mb mc md me aw mf bi"><span id="afa7" class="ln kr hh mc b fi mg mh l mi mj">import onnx<br/>from onnx_tf.backend import prepare</span><span id="72f5" class="ln kr hh mc b fi mk mh l mi mj">onnx_model = onnx.load('your_model.onnx')<br/>tf_rep = prepare(onnx_model)</span></pre><p id="e5ee" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这将输出一个张量流模型表示，然后可用于推理或部署。</p><p id="134c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">注意</strong>:这里你已经看到了从PyTorch到ONNX到Tensorflow的转换，使用<a class="ae jm" href="https://github.com/onnx/tensorflow-onnx/" rel="noopener ugc nofollow" target="_blank"> Tensorflow到ONNX </a>和<a class="ae jm" href="https://github.com/ToriML/onnx2pytorch" rel="noopener ugc nofollow" target="_blank"> ONNX到PyTorch </a>工具也可以完成相反的转换。</p><h1 id="4ebb" class="kq kr hh bd ks kt ml kv kw kx mm kz la in mn io lc iq mo ir le it mp iu lg lh bi translated">结论</h1><p id="3986" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">本文简要介绍了ONNX及其实现AI框架和工具之间互操作性的方法。在本文中，我展示了在PyTorch和ONNX之间交换AI模型的简单过程，使用了不到十行代码。</p><p id="c651" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你可以在这个<a class="ae jm" href="https://github.com/Soot3/Farmer_TK_Notebooks/blob/main/notebooks/potato-model.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中找到从PyTorch训练到Tensorflow推理的完整代码样本。</p><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hi fi z dy my ea eb mz ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh jg mt"/></div></div></a></div></div></div>    
</body>
</html>