<html>
<head>
<title>Stop browsing, here’s the example you need (GoogleDrive API + Python)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止浏览，这里有你需要的例子(GoogleDrive API + Python)</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/stop-browsing-heres-the-example-you-need-googledrive-api-python-5b3d3075baaa?source=collection_archive---------5-----------------------#2022-01-22">https://medium.com/mlearning-ai/stop-browsing-heres-the-example-you-need-googledrive-api-python-5b3d3075baaa?source=collection_archive---------5-----------------------#2022-01-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/cbb8b8e03dc8255fa829ed71931414e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMM8kkirRLyjtbp1kbUg6Q.png"/></div></div></figure><div class=""/><p id="45bd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章包含了一个非常有用的使用Google Drive API + Python处理文件的例子。希望对你有帮助！</p><p id="7d60" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">动机:我很难用谷歌提供的API找到一个关于列表、创建、更新等文件的清晰实现。</p><p id="f478" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">背景:</strong>在我目前的工作中，我的团队不得不减少在Google Drive上管理文件的人力。所以我开始写脚本。注意，这篇文章只是用html文件来解释你，但是代码片段和其他格式是一样的。</p><p id="cabd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">问题:</strong>潜入<a class="ae jn" href="https://developers.google.com/drive/api/v3/about-sdk" rel="noopener ugc nofollow" target="_blank">谷歌提供的文档</a>，收录的例子自己都不满意。同样的事情也发生在其他博客和Stackoverflow的Q &amp; A上。我所发现的，并没有解释应该关注的最重要的方面。</p><p id="e16b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">假设</strong>:你是一个大开发者，虽然你不知道如何创建Google API密匙，但你的背包里有成吨的文档，所以如果你遵循这个<a class="ae jn" href="https://developers.google.com/workspace/guides/configure-oauth-consent" rel="noopener ugc nofollow" target="_blank"> gude </a>，我相信你不会有任何问题。</p><p id="86dc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从这个开始。</p><p id="d4cb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">导入我们的库(建议:阅读<a class="ae jn" href="https://pycqa.github.io/isort/" rel="noopener ugc nofollow" target="_blank">或</a>文档。它有助于您改进代码)</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="2b13" class="jx jy hs jt b fi jz ka l kb kc"># Built in packages<br/>import time</span><span id="363f" class="jx jy hs jt b fi kd ka l kb kc"># Third party packages<br/>import pandas as pd<br/>from apiclient.http import MediaFileUpload</span><span id="4910" class="jx jy hs jt b fi kd ka l kb kc"># Credentials storaged local<br/>from googleapiclient.discovery import build<br/>from oauth2client.service_account import ServiceAccountCredentials</span><span id="9e1a" class="jx jy hs jt b fi kd ka l kb kc"># Local packages<br/>#credentials stored local<br/>from .credentials import gcp_credentials</span><span id="6a19" class="jx jy hs jt b fi kd ka l kb kc"># In my case, i handle with html files.<br/>FILE_NAME = 'file_name.html'</span></pre><p id="7d0b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是我还没找到的最重要的提示之一:确保你的文件存在于你指向的回购协议中。这个API不够智能，无法识别您的文件是否已经在它的repo中。所以如果没有，那就创造。如果是，更新。(没有人期望找到重复的文件)</p><p id="64c7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">加载凭据</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="93a1" class="jx jy hs jt b fi jz ka l kb kc"># Load credentials<br/>scope = ['<a class="ae jn" href="https://www.googleapis.com/auth/drive'" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/drive'</a>]<br/>gcp_cred = gcp_credentials()<br/>creds = ServiceAccountCredentials.from_json_keyfile_dict(gcp_cred, scope)</span></pre><p id="1f8d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用凭证实例化build方法，并将mimetype定义为text/csv，以明确我们正在处理的文件类型。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="d5cc" class="jx jy hs jt b fi jz ka l kb kc">#Create my google drive service<br/>service = build('drive', 'v3', credentials=creds)<br/>mimetype = 'text/csv'</span></pre><p id="1ba7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您需要folder_id参数。它位于浏览器的顶部，复制字符串，如下图突出显示的例子所示。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ke"><img src="../Images/ae28ed871f798699d7a486d2a5b214e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlVQYksmVmqs3lgwxRzkVA.png"/></div></div></figure><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5524" class="jx jy hs jt b fi jz ka l kb kc">#Example folder id<br/>FOLDER_ID = '000111222333444AAABBBCCCDDDEEE'</span></pre><p id="b1e6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如前所述，首先你需要列出所有项目包括在您的驱动器。让我们继续前进！</p><p id="97dc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们需要创建一个<a class="ae jn" href="https://developers.google.com/drive/api/v3/search-files" rel="noopener ugc nofollow" target="_blank">查询参数</a>并给出drive_id作为参数。最后一个在FOLDER_ID所在的位置找到。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="822d" class="jx jy hs jt b fi jz ka l kb kc">query = f"parents in '{FOLDER_ID}' and trashed = false" <br/>page_token = None<br/>DRIVE_ID = 'ThisIsAString0123456789'<br/>list_of_files = []<br/>while True:<br/>     response = service.files().list(<br/>                corpora = 'drive',<br/>                driveId = DRIVE_ID,<br/>                q=query,<br/>                pageSize=20,<br/>                fields="nextPageToken, files(id, name)",<br/>                pageToken=page_token,<br/>                includeItemsFromAllDrives = True,<br/>                supportsAllDrives= True).execute()<br/>     <br/>     list_of_files += response.get('files')<br/>     page_token = response.get('nextPageToken', None)<br/>     if page_token is None:<br/>           break</span><span id="19d5" class="jx jy hs jt b fi kd ka l kb kc"># All files included at our repo<br/>files = []<br/>for file in range(len(list_of_files)):<br/>    if list_of_files[file].get('name'):<br/>        files.append({'name': list_of_files[file].get('name'),<br/>                            'id':list_of_files[file].get('id')})</span><span id="fb66" class="jx jy hs jt b fi kd ka l kb kc">df_files = pd.DataFrame(files)</span></pre><p id="df8e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">列出所有项目后，该检查文件是否存在，以便创建或替换。</p><p id="cb5a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第二个关键提示:创建新文件时，FOLDER_ID必须是字符串的<strong class="ir ht">列表。如果你不这样做，API既不会失败也不会出错，所以要小心。</strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="383c" class="jx jy hs jt b fi jz ka l kb kc">if FILE_NAME in list(df_files.name):<br/>    # Exists<br/>    # YES:Update<br/>    media = MediaFileUpload(FILE_NAME, mimetype=mimetype)<br/>    index = df_files[df_files["name"] == html_name].index<br/>    service.files().update(<br/>                fileId=df_files.loc[index[0], "id"],<br/>                media_body=media,<br/>                supportsAllDrives=True).execute()       <br/>else:    <br/>    # NO: CREATE<br/>    file_metadata = {<br/>                "name": FILE_NAME,<br/>                "parents": FOLDER_ID, #REMEMBER: This is a list<br/>                "mimeType": mimetype,<br/>                    }<br/>    media = MediaFileUpload(html_name,<br/>                            mimetype=mimetype,<br/>                            resumable=True)<br/>    service.files().create(<br/>                body=file_metadata,<br/>                media_body=media,<br/>                supportsAllDrives=True).execute()</span></pre><p id="a5dd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">亲爱的读者，希望这种开发，减少人类的努力，也有助于你成为一个更好的开发人员。如果对你有用，请告诉我，我会阅读你所有的评论。</p><p id="33e2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你愿意，可以通过<a class="ae jn" href="https://www.linkedin.com/in/pablo-rosa-2b1183aa/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p><div class="hg hh ez fb hi kf"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd ht fi z dy kk ea eb kl ed ef hr bi translated">Mlearning.ai提交建议</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">medium.com</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt ho kf"/></div></div></a></div></div></div>    
</body>
</html>