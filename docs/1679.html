<html>
<head>
<title>Modelling Vitamin E in Ruminants</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反刍动物维生素E模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/modelling-vitamin-e-in-ruminants-6679cd49cad2?source=collection_archive---------10-----------------------#2022-01-18">https://medium.com/mlearning-ai/modelling-vitamin-e-in-ruminants-6679cd49cad2?source=collection_archive---------10-----------------------#2022-01-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="7c57" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">在R中寻找正确的(非线性)线性混合模型</h2></div><p id="ac15" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi js translated">这不是我第一次发表关于使用非线性混合模型的文章。如果你了解我，你会知道我经常使用<a class="ae kb" rel="noopener" href="/mlearning-ai/introduction-to-mixed-models-in-r-9c017fd83a63">混合型号</a>。我尤其喜欢<a class="ae kb" rel="noopener" href="/mlearning-ai/non-linear-mixed-model-in-r-a6fc054c3f82">非线性变量</a>，因为它们提供了一套独特的可能性和挑战。今天我要写一个我参与的老项目，使用商业数据，模拟反刍动物的维生素E。不幸的是，我不能分享这些数据，但我能做的是尽可能突出我在那个项目中所做的。</p><p id="99dc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们从加载我将使用的库开始。对于非线性混合模型，<a class="ae kb" href="https://cran.r-project.org/web/packages/nlme/nlme.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hi"> nlme </strong> </a>包是您的主力。虽然它已经存在很多年了，但它的功能从来没有让我惊讶过。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="6681" class="kl km hh kh b fi kn ko l kp kq">rm(list = ls())</span><span id="4c3b" class="kl km hh kh b fi kr ko l kp kq">#### Libraries #####<br/>library(lme4)<br/>library(ggplot2)<br/>library(nlme)<br/>library(MASS)<br/>library(nls2)<br/>library(nlstools)<br/>library(car)<br/>library(lattice)<br/>library(plotBy)<br/>library(boot)<br/>library(gplots)<br/>library(sjPlot)<br/>library(sjmisc)<br/>library(sjstats)<br/>library(plyr)<br/>library(splines)<br/>library(glmmLasso)<br/>library(lmerTest)<br/>library(merTools)<br/>library(piecewiseSEM)<br/>library(influence.ME)<br/>library(AICcmodavg)<br/>library(bbmle) <br/>library(minpack.lm)</span></pre><p id="e377" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，加载数据并进行必要的转换。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="7a6a" class="kl km hh kh b fi kn ko l kp kq">#### Import data ####<br/>VitaminE &lt;- read.csv("VitaminE.csv")<br/>VitaminE$Treat&lt;-paste(VitaminE$SOURCE, VitaminE$DOSE)<br/>VitaminE$ID&lt;-paste(VitaminE$ROUND, VitaminE$PEN)<br/>length(unique(VitaminE$ID)) # 36 unique lines<br/>VitaminE$Treat&lt;-as.factor(VitaminE$Treat)<br/>VitaminE$ROUND&lt;-as.factor(VitaminE$ROUND)<br/>VitaminE$TIME2&lt;-VitaminE$TIME-1<br/>VitaminE$y&lt;-VitaminE$TBARS<br/>VitaminE$s&lt;-VitaminE$SYN<br/>VitaminE$n&lt;-VitaminE$NAT</span><span id="27be" class="kl km hh kh b fi kr ko l kp kq">#### Summarizing DATA ####<br/>ddply(VitaminE, c("TIME2"), summarise,<br/>      N = sum(!is.na(TBARS)),<br/>      Mis = sum(is.na(TBARS)),<br/>      Mean = round(mean(TBARS, na.rm=T),3),<br/>      Median = round(median(TBARS, na.rm=T),3),<br/>      SD = round(sd(TBARS, na.rm=T),3),<br/>      SE = round(sd(TBARS, na.rm=T) / sqrt(N),5),<br/>      LCI = round(Mean - (2*SE),3), <br/>      HCI = round(Mean + (2*SE),3))</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div class="er es ks"><img src="../Images/1358240d6a07097dcdf263758eee0726.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*jMX4JEZbmiFGVqYnNNJI4Q.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx">This is how the data looks, summarized</figcaption></figure><p id="760a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是数据的图表。很明显，如果你想用一个非线性公式来建模，你需要以一种特殊的方式来看待它。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="81e4" class="kl km hh kh b fi kn ko l kp kq">xyplot(TBARS~TIME|Treat, data=VitaminE)<br/>xyplot(TBARS~DOSE, data=VitaminE)<br/>xyplot(TBARS~DOSE|TIME, data=VitaminE)<br/>xyplot(TBARS~TIME, data=VitaminE)<br/>xyplot(TBARS~DOSE|SOURCE, data=VitaminE)<br/>plot(VitaminE$DOSE,VitaminE$TBARS)<br/>plot(VitaminE$TIME,VitaminE$TBARS)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/a80f35f4a959cd7e9200f7a660609756.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*wmJSRZYKK7PPjxO2e7tmyQ.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/72c74bc403e5683945439a5fa3ce4fac.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*E7J_f60MfONM-fwo1aMKlw.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/881bf14d48eebe895d24755b71c05be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Zr9xbSc9TU_2BZ-7erVQJQ.png"/></div></figure></div><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lk"><img src="../Images/e76d243e59cc10398a36ab659cd4e3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvkGIN4rjXpLkLmM5J7sGg.png"/></div></div></figure><p id="184c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">和更多的情节。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="b252" class="kl km hh kh b fi kn ko l kp kq">ggplot(VitaminE, aes(DOSE, TBARS, colour=SOURCE)) + <br/>  geom_point() +<br/>  theme_bw()</span><span id="526c" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE, aes(TIME, TBARS, colour=Treat, group=ID)) + <br/>  geom_point() +<br/>  geom_line()+<br/>  theme_bw()</span><span id="43f4" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE, aes(TIME, TBARS, colour=SOURCE, group=ID)) + <br/>  geom_point() +<br/>  geom_line()+<br/>  theme_bw()</span><span id="0838" class="kl km hh kh b fi kr ko l kp kq">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="line", lwd=1.5)</span><span id="cd1a" class="kl km hh kh b fi kr ko l kp kq">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=SOURCE))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=SOURCE), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=SOURCE), fun.y=mean, geom="line", lwd=1.5)</span><span id="bfb3" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80")</span><span id="cf29" class="kl km hh kh b fi kr ko l kp kq">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=DOSE))+<br/>  myx+<br/>  myy+<br/>  geom_line()</span><span id="8988" class="kl km hh kh b fi kr ko l kp kq">## Effect of Round<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=as.factor(ROUND)))+<br/>  myx+<br/>  myy+<br/>  geom_line() +<br/>  stat_summary(aes(group=ROUND), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=ROUND), fun.y=mean, geom="line", lwd=1.5)</span><span id="9b02" class="kl km hh kh b fi kr ko l kp kq">## Effect of Sex<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=as.factor(SEX)))+<br/>  myx+<br/>  myy+<br/>  geom_line() +<br/>  stat_summary(aes(group=SEX), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=SEX), fun.y=mean, geom="line", lwd=1.5)</span><span id="cc2c" class="kl km hh kh b fi kr ko l kp kq">## Effect of Pen<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.2), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME, y=TBARS, group=ID, colour=as.factor(PEN)))+<br/>  myx+<br/>  myy+<br/>  geom_line()</span><span id="abf3" class="kl km hh kh b fi kr ko l kp kq">sjp.poly(VitaminE$TBARS,VitaminE$TIME, 1) <br/>sjp.poly(VitaminE$TBARS,VitaminE$TIME, 2)<br/>sjp.poly(VitaminE$TBARS,VitaminE$TIME, 3)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt ll lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/21f7ef87f5318d78032c4707fa515e62.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*pInbL-hcgGBLYL5dY5ezEw.png"/></div></figure><figure class="la kt lm lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/508908bd2f77321830acd454f1ea1ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*9IiW9YqN9azvm33RLiHgMw.png"/></div></figure><figure class="la kt ll lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/65c960c317b326002a18f31721d5f658.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*JDRpphdfV-mxAjXdqxE8Yw.png"/></div></figure></div><div class="ab cb"><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/683821caf8ecb0f31cc0e96d75fa71c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*miqlSdyevVGAr5pSNi2s2A.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/7b3fc6c5e025e215ded39dd810dc9ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*7n9OTN22Su2CYilpehG9tQ.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/2f9fa4863a5cabd9895b856d5a2fd774.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*WYEzfhxdqdb1Wrd1oPxCqQ.png"/></div></figure></div><div class="ab cb"><figure class="la kt ln lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/9ad2f1f974ae9e9c3b3c48bfcb24f8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*3FFhtaW4pu_8o62LDtWAug.png"/></div></figure><figure class="la kt lo lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/11c432748ea00a117ac36c0a3cefc2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*NMGXzKGL1HfxOjKpEhwzew.png"/></div></figure><figure class="la kt lo lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/aa406a61774eb3c09ec5e645920d3f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*wAX5j35PD3mdUDkI0btdpg.png"/></div></figure></div><div class="ab cb"><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/bc008728c6ff94230efe4aca14ecea80.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*bp38z_f6Tp1KRCTIbiBobA.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/7d9ec90ed924d5be9d40485f7408e94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*84zz0VU88Ngm9hTCo3TDgw.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/71a0fbaf9ab9d60d4200220c140914dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*mx5oYMrDmaWDJ6oibh0pEQ.png"/></div></figure></div><p id="94b5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我将转移到work horse，即<strong class="iy hi"> nls </strong>和<strong class="iy hi"> nlme </strong>包，后者是混合模式版本。我想运行的公式是这样的:</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="54c4" class="kl km hh kh b fi kn ko l kp kq">formuTBARS&lt;-as.formula(y~a1+I(b1*TIME2/(exp(b2*SYN+b3*NAT))))</span></pre><p id="8528" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，我将使用nls包来运行一个简单的非线性模型，不包括随机组件。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="f2f8" class="kl km hh kh b fi kn ko l kp kq">try&lt;-nls(formula=TBARS~a1+I(b1*TIME2/(exp(b2*SYN+b3*NAT))),<br/>         start=list(a1=0.116,b1=0.100,b2=2.363,b3=4.2614),<br/>         data=VitaminE)<br/>summary(try)<br/>plot_model(try)</span><span id="a6eb" class="kl km hh kh b fi kr ko l kp kq"># Manual formula works --&gt; seems to be quite a fit even <br/>0.101+I(0.092*8/(exp(0.023*0.25+0*0)))</span><span id="c6c6" class="kl km hh kh b fi kr ko l kp kq">attach(VitaminE)<br/>try2&lt;-nlsLM(formula=TBARS~a1+I(b1*TIME2/(exp(b2*SYN+b3*NAT))),<br/>      start=list(a1=0.116,b1=0.100,b2=2.363,b3=4.2614),<br/>      data=VitaminE)<br/>summary(try2)<br/>plot(try2) <br/>pr&lt;-profile(try2) <br/>confint(try2)<br/>VitaminE$pred&lt;-predict(try2)<br/>plot(VitaminE$TBARS, VitaminE$pred, col=c(1,2))<br/>qqnorm(try2) <br/>AIC(try2)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt lp lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/095d99077d4b7cd6e1d083fb5b3aa6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*2Jo47GthZLsFT9nGBT3MwQ.png"/></div></figure><figure class="la kt lq lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/e2762480a205317d6bd51c64bcd0c570.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*lkAobnONFFXiobhVfmMaww.png"/></div></figure></div><div class="ab cb"><figure class="la kt lr lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/757da6b90c8ad65fab05e0176dbbfb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*ou8rkVSOLkZkkVT6gjpxqg.png"/></div></figure><figure class="la kt ls lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/6e356a48b9a902bc4f97f10d4f8e6337.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*GLzoYJoEV9NMh51WDwdXUg.png"/></div></figure><figure class="la kt ls lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/4ae1b85e21a8fad8236b7847500d52e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*RyLU8ipiWDCzoKBBiuSG-A.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx lt di lu lv">Residuals are not that great although the formula does seem to capture the gist of the model</figcaption></figure></div><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lw"><img src="../Images/78271821e20090e8ede674cd231611d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6gm7Si1kTWp522kfrN4BA.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Not how I would like it to be</figcaption></figure><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="fd6f" class="kl km hh kh b fi kn ko l kp kq">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,6,8,11,13))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.5), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME2, y=TBARS, group=ID, shape=Treat, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  scale_shape_manual(values=1:(nlevels(VitaminE$Treat)+1))+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=2.5)+<br/>  geom_line(aes(y=fitted(try2)), lwd=1, alpha=0.8)+<br/>  facet_grid(~Treat)</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lx"><img src="../Images/bbcd12763b9f194d6ab9e612da45dca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mY-nqVNvS36JuT9Wn8uL0Q.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Its not bad. Its not great either, but its not bad. The linear line though does hint at the unnecessary move towards a non-linear model</figcaption></figure><p id="cdf2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们尝试不同的非线性模型并进行比较。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="7665" class="kl km hh kh b fi kn ko l kp kq">try3&lt;-nlsLM(formula=TBARS~a1+b1*TIME2+I(b2*TIME2^2)/(exp(b3*SYN+b4*NAT)),<br/>            start=list(a1=0.1,b1=0.04,b2=0.04,b3=2.363,b4=4.2614),<br/>            data=VitaminE)</span><span id="af62" class="kl km hh kh b fi kr ko l kp kq">try4&lt;-nlsLM(formula=TBARS~a1+I((b1*TIME2)/(exp(b2*SYN+b3*NAT))),<br/>            start=list(a1=0.116,b1=0.100,b2=2.363,b3=4.2614),<br/>            data=VitaminE)</span><span id="1745" class="kl km hh kh b fi kr ko l kp kq">anova(try,try2,try3,try4)</span><span id="50f1" class="kl km hh kh b fi kr ko l kp kq">plot(try2) <br/></span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div class="er es ly"><img src="../Images/dcda8b6b1018f37437e6737f9c91ac20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*piUUokYMgbjwQodIdVsyYA.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx">First model seems best still.</figcaption></figure><p id="1b4a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">是否有一些有影响的观察结果会使非线性公式变得更加困难？我们可以使用刀切法，逐个删除观测值，然后重新调整模型。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="c5c9" class="kl km hh kh b fi kn ko l kp kq">try2.jack&lt;-nlsJack(try2)<br/>summary(try2.jack)<br/>plot(try2.jack)</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lz"><img src="../Images/f375c4a54106791a641d4985882167f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxxYJel-ZkXSAeBnNBvTow.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">There are some observations that influence the parameters. Of course this can also in general be due to a small sample size.</figcaption></figure><p id="b9d7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们来看看这些预测器是如何相互关联的。大的相关性将暗示使用更简单的模型，因为增加的参数实际上没有增加任何东西。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="a302" class="kl km hh kh b fi kn ko l kp kq">try2.conf1 &lt;- nlsConfRegions(try2,length = 2000) <br/>plot(try2.conf1)<br/>try2.surf&lt;-nlsContourRSS(try2)<br/>plot(try2.surf, col=FALSE, nlev=10)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/c58f9e5fdb2bd6642c9c84d2f37ff4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*lH6X-Qb7lixahqqdj2sDvA.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/e86ccf46d7f783cbb97ca4019ee3d2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*0B1c2gTthWNPB1lqS2SQ9g.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx mb di mc lv">Seems O.K. to me.</figcaption></figure></div><p id="ad73" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当然还有预测和拟合图。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="7256" class="kl km hh kh b fi kn ko l kp kq">## Observed vs fitted<br/>plot(VitaminE$TBARS, fitted(try2), col=c(1,2), pch=c(1,2)); abline(a=0,b=1)<br/>plot(VitaminE$TBARS, fitted(fit12), col=c(1,2), pch=c(1,2)); abline(a=0,b=1) # as comparison, the polynomial model</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lz"><img src="../Images/4f7b5bf79482e7c6a081dff45f465c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6to8mpc9A1UYWSTktsBtQ.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Not bad, but also not very good. The problem is in the curve of the model, especially at larger values of TBARS. This is what happens frequently when value increase and the variance increases with it. Then it becomes more difficult to model.</figcaption></figure><p id="33db" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你真的了解我，你会知道我就是喜欢自举。因此，让我们启动模型的参数。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="3fe5" class="kl km hh kh b fi kn ko l kp kq">## Confidence intervals<br/># Profiled<br/>confint(try2)<br/># Bootstrapped<br/>try2_boot&lt;-nlsBoot(try2, niter=5000)<br/>summary(try2_boot)<br/>plot(try2_boot, type="boxplot")</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lz"><img src="../Images/7e3a25d75378f8252c878eac1e72b19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HA9dhQiGP41c8X7qXP5Cyg.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Bootstrapping does not reveal strange results, but the spread does for sure lead to different curves.</figcaption></figure><p id="1ea1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">应用bootsraps的另一种方法是将其应用于模型本身，并观察平方和的平方根和均方误差在bootsraps之间如何变化。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="a64c" class="kl km hh kh b fi kn ko l kp kq">b&lt;-10000<br/>RSS&lt;-matrix(nrow=b, ncol=1)<br/>RSME&lt;-matrix(nrow=b, ncol=1)<br/>n&lt;-nrow(VitaminE)<br/>frac &lt;- 0.9<br/>for(i in 1:b){<br/>ix&lt;-sample(n, frac*n) # indexes of in sample rows<br/>VitaminE.out&lt;-VitaminE[-ix, ] # out of sample data<br/>pred&lt;-predict(try2, new=VitaminE.out)<br/>act&lt;- VitaminE.out$TBARS<br/>RSS[i]&lt;-sum((pred-act)^2)<br/>RSME[i]&lt;-sqrt(RSS[i]/length(VitaminE.out))<br/>}<br/>hist(RSS, breaks=100, prob=T); lines(density(RSS), col="red", lwd=2)<br/>hist(RSME,breaks=100, prob=T); lines(density(RSME), col="red", lwd=2)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/8c6b571e78e38f8144770aff5e3b642e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*OO15Fb5nk_bEgzflFDTjQg.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/df0d63b10fb5ec274d7160ba26db0b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KOBxXPyo1YTSX1S9Xh2VyA.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx mb di mc lv">The findings are for not as clear cut and can differ quite a lot. These are not small changes!</figcaption></figure></div><p id="99e8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">虽然我喜欢非线性模型，但我怀疑它们是否适用于这个数据集。如果基础数据不能真正由非线性公式近似，模型将很少收敛或者收敛是易变的。此外，非线性公式在某种程度上被固定在它需要建模的曲线上。如果曲线不存在，则拟合不是最佳。</p><p id="103a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，让我们看看是否可以使用一个线性混合模型来处理数据，我将从运行其中几个开始。实际上最好的方法是指定完整的模型，然后使用类似<a class="ae kb" href="https://ssc.wisc.edu/sscc/pubs/R_intro/book/4-4-variable-selection-functions.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hi"> drop1 </strong> </a>这样的函数，但是在这里给我。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="d8f5" class="kl km hh kh b fi kn ko l kp kq">options(scipen = 3)<br/>fit&lt;-lme4::lmer(TBARS~TIME2+(1|ID), data=VitaminE,REML=FALSE)<br/>fit2&lt;-lme4::lmer(TBARS~TIME2+(TIME2|ID), data=VitaminE,REML=FALSE) # perfect correlation random intercept + random slope<br/>fit3&lt;-lme4::lmer(TBARS~TIME2+(1|ID)+(0+TIME2|ID), data=VitaminE,REML=FALSE)<br/>fit4&lt;-lme4::lmer(TBARS~TIME2*Treat+(1|ID)+(0+TIME2|ID), data=VitaminE,REML=FALSE) <br/># fit5&lt;-lme4::lmer(TBARS~TIME*Treat+SOURCE+ROUND+(1|ID)+(0+TIME|ID), data=VitaminE,REML=FALSE) # rank defficient <br/># fit6&lt;-lme4::lmer(TBARS~TIME*Treat+SOURCE+(0+TIME|ID), data=VitaminE,REML=FALSE) # rank defficient because treat already in source <br/>fit7&lt;-lme4::lmer(TBARS~poly(TIME2,2)*Treat+(0+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) <br/>fit8&lt;-lme4::lmer(TBARS~poly(TIME2,2)+Treat+(1+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) <br/>fit9&lt;-lme4::lmer(TBARS~poly(TIME2,2)+DOSE+SOURCE+(1+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) <br/>fit10&lt;-lme4::lmer(TBARS~poly(TIME2,2)+DOSE+SOURCE+(0+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) # random intercept needs to be in<br/>fit11&lt;-lme4::lmer(TBARS~poly(TIME2,2)+DOSE+SOURCE+(1|ID)+(0+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) # dropping correlation definitly <br/>fit12&lt;-lme4::lmer(TBARS~poly(TIME2,2)*Treat+(1+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE) <br/>fit13&lt;-lme4::lmer(TBARS~poly(TIME2,2)*Treat+SEX+ROUND+(1+poly(TIME2,2)|ID), data=VitaminE,REML=FALSE)</span><span id="a334" class="kl km hh kh b fi kr ko l kp kq"># Comparing models<br/>anova(fit8, fit9, fit12, fit13)<br/>mynames&lt;-c("1","2","3","4","7","8","9", "10", "11", "12", "13")<br/>myaicc&lt;-as.data.frame(aictab(cand.set=list(fit,fit2,fit3,fit4,fit7,fit8,fit9, fit10, fit11, fit12, fit13), modnames=mynames))[, -c(5,7)]<br/>myaicc$eratio&lt;-max(myaicc$AICcWt)/myaicc$AICcWt<br/>data.frame(Model=myaicc[,1],round(myaicc[, 2:7],4))</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div class="er es md"><img src="../Images/b93a91aa519a6eea62eff1958d95f24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*ifigtwedmqGeLmiuUgzf8w.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx">Model 12 seems to be thes best fit, so lets evaluate model 12.</figcaption></figure><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="4797" class="kl km hh kh b fi kn ko l kp kq">## Diagnostics<br/>xyplot(ranef(fit8))<br/>bwplot(VitaminE$ID~resid(fit9))<br/>bwplot(VitaminE$Treat~resid(fit9))</span><span id="334c" class="kl km hh kh b fi kr ko l kp kq">summary(fit12)<br/>plot(fit12) <br/>ranef(fit12)<br/>plot(acf(resid(fit12))) # autocorrelation second lag</span><span id="6280" class="kl km hh kh b fi kr ko l kp kq"># Plot fitted model<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,6,8,11,13))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,2.5, by = 0.5), limits = c(0,2.5))<br/>ggplot(VitaminE, aes(x=TIME2, y=TBARS, group=ID, shape=Treat, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  scale_shape_manual(values=1:(nlevels(VitaminE$Treat)))+<br/>  # geom_point(aes(group=Treat))+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=2.5)+<br/>  stat_summary(aes(y=fitted(fit12), group=Treat),fun.y=mean, geom = "line")+<br/>  facet_grid(~Treat)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/bef9ef1792a0c8750ed1c44355534ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*57azBzOOsB7Pnil9tPu3iw.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/c9c5477b18f57f83c7bd0c7cc232707d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*E6H3oZlQIaKAfkVaeOWDVA.png"/></div></figure></div><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es me"><img src="../Images/863a423770ba155341fe0ef01dfad7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nu5lbaZNPuQIrQ62Q-GOmQ.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Looking good!</figcaption></figure><p id="fe01" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，lme4软件包真正不擅长的事情之一是为模型的误差部分合并协方差结构。这是建立dependt数据模型所需要的，并且您希望将LSMEANS从该模型中取出。因此，我将转向<strong class="iy hi"> lme </strong>包，它是<strong class="iy hi"> nlme </strong>包的线性混合模型系列成员，用于建模自相关和异方差。</p><p id="2610" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，一个简单的模型，看它是否合适。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="e355" class="kl km hh kh b fi kn ko l kp kq">Grouped&lt;-groupedData(TBARS~TIME|ID,<br/>                     data=VitaminE,<br/>                     FUN=mean)<br/>fit12nlme&lt;-lme(TBARS~poly(TIME2,2)*Treat,<br/>              random=~1+poly(TIME2,2),<br/>              data=Grouped,<br/>              method="ML", <br/>              control=lmeControl(opt="optim", maxIter=10000, msMaxIter = 1000))<br/>bwplot(VitaminE$Treat~resid(fit12))<br/>bwplot(VitaminE$Treat~resid(fit12nlme))<br/>plot(augPred(fit12nlme, level=c(0,1)))</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/b048318ca2b95990c36feac41cffe268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*S23bLWTuPi4jjf-yzqWpOQ.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/5bd3911c72793fde5865e89198598352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9JKaPdEgRxATLMPXBi6O0g.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx mb di mc lv">Not great at all.</figcaption></figure></div><p id="746c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，如果我想以线性方式对数据建模，让数据驱动决策，而不是非线性公式，也许最好是我先好好看看数据本身。使用图表。很多都是。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="3429" class="kl km hh kh b fi kn ko l kp kq">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(1,7,9,12,14))<br/>myy&lt;-scale_y_continuous(breaks = seq(0,20, by = 1), limits = c(0,20))<br/>ggplot(VitaminE, aes(x=TIME, y=a, group=ID, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="line", lwd=1.5)</span><span id="b621" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE, aes(x=TIME, y=a, group=ID, colour=SOURCE))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=SOURCE), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=SOURCE), fun.y=mean, geom="line", lwd=1.5)</span><span id="c9a4" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE[VitaminE$SOURCE=="NAT",], aes(x=TIME, y=a, group=ID, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="line", lwd=1.5)</span><span id="c66b" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE[VitaminE$SOURCE=="SYN",], aes(x=TIME, y=a, group=ID, colour=Treat))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="point", size=3.5)+<br/>  stat_summary(aes(group=Treat), fun.y=mean, geom="line", lwd=1.5)</span><span id="d747" class="kl km hh kh b fi kr ko l kp kq">### Linear vs non-linear<br/>sjp.poly(VitaminE$a,VitaminE$TIME, 1) # best to approach it in a linear way <br/>sjp.poly(VitaminE$a,VitaminE$TIME, 2)<br/>sjp.poly(VitaminE$a,VitaminE$TIME, 3)</span><span id="db7f" class="kl km hh kh b fi kr ko l kp kq">ggplot(VitaminE, aes(x=TIME, y=a, group=ID))+<br/>  myx+<br/>  myy+<br/>  geom_line(colour="grey80") +<br/>  stat_smooth(aes(group=1),col="red", method = lm, formula = y~ns(x,2), se=FALSE, lwd=1.5) +<br/>  stat_smooth(aes(group=1),col="darkgreen", method = lm, formula = y~poly(x,2), se=FALSE, lwd=1.5) +<br/>  stat_smooth(aes(group=1),col="blue", method = lm, formula = y~x, se=FALSE, lwd=1.5)</span></pre><div class="kc kd ke kf fd ab cb"><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/e6bb31fa9c52e97ac0a36058a55caba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*PUF--RmF-KC6IlZPYtmaRA.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/359273fc49e3af7a8d2b77bb083d1b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Bl6Frb_P8uNuvFTRL6hqVA.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/53fb4d6e30678f0b6b4d92f0d5e16b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*LHZIa6KABlfi9jfNj0yryw.png"/></div></figure></div><div class="ab cb"><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/563b701863584daf90d196acf957505e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MML7CQLAO-s-bBqfjgHN7A.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/6239b4243bb5c8cc3edf428f43e77533.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*LP4X_2TXbcqpPhwVz1E5dA.png"/></div></figure><figure class="la kt lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/63e526ea2f963b907c784fef43feaad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Fpk03qQcwlhE94JmP6YpUQ.png"/></div></figure></div><div class="ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/0b7a088e2f90823d47f0dee84ac49bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*b_DP-AGdqsNTL6Si0FgmGA.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/8fe03a658f035e5463454302a944653c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*rW0FnjBBpVxmB1jZQogyFg.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx mb di mc lv">For sure a need to incorporate splines or polynomials. I prefer splines.</figcaption></figure></div><p id="d830" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有另一套模型可以试用。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="0ee6" class="kl km hh kh b fi kn ko l kp kq">VitaminE$TIME2&lt;-VitaminE$TIME-1<br/>fit&lt;-lmer(a~TIME2*Treat+ROUND+SEX+(TIME2|ID), data=VitaminE)<br/>fit2&lt;-lmer(a~TIME2*SOURCE+ROUND+SEX+(TIME2|ID), data=VitaminE)<br/>fit3&lt;-lmer(a~ns(TIME2,2)*SOURCE+ROUND+SEX+(ns(TIME2,2)|ID), data=VitaminE)<br/>fit4&lt;-lmer(a~ns(TIME2,3)*SOURCE+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>fit5&lt;-lmer(a~ns(TIME2,3)*Treat+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>fit6&lt;-lmer(a~ns(TIME2,3)+Treat+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>fit7&lt;-lmer(a~ns(TIME2,3)*SOURCE*DOSE+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE) # Rank defficient<br/>fit8&lt;-lmer(a~ns(TIME2,2)*DOSE+(ns(TIME2,2)|ID), data=VitaminE)<br/>fit9&lt;-lmer(a~ns(TIME2,2)*DOSE+(ns(TIME2,2)|ID), data=VitaminE, subset = VitaminE$SOURCE=="NAT") # aparte formule per dose</span><span id="4f2d" class="kl km hh kh b fi kr ko l kp kq">anova(fit8, fit6)<br/>anova(fit4,fit5,fit6)<br/>summary(fit8)<br/>plot(fit8)<br/>plot(acf(resid(fit6)))<br/>pr&lt;-profile(fit6); xyplot(pr) # does not show a good picture, especially for the random effects <br/>VarCorr(fit6)<br/>bwplot(VitaminE$ID ~ resid(fit6))<br/>bwplot(VitaminE$Treat ~ resid(fit6))<br/>fit6_inf&lt;-influence(fit6,"ID"); plot(fit6_inf,xlab="DFBETAS",ylab="ID")<br/>plot(dfbetas(fit6_inf))</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div class="er es mf"><img src="../Images/671e47882833a3d99034cb19b80b3322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*UCMtK87pCbbjs5EOTgNxVg.png"/></div></figure><div class="kc kd ke kf fd ab cb"><figure class="la kt mg lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/39c5d535e48c05c6d94c458817bbfd28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*odRPzy6KB51qaVuYP7Bqxg.png"/></div></figure><figure class="la kt mh lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/218baf456077ae015df5c807d29e9869.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*E9wBaQ-NquElC1X-9bs5Yw.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx mi di mj lv">Residuals and autocorrelation plot are looking good. First lag is beyond the limit though.</figcaption></figure></div><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es me"><img src="../Images/7c51c4e5e94baeaf4e56136f4730838f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7j5OtpEcuY0KU6oB_3E2LA.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">And the parameter estimates. Especially for the error part, things are not really going smooth and a more simple would probably be better. Which means deleting the random slopes.</figcaption></figure><div class="kc kd ke kf fd ab cb"><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/ea77fd4bdaf13494ed96505283466758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*wwILHNHbcc9hGAwBLFm0Pg.png"/></div></figure><figure class="la kt ma lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/e86499b48d161609d9a3407d9c726081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*IqvyXSuoL5gtWWmqs_771A.png"/></div></figure></div><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mk"><img src="../Images/39f31dbfd2619f5334d1bdfd5eccbf19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-P-zbFk-CQF_I1VfIUR-A.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Another reason for deleting the random slopes — most of them are not that different.</figcaption></figure><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="40ab" class="kl km hh kh b fi kn ko l kp kq">### Variable selection ###<br/>drop1(fit6,test="Chisq")<br/>KRSumFun &lt;- function(object, objectDrop, ...) {<br/>    krnames &lt;- c("ndf","ddf","Fstat","p.value","F.scaling")<br/>    r &lt;- if (missing(objectDrop)) {<br/>      setNames(rep(NA,length(krnames)),krnames)<br/>    } else {<br/>      krtest &lt;- KRmodcomp(object,objectDrop)<br/>      unlist(krtest$stats[krnames])<br/>    }<br/>    attr(r,"method") &lt;- c("Kenward-Roger via pbkrtest package")<br/>    r<br/>  }<br/>drop1(fit6,test="user",sumFun=KRSumFun)</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div class="er es ml"><img src="../Images/f8d33c5fd93c05c8b8f120be58f8a741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*4vdoxseJVrVEaw0IN1zv5Q.png"/></div><figcaption class="kw kx et er es ky kz bd b be z dx">Funny, Treat is not even considered significant</figcaption></figure><p id="788f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看一下拟合图和观察图，以了解模型的表现。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="b785" class="kl km hh kh b fi kn ko l kp kq">fit6&lt;-lmer(a~ns(TIME2,3)+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,6,8,11,13))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 20, by = 11))<br/>ggplot(VitaminE, aes(TIME2, a, shape=Treat, colour=Treat))+<br/>  stat_summary(fun.data=mean_se, geom="pointrange", lwd=1)+<br/>  stat_summary(aes(y=fitted(fit6), linetype=Treat), <br/>               fun.y=mean, geom = "line", lwd=1)+<br/>  myx+<br/>  myy</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mm"><img src="../Images/66d5217fb5acbffadd8a1b6b4d579e55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlnyvmXQjbOkXJ5J1f3wxg.png"/></div></div></figure><p id="b532" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们在模型中包括治疗。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="604f" class="kl km hh kh b fi kn ko l kp kq">fit6&lt;-lmer(a~ns(TIME2,3)+Treat+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>ranef(fit6) # problem with this model is, is that the estimates now come from the IDs. <br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,6,8,11,13))<br/>myy&lt;-scale_y_continuous(breaks = seq(0, 20, by = 11))<br/>ggplot(VitaminE, aes(TIME2, a, shape=Treat, colour=Treat))+<br/>  stat_summary(fun.data=mean_se, geom="pointrange", lwd=1)+<br/>  stat_summary(aes(y=fitted(fit6), linetype=Treat), <br/>               fun.y=mean, geom = "line", lwd=1)+<br/>  myx+<br/>  myy</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mm"><img src="../Images/f8565ef4f483aa9341ef1e3d77f9f877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IugoKtfEj-GgmRXe7uFv4Q.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Same predictions as before. Adding treatment does not really seem to do much above and beyond modeling the individual IDs.</figcaption></figure><p id="63c1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过获得bootstrapped置信区间，我们可以使预测更加有趣。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="cd75" class="kl km hh kh b fi kn ko l kp kq">fit6&lt;-lmer(a~ns(TIME2,3)+ROUND+SEX+(ns(TIME2,3)|ID), data=VitaminE)<br/>plot(fitted(fit6),VitaminE$a, col=c(1,2));abline(a=0,b=1)</span><span id="e3df" class="kl km hh kh b fi kr ko l kp kq">pred&lt;-predictInterval(fit6, level=0.95, <br/>                      n.sims=1000, <br/>                      stat="mean", <br/>                      type="linear.prediction", <br/>                      include.resid.var=T)<br/>VitaminE$fit&lt;-pred$fit<br/>VitaminE$upr&lt;-pred$upr<br/>VitaminE$lwr&lt;-pred$lwr<br/>ggplot(VitaminE, aes(x=TIME, group=ID))+<br/>  geom_ribbon(aes(ymin = lwr, ymax = upr, fill="red"),alpha = 0.1)+<br/>  geom_point(aes(y=a))+geom_line(aes(y=a))+<br/>  geom_point(aes(y=fit), color="red")+geom_line(aes(y=fit), color="red")+<br/>  facet_wrap(~Treat)+<br/>  labs(title="Predicted vs Observed based on fit6", x="Time")+<br/>  theme(legend.position = "none")+<br/>  theme_bw()</span></pre><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mm"><img src="../Images/a7d837a173a01b64afe25ff5d4d2e252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VM_REDRrrxubaJhdMhtgg.png"/></div></div></figure><figure class="kc kd ke kf fd kt er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mn"><img src="../Images/29d6675feb9d228efe76a7f7b80a44b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDaz3FW_7tBiaC3OiTswrw.png"/></div></div></figure><p id="5b84" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">预测看起来不错！只要确保你不包括治疗；-)</p><div class="mo mp ez fb mq mr"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">medium.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf ku mr"/></div></div></a></div></div></div>    
</body>
</html>