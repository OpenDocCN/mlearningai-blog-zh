<html>
<head>
<title>Data Engineering daily problems-1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程日常问题-1</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/data-engineering-daily-problems-1-85ca36192478?source=collection_archive---------2-----------------------#2022-03-25">https://medium.com/mlearning-ai/data-engineering-daily-problems-1-85ca36192478?source=collection_archive---------2-----------------------#2022-03-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="23d7" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">提高你的隐性知识与这些双重定量的闹鬼使用自动气象站λ</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/aebac2c392490b621ef93057659fa9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*385F_qdlpELgHhQq"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Image by <a class="ae jm" href="https://unsplash.com/@jackson_films" rel="noopener ugc nofollow" target="_blank">Jackson Films</a> via <a class="ae jm" href="https://unsplash.com/photos/FgEngMJ0ocY" rel="noopener ugc nofollow" target="_blank">Unplash</a></figcaption></figure><h1 id="2863" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">系列介绍</h1><p id="78f8" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">软件工程可能是互联网上信息最多的领域。有了这么多的信息，人们可能会认为任何有时间、纪律、能力和毅力的人都可以成为大师…这是真的，至少在理论上是这样的…</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lb lc l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">via Giphy</figcaption></figure><p id="4546" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">我来给大家介绍一下<strong class="kh hi">显性</strong>和<strong class="kh hi">隐性</strong> <strong class="kh hi">知识的区别。</strong>根据维基百科(简单点说):</p><ul class=""><li id="6d60" class="li lj hh kh b ki ld kl le ko lk ks ll kw lm la ln lo lp lq bi translated"><strong class="kh hi">显性知识</strong>是指可以很容易地表达、编码、存储和访问的知识。</li><li id="b2c9" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kh hi">隐性知识</strong>是难以表达或提取的知识，因此更难通过写下来或用语言表达的方式转移给别人。这包括个人智慧、经验、洞察力和直觉。</li></ul><p id="c1b3" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">我不打算通过详细解释它们之间的差异来重新发明轮子，但是我相信正是这些知识类型之间的差异的存在使得对高级软件工程师档案的需求如此之大(当然这也可以应用于其他学科)。</p><blockquote class="lw lx ly"><p id="9703" class="kf kg lz kh b ki ld ii kk kl le il kn ma lf kq kr mb lg ku kv mc lh ky kz la ha bi translated"><strong class="kh hi">在这种类型的档案中，有些东西不是仅仅通过培训/学习(显性知识)就能获得的，它还需要经验(隐性知识)。</strong></p></blockquote><p id="69da" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">这就是为什么我要开始汇编我在作为一名数据工程师的日常工作中遇到的一系列问题，这些问题作为一个单独的解决方案可能没有价值(如果你没有直接遇到和我一样的问题)，但可以帮助开发该领域的隐含知识。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md lc l"/></div></figure><p id="a4cd" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">我的想法是在这一系列文章中汇编这些例子，以便在最好的情况下，它们可以帮助面临相同问题的人，在一般情况下，它们可以作为好奇心或帮助开发隐性知识。</p><h1 id="4ec7" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">问题AWS Lambda中的SQLite</h1><h2 id="1add" class="me jo hh bd jp mf mg mh jt mi mj mk jx ko ml mm jz ks mn mo kb kw mp mq kd mr bi translated"><strong class="ak">描述</strong></h2><p id="73de" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">使用AWS Lambda来自动化从存储在S3的SQLite DB中读取和写入数据的过程。该进程在本地运行良好，但在Lambda上执行时失败，并显示以下错误消息:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="a901" class="me jo hh mt b fi mx my l mz na">[ERROR] OperationalError: near “(“: syntax error<br/>Traceback (most recent call last):<br/> File “/var/task/lambda_function.py”, line 24, in lambda_handler<br/> calculations.main()</span></pre><p id="9b17" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">正如在前面的错误消息中可以看到的，在执行SQL查询时，这似乎是一个Python错误，但是它没有给出关于错误来源的更多信息。正在使用的查询示例:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="6fc3" class="me jo hh mt b fi mx my l mz na">SELECT Name, ROW_NUMBER () OVER ( PARTITION BY SURNAME ORDER BY Execution_Date DESC) AS ROW_NU, SUBSTR(Execution_Date,1,10) as Execution_Date_sub<br/>FROM Persons</span></pre><p id="4ad1" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">查询的“复杂性”在<strong class="kh hi"><em class="lz">ROW _ NUMBER</em></strong>window函数中，但在本地有效的查询在使用相同Python版本和相同库的AWS Lambda中无效…</p><p id="1bd4" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">嗯，那不是100%正确。在回顾了Lambda提供的不同Python运行时之后，我发现所有的运行时都包含了预装的AWS SDK(在我们的例子中是<a class="ae jm" href="https://github.com/boto/boto3" rel="noopener ugc nofollow" target="_blank"> boto3 </a></p><div class="nb nc ez fb nd ne"><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-python.html" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hi fi z dy nj ea eb nk ed ef hg bi translated">用Python构建Lambda函数</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">可以在AWS Lambda中运行Python代码。Lambda为Python提供了运行你的代码来处理事件的运行时。你的…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="825b" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">由于我没有找到Lambda运行时中预安装的所有包的列表，所以我决定采取实际的方法:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nn"><img src="../Images/4cf4057fea22ea5c8aa5f8bcfdb6877e.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*l04RqMPMiKqNryziLEcOvQ.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">AWS Lambda simple script to get the SQLite version of the runtime</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es no"><img src="../Images/3497700b1b679352dfe25f4ff06488b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*qvOF1wbjx6_e21hXhJWraA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Output of previous command</figcaption></figure><p id="95e4" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">SQLite版本，其中增加了对窗口函数的支持:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es np"><img src="../Images/5dd237d77bb0cc50367d2d32a6583288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*vHouqSgWHw6nodBZp8c3wg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx"><a class="ae jm" href="https://www.sqlite.org/releaselog/3_25_0.html" rel="noopener ugc nofollow" target="_blank">https://www.sqlite.org/releaselog/3_25_0.html</a></figcaption></figure><p id="9037" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated"><strong class="kh hi">3 . 7 . 17(AWS Lambda中使用的SQLite版本)比3.25.0(第一个兼容窗口功能的SQLite版本)更新？</strong>因为我不确定，所以我在官方库<a class="ae jm" href="https://github.com/sqlite/sqlite/tags" rel="noopener ugc nofollow" target="_blank">查看了不同的SQLite版本</a>:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nq"><img src="../Images/6f2a3db16ae380f23d060e6aad2cc831.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*NuvJvMLSRwmC6SM4ORLyHA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">SQLite version being used in AWS Lambda</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nr"><img src="../Images/b492482b6e1848c38167df9490dd9ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*d_DJ6PyQs_tQlIzTwpf-NQ.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">First SQLite version compatible with window functions.</figcaption></figure><h2 id="6abe" class="me jo hh bd jp mf mg mh jt mi mj mk jx ko ml mm jz ks mn mo kb kw mp mq kd mr bi translated">解决办法</h2><p id="5566" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">由于AWS Lambda Python运行时内置了SQLite版本3.7.17，我们无法安装同一个包的另一个版本。但是我们可以使用像<strong class="kh hi"> pysqlite3 </strong>这样的包装器</p><div class="nb nc ez fb nd ne"><a href="https://github.com/coleifer/pysqlite3" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hi fi z dy nj ea eb nk ed ef hg bi translated">GitHub - coleifer/pysqlite3:来自Python 3的SQLite3 DB-API 2.0驱动程序，单独打包，带有…</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">这个库从Python 3中提取SQLite模块，并将其打包成一个可单独安装的模块。这可能是…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">github.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jg ne"/></div></div></a></div><blockquote class="lw lx ly"><p id="b172" class="kf kg lz kh b ki ld ii kk kl le il kn ma lf kq kr mb lg ku kv mc lh ky kz la ha bi translated">这个库从Python 3中提取SQLite模块，并将其打包成一个可单独安装的模块。linux有一个二进制包(wheel ),它有一个完全独立的<code class="du ny nz oa mt b">pysqlite3</code>,与最新版本的SQLite静态链接。</p></blockquote><p id="41b3" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">这个包允许我们修改SQLite的导入，就好像我们正在导入一个完全不同的包(为了避免版本冲突),我们将其重命名为sqlite3，这样就不必更改其余的代码:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="933a" class="me jo hh mt b fi mx my l mz na">import pysqlite3 as sqlite3</span></pre><div class="nb nc ez fb nd ne"><a href="https://stackoverflow.com/questions/65280790/install-newer-version-of-sqlite3-on-aws-lambda" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hi fi z dy nj ea eb nk ed ef hg bi translated">在AWS Lambda上安装新版本的sqlite3</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">stackoverflow.com</p></div></div><div class="ns l"><div class="ob l nu nv nw ns nx jg ne"/></div></div></a></div><h1 id="f35c" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">问题2:从AWS Lambda中删除网站时的不同反应</h1><p id="0be3" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">再次出现生产(AWS Lambda)和本地环境之间不同结果的问题…</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es oc"><img src="../Images/8ff65b5bac2f3dfd0e6855888ff4f9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/0*RNW4cmZB0Nw4kQEm.jpg"/></div></figure><h2 id="3c15" class="me jo hh bd jp mf mg mh jt mi mj mk jx ko ml mm jz ks mn mo kb kw mp mq kd mr bi translated">描述</h2><p id="127b" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">用Python写的一个程序，对某个网站进行网络抓取(使用BeautifulSoap ),在JSON中处理结果并上传到S3:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="f84c" class="me jo hh mt b fi mx my l mz na">req = urllib.request.Request(url=url_page, headers=header) <br/>page = urllib.request.urlopen(req) <br/>soup = BeautifulSoup(page, 'html.parser')<br/>for div in soup.find_all("div", class_="SOME_CLASS"):<br/>    #STORES IN JSON FORMAT AND UPLOADS TO S3</span></pre><p id="9dc9" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">在本地，它工作得很成功。在AWS Lambda中，我们有以下错误:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="04d0" class="me jo hh mt b fi mx my l mz na">[ERROR] AttributeError: ‘NoneType’ object has no attribute ‘find_all’</span></pre><p id="278a" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">在深入查看日志后，我发现SOUP对象不是空的，即LAMBDA函数具有web可见性(因此它在尝试下载源代码时没有失败)，<strong class="kh hi">一些不同的东西失败了</strong>。</p><p id="54bc" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">在将这个错误贴上官方<a class="ae jm" href="https://en.wikipedia.org/wiki/Poltergeist" rel="noopener ugc nofollow" target="_blank">恶作剧的标签</a>之前，我首先尝试了以下理性的方法:</p><ul class=""><li id="e5bb" class="li lj hh kh b ki ld kl le ko lk ks ll kw lm la ln lo lp lq bi translated">改变了我的请求中使用的头，但是，由于相同的头在本地工作，它没有意义。<strong class="kh hi">相同结果</strong>。</li><li id="f242" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated">试着运行<strong class="kh hi"> CURL </strong>，就像我在系统自己的终端上运行它一样(看看这是VM的问题还是我的代码的问题):</li></ul><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="a616" class="me jo hh mt b fi mx my l mz na">import subprocess<br/>def lambda_handler(event, context):<br/> CurlUrl=”curl -H ‘MY_HEADERS‘ -H ‘Connection : keep-alive ‘ <a class="ae jm" href="https://www.smartbets.com/football/celta-vigo-espanyol/" rel="noopener ugc nofollow" target="_blank">https://www.web.com</a>"<br/> status, output = subprocess.getstatusoutput(CurlUrl)<br/> print(output)</span></pre><p id="fdb4" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">出现以下错误:</p><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="203a" class="me jo hh mt b fi mx my l mz na">/bin/sh: curl: command not found</span></pre><p id="2764" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">惊喜！<strong class="kh hi"> CURL </strong>没有安装在AWS Lambda正在使用的Linux虚拟机中</p><ul class=""><li id="b007" class="li lj hh kh b ki ld kl le ko lk ks ll kw lm la ln lo lp lq bi translated"><a class="ae jm" href="https://www.twilio.com/blog/asynchronous-http-requests-in-python-with-aiohttp" rel="noopener ugc nofollow" target="_blank">我尝试异步执行调用</a>，以防出现某种不允许我下载整个页面的隐式超时。<strong class="kh hi">同样的结果</strong>。</li><li id="b3a0" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated">我下载了页面HTML并存储在S3 (Lambda存储只持续到函数终止)，这样我就可以在本地查看它。有一次下载，我数了一下字符数，我看到下载的版本有我本地版本总字符数的1/3。</li></ul><p id="b46e" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">这最后一次尝试给了我所需要的线索…</p><h2 id="ef22" class="me jo hh bd jp mf mg mh jt mi mj mk jx ko ml mm jz ks mn mo kb kw mp mq kd mr bi translated">解决办法</h2><p id="0e9e" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">在我所在的国家还没有可用的AWS Lambda地区，所以我使用欧洲的另一个地区(<strong class="kh hi"> eu-west-3 </strong>)。似乎我试图抓取的网站在每个国家都有某种内容限制，所以我能够从我的本地执行中获得网站的完整内容，但当在eu-west-3 AWS Lambda中尝试相同的代码时，网页的内容有所不同(我在执行本地执行时获得的总字符数的1/3)。</p><p id="43e5" class="pw-post-body-paragraph kf kg hh kh b ki ld ii kk kl le il kn ko lf kq kr ks lg ku kv kw lh ky kz la ha bi translated">为了探究我的假设，<strong class="kh hi">我将我的AWS Lambda区域从eu-west-3更改为us-west-2 </strong>，并且废弃过程如预期的那样工作(我能够获得与在我的本地环境中执行时相同的网页)。</p><h1 id="3f28" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">结论</h1><p id="7e68" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">在这篇文章中，我们看到:</p><ul class=""><li id="fa54" class="li lj hh kh b ki ld kl le ko lk ks ll kw lm la ln lo lp lq bi translated">显性知识和隐性知识的区别。</li><li id="0cf8" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated">这类文章的目的不仅仅是揭示一个非常具体的问题的解决方案，而是通过向读者展示具体的问题和解决问题的过程来帮助发展隐含的知识。</li><li id="df97" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kh hi">问题1 </strong>:如何更改AWS Lambda Python运行时预建的SQLite版本。</li><li id="20b7" class="li lj hh kh b ki lr kl ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kh hi">问题二</strong>:如何解决本地执行和AWS Lambda报废结果的差异。</li></ul><pre class="ix iy iz ja fd ms mt mu mv aw mw bi"><span id="620f" class="me jo hh mt b fi mx my l mz na">“The success formula: solve your own problems and freely share the solutions.”<br/>― <a class="ae jm" href="https://twitter.com/naval/status/1444741381579177984" rel="noopener ugc nofollow" target="_blank"><strong class="mt hi">Naval Ravikant</strong></a></span></pre><div class="nb nc ez fb nd ne"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hi fi z dy nj ea eb nk ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">medium.com</p></div></div><div class="ns l"><div class="od l nu nv nw ns nx jg ne"/></div></div></a></div></div></div>    
</body>
</html>