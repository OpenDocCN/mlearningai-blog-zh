<html>
<head>
<title>Segmentation using the RFM framework (Recency, Frequency, Monetary value)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用RFM框架进行细分(新近性、频率、货币价值)</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/segmentation-using-the-rfm-framework-recency-frequency-monetary-value-8bb19ea3b51a?source=collection_archive---------7-----------------------#2021-03-23">https://medium.com/mlearning-ai/segmentation-using-the-rfm-framework-recency-frequency-monetary-value-8bb19ea3b51a?source=collection_archive---------7-----------------------#2021-03-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6a85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">获取大量客户交易数据集，并基于新近性、频率和货币价值进行细分。</p><p id="6557" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">项目概述-: </em> </strong>使用来自在线零售商的交易数据集，根据最近(他们订购的时间)、频率(他们订购的频率)和货币价值(由他们的收入定义)对客户进行细分。该项目概述了从数据清理到结果解释的整个工作流程</p><p id="acbb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">业务需求-: </em> </strong>细分客户以识别最具持续价值的客户。</p><p id="a3a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">所用手法-: </em> </strong> K表示聚类。尝试通过算法识别细分市场，而不是通过传统分析为每个指标创建十分位数。k均值创建最明显的聚类/分段，在聚类内具有最大的相似性，在聚类之间具有最大的差异</p><p id="398e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">步骤1-:探索性数据分析和数据清理</em> </strong></p><p id="741b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导入模块和加载数据</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ad61" class="jm jn hh ji b fi jo jp l jq jr">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>from sklearn.cluster import KMeans<br/>from sklearn.preprocessing import StandardScaler<br/>import datetime<br/>import seaborn as sns</span><span id="63a8" class="jm jn hh ji b fi js jp l jq jr">data=pd.read_excel('onlineretail.xlsx')<br/>data.shape</span></pre><p id="058f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加载数据并运行shape方法显示了大约541，000个事务，包含8列数据</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d335" class="jm jn hh ji b fi jo jp l jq jr">data.head()</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/0a7b32894a3209915e3c2212ef47f8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kzUpNaWCiP-6w-_5ZcmyYw.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">fig 1-: sample 5 rows of the data frame</figcaption></figure><p id="fde1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">处理缺失值</em> </strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7b4b" class="jm jn hh ji b fi jo jp l jq jr">data.dropna(inplace=True)<br/>data.info()</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kf"><img src="../Images/db16fc4f36c6c70c7af0ef51ff7391de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dbtwNYKxfuZrf17KimRUQ.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">fig 2-: Dropping missing values</figcaption></figure><p id="9dde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">处理明显异常值</em> </strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5f47" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi"><em class="jc">#Looking at the distribution for the sales quantity column</em></strong><br/>plt.hist(data.Quantity)<br/>plt.show()</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kg"><img src="../Images/6b7ac29ffe7056057db5039c0fa8581d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4KmbpLUzI_V4vpsXrtVpg.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">fig 3-: distribution of sales Quantity</figcaption></figure><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="0076" class="jm jn hh ji b fi jo jp l jq jr">Q3=data.Quantity.quantile(0.95)<br/>Q1=data.Quantity.quantile(0.05)<br/>print(Q1," ",Q3)<br/>1.0 36.0</span></pre><ul class=""><li id="cfa0" class="kh ki hh ig b ih ii il im ip kj it kk ix kl jb km kn ko kp bi translated">看起来销售数量列有异常值</li><li id="8015" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">负的数量看起来像退货。对于这第一次通过，我们将删除它们</li><li id="ffa9" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">大多数订单都在15000英镑以下或左右</li><li id="04a6" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">95%是每张发票36个订单。</li><li id="75d5" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">对于这一轮，我们将筛选数据集，使其少于1，000个订单</li></ul><p id="6b26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">步骤2-:创建指标并创建模型</em> </strong></p><p id="379a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">创建新近度量</em> </strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="f24a" class="jm jn hh ji b fi jo jp l jq jr">sales=data.loc[(data.Quantity&gt;=0)&amp;(data.Quantity&lt;1000),:].copy()</span><span id="6b47" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Getting the first and last invoicedate</em></strong><br/>sales.sort_values(by=['CustomerID','InvoiceDate'],inplace=True)<br/>first_sale=sales.groupby('CustomerID')['InvoiceDate'].first()<br/>last_sale=sales.groupby('CustomerID')['InvoiceDate'].last()</span><span id="45bd" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Creating merging the dataframes with the last and 1st Date</em></strong><br/>sale_date=pd.concat([first_sale,last_sale],axis=1)</span><span id="9fa7" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Defining the recency metric <br/></em></strong>sale_date['datecomp']=datetime.datetime.strptime('2012-01-01','%Y-%m-%d')</span><span id="77c5" class="jm jn hh ji b fi js jp l jq jr">sale_date['recency']=(sale_date.datecomp-sale_date.last_sale).dt.days</span></pre><p id="4667" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">创建频率度量</em> </strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="c354" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi"><em class="jc">#Creating the frequency Metric</em></strong><br/>freq=sales.groupby('CustomerID')['InvoiceNo'].count()</span><span id="c3ae" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc"># Adding the Frequency metric to the main dataset<br/></em></strong>sale_date['freq']=freq</span></pre><p id="9e24" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">创建货币价值指标</em> </strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="4208" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi"><em class="jc">#Create a Monetary Value metric</em></strong><br/>sales['Monetaryval']=sales.Quantity*sales.UnitPrice<br/>Mval=sales.groupby('CustomerID')['Monetaryval'].sum()</span><span id="ec24" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Adding the Monetary value Metric to the dataset<br/></em></strong>sale_date['Mval']=Mval<br/>sale_date</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kv"><img src="../Images/6d16437c82ebb645715de86c0d778f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iCZw-bQt8zf_PugisbX_eg.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">fig 4-: Final dataset with Recency, Frequency and Monetary Value</figcaption></figure><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="f318" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi"><em class="jc">#Selecting only the needed features</em></strong><br/>select_df=sale_date.loc[:,['recency','freq','Mval']].copy()</span><span id="b951" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Standardizing and scaling data</em></strong><br/>X=StandardScaler().fit_transform(select_df)</span><span id="d2ad" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Running with multiple values for clusters<br/></em></strong>ssd=[]<br/>K=range(1,10)<br/>for k in K:<br/>    model=KMeans(n_clusters=k)<br/>    model.fit(X)<br/>    ssd.append(model.inertia_)</span><span id="545f" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Plotting the number of clusters versus the Within Cluster Sum of Square Errors<br/></em></strong>plt.figure(figsize=(12,5))<br/>plt.plot(K,ssd)<br/>plt.xlabel('Number of clusters',fontsize=14)<br/>plt.ylabel('WSSE',fontsize=14)<br/>plt.title('Elbow plot',fontsize=14)</span></pre><ul class=""><li id="010c" class="kh ki hh ig b ih ii il im ip kj it kk ix kl jb km kn ko kp bi translated">以多个K值或集群运行。</li><li id="b0b2" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">然后绘制K值对WSSE的曲线图。</li><li id="b0d0" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">选择K值，其中WSSE(聚类相似性的度量)的增量增益开始变平</li></ul><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kw"><img src="../Images/c80c921d4c24314506ecd75515669baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GN5FaW0uaStchfpLhJFLMA.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">Fig 5-: Identifying optimal number of clusters</figcaption></figure><ul class=""><li id="61c9" class="kh ki hh ig b ih ii il im ip kj it kk ix kl jb km kn ko kp bi translated">K=3时明显的肘点</li><li id="a1cb" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">另一个肘点为K=4(不那么明显)</li></ul><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="1877" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi"><em class="jc">#Running the model with 4 clusters</em></strong><br/>model=KMeans(n_clusters=4)<br/>model.fit(X)</span><span id="b67f" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Adding the cluster labels to the dataset<br/></em></strong>select_df['labels']=model.labels_</span><span id="6730" class="jm jn hh ji b fi js jp l jq jr"><strong class="ji hi"><em class="jc">#Lets look at the clusters<br/></em></strong>select_df.groupby('labels')['CustomerID','freq','Mval','recency'].agg({'CustomerID':'count','freq':'mean','Mval':'mean','recency':'mean'})</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kx"><img src="../Images/5bd0149fcd7974f3372a89bad81f68f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nXkO7l2r5RMvyMNEQfeEaA.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">Fig 6-: Making sense of the clusters</figcaption></figure><p id="bd23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">分类3订购频率最高，价值最高，并且是最新的→白金</p><ul class=""><li id="80b3" class="kh ki hh ig b ih ii il im ip kj it kk ix kl jb km kn ko kp bi translated">分类2的订购频率稍低，价值略低于分类3，最近订购频率稍低→黄金</li><li id="f70b" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">集群0在所有3项指标上都低于2和3→银牌</li><li id="ea5b" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">第1类非常罕见的购物者→青铜</li></ul><p id="5426" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">最终命名的星团</em> </strong></p><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ky"><img src="../Images/9e40d980528923397b05718d8701111c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2G4B14FItCC9IvKKVXg_w.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">Fig 7-: Named clusters</figcaption></figure><p id="c37f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">步骤3-:可能的业务结果</em> </strong></p><ul class=""><li id="6039" class="kh ki hh ig b ih ii il im ip kj it kk ix kl jb km kn ko kp bi translated">向黄金级和白金级客户提供目标优惠。向该细分市场独家推出新产品。针对店内信用卡的白金和金卡客户</li><li id="cb24" class="kh ki hh ig b ih kq il kr ip ks it kt ix ku jb km kn ko kp bi translated">使用优惠来增加银卡客户的新客户。这一细分市场拥有最多的客户，在这里增加频率将对底线产生重大影响。目标电子邮件活动</li></ul><div class="kz la ez fb lb lc"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hi fi z dy lh ea eb li ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jz lc"/></div></div></a></div></div></div>    
</body>
</html>