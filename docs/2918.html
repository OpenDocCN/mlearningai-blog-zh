<html>
<head>
<title>Ivermectin, Covid-19 and death</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伊维菌素、新冠肺炎和死亡</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/ivermectin-covid-19-and-death-355114059c41?source=collection_archive---------3-----------------------#2022-06-27">https://medium.com/mlearning-ai/ivermectin-covid-19-and-death-355114059c41?source=collection_archive---------3-----------------------#2022-06-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="f522" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用二项式、负二项式、贝塔和零膨胀贝塔分布对公布数据进行贝叶斯荟萃分析。</h2></div><p id="4745" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">伊维菌素作为一种可能的新冠肺炎前处理已经受到了很多关注。无论是在研究的数量上，还是从(大部分)医学界的强烈反对上。这篇文章不是要展示伊维菌素是否有效，而是关于分析数据的方法。顺便说一下，这些都是从这个<a class="ae js" href="https://ivmmeta.com/" rel="noopener ugc nofollow" target="_blank">生活系统综述</a>中摘录的。正如你在网站上看到的，有很多关于研究有效性和荟萃分析本身的讨论，这很好。这是科学。</p><p id="2b2f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">简而言之，我下载了数据，只关注死亡率。预选是在那些研究中完成的，这些研究清楚地标明了给药剂量和两组中的事件数。对死亡率的唯一关注是因为这一指标对研究中可能出现的大量偏差更为稳健。几乎所有的研究都有一个可能但严重的局限性，那就是伊维菌素几乎从未作为唯一的药物使用。然而，这篇文章不是为了改变临床政策，而是关于分析这样的数据集。正如您将看到的，尽管可以自由地用多种方式解决它们，但它们可能相当具有挑战性。</p><p id="9018" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">那么，让我们开始吧。这将是相当后，所以我会添加代码之间。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="21f3" class="kc kd hh jy b fi ke kf l kg kh">library(ggplot2)<br/>library(dplyr)<br/>library(brms)             # Bayesian modeling through Stan<br/>library(tidybayes)        # Manipulate Stan objects in a tidy way<br/>library(broom)            # Convert model objects to data frames<br/>library(broom.mixed)      # Convert brms model objects to data frames<br/>library(vdemdata)         # Use data from the Varieties of Democracy (V-Dem) project<br/>library(betareg)          # Run beta regression models<br/>library(extraDistr)       # Use extra distributions like dprop()<br/>library(ggdist)           # Special geoms for posterior distributions<br/>library(gghalves)         # Special half geoms<br/>library(ggbeeswarm)       # Special distribution-shaped point jittering<br/>library(ggrepel)          # Automatically position labels<br/>library(patchwork)        # Combine ggplot objects<br/>library(marginaleffects)  # Calculate marginal effects for frequentist models<br/>library(emmeans)          # Calculate marginal effects in even fancier ways<br/>library(modelsummary)     # Create side-by-side regression tables<br/>library(RColorBrewer)<br/>library(modelr)<br/>library(reshape2)<br/>library(grid)<br/>library(gridExtra)<br/>library(lme4)<br/>library(sjPlot)<br/>library(sjmisc)<br/>library(metafor)<br/>library(meta)<br/>library(dmetar)</span></pre><p id="e657" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我拿的数据来自https://ivmmeta.com/<a class="ae js" href="https://ivmmeta.com/" rel="noopener ugc nofollow" target="_blank">网站。由于数据无法下载，我在Excel文件中重新创建了数据，结果如下。不幸的是，我无法提取所有的数据。</a></p><p id="1e9c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们来看看我得到了什么，并将每项研究转换成比值比。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="66b7" class="kc kd hh jy b fi ke kf l kg kh">df &lt;- read_excel("Data.xlsx")<br/>View(df)<br/>skimr::skim(df)<br/>df%&gt;%print(n=50)</span><span id="a78a" class="kc kd hh jy b fi ki kf l kg kh">df%&gt;%<br/>  mutate(OR = (Treatment_cases/Treatment_N) / (Control_cases/Control_N))%&gt;%<br/>  ggplot(., aes(y=Study, x=OR, colour=Setting))+<br/>  geom_point()+<br/>  geom_vline(xintercept=1, col="black", lty=2)+<br/>  theme_bw()</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk kl km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/307941b7d1ee1d2de2a409358c0cb4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*5gO7V4GBRjBxmgNkpMSxqw.png"/></div></figure><figure class="kj kk kw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/5a9cc8fc6a112ea020b99962be7f48f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*r_wbNJbt488yCosMaPuTlg.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lb di lc ld">The first 39 lines of data coming from the Excel file, and the odds ratio graph. The zero-point in an odds ratio is 1.</figcaption></figure></div><p id="40eb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，分析这个数据集最简单的方法是以一种频繁的方式使用正式的元分析。我已经写了几次关于一个<a class="ae js" href="https://towardsdatascience.com/introduction-to-meta-analysis-in-r-468e9b33925c" rel="noopener" target="_blank">元分析</a>实际上只不过是一个<a class="ae js" rel="noopener" href="/mlearning-ai/introduction-to-mixed-models-in-r-9c017fd83a63">混合模型</a>的文章。你会看到同样的事情发生在这里。使用<a class="ae js" href="https://cran.r-project.org/web/packages/meta/meta.pdf" rel="noopener ugc nofollow" target="_blank"> meta </a>包，我将让内置函数计算每个研究的优势比，并使用<a class="ae js" href="https://pub.towardsai.net/generalized-linear-mixed-models-in-sas-distributions-link-functions-scales-overdisperion-and-4b1c767bb89a" rel="noopener ugc nofollow" target="_blank">广义线性混合模型</a>将它们转换成一个汇总估计。从这个模型中，你可以做很多额外的测试，比如测试发表偏倚、影响分析、分组和元回归。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="85b9" class="kc kd hh jy b fi ke kf l kg kh">dfOR_meta&lt;-dfOR%&gt;%<br/>  dplyr::select(Study,<br/>         Treatment_cases, <br/>         Treatment_N, <br/>         Control_cases, <br/>         Control_N, <br/>         Outcome)%&gt;%<br/>  dplyr::filter(Outcome=="death")%&gt;%<br/>  tidyr::drop_na()</span><span id="74c8" class="kc kd hh jy b fi ki kf l kg kh">meta1&lt;-metabin(Treatment_cases, <br/>               Treatment_N, <br/>               Control_cases, <br/>               Control_N,<br/>              studlab=Study,<br/>              tau.common=FALSE,<br/>              data = dfOR_meta, <br/>              method = "GLMM",<br/>              model.glmm = "CM.AL",<br/>              sm="OR",<br/>              MH.exact = TRUE,<br/>              fixed = FALSE,<br/>              random = TRUE,<br/>              method.tau = "ML",<br/>              prediction = TRUE, <br/>              haln=TRUE)<br/>meta1<br/>summary(meta1)<br/>forest.meta(meta1, layout = "RevMan5")<br/>exp(meta1$TE.random)<br/>meta1$tau2<br/>find.outliers(meta1)<br/>def.inf &lt;- InfluenceAnalysis(meta1, random = TRUE)<br/>plot(def.inf, "baujat")<br/>plot(def.inf, "influence")<br/>plot(def.inf, "es")<br/>plot(def.inf, "i2")<br/>drapery(meta1, <br/>        labels ="studlab",<br/>        type = "pval", <br/>        legend = FALSE)<br/>funnel(meta1)<br/>metabias(meta1, <br/>         method.bias = 'linreg', <br/>         k.min = 5, <br/>         plotit = T)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es le"><img src="../Images/cfc50b5b8db0a561d12b35ea978dc042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWBehC9Cy9z__rIxpmB9fw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The results from the meta-analysis including all studies. It will show you the summary estimate of the odds ratio, the <a class="ae js" rel="noopener" href="/mlearning-ai/inference-estimates-p-values-and-confidence-limits-a-frequentist-approach-acdd45d94bd5">confidence intervals and p-values</a>, the prediction interval and tests of heterogeneity.</figcaption></figure><p id="873a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面的结果最好用森林图来描绘。在这里你可以看到每个研究的优势比，这是驱动结果的数据。此外，您还可以看到汇总估计值和预测间隔。在之前的一篇博文<a class="ae js" rel="noopener" href="/mlearning-ai/confidence-vs-prediction-intervals-576d3047f4c">中，我已经提到了当下面有一个更宽的预测区间时，报告一个显著的置信区间的含义。人们应该同时考虑两者，如果预测区间真的那么宽，置信区间对任何形式的临床应用都没有什么信心。现在看来，这里的情况也将如此。</a></p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lf"><img src="../Images/193298bd77fa5f3a8858364fd171deac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bY8Xwq_pjMxYrqZWLXHuQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The summary estimate is in favor of Ivermectin, but the prediction interval clearly shows that the data cannot be used for individual prediction, and hence it is difficult to estimate how people will react to getting the treatment. In such a case, a full risk analysis needs to be made, which is not done here.</figcaption></figure><p id="407a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，当你有这么多的研究时，看看它们如何影响结果以及它们各自的贡献是很好的。正如您在下面看到的，我已经绘制了每个纳入研究的效应大小变化。实际上，它显示的是如果你忽略一项研究，影响大小是如何变化的。</p><p id="79d1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">很明显，除了最下面的两个，大多数的研究都很小。如果我们回到之前的森林图，你可以看到这些研究确实有更大的样本量，但也有更多的事件。对我来说，不清楚如何实际解释网站上展示的这些结果，所以我最终把它们拿出来了。这是有风险的，现在只有小规模的研究，但至少是我能理解的研究。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lf"><img src="../Images/b5745f0d7381a960d6a83bd4c5a3e451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ViuL2SqYF1AcAZLBYfJUkw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">This is a very neat graph showing the influence of a study.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk lg km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/1d71a6f625db94d81994810d0a009aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*3Nz9bvxKTyAVt4FTewcvOg.png"/></div></figure><figure class="kj kk lh km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/0a4d314421726f921c1a6f7abb6c9b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*GP0q0vjD2KmvfmfC-EGGAQ.png"/></div></figure><figure class="kj kk li km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/585818c696c1331f1aa150f11d02c6b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*iF0l8ONDTbYIWt0CB7cybA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx lj di lk ld">These graphs show the same — how each study influences particular metrics. What you want to see is not only their influence, but also <strong class="bd ll">why </strong>and <strong class="bd ll">how </strong>much they differ. There is nothing wrong with deviating from the rest, but if they have such a big influence, the body of evidence becomes much more fragile.</figcaption></figure></div><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lm"><img src="../Images/1aba38125fbc0f10c0232033c9a97f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4agS5W86kjRvNrRSD4zoA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">This plot is perhaps the most famous of all, besides the forest plot. It’s a funnel plot showing the distribution of the odd-ratio as a function of the standard error. The theory goes that if there is indeed publication bias, small studies will not be shown. Negative results in general will not be shown. So, what you want is an even spread. Once again, I see three studies with extreme positive odds ratio’s for the experimental group with almost no standard error. Keeping those studies in is too much of a risk.</figcaption></figure><p id="8848" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">基于以上结果，我决定删除三项研究。首先，我发现他们在网站上的展示不是很清晰，显示了对照组的极端死亡人数。这很可能是我喜欢的理解，但我仍然想知道如果删除这些研究会发生什么。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f596" class="kc kd hh jy b fi ke kf l kg kh">dfOR_meta2&lt;-dfOR%&gt;%<br/>  dplyr::select(Study,<br/>                Treatment_cases, <br/>                Treatment_N, <br/>                Control_cases, <br/>                Control_N, <br/>                Outcome)%&gt;%<br/>  dplyr::filter(Outcome=="death")%&gt;%<br/>  dplyr::filter(!Study %in% c('Efimenko', <br/>                              'Mayer', <br/>                              'Baguma'))%&gt;%<br/>  tidyr::drop_na()</span><span id="81f9" class="kc kd hh jy b fi ki kf l kg kh">meta2&lt;-metabin(Treatment_cases, <br/>               Treatment_N, <br/>               Control_cases, <br/>               Control_N,<br/>               studlab=Study,<br/>               tau.common=FALSE,<br/>               data = dfOR_meta2, <br/>               method = "GLMM",<br/>               model.glmm = "CM.AL",<br/>               sm="OR",<br/>               MH.exact = TRUE,<br/>               fixed = FALSE,<br/>               random = TRUE,<br/>               method.tau = "ML",<br/>               prediction = TRUE, <br/>               haln=TRUE)<br/>forest.meta(meta2, layout = "RevMan5")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lf"><img src="../Images/866c94221e5db0dba706cafea5e29263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UcI6JJPoOGIxWxMIPrdJfQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And the forest plot. The random effects summary estimate still favors Ivermectin and the confidence intervals are within bounds. However, the prediction interval does not, meaning that there is a lot of uncertainty in the data, and the message is not suited for clinical communication. We do not have any idea who will benefit from this treatment.</figcaption></figure><p id="9e00" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">到目前为止，我们只从全球的角度来看这些研究，没有考虑到更进一步的背景，如<em class="ln">设定</em>或<em class="ln">剂量</em>。让我们来做一个分组分析，仔细看看S<em class="ln">setting</em>。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3924" class="kc kd hh jy b fi ke kf l kg kh">dfOR_meta2_subgroup&lt;-dfOR%&gt;%<br/>  dplyr::select(Study,<br/>                Treatment_cases, <br/>                Treatment_N, <br/>                Control_cases, <br/>                Control_N, <br/>                Outcome, <br/>                Setting)%&gt;%<br/>  dplyr::filter(Outcome=="death")%&gt;%<br/>  dplyr::filter(!Study %in% c('Efimenko', <br/>                              'Mayer', <br/>                              'Baguma'))%&gt;%<br/>  tidyr::drop_na()<br/>meta2_sub&lt;-metabin(Treatment_cases, <br/>               Treatment_N, <br/>               Control_cases, <br/>               Control_N,<br/>               studlab=Study,<br/>               subgroup=Setting,<br/>               tau.common=FALSE,<br/>               data = dfOR_meta2_subgroup, <br/>               method = "GLMM",<br/>               model.glmm = "CM.AL",<br/>               sm="OR",<br/>               MH.exact = TRUE,<br/>               fixed = FALSE,<br/>               random = TRUE,<br/>               method.tau = "ML",<br/>               prediction = TRUE, <br/>               haln=TRUE)<br/>meta2_sub<br/>summary(meta2_sub)<br/>forest.meta(meta2_sub, layout = "RevMan5")<br/>exp(meta1$TE.random)<br/>meta1$tau2<br/>find.outliers(meta1)<br/>def.inf &lt;- InfluenceAnalysis(meta1, random = TRUE)<br/>plot(def.inf, "baujat")<br/>plot(def.inf, "influence")<br/>plot(def.inf, "es")<br/>plot(def.inf, "i2")<br/>drapery(meta1, <br/>        labels ="studlab",<br/>        type = "pval", <br/>        legend = FALSE)<br/>funnel(meta1)<br/>metabias(meta1, <br/>         method.bias = 'linreg', <br/>         k.min = 5, <br/>         plotit = T)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lf"><img src="../Images/b0254635bf9f0bfbc9cf72943575528c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MS6KAj8VGvyuiGFm0tsWQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">This is quite a big forest plot but it does the trick. As you can see, I cut the analysis in three and looked at the odds ratio between Ivermectin and the control for three settings: ‘Early’, ‘Late’ and ‘Prophylaxis’. The last one is actually way to small to create any meaningful sub-group analysis.</figcaption></figure><p id="9a77" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">亚组分析显示对早期设置没有影响，对晚期设置有轻微的积极影响，对预防有积极影响。亚组差异的测试是不显著的，但我不关心这个。在临床上，你在什么样的环境下进行实验性治疗是非常重要的，所以需要进行亚组分析。</p><p id="e460" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，最后两种设置表现出严重的异质性，这限制了数据的可用性。我甚至不得不质疑这种级别的分组划分是否足够。概率是有条件依赖的，可以通过一个变量或一项研究的纳入或排除做出重大反应。此外，即使没有描述，也不需要很长时间就可以解读出后期设置的预测间隔也将超过1，这意味着伊维菌素数据不能用于单独预测谁将从中受益。</p><p id="da77" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">是时候更上一层楼，做更多的造型了。我们还没有触及<em class="ln">剂量</em>，我希望在分析本身中有更多一点的自由。</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="288c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，正如我所说的，元分析是一个广义的线性混合模型，我们可以从不同的角度使用r中可用的不同库来处理它。让我们看看如果我使用<a class="ae js" href="https://cran.r-project.org/web/packages/lme4/index.html" rel="noopener ugc nofollow" target="_blank"> lme4包</a>的<strong class="iy hi"> glmer </strong>函数会发生什么，并查看每个样本中的事件数。现在，我只想看一看变化。为此，我确实需要改变数据的构建方式。</p><p id="7731" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请注意，我正在通过计算比率来准备Beta分布的数据。由于β不喜欢0或1，我将增加或减少一个非常小的数字。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="17f6" class="kc kd hh jy b fi ke kf l kg kh">dfmelt&lt;-df%&gt;%<br/>  dplyr::select(-Outcome)%&gt;%<br/>  melt(., id.vars=c("Study", "Setting", "Dose"))%&gt;%<br/>  tidyr::separate(variable, c("Treatment", "N"))%&gt;%<br/>  dplyr::arrange(Study)%&gt;%<br/>  tidyr::spread(N, value)%&gt;%<br/>  dplyr::filter(!Study %in% c('Efimenko', <br/>                              'Mayer', <br/>                              'Baguma'))<br/>dfmelt$ratio&lt;-dfmelt$cases/dfmelt$N<br/>dfmelt2&lt;-dfmelt%&gt;%<br/>  dplyr::mutate(ratio = ifelse(ratio == 0, 0.001, ratio),<br/>                Dose = ifelse(Treatment == "Control", 0, Dose))%&gt;%<br/>  dplyr::mutate(Treatment = forcats::fct_recode(Treatment, <br/>                                                "Ivermectine" = "Treatment"))<br/>dim(dfmelt2)<br/>dfmelt2%&gt;%print(n=90, na.print="")</span><span id="7b40" class="kc kd hh jy b fi ki kf l kg kh">fit_random_int&lt;-glmer(cbind(cases,N)~1 + (1|Study), <br/>                      data=dfmelt2,<br/>                      family=binomial(link="logit"))<br/>summary(fit_random_int)<br/>plot(fit_random_int)<br/>plot_model(fit_random_int, type="re")<br/>coef(fit_random_int)<br/>fixef(fit_random_int)<br/>exp(fixef(fit_random_int))<br/>ranef(fit_random_int)<br/>fixef(fit_random_int)[[1]]+ranef(fit_random_int)[[1]]</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lv"><img src="../Images/1e9bb894963ebd72c93b241f41cd170e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fDSNgC20za5xBAvlm1rog.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The melted dataset with two lines per study — one for each treatment. We will need this dataset for later analysis.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk lw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/061926bb7108f39f0de9332ef1504565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*nwWMJzhxoj-25PfODmDhTQ.png"/></div></figure><figure class="kj kk lx km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/2e86ac18e27162f14766389fe08241f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*soRuU3E79136DFFHMazCWQ.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ly di lz ld">The analysis is wrong from the beginning, since I have two lines per study yet did not include treatment as the differentiator. It was better of me to just pre-calculate the OR and then look for variation using the <strong class="bd ll">lmer </strong>function, but lets stick with this for a moment.</figcaption></figure></div><figure class="jt ju jv jw fd kk er es paragraph-image"><div class="er es ma"><img src="../Images/cd6b9b2a267ea60002e420ac8d305c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*_QiapR0RnMaAgndRgo9hzA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Here, we can see the random effects from the <strong class="bd ll">glmer </strong>function. It seems that there is sufficient variation, but the analysis is not fail safe, yet. Lets add <strong class="bd ll">Treatment</strong>.</figcaption></figure><p id="323f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，让我们添加<em class="ln">治疗</em>。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1825" class="kc kd hh jy b fi ke kf l kg kh">fit_random_int_b&lt;-glmer(cbind(cases,N)~Treatment + (1|Study), <br/>                        data=dfmelt2,<br/>                        family=binomial(link="logit"))<br/>anova(fit_random_int, fit_random_int_b)<br/>plot_model(fit_random_int_b, type="diag")<br/>plot_model(fit_random_int_b, type="re")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mb"><img src="../Images/9f1254b9c6e9943bb4f50c0ea8d31ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASeL25aD3y0RtM_l8DDjMg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The assumption of normality of the variances is met, at least for the random effect of <strong class="bd ll">Study</strong>.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mc"><img src="../Images/18575a1f3540610ce86c48274e6b1bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0K2_ZhvZ73_yNaV2oDwOg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And of course the model including treatment fits the data MUCH better — I made the data in such a way that treatment would be a very big differentiator. No surprises here. In fact, this model NEEDS to have treatment included, regardless of model performance.</figcaption></figure><p id="b774" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我没有真正做的一件事是查看原始数据，并绘制图表。当然，我们有了第一张显示每项研究优势比的图表，但这还不够。我想看看更原始的数据，因为二项式分布很可能不是最好的选择。你永远不会事先真正知道，有些人可能会说这没关系，但我们不要走那条路。</p><p id="1b0f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你看看原始数据，你会发现很多时候其中一组没有死亡。这很好，这意味着新冠肺炎不致命，但这也意味着我们可能会处理零充气模型，我们需要以不同的方式处理这些问题。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c819" class="kc kd hh jy b fi ke kf l kg kh">ggplot(dfmelt2, aes(x = ratio, fill="All data")) +<br/>  geom_density(alpha = 0.6) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  labs(x = "Proportion of deaths", y = "Density") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span><span id="4625" class="kc kd hh jy b fi ki kf l kg kh">g1&lt;-ggplot(dfmelt2, aes(x = Treatment, y = ratio)) +<br/>  geom_half_point(aes(color = Treatment), <br/>                  transformation = position_quasirandom(width =0.1),<br/>                  side = "l", size = 0.5, alpha = 0.5) +<br/>  geom_half_boxplot(aes(fill = Treatment), side = "r") + <br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_color_viridis_d(option = "plasma", end = 0.8) +<br/>  guides(color = "none", fill = "none") +<br/>  labs(x = "Treatment", y = "Proportion of deaths") +<br/>  ggthemes::theme_clean()<br/>g2&lt;-ggplot(dfmelt2, aes(x = ratio, fill = Treatment)) +<br/>  geom_density(alpha = 0.6) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  labs(x = "Proportion of deaths", y = "Density", fill = "Treatment") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")<br/>grid.arrange(g1,g2,ncol=2)</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk md km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/3f7025bd000a28906035a0abb0b47fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*fBOgpNj3dXNxB4X35Z8O3g.png"/></div></figure><figure class="kj kk me km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/899e207f48cf4fce74309cb2512f087e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*IjLbVBZMHDAZ0Xf14Rmjfw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx mf di mg ld">The data definitely hints at zero-inflated data. It looks very much like a Poisson or a Gamma, but considering the discrete nature of the data, I would say that taking extreme care of that big peak to the left does not hurt.</figcaption></figure></div><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="28f7" class="kc kd hh jy b fi ke kf l kg kh">ggplot(dfmelt2, aes(x = ratio, fill = Treatment)) +<br/>geom_density(alpha = 0.6) +<br/>scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>labs(x = "Proportion of deaths", y = "Density", fill = "Treatment")+<br/>ggthemes::theme_clean() +<br/>facet_wrap(~Setting, scales="free")+<br/>theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mh"><img src="../Images/fa82bf499464a06ca571f9203f6664d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VnfWmy1peXlNiTt0x9UNIg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Splitting the data by <strong class="bd ll">Setting </strong>goes to show how sparse the mortality data is in the Early and Prophylaxis stage. In those settings, I am not even sure if I can make any meaningful analysis. Also, do note that the data in itself is sparse for density functions. Because of the incidental occurrence of death, density functions almost make it seem as if there are some funky things going on, but it is actually just a lack of events we are seeing.</figcaption></figure><p id="5568" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面，你可以看到我经历了几个不同的模型。他们每个人都使用二项式分布，这可能不是最好的分布。对我来说，这是关于看看如果我添加/删除固定和/或随机效果会发生什么。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7f99" class="kc kd hh jy b fi ke kf l kg kh">fit0&lt;-glm(cbind(cases,N)~Treatment+Dose+Setting, <br/>           data=dfmelt2,<br/>           family=binomial())<br/>fit&lt;-glmer(cbind(cases,N)~Treatment+Dose+Setting + <br/>             (1|Study), <br/>           data=dfmelt2,<br/>         family=binomial())<br/>fit2&lt;-glmer(cbind(cases,N)~Treatment+Dose+ <br/>             (1|Study), <br/>           data=dfmelt2,<br/>           family=binomial())<br/>fit3&lt;-glmer(cbind(cases,N)~Treatment*Dose+ <br/>              (1|Study), <br/>            data=dfmelt2,<br/>            family=binomial())<br/>fit4&lt;-glmer(cbind(cases,N)~1+(1|Study), <br/>            data=dfmelt2,<br/>            family=binomial())<br/>fit5&lt;-glmer(cbind(cases,N)~Treatment+(1|Study), <br/>            data=dfmelt2,<br/>            family=binomial())<br/>AIC(fit0, fit, fit2, fit4, fit5)<br/>anova(fit, fit2)<br/>anova(fit4, fit5)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mi"><img src="../Images/303f39f02557ab4012dd888fc6194451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scy2YCs9X9yc50PEQXGpUQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Since not all models have the same number of observations, you cannot compare them.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mj"><img src="../Images/113ff4c38cd1a2f506b5d84c6d65b186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hqd06D55PYG6TnyK89O02A.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><strong class="bd ll">Setting </strong>adds to the model, which could already be depicted from the graphs above. Also, it is best to keep in <strong class="bd ll">Treatment</strong>, but also Dose. It seems that, via indirect comparison, the best model is the model that includes all.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mk"><img src="../Images/3716bead3ea4bd39c1c9ef09c22ea64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXculArOmaHcBcYE6zVdvQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And here we have the fit of the model including the random component of <strong class="bd ll">Study </strong>and the fixed effect of <strong class="bd ll">Treatment</strong>. The variance of <strong class="bd ll">Study </strong>is sufficient to warrant its inclusion and <strong class="bd ll">Treatment </strong>is a significant differentiator. However, without <strong class="bd ll">Setting </strong>and <strong class="bd ll">Dose</strong>, these results do not matter that much. <a class="ae js" href="https://blog.devgenius.io/marginal-vs-conditional-probabilities-visualizations-and-models-in-r-e7288ad26cb9" rel="noopener ugc nofollow" target="_blank">Conditional probabilities</a> have a fun way of reshuffling it all.</figcaption></figure></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="74d5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该走了贝叶斯！在过去的一个月里，我已经发表了几篇展示贝叶斯分析方法的文章，我不会深入讨论贝叶斯理论。为此，你需要看看我的博客列表，或者在网上阅读许多其他优秀的博客。不，这里重要的是我们如何在这个数据集上应用贝叶斯分析，因为正如我已经提到的，伊维菌素是一种并非没有争议的治疗方法。但是，在我转向prior之前，是时候寻找一个更好的发行版了。</p><p id="552e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们从我使用glmer应用的相同分析开始。我最喜欢的贝叶斯包是<a class="ae js" href="https://www.rdocumentation.org/packages/brms/versions/2.17.0" rel="noopener ugc nofollow" target="_blank"> brms </a>。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="22f5" class="kc kd hh jy b fi ke kf l kg kh">get_prior(cases | trials(N)~Treatment+Dose+Setting + (1|Study), <br/>          data=dfmelt2,<br/>          family=binomial(link="logit"))<br/>bayes_binom&lt;-brm(<br/>  cases | trials(N)~Treatment+Dose+Setting + (1|Study), <br/>  data=dfmelt2,<br/>  family=binomial(link="logit"),<br/>  warmup = 1000, <br/>  iter = 4000,<br/>  chains = 4,<br/>  cores=6,<br/>  seed = 123)<br/>summary(bayes_binom)<br/>plot(bayes_binom)<br/>pp_check(bayes_binom, ndraws=100)<br/>prior_summary(bayes_binom)<br/>pp_check(bayes_binom, type = "error_hist", ndraws = 11)<br/>pp_check(bayes_binom, type = "scatter_avg", ndraws = 100)<br/>pp_check(bayes_binom, type = "stat_2d")<br/>pp_check(bayes_binom, type = "loo_pit")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ml"><img src="../Images/cf92a90e01f7d5febe9d3b9d61d9cc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rZboKMlEvVlJ67OJW-89QA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And the first model. It looks good!</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk mm km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/a0d8ff4d7e3b27858860a6f38ff10d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*15jlJW0UceEnvd1IxoyLng.png"/></div></figure><figure class="kj kk mn km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/0781e36e1697be491d15917149b056cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*Zqqd2TxDpoIUixLTcrCoPA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx mo di mp ld">Looking good again.</figcaption></figure></div><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mq"><img src="../Images/0e2383894beaeca221d575be228a1f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUfpyymy6UZUCXYHg46QYg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Good.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/1750065026436e29eb23cc9a04411fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*HAQkzGn2Ok-PJjtymW94hA.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/edae2ef179a434e4e9569b39dc2712e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*jVYL30Mk4EoO0jo56EOoCA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ms di mt ld">And good.</figcaption></figure></div><p id="6a3f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面的模型看起来不错，尽管还远远没有准备好。它不是贝叶斯模型，它的先验直接来自数据。但对我来说，最重要的部分是能够得到一个符合贝叶斯模型在链收敛和抽样方面的所有假设的结果。确实如此。</p><p id="07be" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我们可以创建一个很长的图表列表来显示模型的表现。实际上，它显示了采样是如何进行的。后验概率可以任意偏离可能性。它不需要适合。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7bd5" class="kc kd hh jy b fi ke kf l kg kh">yrep&lt;-posterior_predict(bayes_binom)<br/>y&lt;-dfmelt2$cases[!is.na(dfmelt2$cases) &amp; !is.na(dfmelt2$Dose)]<br/>group&lt;-dfmelt2$Treatment[!is.na(dfmelt2$cases) &amp; !is.na(dfmelt2$Dose)]<br/>x&lt;-dfmelt2$Dose[!is.na(dfmelt2$cases) &amp; !is.na(dfmelt2$Dose)]<br/>bayesplot::ppc_dens_overlay(y, yrep)<br/>bayesplot::ppc_ecdf_overlay(y, yrep[sample(nrow(yrep), 25), ])<br/>bayesplot::ppc_hist(y, yrep[1:8, ])<br/>bayesplot::ppc_boxplot(y, yrep[1:8, ])<br/>bayesplot::ppc_dens(y, yrep[200:202, ])<br/>bayesplot::ppc_freqpoly(y, yrep[1:3,], alpha = 0.1, size = 1, binwidth = 5)<br/>bayesplot::ppc_freqpoly_grouped(y, yrep[1:3,], group) + yaxis_text()<br/>bayesplot::ppc_dens_overlay_grouped(y, yrep[1:25, ], group = group)<br/>bayesplot::ppc_ecdf_overlay_grouped(y, yrep[1:25, ], group = group)<br/>bayesplot::ppc_violin_grouped(y, yrep, group, size = 1.5)<br/>bayesplot::ppc_violin_grouped(y, yrep, group, alpha = 0, y_draw = "points", y_size = 1.5)<br/>bayesplot::ppc_violin_grouped(y, yrep, group, alpha = 0, y_draw = "both",<br/>                   y_size = 1.5, y_alpha = 0.5, y_jitter = 0.33)</span><span id="6998" class="kc kd hh jy b fi ki kf l kg kh">bayesplot::bayesplot_theme_set(ggplot2::theme_linedraw())<br/>bayesplot::color_scheme_set("viridisE")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("mean", "sd"))<br/>bayesplot::bayesplot_theme_set(ggplot2::theme_grey())<br/>bayesplot::color_scheme_set("brewer-Paired")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("median", "mad"))</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk mu km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/2b6e5d0e4732b6f5e4ca88c4069940cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*c9njTD_cuqlfpZOIaf07Jg.png"/></div></figure><figure class="kj kk mv km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/c2427f0e5a79f2a6877434f55d41c06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*qTnelz69P1rBZOHB6txMnQ.png"/></div></figure><figure class="kj kk mv km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/129721fbaf089e494e191d47f88df62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*5I81uaCVzR9SqrzvwM73vQ.png"/></div></figure></div><div class="ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/5d0569f802dc50e43eb93827b64f6c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UYfOim5KJAZ10f46WrUMrA.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/d3f0ec765e6f738e2d218215d462527f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qVuSNxYzPyUrKXSQn-ixRA.png"/></div></figure></div><div class="ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/51c387799bb95cbcdbce425eb2268671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qyw496Da_DTnkHRTXEe9bg.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/4880a0cf6167ba08f24b6034049daf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*O8Glals7Y9WHgcaaDbtZNQ.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ms di mt ld">Lots of plots showing you how the posterior sampling goes and what it amounts to. Without an informative prior, the plots only help you to give some assessment in terms of sampling.</figcaption></figure></div><p id="051a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来是评估我们是否选择了正确发行版的代码。我们把这个叫做<a class="ae js" href="https://en.wikipedia.org/wiki/Probability_integral_transform" rel="noopener ugc nofollow" target="_blank">概率积分变换</a> (PIT)，基本上就是利用CDF性质来<em class="ln">把</em>连续的随机变量转换成均匀分布的。<strong class="iy hi">然而，如果用于生成连续随机变量的分布是真实分布，这仅适用于<em class="ln">和</em>。这里有一篇关于这个的非常好的博文。因此，使用留一法交叉验证，模型转换数据，如果选择的分布是“实际”分布(你永远无法知道)，向均匀分布的转换将在QQ图中显示正态分布的属性。简单，不是吗？不，当然不是，但是除了你永远无法知道正确的分布是什么之外，它是一个有用的检查工具。但是，当涉及到贝叶斯分析时，这也有点违反直觉，因为后验概率是先验概率和似然概率的函数。拥有一个可靠的先验知识和一个可靠的数据收集程序来获取可能性，比检查分布是否正确更重要。</strong></p><p id="fd1b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不管怎样，我们还是去看看吧。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="614a" class="kc kd hh jy b fi ke kf l kg kh">loo1 &lt;- loo(bayes_binom, save_psis = TRUE, cores = 4)<br/>psis1 &lt;- loo1$psis_object<br/>lw &lt;- weights(psis1)<br/>bayesplot::ppc_loo_pit_overlay(y, yrep, lw = lw)+theme_bw()<br/>bayesplot::ppc_loo_pit_qq(y, yrep, lw = lw)+theme_bw()<br/>bayesplot::ppc_loo_pit_qq(y, yrep, lw = lw, compare = "normal")+theme_bw()<br/>keep_obs &lt;- 1:30<br/>bayesplot::ppc_loo_intervals(y, yrep, psis_object = psis1, subset = keep_obs)+theme_bw()<br/>bayesplot::ppc_loo_intervals(y, yrep, psis_object = psis1, subset = keep_obs,<br/>                  order = "median")+theme_bw()</span><span id="aa03" class="kc kd hh jy b fi ki kf l kg kh">ce&lt;-conditional_effects(bayes_binom)<br/>pe&lt;-plot(ce, rug=TRUE)<br/>grid.arrange(pe$Treatment,<br/>             pe$Dose, <br/>             pe$Setting,<br/>             ncol=3)</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk mw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/cc60b15e8b7c01df9294a0f01e4b38e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*fLNVbeXCcUTfxlQlR1jF2Q.png"/></div></figure><figure class="kj kk mw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/5bba5b29558b68f7861bf2070150c385.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*StHm9zXfne3HIw89g4utBA.png"/></div></figure><figure class="kj kk mw km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/7bff9e7be47f0c388f8d67ec137eef26.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*z9aduW4pjUwhcLDkAbIk2w.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx mx di my ld">Looks good! The Beta should do the trick nicely. The Normal distribution is not suited which should not surprise you. Data are discrete, not continuous.</figcaption></figure></div><div class="ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/629f0eda91292f073e64c076c1a49e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*hEm-Xdc42_TmAT39pQRg4A.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/c48f4eae3b889bf71100d93512a12415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pf5LOoN7ZOlDe0BaEDaukQ.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ms di mt ld">And the observed vs predicted plot. The data shows the zero-inflation very clearly.</figcaption></figure></div><p id="c6b8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦建立了一个合适的模型，我们就可以看看这里显示的条件分布。总的来说，没有治疗效果，没有剂量效果，但有明显的设置效果。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es mz"><img src="../Images/b1c752922843f8ce27ab935b0263d3a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niXZobv_3K5PC246yDhdGg.png"/></div></div></figure><p id="f6fe" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，我们还没有完成。</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="6d33" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我之前发表过，离散数据，如二项式数据，可以用多种方法进行分析。你可以选择二项式，<a class="ae js" href="https://pub.towardsai.net/analyzing-ordinal-data-in-sas-using-the-binary-binomial-and-beta-distribution-8efe5fe5af66" rel="noopener ugc nofollow" target="_blank">，就像我在</a>之前做的那样，但也要计算比率并应用beta分布。所以，让我们使用我之前已经计算过的比率，并绘制数据。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="844d" class="kc kd hh jy b fi ke kf l kg kh">ggplot(dfmelt2, aes(y=Study, <br/>                    x=ratio, <br/>                    colour=Treatment))+<br/>  geom_point()+<br/>  theme_bw()</span><span id="e2ae" class="kc kd hh jy b fi ki kf l kg kh">ggplot(dfmelt2, aes(y=ratio, <br/>                    x=log(N), <br/>                    colour=Study))+<br/>  geom_point()+<br/>  facet_wrap(~Treatment)+<br/>  theme_bw()+<br/>  theme(legend.position = "none")</span><span id="7feb" class="kc kd hh jy b fi ki kf l kg kh">ggplot(dfmelt2, aes(y=ratio, <br/>                    x=log(N)))+<br/>  geom_density_2d_filled()+<br/>  facet_wrap(~Treatment)+<br/>  theme_bw()+<br/>  theme(legend.position = "none")</span><span id="8843" class="kc kd hh jy b fi ki kf l kg kh">ggplot(dfmelt2, aes(y=ratio, <br/>                    x=log(N)))+<br/>  geom_density_2d_filled()+<br/>  facet_wrap(~Setting, scales="free")+<br/>  theme_bw()+<br/>  theme(legend.position = "none")</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk na km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/1e6fcb9f7ebd1c70af63f1043b7d4f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*Qi6CbIQGCf8rmiGB9j2CrA.png"/></div></figure><figure class="kj kk nb km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/930093edbe322164207c861d0aa988e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*POVAvgFZg7rtQuVTX097HQ.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx nc di nd ld">In the left plot you can see, per study, the ratio of deaths as a function of the number of people included. For the majority of studies, Ivermectin has a lower ratio than control, but that is not a definitive answer. From the right plot, you may discern the ratio as a function of the sample size. Looks good enough, considering that most studies are really not that big.</figcaption></figure></div><p id="ef66" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是对数据进行<a class="ae js" href="https://towardsdatascience.com/spatial-regression-using-fabricated-data-bbdb35da4851" rel="noopener" target="_blank">空间分析</a>的前奏，它以图形方式告诉我，哪一组的数据更精确。这不是一种比较不同组的正式方法，而是掌握数据的额外步骤。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ne"><img src="../Images/e7c34574f4e2f0815d6ab11053e0d095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24vMPBKSnLfGpWPggLcB7w.png"/></div></div></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nf"><img src="../Images/38a0d52e9504b8ff5581aa0bf45d72d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ji-YWHsEiqsKnSDRmR18wg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The Prophylaxis group just does not have the sample size necessary from which to extract any meaningful analysis.</figcaption></figure><p id="0d6c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是回归测试的第一步。在这里，我将再次使用所有因素作为主效应，并且不包括<strong class="iy hi">研究</strong>的随机成分。我们已经知道它需要被包括在内，但现在让我们只处理数据并应用beta分布。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3306" class="kc kd hh jy b fi ke kf l kg kh">model_beta &lt;- betareg(ratio ~ Treatment + Dose + Setting, <br/>                      data = dfmelt2, <br/>                      link = "logit")<br/>summary(model_beta)<br/>plot(model_beta)<br/>tidy(model_beta)<br/>marginaleffects(model_beta,<br/>                newdata = <br/>                  datagrid(<br/>                    Treatment = c("Ivermectine", "Control"),<br/>                    Dose      = c(14,0),<br/>                    Setting   = c("Early", "Early")))</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ng"><img src="../Images/5be659a06120af3712effc798c25dd85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w-s4jr_wmfLwR_QLdEYQKg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Summary of the beta-model made. The link function is the logit, so we should obtain odds ratios by taking the exponential of the coefficients.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk nh km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/c60c3eeeca4f2110073c0182851887be.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*MyBB88ietkQFHMa1mXaizg.png"/></div></figure><figure class="kj kk ni km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/07e9dd466248a9527082629baef8f4e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*dVfbmDn_0OAgARxWwo69sw.png"/></div></figure></div><div class="ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/b90b756ce1ff2056a4542d9789c083fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*AKNK1PDn2r60Y9v8HzTlpA.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/442252f308f8c93a7a91f926c2ed814e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UtY-SkBvhwYxhoH5-p_jXA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ms di mt ld">Looking good enough, except the bottom right. That is not looking good — I want to see a cloud.</figcaption></figure></div><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nj"><img src="../Images/505e5b616da317107db8769e592b8f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WGPM-urQbPFtzBeARzImFA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The marginal effects as a function of treatment, dose, and setting.</figcaption></figure><p id="de03" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们还使用brms系列创建了一个beta回归。在没有特定先验的情况下，这只是可能性分析，现在我确实包括了<em class="ln">研究</em>的随机成分。在贝叶斯分析中，所有参数都是随机的，所以这有点用词不当，但我想说的是，我将包括一个参数<em class="ln">研究</em>，它是从所有级别的<em class="ln">研究</em>中建立起来的。这不同于单独评估所有研究。</p><p id="1f87" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们开始了，使用Beta分布对数据进行非贝叶斯贝叶斯分析。现在，模型本身应该看起来简单明了，除了一件事，那就是<em class="ln"> phi </em>或精度估计。通常，您可以使用alpha和beta值来使用Beta分布，这将帮助您计算分布的均值和方差。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div class="er es nk"><img src="../Images/e0203fb7265a8898c32cabc2b9501c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*eJM60aMuhpUb8McbDMBOUQ.png"/></div></figure><p id="ca49" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，使用alpha=5和beta =6的Beta分布如下所示:</p><div class="jt ju jv jw fd ab cb"><figure class="kj kk nl km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/ed6535cd421ca17db9bde7c47e056194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*QGLd7iuvIitgDkunAUOMWw.png"/></div></figure><figure class="kj kk nm km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/31ee207f3f75ef80e14ed4a35d42a24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*6bi9siTCycqhTxvByM03Mw.png"/></div></figure></div><p id="47bc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是，我们也可以使用使用平均值和精度的Beta分布，您可以在brms中将其添加为自定义分布。<a class="ae js" href="https://paul-buerkner.github.io/brms/articles/brms_customfamilies.html" rel="noopener ugc nofollow" target="_blank">该公式在数学上看起来像这样</a>:</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div class="er es nn"><img src="../Images/c3b144610e70e9cd66a80f980ae10752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*V8CVKaEGNcB1sLLt3njiGw.png"/></div></figure><p id="b484" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，我要建模的是两个部分:均值和方差，这是我可以在brms中分别做的。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d479" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes &lt;- brm(<br/>  bf(ratio ~ Treatment+Dose+Setting+(1|Study),<br/>     phi ~ Treatment),<br/>  data = dfmelt2,<br/>  family = Beta(),<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234, <br/>  backend = "cmdstanr")<br/>summary(model_beta_bayes)<br/>plot(model_beta_bayes)<br/>tidy(model_beta_bayes, effects = "fixed")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es no"><img src="../Images/9e4953debd4f0679ab131a36afd0c3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HpBZW1npKHrrBN3kPq-CqA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The summary model. You can see that there is a <strong class="bd ll">phi_TreatmentIvermectine</strong> estimate in the bottom. That is the precision estimate, and what I did is tell this model that the mean is determined by the <strong class="bd ll">Treatment</strong>, <strong class="bd ll">Dose</strong>, <strong class="bd ll">Setting </strong>and <strong class="bd ll">Study</strong>. The precision of the model is determined by <strong class="bd ll">Treatment</strong>.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/e1b3bed6e11e8ffccaf157d52601296f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*JNQa3CVp6USVsqcBFVgd4Q.png"/></div></figure><figure class="kj kk mr km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/eb7e22ab116aabeef9097474dc01b25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ESHSdSm1CTpdHq5uecew2w.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ms di mt ld">Distribution of the posterior estimates which all look good. Note that the precision estimate is quite large, but basically comes done to zero.</figcaption></figure></div><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7722" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes %&gt;% <br/>  gather_draws(`b_.*`, regex = TRUE) %&gt;% <br/>  dplyr::mutate(component = ifelse(stringr::str_detect(.variable, "phi_"), "Precision", "Mean"),<br/>                intercept = stringr::str_detect(.variable, "Intercept"))%&gt;%<br/>  ggplot(., aes(x = .value, <br/>                y = forcats::fct_rev(.variable), <br/>                fill = component)) +<br/>  geom_vline(xintercept = 0) +<br/>  stat_halfeye(aes(slab_alpha = intercept), <br/>               .width = c(0.8, 0.95), point_interval = "median_hdi") +<br/>  scale_fill_viridis_d(option = "viridis", end = 0.6) +<br/>  scale_slab_alpha_discrete(range = c(1, 0.4)) +<br/>  guides(fill = "none", slab_alpha = "none") +<br/>  labs(x = "Coefficient", y = "Variable",<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  facet_wrap(vars(component), ncol = 1, scales = "free_y") +<br/>  ggthemes::theme_clean()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es np"><img src="../Images/b7264699e9d48527104c214e39d9e9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j18MLVW1dpZi1_2bGSUG6g.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And here we have our estimates of the mean and the precision in terms of 80% and 95% credible intervals. For sure some estimates seem to have informative credible intervals, but without a suitable prior, it really does not mean much.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="110b" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes %&gt;% <br/>  spread_draws(`b_.*`, regex = TRUE) %&gt;% <br/>  mutate(across(starts_with("b_phi"), ~exp(.))) %&gt;%<br/>  mutate(across((!starts_with(".") &amp; !starts_with("b_phi")), ~plogis(.))) %&gt;%<br/>  gather_variables() %&gt;% <br/>  median_hdi()<br/>emmeans(model_beta_bayes, ~ Treatment,<br/>        transform = "response") %&gt;% <br/>  contrast(method = "revpairwise")<br/>emmeans(model_beta_bayes, ~ Treatment | Setting,<br/>        transform = "response") %&gt;% <br/>  contrast(method = "revpairwise")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nq"><img src="../Images/ae008fb4dfd2a15897c8baa09a88d527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7zhdIuMU9nctT8fc3YoTw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">A tibble showing the estimates in terms of their median and highest density interval.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nr"><img src="../Images/a71440285e0a58710f33342540a75d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zibi2PpdbrNO2GR--g0Ybg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And the differences between the treatments marginally, and conditionally by setting.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="e608" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes %&gt;%<br/>  recover_types(dfmelt2) %&gt;%<br/>  emmeans::emmeans( ~ Treatment) %&gt;%<br/>  emmeans::contrast(method = "pairwise") %&gt;%<br/>  gather_emmeans_draws() %&gt;%<br/>  ggplot(aes(x = .value, <br/>             y = contrast)) +<br/>  stat_halfeye(alpha=0.5)+<br/>  theme_bw()</span><span id="2349" class="kc kd hh jy b fi ki kf l kg kh">emmeans(model_beta_bayes, ~ Treatment | Setting,<br/>        transform = "response") %&gt;% <br/>  contrast(method = "pairwise")%&gt;%<br/>  gather_emmeans_draws()%&gt;%<br/>  dplyr::select(Setting, .value)%&gt;%<br/>  group_by(Setting)%&gt;%summarise(mean = mean(.value), <br/>                                sd = sd(.value))</span><span id="8586" class="kc kd hh jy b fi ki kf l kg kh">model_beta_bayes %&gt;%<br/>  recover_types(dfmelt2) %&gt;%<br/>  emmeans::emmeans( ~ Treatment | Setting, adjust="sidak") %&gt;%<br/>  emmeans::contrast(method = "pairwise") %&gt;%<br/>  gather_emmeans_draws() %&gt;%<br/>  ggplot(aes(x = .value, <br/>             y = contrast, <br/>             fill=Setting)) +<br/>  stat_halfeye(alpha=0.5)+<br/>  theme_bw()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ns"><img src="../Images/1fa746bdeeb1bdd7c7ee47b58dd88a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FPVQtHPWoU2Caqkn7BcBjw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Graph showing the marginal difference.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk nt km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/88da4b519ee2c6cb2cf0381398ed8293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*Nu6i5fQqVvfdWFxJchZ8dA.png"/></div></figure><figure class="kj kk nu km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/d6304347ef466f6e7e2d9c0874bb5445.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*T8H0SmXeILV350q1oiMrow.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx nv di nw ld">Seems that the setting does not affect the difference between the treatments. Not fully congruent with what I saw above, although the difference was indeed small.</figcaption></figure></div><p id="13f2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是相同的贝叶斯模型，但没有随机的<em class="ln">研究</em>。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="a770" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes_fixed &lt;- brm(<br/>  bf(ratio ~ Treatment+Dose+Setting,<br/>     phi ~ Treatment),<br/>  data = dfmelt2,<br/>  family = Beta(),<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234, <br/>  backend = "cmdstanr")<br/>summary(model_beta_bayes_fixed)<br/>LOO(model_beta_bayes_fixed, model_beta_bayes)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nx"><img src="../Images/766013ee5a87bd29bdba4a8271c05469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5aviByE_ClZJLnyMCRrW3g.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Summary of the model.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ny"><img src="../Images/cdb22160de7da477cfa57d17290211c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eszriqaD5tnMNNTLq5ndOA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The model without random <strong class="bd ll">Study </strong>seems to perform better, but the Pareto K diagnostic values of that model are not really good. So, a comparison is not trustworthy by my standards.</figcaption></figure><p id="552a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不过，让我们来看看估计值是如何表现的。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="bc15" class="kc kd hh jy b fi ke kf l kg kh">g1&lt;-model_beta_bayes_fixed %&gt;%<br/>  epred_draws(newdata = tibble(Treatment = c("Ivermectine", "Control"), Setting   = c("Late", "Late"), Dose = c(24,24)))%&gt;%<br/>  ggplot(., aes(x = .epred, y = Treatment, fill = Treatment)) +<br/>  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi")+<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  guides(fill = "none") +<br/>  labs(x = "P (Death | Treatment, Setting = Late, Dose = 24mg)", y = NULL,caption = "80% and 95% credible intervals shown in black") +<br/>  theme_bw()<br/>g2&lt;-model_beta_bayes_fixed %&gt;%<br/>  recover_types(dfmelt2) %&gt;%<br/>  emmeans::emmeans( ~ Treatment) %&gt;%<br/>  emmeans::contrast(method = "pairwise") %&gt;%<br/>  gather_emmeans_draws() %&gt;%<br/>  ggplot(aes(x = .value, y = contrast)) +<br/>  stat_halfeye()+<br/>  theme_bw()<br/>g3&lt;-model_beta_bayes_fixed %&gt;%<br/>  recover_types(dfmelt2) %&gt;%<br/>  emmeans::emmeans( ~ Treatment | Setting, adjust="sidak") %&gt;%<br/>  emmeans::contrast(method = "pairwise") %&gt;%<br/>  gather_emmeans_draws() %&gt;%<br/>  ggplot(aes(x = .value, y = contrast, fill=Setting)) +<br/>  stat_halfeye()+<br/>  theme_bw()+<br/>  theme(legend.position="bottom")<br/>grid.arrange(g1,g2,g3,nrow=3)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nz"><img src="../Images/618c47437dd71d98691a671d4a3f65d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3jJ6DHjgRua8ZMNOFT2TA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Plot showing the posterior distribution of the treatments, separately, their comparison and the comparison per setting. The latter still does not differentiate.</figcaption></figure><p id="1429" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是一个新的模型，这次增加了<em class="ln">设置</em>到精度参数。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="b891" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes_fixed_phi &lt;- brm(<br/>  bf(ratio ~ Treatment+Dose+Setting,<br/>     phi ~ Treatment + Setting),<br/>  data = dfmelt2,<br/>  family = Beta(),<br/>  inits = "0",<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234, <br/>  backend = "cmdstanr")<br/>summary(model_beta_bayes_fixed_phi)<br/>plot(model_beta_bayes_fixed_phi)<br/>LOO(model_beta_bayes_fixed, <br/>    model_beta_bayes,<br/>    model_beta_bayes_fixed_phi)</span><span id="25ca" class="kc kd hh jy b fi ki kf l kg kh">model_beta_bayes_fixed_phi %&gt;% <br/>  predicted_draws(newdata = tibble(Treatment = c("Ivermectine", "Control"),Setting = c("Late", "Late"),Dose = c(24,24))) %&gt;% <br/>  mutate(is_zero = .prediction == 0,.prediction = ifelse(is_zero, .prediction - 0.01, .prediction))%&gt;% ggplot(., aes(x = .prediction)) +geom_histogram(aes(fill = is_zero), binwidth = 0.025,boundary = 0, color = "white") + geom_vline(xintercept = 0) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.5,guide = guide_legend(reverse = TRUE)) + labs(x = "Predicted P(Death | Treatment, Setting = Late, Dose = 24)", y = "Count", fill = "Is zero?") + facet_wrap(vars(Treatment), ncol = 2,labeller = labeller(quota = c(`Treatment` = "Treatment", `Control` = "Control"))) + ggthemes::theme_clean() + theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oa"><img src="../Images/80c61257aa466b0c970e802bf90531e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGtKejlft4Drn3Qlq3-W3w.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">We now have three parameter estimates for precision. Clear to see that none of the precision estimates have an informative posterior to be added to the model. Once again, this is not a full Bayesian analysis. I will get to that in the end.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ob"><img src="../Images/d83ebc7f26fe2ab23ee632d2ffe2c800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0JpAhrVnjvHIFkXUAbvwA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">It seems that the prior model is still the best, but I like the model containing the precision estimates better. However, since those posterior estimates are not really informative there is no reason to keep that model.</figcaption></figure><p id="3042" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我已经提到过数据集中可能有太多的零，如果是这样的话，我也需要建模。那么，用这个模型我实际上预测了多少个零呢？嗯，没有！这似乎是不正确的，所以我们需要很快更仔细地研究数据中零的数量，并找到一种建模的方法。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oc"><img src="../Images/baba4da40d183aa8d438fd6b25f32a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wlKUSD5bNOo69uZZ-Ly2Iw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The Beta distribution model does not predict any zero’s.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="55fb" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes_fixed_phi %&gt;% <br/>  epred_draws(newdata = tidyr::expand_grid(Treatment = "Ivermectine",<br/>                                    Setting = "Late",<br/>                                    Dose = seq(0, 120, by = 1)))%&gt;%<br/>  ggplot(., aes(x = Dose, <br/>                y = .epred)) +<br/>  stat_lineribbon() + <br/>  scale_fill_brewer(palette = "Purples") +<br/>  geom_hline(yintercept=0, col="black", lty=2)+<br/>  labs(x = "Dose ivermectine (mg)", <br/>       y = "P(Deaths%|Dose &amp; Setting = Late)",<br/>       fill = "Credible interval") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span><span id="12cb" class="kc kd hh jy b fi ki kf l kg kh">emtrends(model_beta_bayes_fixed_phi, ~ Dose, var = "Dose", <br/>         transform = "response")<br/>emtrends(model_beta_bayes_fixed_phi, ~ Dose, var = "Dose",<br/>         at = list(Dose = c(20, 50, 80)),<br/>         transform = "response")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es od"><img src="../Images/5a717706adaa1b1380f62e7cc5551428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lILvUUho8wGoGzDrgTDsBQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The relationship between dose and proportion of deaths when <strong class="bd ll">Setting </strong>= ‘Late’.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oe"><img src="../Images/d3ed5879c19f673b69d04b4105bb77c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0YMbJLawO4-54QKx6ZxQ1Q.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The trend for <strong class="bd ll">Dose </strong>at the mean dose, and at specific dosages. All marginally.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ffd8" class="kc kd hh jy b fi ke kf l kg kh">model_beta_bayes_fixed_phi %&gt;% <br/>  emtrends(~ Dose, var = "Dose",<br/>           at = list(Dose = c(14,24,48,96)),<br/>           transform = "response") %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(., aes(x = .value, <br/>                fill = factor(Dose))) +<br/>  geom_vline(xintercept = 0) +<br/>  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",<br/>               slab_alpha = 0.75) +<br/>  scale_fill_viridis_d(option = "viridis", end = 0.6) +<br/>  labs(x = "Average marginal effect of dose (ivermectine)", <br/>       y = "Density", fill = "Dose",<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span><span id="d7ba" class="kc kd hh jy b fi ki kf l kg kh">model_beta_bayes_fixed_phi %&gt;% <br/>  emtrends(~ Dose | Setting, var = "Dose",<br/>           at = list(Dose = c(14,24,48,96)),<br/>           transform = "response") %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(., aes(x = .value, <br/>                fill = factor(Setting))) +<br/>  geom_vline(xintercept = 0) +<br/>  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",<br/>               slab_alpha = 0.75) +<br/>  scale_fill_viridis_d(option = "viridis", end = 0.6) +<br/>  facet_wrap(~Dose, scales="free")+<br/>  labs(x = "Average marginal effect of dose (ivermectine)", <br/>       y = "Density", fill = "Dose",<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  theme_bw() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es of"><img src="../Images/2bcf956862b285609d8fe8acc98c47a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1i7R_AimpPDogSkQ2VHYQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Marginal effect of <strong class="bd ll">Dose</strong>.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es og"><img src="../Images/dc3725d83137932282a9a53b7f826bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QuSHQ-09qYBEKIYBjrMcw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Conditional effect of dosages per setting. There is a clear <strong class="bd ll">Setting*Dose</strong> interaction in this graph, even though I did not model that explicitly. Could also be a sample size issue, in which case I am seeing things that are not there. Will investigate soon.</figcaption></figure><p id="6ae1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但首先，让我们来处理我所知道的零通胀数据。</p><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oh"><img src="../Images/a8950be1e4c6f564555f61cc92a33676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjLbVBZMHDAZ0Xf14Rmjfw.png"/></div></div></figure></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="9363" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以，零膨胀的贝塔分布实际上做了一件贝塔分布没有做的事，那就是模拟多余的零部分。因此，我们现在有三个参数:<strong class="iy hi">表示</strong>、<strong class="iy hi">精度</strong>和<strong class="iy hi">零膨胀</strong>。</p><p id="9256" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看看第一个简单的模型是什么样子的。我将均值和精度建模为截距的函数，随机<em class="ln">研究</em>组件，只寻找零膨胀组件的截距。换句话说，我想看看是否存在零膨胀反应。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="53f4" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi_int_only &lt;- brm(<br/>  bf(ratio ~ 1 + (1|Study),<br/>     phi ~ 1 + (1|Study),<br/>     zi ~ 1),<br/>  data = dfmelt2,<br/>  family = zero_inflated_beta(),<br/>  chains = 4, <br/>  iter = 2000, <br/>  warmup = 1000,<br/>  cores = 6, <br/>  seed = 1234,<br/>  backend = "cmdstanr")<br/>summary(model_beta_zi_int_only)<br/>plot(model_beta_zi_int_only)<br/>pp_check(model_beta_zi_int_only, ndraws=200)<br/>LOO(model_beta_bayes_random, <br/>    model_beta_bayes_random2, <br/>    model_beta_zi_int_only)<br/>tidy(model_beta_zi_int_only, effects = "fixed")<br/>zi_intercept &lt;- tidy(model_beta_zi_int_only, effects = "fixed") %&gt;% <br/>  filter(component == "zi", term == "(Intercept)") %&gt;% <br/>  pull(estimate)<br/>plogis(zi_intercept)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oi"><img src="../Images/400d99e9de76645bbf99a3d0a92b05a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-UJcrpkzIy5R-CZaN3bLDA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Two variance components, and three population-level effects which combine to estimates for the mean, precision, and zero-inflation component. The <strong class="bd ll">sd(phi_Intercept)</strong> shows a somewhat deviating Rhat which will probably light-up in the chain graphs.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nz"><img src="../Images/6c56d729f207b7154f9931d9c6d21a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idrlH_2wDJog4Rw_Lp3tuw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Yes it does.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oj"><img src="../Images/87cea08b3940bd40e9e1e67251889bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JybR2Z2sz2UU9jLeVYvR5A.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Not too bad.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ok"><img src="../Images/8067fb4cf4bf50d43a3adfe61f32979b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Ex7jGErblP3FGQ1ct4ELQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And the zero-inflated model performs much better than other models containing random components.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ol"><img src="../Images/04b161394d3c36e9d51abae90bfa251f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PvzMnV-duPGSLReYwg9UA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Estimates are meaningful.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="61e5" class="kc kd hh jy b fi ke kf l kg kh">df_random&lt;-model_beta_zi_int_only %&gt;%<br/>  spread_draws(r_Study[Study,term])<br/>g1&lt;-ggplot(df_random, aes(x=r_Study, <br/>                      alpha=0.5))+<br/>  geom_density()+<br/>  theme_bw()+theme(legend.position = "none")<br/>prior_summary(model_beta_zi_int_only)<br/>stancode(model_beta_zi_int_only)<br/>g2&lt;-ggplot(df_random, aes(x=r_Study, <br/>                      fill=Study, <br/>                      alpha=0.5))+<br/>  geom_density()+<br/>  theme_bw()+theme(legend.position = "none")<br/>grid.arrange(g1,g2,ncol=2)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es om"><img src="../Images/5913835a4b547004b2005bb8e0cff81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FagIOeFZTZdYEGq-MxCXw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The random component of the model, showing the overall posterior distribution of <strong class="bd ll">Study</strong>, and the <strong class="bd ll">Study-by-Study</strong> estimate that makes up the overall estimate.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3139" class="kc kd hh jy b fi ke kf l kg kh">dfmelt2 %&gt;%<br/>  data_grid(Study) %&gt;%<br/>  add_epred_draws(model_beta_zi_int_only, <br/>                  dpar = c("mu", "phi", "zi"), allow_new_levels=TRUE) %&gt;%<br/>  sample_draws(100) %&gt;%<br/>  ggplot(aes(x = .epred, fill=Study)) +<br/>  geom_density(alpha=0.5) +<br/>  theme_bw()+<br/>  theme(legend.position="none")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es on"><img src="../Images/c5427f8677e8222083401f5614ff200d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_ySl1VFi9Qo2C6R5HLj8A.png"/></div></div></figure><p id="a04c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们更进一步，把感兴趣的变量包括进来。由于数据的稀疏性，我仍然把它们作为主要影响包括在内。这当然是有争议的。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="89c3" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi &lt;- brm(<br/>  bf(ratio ~ Treatment+Dose+Setting,<br/>     phi ~ Treatment,<br/>     zi ~ Treatment),<br/>  data = dfmelt2,<br/>  family = zero_inflated_beta(),<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234,<br/>  backend = "cmdstanr")<br/>summary(model_beta_zi)<br/>pp_check(model_beta_zi, ndraws=200)<br/>LOO(model_beta_zi_int_only, <br/>    model_beta_zi)<br/>yrep&lt;-posterior_predict(model_beta_zi)<br/>x&lt;-dfmelt2$Dose[!is.na(dfmelt2$cases)]<br/>y&lt;-dfmelt2$ratio[!is.na(x)]%&gt;%na.omit()%&gt;%as.vector()<br/>group&lt;-dfmelt2$Treatment[!is.na(x)]<br/>bayesplot::bayesplot_theme_set(ggplot2::theme_linedraw())<br/>bayesplot::color_scheme_set("viridisE")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("mean", "sd"))<br/>bayesplot::bayesplot_theme_set(ggplot2::theme_grey())<br/>bayesplot::color_scheme_set("brewer-Paired")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("median", "mad"))</span><span id="5796" class="kc kd hh jy b fi ki kf l kg kh">theme_set(theme_bw())<br/>ce&lt;-conditional_effects(model_beta_zi)<br/>ce_plot&lt;-plot(ce, rug=TRUE)<br/>grid.arrange(ce_plot$Treatment, <br/>             ce_plot$Dose, <br/>             ce_plot$Setting, <br/>             ncol=3)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oo"><img src="../Images/ac8ed132d9bf454057ff6211e8aecc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFhY4wN33d7z72o_xrObhQ.png"/></div></div></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div class="er es op"><img src="../Images/5d7a1159dd88bfcdc17e219123d9e9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*kDtEffPMk6jAcOjBaNLhiw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Oops. Cannot compare because of different observations used. Due to missing data, the sample size will decrease as NAs are not allowed.</figcaption></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oq"><img src="../Images/890dce3d315ce14956c1d146e9a45b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkPPVa26t7kTXPGdpSYdqA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Looking good.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk or km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/58d84f96924c147516bd31942fcd9501.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*yxjEzJmwysBmFZiSP-rZnQ.png"/></div></figure><figure class="kj kk os km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/bddf8355341bf435bfef775778798b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*hM7wjRRXTRvSHjjDu0T2wA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx ot di ou ld">Looking good as well, nothing funky with the sampling.</figcaption></figure></div><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="37c5" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi %&gt;% <br/>  predicted_draws(newdata = tibble(Treatment = c("Ivermectine", "Control"),<br/>                                   Setting = c("Late", "Late"),<br/>                                   Dose = c(24,24))) %&gt;% <br/>  mutate(is_zero = .prediction == 0,<br/>         .prediction = ifelse(is_zero, .prediction - 0.01, .prediction))%&gt;%<br/>  ggplot(., aes(x = .prediction)) +<br/>  geom_histogram(aes(fill = is_zero), binwidth = 0.025, <br/>                 boundary = 0, color = "white") +<br/>  geom_vline(xintercept = 0) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.5,<br/>                       guide = guide_legend(reverse = TRUE)) +<br/>  labs(x = "Predicted P(Death | Treatment, Setting = Late, Dose = 24)", <br/>       y = "Count", <br/>       fill = "Is zero?") +<br/>  facet_wrap(vars(Treatment), ncol = 2,<br/>             labeller = labeller(quota = c(`Treatment` = "Ivermectine", <br/>                                           `Control` = "Control"))) + <br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ov"><img src="../Images/0242064c5ee93306555324fb3dddeb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ObFX31_yteImrg7hYwmXA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">And the model IS predicting zero’s, which is a function of the zero-inflated model itself.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c2a4" class="kc kd hh jy b fi ke kf l kg kh">get_variables(model_beta_zi)<br/>model_beta_zi %&gt;%<br/>  recover_types(dfmelt2)%&gt;%<br/>  spread_draws(b_Dose)%&gt;%<br/>  ggplot(., aes(x=b_Dose, fill=as.factor(.chain)))+<br/>  geom_density(alpha=0.5)+<br/>  labs(fill="Chain")+<br/>  theme_bw()</span><span id="1a56" class="kc kd hh jy b fi ki kf l kg kh">model_beta_zi%&gt;%<br/>  emmeans(~ Treatment | Setting + Dose,<br/>          at = list(Dose = seq(0, 120, by = 10)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  contrast(method = "revpairwise") %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(., aes(x = .value, y=Setting, fill=factor(Dose))) +<br/>  stat_halfeye(.width = c(0.8, 0.95), <br/>               point_interval = "median_hdi",<br/>               alpha=0.5) +<br/>  labs(x = "Effect of Treatment &amp; Dose on the proportion of deaths by Setting", y = NULL,<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  ggthemes::theme_clean()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ow"><img src="../Images/75624440a1c49fcdaa1774a0455cf787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hQtIv5GUCeaewfpigmlYbA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The marginal effect not showing an informative effect of Ivermectin.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4301" class="kc kd hh jy b fi ke kf l kg kh">get_variables(model_beta_zi)<br/>model_beta_zi %&gt;%<br/>  recover_types(dfmelt2)%&gt;%<br/>  spread_draws(b_Dose)%&gt;%<br/>  ggplot(., aes(x=b_Dose, fill=as.factor(.chain)))+<br/>  geom_density(alpha=0.5)+<br/>  labs(fill="Chain")+<br/>  theme_bw()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ox"><img src="../Images/04d07cc5349ae5094b24f600cc8dcb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g26DZRvbeX3Jx6mGFKHtew.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Chains tend to agree.</figcaption></figure><p id="9a2d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我们有了零膨胀模型，我们可以再次从中提取后验估计。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="955a" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi%&gt;%<br/>  emmeans(~ Treatment | Setting + Dose,<br/>          at = list(Dose = seq(0, 120, by = 10)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  contrast(method = "revpairwise") %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(., aes(x = .value, y=Setting, fill=factor(Dose))) +<br/>  stat_halfeye(.width = c(0.8, 0.95), <br/>               point_interval = "median_hdi",<br/>               alpha=0.5) +<br/>  labs(x = "Effect of Treatment &amp; Dose on the proportion of deaths by Setting", y = NULL,<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  ggthemes::theme_clean()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oy"><img src="../Images/b9ec015b17e26dec564ea8fe94b2f58a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Vj8PHafZsHBpJRW4PozQw.png"/></div></div></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d620" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi %&gt;% <br/>  emmeans(~ Treatment + Dose,<br/>          at = list(Dose = seq(0, 120, by = 1)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(.,<br/>       aes(x = Dose, <br/>           y = .value, <br/>           color = Treatment, <br/>           fill = Treatment)) +<br/>  stat_lineribbon(aes(fill_ramp = stat(level))) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_color_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_fill_ramp_discrete(range = c(0.2, 0.7)) +<br/>  geom_point(data=dfmelt2, aes(x=Dose, y=ratio), col="black")+<br/>  facet_wrap(vars(Treatment), ncol = 2,<br/>             labeller = labeller(Treatment = c(`Ivermectine` = "Ivermectine",<br/>                                           `Control` = "Control"))) +<br/>  labs(x = "Dose (ivermectine)",<br/>       y = "Predicted proportion of deaths",<br/>       fill = "Treatment", color = "Treatment",<br/>       fill_ramp = "Credible interval") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es oz"><img src="../Images/ca15f7a5cb86f56df8585f953ec49b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5GqiMcWG-eiQymWEu-Zlw.png"/></div></div></figure><p id="2a0b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们运行其他模型，将它们与之前的模型进行比较。我确实在一些模型中包含了交互作用。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3e1c" class="kc kd hh jy b fi ke kf l kg kh">model_beta_zi_2 &lt;- brm(<br/>  bf(ratio ~ Treatment*Dose+Setting,<br/>     phi ~ Treatment,<br/>     zi ~ Treatment),<br/>  data = dfmelt2,<br/>  family = zero_inflated_beta(),<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234,<br/>  backend = "cmdstanr")<br/>summary(model_beta_zi_2)<br/>LOO(model_beta_zi, model_beta_zi_2)</span><span id="a578" class="kc kd hh jy b fi ki kf l kg kh">model_beta_zi_3 &lt;- brm(<br/>  bf(ratio ~ Treatment + Dose+Setting,<br/>     phi ~ Treatment,<br/>     zi ~ Treatment),<br/>  data = dfmelt2,<br/>  family = zero_inflated_beta(),<br/>  chains = 4, iter = 2000, warmup = 1000,<br/>  cores = 6, seed = 1234,<br/>  backend = "cmdstanr")<br/>summary(model_beta_zi_3)<br/>LOO(model_beta_zi,<br/>    model_beta_zi_2, <br/>    model_beta_zi_3)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div class="er es pa"><img src="../Images/8fd64fa43edd533098b6d7a6f4760502.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*tHIvptSXQrsd8-jhYwLLIw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">No real difference between the models. Interaction between <strong class="bd ll">Dose </strong>and <strong class="bd ll">Treatment </strong>does not add much, and any interaction with <strong class="bd ll">Setting </strong>will be messy with Prophylaxis. I could take that one out as well, but I will stick with it when I move to a full Bayesian analysis.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="03f5" class="kc kd hh jy b fi ke kf l kg kh">ndraws = 50<br/>dfmelt2%&gt;%<br/>  group_by(Treatment, Setting) %&gt;%<br/>  data_grid(Dose= seq_range(Dose, n = 101)) %&gt;%<br/>  add_epred_draws(model_beta_zi_3, ndraws = ndraws) %&gt;%<br/>  ggplot(aes(x = Dose, y = ratio, color = factor(Treatment))) +<br/>  geom_line(aes(y = .epred, group = paste(Treatment, .draw)), alpha=0.3) +<br/>  geom_point(data = dfmelt2, aes(x=Dose, y=ratio, color=Treatment)) +<br/>  scale_color_brewer(palette = "Dark2")+<br/>  facet_wrap(~Setting)+<br/>  theme_bw()+<br/>  theme(legend.position = "none")</span><span id="89ef" class="kc kd hh jy b fi ki kf l kg kh">dfmelt2%&gt;%<br/>  group_by(Treatment, Setting) %&gt;%<br/>  data_grid(Dose= seq_range(Dose, n = 101)) %&gt;%<br/>  add_predicted_draws(model_beta_zi_3) %&gt;%<br/>  ggplot(aes(x = Dose, y = ratio, <br/>             color = factor(Treatment), <br/>             fill =factor(Treatment))) +<br/>  stat_lineribbon(aes(y = .prediction), .width = c(.95, .80, .50), alpha = 1/4) +<br/>  geom_point(data = dfmelt2) +<br/>  scale_fill_brewer(palette = "Set2") +<br/>  scale_color_brewer(palette = "Dark2")+<br/>  facet_wrap(~Setting)+<br/>  labs(fill = "Treatment", color="")+<br/>  guides(color = FALSE)+<br/>  theme_bw()</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk pb km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/ac79938ab79687a37a331d6c1cd5e892.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*_3Om7OqWrn8t2f3TgzKqzw.png"/></div></figure><figure class="kj kk pc km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/6ccabd54845aa3c74da0a1327a860860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*YHC--bmiHqNyzkQveWKJuQ.png"/></div></figure></div><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7d08" class="kc kd hh jy b fi ke kf l kg kh">dfmelt2%&gt;%<br/>  group_by(Treatment, Setting) %&gt;%<br/>  data_grid(Dose= seq_range(Dose, n = 101)) %&gt;%<br/>  add_predicted_draws(model_beta_zi_3) %&gt;%<br/>  ggplot(aes(x = Dose, y = ratio)) +<br/>  stat_lineribbon(aes(y = .prediction), <br/>                  .width = c(.99, .95, .8, .5), color = brewer.pal(5, "Blues")[[5]]) +<br/>  geom_point(data = dfmelt2) +<br/>  scale_fill_brewer() +<br/>  facet_grid(Treatment ~ Setting, space = "free_x", scales = "free_x")+<br/>  theme_bw()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pd"><img src="../Images/5e95a8fc0a2832b4b048063a90d3763e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*re1WD5bSnOuvrfGAIpLsUw.png"/></div></div></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pd"><img src="../Images/5e95a8fc0a2832b4b048063a90d3763e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*re1WD5bSnOuvrfGAIpLsUw.png"/></div></div></figure><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pd"><img src="../Images/5e95a8fc0a2832b4b048063a90d3763e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*re1WD5bSnOuvrfGAIpLsUw.png"/></div></div></figure><p id="e84e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以，上面的图显示了来自模型的后验绘制。这一切看起来非常好，整洁，令人印象深刻，但它不是一个完整的贝叶斯分析。没有一个信息丰富的先验，这是不可能的，所以我们现在就做！</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="a264" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是我想展示的最终模型。这是一个<strong class="iy hi">零膨胀贝塔回归模型</strong>，我从其中建模出<strong class="iy hi">均值</strong>、<strong class="iy hi">精度</strong>和<strong class="iy hi">零膨胀</strong>。前科都是一样的——一个信息丰富的没有什么区别的前科。伊维菌素已经与许多人进行了很多讨论，认为它对新冠肺炎没有任何帮助。它是动物体内的除虫剂，所以你为什么要用它呢？因此，我会加上先验，加上几乎可以肯定它对死亡比例没有任何影响的数学等价。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="af31" class="kc kd hh jy b fi ke kf l kg kh">model_formula&lt;-bf(<br/>    ratio ~ Treatment + Dose + Setting + (1|Study),<br/>    phi ~ Treatment + Setting,<br/>    zi ~ Treatment + Setting)<br/>get_prior(<br/>  model_formula,<br/>  data = dfmelt2,<br/>  family = zero_inflated_beta())<br/>priors&lt;-c(prior(normal(0, 2),  class = b, coef=Dose),<br/>          prior(normal(0, 2),  class = b, coef=SettingLate),<br/>          prior(normal(0, 2),  class = b, coef=SettingProphylaxis),<br/>          prior(normal(0, 2),  class = b, coef=TreatmentIvermectine),<br/>          prior(normal(0, 2),  class = Intercept),<br/>          prior(normal(0, 2),  class = sd, group=Study),<br/>          prior(normal(0, 2),  class = Intercept, dpar=phi),<br/>          prior(normal(0, 2),  class = b, coef=SettingLate, dpar=phi),<br/>          prior(normal(0, 2),  class = b, coef=SettingProphylaxis, dpar=phi),<br/>          prior(normal(0, 2),  class = b, coef=TreatmentIvermectine, dpar=phi),<br/>          prior(normal(0, 2),  class = Intercept, dpar=zi),<br/>          prior(normal(0, 2),  class = b, coef=SettingLate, dpar=zi),<br/>          prior(normal(0, 2),  class = b, coef=SettingProphylaxis, dpar=zi),<br/>          prior(normal(0, 2),  class = b, coef=TreatmentIvermectine, dpar=zi))<br/>bayes_beta_final&lt;-<br/>  brm(model_formula, <br/>      data=dfmelt2,<br/>      family=zero_inflated_beta(),<br/>      prior=priors,<br/>      control = list(adapt_delta = 0.91,<br/>                     max_treedepth = 11),<br/>      chains = 4, iter = 4000, warmup = 1000,<br/>      cores = 6, seed = 1234, <br/>      threads = threading(12),<br/>      backend = "cmdstanr")<br/>summary(bayes_beta_final)<br/>plot(bayes_beta_final)</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pe"><img src="../Images/73d08ec0431e8e52fbf3697b397abf4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H8EjAGNcB0zvkQQgnKbE_A.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Models looks good in terms of sampling.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="kj kk pf km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/97d130d40a171f2b3fd55b0a3115f7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*lCYyJ1U-c2y_RnGLhoIugg.png"/></div></figure><figure class="kj kk pg km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/47cbed4057ee5092fa9a6240f5e4f584.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*W6EjdzTVCaOTwx29mQ-NcA.png"/></div></figure><figure class="kj kk ph km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/07ceae061e7bf4f962b2e7e53a576ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*fBjr4yiF-wfM1oreL2bR2A.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx pi di pj ld">Chains also show the model looks good.</figcaption></figure></div><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7180" class="kc kd hh jy b fi ke kf l kg kh">pp_check(bayes_beta_final, ndraws=100)<br/>LOO(model_beta_zi,<br/>    model_beta_zi_2, <br/>    model_beta_zi_3, <br/>    bayes_beta_final) # final model definitly not the best <br/>yrep&lt;-posterior_predict(bayes_beta_final)<br/>x&lt;-dfmelt2$Dose[!is.na(dfmelt2$cases)]<br/>y&lt;-dfmelt2$ratio[!is.na(x)]%&gt;%na.omit()%&gt;%as.vector()<br/>group&lt;-dfmelt2$Treatment[!is.na(x)]<br/>bayesplot::bayesplot_theme_set(ggplot2::theme_linedraw())<br/>bayesplot::color_scheme_set("viridisE")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("mean", "sd"))+theme_bw()<br/>bayesplot::bayesplot_theme_set(ggplot2::theme_grey())<br/>bayesplot::color_scheme_set("brewer-Paired")<br/>bayesplot::ppc_stat_2d(y, yrep, stat = c("median", "mad"))+theme_bw()</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kj kk pk km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/136b9002f2daa52121ce1f233f8eda4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*OYnKZYZrNkhxfVM_AI4YlA.png"/></div></figure><figure class="kj kk pl km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/b93abcc6cfaa3dfcb837762739fef80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*dF4ej_1qBtq5VvOWW_gs_g.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx pm di pn ld">Left: looking good. Right: the model with the informative prior is deemed to be the worst, with the other three being equally better. Still, I will keep this model. It HAS informative priors and the rest are just likelihood models.</figcaption></figure></div><div class="ab cb"><figure class="kj kk po km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/00f82f8eecd4bc1e93319584dd56ae72.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*kOOau7ox33tFu6dWJZNdKA.png"/></div></figure><figure class="kj kk pp km kn ko kp paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><img src="../Images/22e7c4d641d77444214c24d86b15f650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*7fVmc5OBaG_HUEAaA1Zlxw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx pq di pr ld">Sampling looking good.</figcaption></figure></div><p id="53a2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来是有趣的部分——后面的抽奖。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="698d" class="kc kd hh jy b fi ke kf l kg kh">bayes_beta_final%&gt;% <br/>  predicted_draws(newdata = tibble(Treatment = c("Ivermectine", "Control"),<br/>                                   Setting = c("Late", "Late"),<br/>                                   Dose = c(24,24), <br/>                                   Study = c('Ravikirti', 'Ravikirti'))) %&gt;% <br/>  mutate(is_zero = .prediction == 0,<br/>         .prediction = ifelse(is_zero, .prediction - 0.01, .prediction))%&gt;%<br/>  ggplot(., aes(x = .prediction)) +<br/>  geom_histogram(aes(fill = is_zero), binwidth = 0.025, <br/>                 boundary = 0, color = "white") +<br/>  geom_vline(xintercept = 0) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.5,<br/>                       guide = guide_legend(reverse = TRUE)) +<br/>  labs(x = "Predicted P(Death | Treatment, Setting = Late, Dose = 24, Study = Ravikirti)", <br/>       y = "Count", <br/>       fill = "Is zero?") +<br/>  facet_wrap(vars(Treatment), ncol = 2,<br/>             labeller = labeller(quota = c(`Treatment` = "Ivermectine", <br/>                                           `Control` = "Control"))) + <br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ps"><img src="../Images/feca3309c976f165b643a7997595ca12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxkBa3WYpkRqy_JRYwHRqA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">The difference in terms of treatments is large, in which we model equal zero’s in both groups but a much more skewed distribution in the Ivermectine group.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="30c5" class="kc kd hh jy b fi ke kf l kg kh">bayes_beta_final %&gt;% <br/>  emmeans(~ Treatment + Dose ,<br/>          at = list(Dose = seq(0, 120, by = 20)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(.,<br/>         aes(x = Dose, <br/>             y = .value, <br/>             color = Treatment, <br/>             fill = Treatment)) +<br/>  stat_lineribbon(aes(fill_ramp = stat(level))) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_color_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_fill_ramp_discrete(range = c(0.2, 0.7)) +<br/>  facet_wrap(vars(Treatment), ncol = 2,<br/>             labeller = labeller(Treatment = c(`Ivermectine` = "Ivermectine",<br/>                                               `Control` = "Control"))) +<br/>  labs(x = "Dose (ivermectine)",<br/>       y = "Predicted proportion of deaths",<br/>       fill = "Treatment", color = "Treatment",<br/>       fill_ramp = "Credible interval") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pt"><img src="../Images/f308cba263e2f3bfa70f1e8f2b3ee43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1HSikaAQAhLa6TKcug-8w.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Don’t be alarmed by the curve in the placebo group (which has no dose). The prediction actually comes from the function of the other variables included. So it is an artefact.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4271" class="kc kd hh jy b fi ke kf l kg kh">bayes_beta_final %&gt;% <br/>  emmeans(~ Setting + Dose,<br/>          at = list(Dose = seq(0, 120, by = 20)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(.,<br/>         aes(x = Dose, <br/>             y = .value, <br/>             color = Setting, <br/>             fill = Setting)) +<br/>  stat_lineribbon(aes(fill_ramp = stat(level))) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_color_viridis_d(option = "plasma", end = 0.8) +<br/>  scale_fill_ramp_discrete(range = c(0.2, 0.7)) +<br/>  facet_wrap(vars(Setting), ncol = 2,<br/>             labeller = labeller(Setting = c(`Early` = "Early",<br/>                                               `Late` = "Late",<br/>                                             `Prophylaxis` = "Prophylaxis"<br/>                                             ))) +<br/>  labs(x = "Dose (ivermectine)",<br/>       y = "Predicted proportion of deaths",<br/>       fill = "Setting", color = "Setting",<br/>       fill_ramp = "Credible interval") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pu"><img src="../Images/3b86b0584e1aabef84cf8e9c0a1f4cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xenX7j3YVIYZvVYJgSpJw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">By setting. Quite some uncertainty, and we know that several settings, like early and prophylaxis, do not seem to lend themselves for any formal analysis.</figcaption></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="083e" class="kc kd hh jy b fi ke kf l kg kh">bayes_beta_final %&gt;% <br/>  emmeans(~ Treatment + Setting + Dose,<br/>          at = list(Dose = seq(0, 120, by = 20)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(.,<br/>         aes(x = Dose, <br/>             y = .value, <br/>             color = Treatment, <br/>             fill = Treatment)) +<br/>  stat_lineribbon(aes(fill_ramp = stat(level))) +<br/>  scale_fill_viridis_d(option = "plasma", end = 0.8, alpha=0.5) +<br/>  scale_color_viridis_d(option = "plasma", end = 0.8, alpha=0.5) +<br/>  scale_fill_ramp_discrete(range = c(0.2, 0.7)) +<br/>  geom_point(data=dfmelt2, aes(x=Dose, y=ratio, col=Treatment))+<br/>  facet_wrap(vars(Setting), <br/>             ncol = 3,<br/>             labeller = labeller(Setting = c(`Early` = "Early",<br/>                                             `Late` = "Late",<br/>                                             `Prophylaxis` = "Prophylaxis")))  +<br/>  labs(x = "Dose (ivermectine)",<br/>       y = "Predicted proportion of deaths",<br/>       fill = "Treatment", <br/>       color = "Treatment",<br/>       fill_ramp = "Credible interval") +<br/>  ggthemes::theme_clean() +<br/>  theme(legend.position = "bottom")</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es pv"><img src="../Images/71fda18bf32f90a13c9740de776d6724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiO4us3aztzNNM4XIz2ihg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">By <strong class="bd ll">Treatment </strong>and <strong class="bd ll">Setting</strong>. Shows again that the posterior by <strong class="bd ll">Dose </strong>makes no sense, it is an artefact of the rest of the model.</figcaption></figure><p id="0f7c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最终模型显示了作为<em class="ln">设置</em>和<em class="ln">剂量</em>函数的处理之间的对比。<em class="ln">剂量</em>确实是一个实验，所以应该小心使用，但它确实清楚地显示:</p><ol class=""><li id="e9e2" class="pw px hh iy b iz ja jc jd jf py jj pz jn qa jr qb qc qd qe bi translated">伊维菌素组的死亡比例低于对照组。</li><li id="c9cb" class="pw px hh iy b iz qf jc qg jf qh jj qi jn qj jr qb qc qd qe bi translated">效果因<em class="ln">设置</em>而异。</li><li id="3f4f" class="pw px hh iy b iz qf jc qg jf qh jj qi jn qj jr qb qc qd qe bi translated">预防法没有足够的数据告诉我们任何事情。</li><li id="fac2" class="pw px hh iy b iz qf jc qg jf qh jj qi jn qj jr qb qc qd qe bi translated">“无效”的先验不能带走数据中的东西，它可能仍然有其局限性。</li></ol><p id="5094" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，这些发现不是最终的，分析将受益于未来的贝叶斯更新。但目前看来，数据似乎在告诉我们，伊维菌素对死亡比例的影响不太可能为零。目前还无法预测谁将从中受益。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="38f9" class="kc kd hh jy b fi ke kf l kg kh">bayes_beta_final%&gt;%<br/>  emmeans(~ Treatment | Setting + Dose,<br/>          at = list(Dose = seq(0, 120, by = 10)),<br/>          epred = TRUE,<br/>          re_formula = NULL) %&gt;% <br/>  contrast(method = "revpairwise") %&gt;% <br/>  gather_emmeans_draws()%&gt;%<br/>  ggplot(., aes(x = .value, y=contrast, fill=factor(Dose))) +<br/>  stat_halfeye(.width = c(0.8, 0.95), <br/>               point_interval = "median_hdi",<br/>               alpha=0.5) +<br/>  labs(x = "P(death | Treatment, Setting &amp; Dose) - Informative prior assuming no effects overal", y = NULL,<br/>       caption = "80% and 95% credible intervals shown in black") +<br/>  facet_wrap(~Setting, scales="free")+<br/>  labs(fill="Dose")+<br/>  ggthemes::theme_clean()</span></pre><figure class="jt ju jv jw fd kk er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es qk"><img src="../Images/4f4942acd3edf5cebd0a99916e086dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sYJfA4r-egtdQg91j4_Cpw.png"/></div></div></figure><p id="6d82" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我知道是否有什么遗漏，错误或者只是简单的错误！</p><div class="ql qm ez fb qn qo"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="qp ab dw"><div class="qq ab qr cl cj qs"><h2 class="bd hi fi z dy qt ea eb qu ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="qv l"><h3 class="bd b fi z dy qt ea eb qu ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="qw l"><p class="bd b fp z dy qt ea eb qu ed ef dx translated">medium.com</p></div></div><div class="qx l"><div class="qy l qz ra rb qx rc ku qo"/></div></div></a></div></div></div>    
</body>
</html>