<html>
<head>
<title>One Transformation we cannot model without in Pyspark — VectorAssembler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark中不可或缺的一个转换——vector assembler</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/one-transformation-we-cannot-model-without-in-pyspark-vectorassembler-a36f58f9ed3b?source=collection_archive---------8-----------------------#2022-11-02">https://medium.com/mlearning-ai/one-transformation-we-cannot-model-without-in-pyspark-vectorassembler-a36f58f9ed3b?source=collection_archive---------8-----------------------#2022-11-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/852e68ec3f9fe18368abe576d75d1481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xEkcJPTZh-9_waNI"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@bekkybekks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bekky Bekks</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="13ed" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi jt translated">大家好！</p><blockquote class="kc kd ke"><p id="7c57" class="iv iw kf ix b iy iz ja jb jc jd je jf kg jh ji jj kh jl jm jn ki jp jq jr js ha bi translated">Databricks <strong class="ix hi">为您的所有数据提供一个统一、开放的平台</strong>。它为数据科学家、数据工程师和数据分析师提供了一个简单的协作环境，让他们能够运行交互式的预定数据分析工作负载。你可以得到你自己的一块馅饼来做实验。它让你能够用少数几种编程语言进行分析。</p></blockquote><p id="0124" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">在本帖中，我们将看到一个我们离不开的转变，即VectorAssembler，首先让我尝试回答为什么需要它:</p><p id="be1b" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">VectorAssembler是为了提高效率和规模。向量汇编器将使用spark vector等技术有效地表达这些特性，这有助于更好地处理数据和有效地管理内存。这有助于建模算法即使在大型数据列中也能高效运行。</p><p id="425e" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">换句话说，VectorAssembler是一个转换器，它将给定的列列表组合成一个向量列。这对于将原始特征和由不同特征转换器生成的特征组合成单个特征向量以训练ML模型是有用的。VectorAssembler接受以下输入列:</p><ul class=""><li id="52e4" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js ko kp kq kr bi translated">全是数字。</li><li id="3191" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">布尔类型。</li><li id="3211" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">向量类型。</li></ul><blockquote class="kc kd ke"><p id="0185" class="iv iw kf ix b iy iz ja jb jc jd je jf kg jh ji jj kh jl jm jn ki jp jq jr js ha bi translated">你可以设置你自己的databricks版本进行实验，查看细节，在我之前的文章中有详细介绍</p></blockquote><div class="kx ky ez fb kz la"><a rel="noopener follow" target="_blank" href="/mlearning-ai/how-to-use-data-bricks-community-edition-9b899a2c0f40"><div class="lb ab dw"><div class="lc ab ld cl cj le"><h2 class="bd hi fi z dy lf ea eb lg ed ef hg bi translated">如何使用数据砖社区版？</h2><div class="lh l"><h3 class="bd b fi z dy lf ea eb lg ed ef dx translated">在这篇文章中，你将学习如何获得你的数据砖社区版！</h3></div><div class="li l"><p class="bd b fp z dy lf ea eb lg ed ef dx translated">medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo io la"/></div></div></a></div><p id="c411" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">让我们先看看基本的</p><ol class=""><li id="5bf1" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js lp kp kq kr bi translated">开始导入库</li></ol><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Importing Libraries</figcaption></figure><p id="c91d" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">2.让我们创建一个虚拟数据集</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Creating the dataset for this experiment</figcaption></figure><p id="ecf7" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">3.在这个实验中，id对于每个用户都是唯一的&amp; clicked是目标变量，所以我们将转换剩余的3个变量。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Applying Transformation</figcaption></figure><p id="cb27" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">正如我们看到的，已经创建了一个名为features的新列，它将所有的特征向量封装到一个列中。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Final output selecting only the transformed features &amp; target Variable(Clicked)</figcaption></figure></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><p id="0411" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">在下一个实验中，我们将转换一个数据集，其中也有分类变量，当我们处理分类变量/特征时，我们必须首先将它们转换为数字并应用一个热编码，为此我们将借助stringIndexers &amp; OneHotEncoding等方法，让我们深入了解它们的定义:</p><p id="8174" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi"/></p><ul class=""><li id="9fb7" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js ko kp kq kr bi translated">frequencyDesc:按标签频率降序排列分配最频繁的标签0)</li><li id="a366" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">frequencyAsc:按标签频率升序排列(最不频繁的标签分配为0)</li><li id="2269" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">alphabetDesc:按字母降序排列</li><li id="f6a7" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">alphabetAsc:升序字母顺序</li></ul><p id="d44b" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi"> <em class="kf"> OneHotEncoding </em> </strong>:一个一键编码器，将一列类别索引映射到一列二进制向量，每行最多只有一个1值，表示输入的类别索引。</p><p id="0a6f" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">让我们在一个例子中实现这个过程，同时注意，当我们处理分类变量时，这将是实际向量汇编过程的前奏。</p><ol class=""><li id="7efe" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js lp kp kq kr bi translated">创建虚拟数据集</li></ol><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Sample dataset creation for Experiment #2</figcaption></figure><p id="91a3" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">2.现在，我们这里有3个字符串列，即姓名、资格和性别，快速检查分类列的不同值，给我们以下见解。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Checking the available values for variable</figcaption></figure><p id="07f0" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">3.在这个例子中，我们将对限定进行实验。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">String Indexer for one column</figcaption></figure><p id="5953" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">需要对每个分类列重复这个过程。为了保持示例的简单性，让我们对qualification示例本身实现onehotencoding，这里我们将使用“qualification_index”作为输入列，qualification_ohe作为输出。</p><p id="af1b" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">4.对索引列执行一次热编码</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">One Hot Encoding</figcaption></figure></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><p id="4ed9" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">正如我们在上面看到的，必须对所有变量重复两步过程(stringIndexer &amp; OneHotEncoding ),我们尝试了一个称为管道的概念，它将为我们对所有列执行此过程。</p><ol class=""><li id="e84a" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js lp kp kq kr bi translated">像往常一样，我们首先创建一个样本数据集</li></ol><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Sample Dataset for Experiment #3</figcaption></figure><p id="2a12" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">该数据集是数值列和分类列的混合。</p><p id="e2ad" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">2.然后，我们定义希望包含在管道中的阶段，在本例中，管道中需要3个步骤</p><ul class=""><li id="438c" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js ko kp kq kr bi translated">分类列的字符串索引</li><li id="9831" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">一种用于字符串索引列的热编码</li><li id="a732" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated">向量组装(将所有列封装到一个向量列中)</li></ul><p id="9b7e" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">3.我们首先定义各个阶段，首先过滤分类列&amp;对它们应用两步过程</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Handling Categorical Features</figcaption></figure><p id="01e5" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">4.然后我们过滤数字列，将它们与一个热编码的分类列组合起来，并为它们定义向量组装器。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="a158" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">5.让我们创建一个管道将所有这些东西放在一起。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="af50" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这个实验的整个笔记本可以在我的github <a class="ae iu" href="https://github.com/rohandawar/Databricks" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="775b" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="kf">敬请期待更多此类内容！下一集再见！！快乐学习！如果你喜欢，你读什么关注我</em> <a class="ae iu" href="https://www.linkedin.com/in/rohandawar/" rel="noopener ugc nofollow" target="_blank"> <em class="kf"> linkedIN </em> </a></p><p id="0cff" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">参考资料:</p><ul class=""><li id="9f19" class="kj kk hh ix b iy iz jc jd jg kl jk km jo kn js ko kp kq kr bi translated"><a class="ae iu" href="https://spark.apache.org/docs/3.1.3/api/python/reference/api/pyspark.ml.feature.VectorAssembler.html" rel="noopener ugc nofollow" target="_blank">矢量装配器</a>的文档</li><li id="6401" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated"><a class="ae iu" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.StringIndexer.html" rel="noopener ugc nofollow" target="_blank"> StringIndexer </a>的文档</li><li id="acfb" class="kj kk hh ix b iy ks jc kt jg ku jk kv jo kw js ko kp kq kr bi translated"><a class="ae iu" href="https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.ml.feature.OneHotEncoder.html" rel="noopener ugc nofollow" target="_blank"> OneHotEncoding </a>的文档</li></ul><div class="kx ky ez fb kz la"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lb ab dw"><div class="lc ab ld cl cj le"><h2 class="bd hi fi z dy lf ea eb lg ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lh l"><h3 class="bd b fi z dy lf ea eb lg ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="li l"><p class="bd b fp z dy lf ea eb lg ed ef dx translated">medium.com</p></div></div><div class="lj l"><div class="md l ll lm ln lj lo io la"/></div></div></a></div></div></div>    
</body>
</html>