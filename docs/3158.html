<html>
<head>
<title>Profiling with TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">张量流剖面</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/profiling-with-tensorflow-9eaa283e8c3?source=collection_archive---------4-----------------------#2022-07-27">https://medium.com/mlearning-ai/profiling-with-tensorflow-9eaa283e8c3?source=collection_archive---------4-----------------------#2022-07-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="138e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章简要回顾了分析概念以及如何使用TensorFlow分析深度学习模型。</p><h1 id="ee21" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">为什么要侧写？</h1><p id="5ec0" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">剖析一个计算机程序旨在更多地了解它的行为。通过了解程序的行为，开发人员可以进行优化，从而提高性能。此外，通过分析一个程序，开发者可以发现程序的瓶颈。例如，假设对于一个模型，在对它进行概要分析之后，我们发现它90%的执行时间都花在了等待预处理的输入数据上。在这种情况下，它表明数据预处理是瓶颈。如果我们能够优化这一步，我们将获得巨大的加速。对于另一个场景，考虑大部分执行时间花在浮点运算等计算上。在这种情况下，像混合精度这样的优化技术可以显著加快速度，因为它们在保持可接受的计算质量的同时进行更少的计算。</p><h1 id="83c8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">先决条件</h1><p id="0900" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">对于使用TensorFlow进行分析，需要以下软件包:</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="0002" class="ko jd hh kk b fi kp kq l kr ks"><strong class="kk hi">pip install tensorboard</strong><strong class="kk hi"><br/>pip install -U tensorboard_plugin_profile</strong></span></pre><p id="1b55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要在本地浏览器上远程查看TensorBoard，请查看以下帖子。</p><div class="kt ku ez fb kv kw"><a rel="noopener follow" target="_blank" href="/mlearning-ai/remote-tensorboard-viewing-on-your-local-browser-b0dc5c5a634a"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hi fi z dy lb ea eb lc ed ef hg bi translated">在本地浏览器上远程浏览Tensorboard</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">张量流是流行的机器学习框架之一。它减轻了ML开发者的生活…</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">medium.com</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk ll kw"/></div></div></a></div><h1 id="3d01" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">如何用TensorFlow进行侧写？</h1><p id="b589" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">对于使用TensorFlow进行概要分析，我们需要创建一个回调并添加到模型的fir函数中。考虑下面的例子。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="9247" class="ko jd hh kk b fi kp kq l kr ks"><strong class="kk hi">import tensorflow as tf<br/>import tensorflow_datasets as tfds<br/>import keras<br/>import numpy as np<br/>import datetime<br/>from datetime import datetime<br/>from packaging import version<br/>import os</strong><br/></span><span id="c079" class="ko jd hh kk b fi lm kq l kr ks">print(“TensorFlow version: “, tf.__version__)<br/>device_name = tf.test.gpu_device_name()<br/>if not device_name:<br/>   raise SystemError(‘GPU device not found’)<br/>   print(‘Found GPU at: {}’.format(device_name))</span><span id="7e6c" class="ko jd hh kk b fi lm kq l kr ks">tfds.disable_progress_bar()<br/>(ds_train, ds_test), ds_info = tfds.load(‘<strong class="kk hi">mnist</strong>’, split=[‘train’, ‘test’], shuffle_files=True, as_supervised=True, with_info=True)<br/></span><span id="7150" class="ko jd hh kk b fi lm kq l kr ks">def normalize_img(image, label):<br/>“””Normalizes images: `uint8` -&gt; `float32`.”””<br/>    return tf.cast(image, tf.float32) / 255., label</span><span id="f170" class="ko jd hh kk b fi lm kq l kr ks">ds_train = ds_train.map(normalize_img)<br/>ds_train = ds_train.batch(128)<br/>ds_test = ds_test.map(normalize_img)<br/>ds_test = ds_test.batch(128)<br/></span><span id="d012" class="ko jd hh kk b fi lm kq l kr ks">model = tf.keras.models.Sequential([<br/>tf.keras.layers.Flatten(<strong class="kk hi">input_shape=(28, 28, 1)</strong>),<br/>#tf.keras.layers.Dense(<strong class="kk hi">128</strong>,activation=’<strong class="kk hi">relu</strong>’),<br/>tf.keras.layers.Dense(<strong class="kk hi">10</strong>, activation=’<strong class="kk hi">softmax</strong>’)<br/>])<br/></span><span id="59f3" class="ko jd hh kk b fi lm kq l kr ks">model.compile(<br/>loss=’sparse_categorical_crossentropy’,<br/>optimizer=tf.keras.optimizers.Adam(0.001),<br/>metrics=[‘<strong class="kk hi">accuracy</strong>’]<br/>)<br/></span><span id="010d" class="ko jd hh kk b fi lm kq l kr ks"># Create a TensorBoard callback<br/><strong class="kk hi">logs </strong>= “logs/” + datetime.now().strftime(“%Y%m%d-%H%M%S”)</span><span id="da9b" class="ko jd hh kk b fi lm kq l kr ks"><strong class="kk hi">tboard_callback </strong>= tf.keras.callbacks.TensorBoard(log_dir = <strong class="kk hi">logs</strong>, histogram_freq = 1, profile_batch = ‘500,520’)</span><span id="e6ab" class="ko jd hh kk b fi lm kq l kr ks">model.fit(ds_train, epochs=10, validation_data=ds_test, callbacks = [<strong class="kk hi">tboard_callback</strong>])</span></pre><h1 id="ae0b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">用TensorFlow做侧写能得到什么？</h1><p id="ed2e" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在浏览器上打开TensorBoard，会出现以下窗口。</p><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ln"><img src="../Images/bc8bf67d672801fc9d06f995552adfbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FPDWWoCCLKLbIdIpO-s3SQ.png"/></div></div></figure><p id="524c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下子菜单用于分析模型指标，通常用于分析模型的性能:</p><ol class=""><li id="a1a2" class="lu lv hh ig b ih ii il im ip lw it lx ix ly jb lz ma mb mc bi translated"><strong class="ig hi">标量和度量</strong>(开发人员可以添加定制的度量来随时间监控，例如，学习率。点击这里的<a class="ae md" href="http://Logging custom scalars" rel="noopener ugc nofollow" target="_blank">查看如何记录自定义标量或度量)</a></li><li id="ba39" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">图像/文本数据</strong>(要查看输入的图像/文本数据，首先需要写入日志文件。<a class="ae md" href="https://www.tensorflow.org/tensorboard/image_summaries" rel="noopener ugc nofollow" target="_blank">如果您想显示图像，甚至创建您的混淆矩阵或查看文本数据，请在此处选择</a>查看图像，在此处选择<a class="ae md" href="https://www.tensorflow.org/tensorboard/text_summaries" rel="noopener ugc nofollow" target="_blank">查看文本</a></li><li id="20c1" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">使用HParams仪表板调节超参数</strong>(应记录它们；否则，您将不会在其仪表板中看到任何信息)。检查这里的<a class="ae md" href="https://www.tensorflow.org/tensorboard/hyperparameter_tuning_with_hparams" rel="noopener ugc nofollow" target="_blank">和</a>。</li><li id="3c18" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">嵌入可视化器</strong>用于显示高维嵌入(此处勾选<a class="ae md" href="https://www.tensorflow.org/tensorboard/tensorboard_projector_plugin" rel="noopener ugc nofollow" target="_blank"/>)</li><li id="feb5" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated">计算图(此图显示了TensorFlow中的模型如何完成所需的运算。)</li></ol><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mj"><img src="../Images/674f8b797634e3c9e83ee700fb3844cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPCSqqYOCVr9nQHUqZ0dQw.png"/></div></div></figure><p id="afdf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击阅读更多关于Tensorboard】提供的工具。</p><p id="97dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，对于概要分析，我们需要概要分析仪表板:</p><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mk"><img src="../Images/ec8e2a8cb98d4a29ddb9177d68e0e187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IL7JTw0iL9FK70I3B1zag.png"/></div></div></figure><p id="dd06" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在“概述”页面上，TensorFlow提供了性能改进建议。此外，还显示了GPU上的前10个张量流操作:</p><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ml"><img src="../Images/b381d2aa9523e06a0cbe448c0e245782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJAcPu1aRkHEz6Bp9BBiGg.png"/></div></div></figure><p id="debb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在分析页面的左侧有一些用于分析的工具。</p><ol class=""><li id="2ef2" class="lu lv hh ig b ih ii il im ip lw it lx ix ly jb lz ma mb mc bi translated"><strong class="ig hi">输入管道分析器</strong>对模型的输入管道给出分析和建议。</li><li id="8ac7" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">内核统计</strong>:列出GPU内核及其硬件需求，如寄存器数量、共享内存字节数等。</li><li id="4d9d" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">内存配置文件</strong>选项卡显示内存使用情况的时间线图，提供以下信息</li><li id="9768" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi"> TensorFlow stats </strong>:包含显示不同部分花费时间的饼图。此外，TensorFlow操作具有出现次数、总时间等。，以表格形式提供。</li><li id="039d" class="lu lv hh ig b ih me il mf ip mg it mh ix mi jb lz ma mb mc bi translated"><strong class="ig hi">跟踪查看器</strong>:显示内核和操作的时间线执行。它揭示了大量关于TensorFlow如何执行神经网络的信息。</li></ol><p id="eb7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">跟踪查看器工具的一个示例:</p><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mm"><img src="../Images/39954c076dc9a7b84169997f29b3483f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tC1_azX7BCz9tqxJWVeiDw.png"/></div></div></figure><p id="d095" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更多缩放:</p><figure class="kf kg kh ki fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mn"><img src="../Images/d87a7fa05651adaacc5c40ee4c20b79c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_SUifOOqGuwt-bFpTEWjcg.png"/></div></div></figure><h1 id="5415" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="4df8" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在这篇文章中，我们在Tensorboard的帮助下回顾了TensorFlow中的分析。完成分析是为了找到目标程序的优化潜力，以获得加速。</p><h1 id="8b33" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">参考</h1><div class="kt ku ez fb kv kw"><a href="https://www.tensorflow.org/tensorboard/get_started" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hi fi z dy lb ea eb lc ed ef hg bi translated">TensorBoard | TensorFlow入门</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">在机器学习中，为了改进某些东西，你通常需要能够测量它。TensorBoard是一款提供…</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">www.tensorflow.org</p></div></div><div class="lf l"><div class="mo l lh li lj lf lk ll kw"/></div></div></a></div><div class="kt ku ez fb kv kw"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hi fi z dy lb ea eb lc ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">medium.com</p></div></div><div class="lf l"><div class="mp l lh li lj lf lk ll kw"/></div></div></a></div></div></div>    
</body>
</html>