<html>
<head>
<title>Exploratory customer personality analysis I: Data visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索性客户个性分析I:数据可视化</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/exploratory-customer-personality-analysis-i-data-visualization-51386c678f92?source=collection_archive---------5-----------------------#2022-05-25">https://medium.com/mlearning-ai/exploratory-customer-personality-analysis-i-data-visualization-51386c678f92?source=collection_archive---------5-----------------------#2022-05-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="52e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">客户细分是将整个客户群划分为一组不同的子群，每个子群由具有相似需求和特征的客户组成。然后，公司可以针对每个不同的客户群制定具体的营销策略，从而提高客户满意度和忠诚度。</p><p id="6039" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我从<a class="ae jc" href="https://www.kaggle.com/imakash3011/customer-personality-analysis" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>偶然发现了这个数据集，我认为它可能是客户细分项目的一个很好的起点。属性的描述可以在前面提到的Kaggle平台上找到。</p><p id="669e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文的第一部分将重点关注数据可视化，而第二部分将更侧重于聚类分析和客户排名。在这个实验中我会用R。让我们开始吧。</p><h1 id="839a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据导入</h1><p id="37df" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">首先，加载所需的R库包。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="a0d4" class="kp je hh kl b fi kq kr l ks kt"><strong class="kl hi">library</strong>(tidyverse)  <em class="ku"># Multiple packages for data analysis<br/></em><strong class="kl hi">library</strong>(visdat)     <em class="ku"># visualize missing values</em><br/><strong class="kl hi">library</strong>(mice)       <em class="ku"># multiple imputation of missing values<br/></em><strong class="kl hi">library</strong>(knitr)      <em class="ku"># for tidy table display</em><br/><strong class="kl hi">library</strong>(GGally)     <em class="ku"># for scatter plot matrix<br/></em><strong class="kl hi">library</strong>(ggmosaic)   <em class="ku"># mosaic plot<br/></em><strong class="kl hi">library</strong>(reshape2)   <em class="ku"># data wrangling<br/></em><strong class="kl hi">library</strong>(ggforce)    <em class="ku"># for parallet set plots</em></span></pre><p id="53f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，将下载的数据加载到R workspace中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="751e" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Set the working directory to where the data file is located</em><br/>setwd("~/ml projects/customer segmentation")<br/>cust_data = read.csv("marketing_campaign.csv", sep = "\t")</span></pre><p id="f597" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有29列(变量)和2240行(观察值)，如下面的输出所示。每行对应一个客户。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b2b2" class="kp je hh kl b fi kq kr l ks kt">cust_data %&gt;% str()<br/>summary(cust_data)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kv"><img src="../Images/b66c983a180edf7798806c26f6599fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5OuRy7s1okJJvIIAOdQRg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Internal structure of customer data.</figcaption></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lh"><img src="../Images/31ed01836728f0dc92ea6d5a270c6ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iSw_0v9SAOvw8XXsOXqgNw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Statistical summaries of some of the attributes (the full output can be found on <a class="ae jc" href="http://rpubs.com/JQ_programmer_92/906741" rel="noopener ugc nofollow" target="_blank">RPubs</a>).</figcaption></figure><p id="7772" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据<code class="du li lj lk kl b">summary()</code>函数的输出，有一些有趣的事情需要注意:</p><ul class=""><li id="b840" class="ll lm hh ig b ih ii il im ip ln it lo ix lp jb lq lr ls lt bi translated"><code class="du li lj lk kl b">Income</code>特征有<code class="du li lj lk kl b">NA's</code>(缺失值)。</li><li id="a77f" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">大多数数字特征描绘了正偏度。</li><li id="4a48" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">像<code class="du li lj lk kl b">ID</code>这样的特性可能没什么用，因为它不编码任何关于客户的信息。我将把它保存在<code class="du li lj lk kl b">DataFrame</code>变量中，但不会在任何后续分析中使用它。</li><li id="6981" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">像<code class="du li lj lk kl b">Z_CostContact</code>和<code class="du li lj lk kl b">Z_Revenue</code>这样特征不是有用的属性，因为它们具有零方差。</li><li id="beda" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">像<code class="du li lj lk kl b">Dt_Customer</code>这样的特征需要一些特征工程，因为它们没有存储在正确的数据类型中。这将在下面的小节中执行。<code class="du li lj lk kl b">Year_Birth</code>可以转化为更直观的属性，如客户的<strong class="ig hi">年龄</strong>。</li><li id="7321" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">对于<code class="du li lj lk kl b">Education</code>和<code class="du li lj lk kl b">Marital Status</code>等特征，从<code class="du li lj lk kl b">character</code>到<code class="du li lj lk kl b">factor</code>的特征重组。</li></ul><h1 id="109f" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">特征工程</h1><h2 id="38d5" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">零方差变量的去除</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="406c" class="kp je hh kl b fi kq kr l ks kt">cust_data_copy = cust_data<br/>cust_data = subset(cust_data, select = -c(Z_CostContact, Z_Revenue))</span></pre><h2 id="960a" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">去掉无效的观察值</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4ac5" class="kp je hh kl b fi kq kr l ks kt">table(cust_data$Marital_Status)   # tabulate the frequency of each marital status category<br/>kable(cust_data %&gt;% filter(Marital_Status == "YOLO"), caption = "YOLO instances")<br/>cust_data = cust_data %&gt;% filter(Marital_Status != "YOLO")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mm"><img src="../Images/37b22193e31df7149fc710b6411bfb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-rJ5Ukwv-gB2TftDD1r7kQ.png"/></div></div></figure><h2 id="0ec7" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">特征提取I</h2><ol class=""><li id="8dd4" class="ll lm hh ig b ih kb il kc ip mn it mo ix mp jb mq lr ls lt bi translated">从属性<code class="du li lj lk kl b">Marital_Status</code>、<code class="du li lj lk kl b">Kidhome</code>和<code class="du li lj lk kl b">Teenhome</code>中得出家庭成员的最小数量。</li><li id="3809" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb mq lr ls lt bi translated">将<code class="du li lj lk kl b">Response</code>和五个<code class="du li lj lk kl b">AcceptedCmp</code>特征相加，计算出已接受要约的总数。</li></ol><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4d4d" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Calculate total number of accepted campaign, minimum number of household members.</em><br/><br/>min_num_member = <strong class="kl hi">function</strong>(x) {<br/>  <strong class="kl hi">if</strong> (x[1]=="Married" || x[1]=="Together"){<br/>    np = 2<br/>  } <strong class="kl hi">else</strong> {<br/>    np = 1<br/>  }<br/>  <strong class="kl hi">return</strong>(as.numeric(x[2]) + as.numeric(x[3]) + np)<br/>}<br/>min_num_household = apply(cust_data %&gt;% <br/>                            select(Marital_Status, Kidhome, Teenhome), <br/>          1, min_num_member)<br/>cust_data$min_num_household = min_num_household<br/><br/>cust_data = cust_data %&gt;% mutate(tot_AcceptedCmp = AcceptedCmp1 + AcceptedCmp2 + AcceptedCmp3 + AcceptedCmp4 + AcceptedCmp5 + Response)</span></pre><h2 id="6d32" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">数据类型的重构</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="da8b" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Change the date from string to date format</em><br/>cust_data$Dt_Customer = as.Date(cust_data$Dt_Customer, <br/>                                     format = c("%d-%m-%Y"))<br/><br/><em class="ku"># Change the categorical features from character to factor</em><br/>categorical_features = c("Education", "Marital_Status", "AcceptedCmp1",<br/>                         "AcceptedCmp2", "AcceptedCmp3", "AcceptedCmp4",<br/>                         "AcceptedCmp5", "Complain", "Response")<br/><strong class="kl hi">for</strong> (i <strong class="kl hi">in</strong> 1:length(categorical_features)){<br/>  cust_data[[categorical_features[i]]] = <br/>    as.factor(cust_data[[categorical_features[i]]])<br/>}<br/><em class="ku"># ordered categorical variables: Kidhome and Teenhome</em><br/>cust_data$Kidhome = factor(cust_data$Kidhome, <br/>                           levels = seq(from = min(cust_data$Kidhome), <br/>                                        to = max(cust_data$Kidhome), <br/>                                        by = 1), ordered = TRUE)<br/>cust_data$Teenhome = factor(cust_data$Teenhome, <br/>                           levels = seq(from = min(cust_data$Teenhome), <br/>                                        to = max(cust_data$Teenhome), <br/>                                        by = 1), ordered = TRUE)</span></pre><h2 id="1bf8" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">特征提取II</h2><p id="8cb1" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">将属性<code class="du li lj lk kl b">Year_Birth</code>更改为年龄，并将<code class="du li lj lk kl b">Dt_Customer</code>更改为客户在公司注册的天数。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="d250" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Change Year_Birth to age</em><br/>current_year = 2014<br/>cust_data = cust_data %&gt;% mutate(age = current_year - Year_Birth) %&gt;% <br/>  subset(select = -c(Year_Birth))<br/><br/><em class="ku"># Change Dt_customer to days of enrollment. Assume that the current date is 1st July 2014</em><br/>current_date = as.Date("2014-07-01")<br/>cust_data = cust_data %&gt;% <br/>  mutate(days_enroll = difftime(current_date, Dt_Customer, units = c("days")) %&gt;% <br/>           as.numeric()) %&gt;% <br/>  subset(select = -c(Dt_Customer))</span></pre><h2 id="5658" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">剔除异常值</h2><ul class=""><li id="e479" class="ll lm hh ig b ih kb il kc ip mn it mo ix mp jb lq lr ls lt bi translated">删除等于或大于100岁的客户。</li><li id="1ee3" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">丢弃<code class="du li lj lk kl b">Income</code>超过<code class="du li lj lk kl b">Income</code>中值10倍的实例。营销部门可能需要针对该客户制定独家营销策略。</li></ul><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="93e6" class="kp je hh kl b fi kq kr l ks kt">summary(cust_data$age)<br/>cust_data = cust_data %&gt;% filter(age &lt; 100)   # filter out age &gt;=100</span><span id="6a17" class="kp je hh kl b fi mr kr l ks kt"># Unusually high Income <br/>cust_data %&gt;% arrange(desc(Income)) %&gt;% head(3) %&gt;% kable()<br/>cust_data = cust_data %&gt;% filter(ID!=9432)   <br/># remove instance with ridiculously high income</span></pre><h2 id="371a" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">缺失值插补</h2><p id="4519" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">处理缺失值主要有两种方法:</p><ol class=""><li id="29f3" class="ll lm hh ig b ih ii il im ip ln it lo ix lp jb mq lr ls lt bi translated">完成案例分析(缺失值的脱落观察)。</li><li id="0890" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb mq lr ls lt bi translated">归罪。<br/> -单一插补。<br/> -多重插补。</li></ol><p id="b53f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">多重插补法通常优于单一插补法，因为缺失值被计算多次，许多不同的似是而非的值被汇集在一起得到估计值。有三种类型的丢失机制:1)完全随机丢失(MCAR)，2)随机丢失(MAR)，3)非随机丢失(MNAR)。关于缺失数据类型的更多详细信息和直观解释可在<a class="ae jc" href="https://www.ncbi.nlm.nih.gov/books/NBK493614/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="22c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一般来说，多重插补通常可以处理MCAR和马尔，但不能处理马尔。如果缺失数据机制是MNAR，则必须对缺失模式进行建模，因为缺失数据不依赖于观测数据。在本实验中，通过链式方程(MICE)实施多重插补，以获得缺失<code class="du li lj lk kl b">Income</code>实例的估计值。关于鼠标算法的简洁说明，请参考这篇<a class="ae jc" href="https://cran.r-project.org/web/packages/miceRanger/vignettes/miceAlgorithm.html" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ab5f" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Write a utility function to check for missing values.</em><br/>check_missing_values = <strong class="kl hi">function</strong>(cust_data){<br/>  vec_missing = apply(cust_data, 2, <strong class="kl hi">function</strong>(x){ sum(any(is.na(x)))})<br/>  idx_missing = which(as.vector(vec_missing)==1)<br/>  <strong class="kl hi">if</strong> (length(idx_missing)&gt;0){<br/>    cat("The columns(features) with missing values: ", <br/>      colnames(cust_data)[idx_missing])<br/>    <br/>  } <strong class="kl hi">else</strong> {<br/>    print("No missing values")<br/>  }<br/>  <br/>}<br/>check_missing_values(cust_data)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es ms"><img src="../Images/e65a3a62f98856758d76ae97b5487ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*l60zE56b2FkGbsXqsfSXCQ.png"/></div></figure><p id="bc4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一种可视化缺失数据的方法是通过<code class="du li lj lk kl b">vis_miss()</code>函数。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5f9e" class="kp je hh kl b fi kq kr l ks kt">vis_miss(cust_data)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mt"><img src="../Images/17f64847a82f4bf301296da6fcc6af41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MqODp_mywIErAEyyG-Vdpg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">1.07% of “Income” values are missing.</figcaption></figure><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="bd47" class="kp je hh kl b fi kq kr l ks kt">cat(" \nThe number of missing values for income: ", sum(is.na(cust_data$Income)))<br/>idx_missing = which(is.na(cust_data$Income))</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es mu"><img src="../Images/1b6417111342c5f0342bad95201c6062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*zL8veiyR1rn_fSzIVI0moA.png"/></div></figure><h2 id="6d19" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">执行多重插补(MICE实施)</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="cc2a" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># MICE implementation</em><br/>imp = <strong class="kl hi">mice</strong>(cust_data, maxit = 0, print = F)<br/>pred = imp$predictorMatrix<br/>pred[,"ID"] = 0<br/><em class="ku"># Use the default value of 5 iterations</em><br/>imp = <strong class="kl hi">mice</strong>(cust_data, seed = 10, predictorMatrix = pred, print = F)<br/><strong class="kl hi">stripplot</strong>(imp, Income~.imp, pch = 20, cex = 2)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mv"><img src="../Images/5309cb676e633e0957535c6cb74212d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e1DhD3h_r4dLhfCbzrDt-Q.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">One dimensional scatterplot for Income variable in each iteration. The red points represent the imputed missing values.</figcaption></figure><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4c08" class="kp je hh kl b fi kq kr l ks kt">cust_data = <strong class="kl hi">complete</strong>(imp, 5)<br/>kable(cust_data[idx_missing[1:5],] %&gt;% select(ID:Income), caption = "Missing values imputed customer data")<br/># Show the first 5 instances whereby the missing values are imputed</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mw"><img src="../Images/ccc27c5b0bc84baa5f3d4c0b0e7ef406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dk6Y9UFaCIdc5dfqEIJj9A.png"/></div></div></figure><p id="4fa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如一维散点图和上表所示，估算的家庭年收入徘徊在1万英镑以下。</p><h1 id="a273" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据可视化</h1><p id="8fbb" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">假设您是处理该数据集的数据科学家之一，您的上级提出了如下几个问题:</p><ol class=""><li id="c6b4" class="ll lm hh ig b ih ii il im ip ln it lo ix lp jb mq lr ls lt bi translated">如何在客户中分配<code class="du li lj lk kl b">Income</code>属性？</li><li id="fc85" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb mq lr ls lt bi translated">数字特征之间有什么关系？有没有什么有趣的数据模式或相关性值得注意，可以提供有用的见解？</li><li id="f03f" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb mq lr ls lt bi translated">分类特征之间的关系是什么？(例如，<code class="du li lj lk kl b">Response</code>(在上一次活动中接受报价)的比率如何随着家庭中儿童和青少年的存在而变化？)</li><li id="7e26" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb mq lr ls lt bi translated">分类特征和数字特征有什么关系？(例如，在不同的教育背景下，购买不同商品的金额分布如何？)</li></ol><p id="0059" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面列出的所有问题都可以通过利用一组适当的数据可视化工具来回答。</p><h2 id="6b2d" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">直方图/密度图</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="289f" class="kp je hh kl b fi kq kr l ks kt">cust_data %&gt;% <strong class="kl hi">ggplot</strong>(<strong class="kl hi">aes</strong>(x = Income)) + <br/>  <strong class="kl hi">geom_histogram</strong>(<strong class="kl hi">aes</strong>(y = <strong class="kl hi">stat</strong>(count)/<strong class="kl hi">sum</strong>(count)), binwidth = 10000, <br/>                 boundary = 0) +<br/>  <strong class="kl hi">ylab</strong>("Relative frequency")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mx"><img src="../Images/ae816ad3c3a7238ee8e007c79be70f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BAH7WAEJzm8CiGTtzaSLLA.png"/></div></div></figure><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4419" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># density plot</em><br/>cust_data %&gt;% <strong class="kl hi">ggplot</strong>(<strong class="kl hi">aes</strong>(x = Income)) + <strong class="kl hi">geom_density</strong>(fill = "lightblue", alpha = 0.5) +<br/>  <strong class="kl hi">geom_vline</strong>(<strong class="kl hi">aes</strong>(xintercept=<strong class="kl hi">mean</strong>(Income)), color = "blue", linetype = 2) + <strong class="kl hi">geom_vline</strong>(<strong class="kl hi">aes</strong>(xintercept=<strong class="kl hi">median</strong>(Income)), color = "red", linetype = 3) + <strong class="kl hi">xlim</strong>(0, 2e+05) + <strong class="kl hi">theme_classic</strong>() + <strong class="kl hi">ggtitle</strong>("density plot for customer annual household income")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es my"><img src="../Images/da03c6bea90c36363d98db8e8aa110ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRfatxvaXeIieP6UjT8YJg.png"/></div></div></figure><p id="335b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数客户(99.5 %)的收入等于或少于10万英镑。事实上，(90.91 %)的客户家庭年收入在2万-9万之间。直方图和密度图都有一个粗的右尾，表示家庭年收入相对较高的客户(有7个客户的<code class="du li lj lk kl b">Income</code>超过15万)。</p><h2 id="5dd7" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">相关图/相关矩阵</h2><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="d71f" class="kp je hh kl b fi kq kr l ks kt"><em class="ku"># Linear correlation and scatter plots matrix for amount spent on different merchandise</em><br/>idx_cont_features = <strong class="kl hi">grepl</strong>("Mnt", <strong class="kl hi">colnames</strong>(cust_data))<br/>cust_data[, idx_cont_features] %&gt;% <strong class="kl hi">ggpairs</strong>(title = "correlogram")<br/><em class="ku"># Linear correlation and scatter plots matrix for number of purchases.</em><br/>idx_cont_features = <strong class="kl hi">grepl</strong>("Num", <strong class="kl hi">colnames</strong>(cust_data))<br/>cust_data[, idx_cont_features] %&gt;% <strong class="kl hi">ggpairs</strong>(title = "correlogram")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mz"><img src="../Images/712235afa8429c2fb2764204ff4f510d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-fajtcQdzuMdzN7RNbNdg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Scatter plot matrix + correlations for products-related features set.</figcaption></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kv"><img src="../Images/a96d1c438760d24c2585d02f37bc7518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cg8ahSfDlfwho2KhPnuVdg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Scatter plot matrix + correlations for “purchase behavior” features set.</figcaption></figure><p id="2ccd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的图中，我们可以很快掌握一些有用的信息:</p><ol class=""><li id="cc96" class="ll lm hh ig b ih ii il im ip ln it lo ix lp jb mq lr ls lt bi translated">在不同产品类型对上花费的金额是<em class="ku">正线性相关</em>。(注:右上方矩阵中相关性旁边的星号表示统计显著性。更多信息可在<code class="du li lj lk kl b">GGally</code>文档<a class="ae jc" href="https://ggobi.github.io/ggally/reference/ggally_cor.html" rel="noopener ugc nofollow" target="_blank">中找到。).这意味着，随着在某一类产品上花费的金额增加，在另一类产品上花费的金额也会增加。</a></li></ol><p id="ab12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.<code class="du li lj lk kl b">NumDealsPurchases</code>与<code class="du li lj lk kl b">NumWebVisitsMonth</code>正相关。这可能是因为客户上个月通过访问公司网站获得了折扣信息。</p><p id="5cf1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.<code class="du li lj lk kl b">NumWebVisitsMonth</code>和<code class="du li lj lk kl b">NumStorePurchases</code>负相关。更喜欢直接在商店购买的客户访问公司网站的频率较低。</p><p id="4578" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，所有数字属性的相关矩阵(包括在特性工程小节中讨论的衍生特性)如下所示:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4d37" class="kp je hh kl b fi kq kr l ks kt">seq = <strong class="kl hi">c</strong>("Mnt", "Num","Age", "days", "Income", "Recency", "household","tot")<br/>a = <strong class="kl hi">sapply</strong>(seq, <strong class="kl hi">function</strong>(x) <strong class="kl hi">grep</strong>(x, <strong class="kl hi">colnames</strong>(cust_data)))<br/><br/>idx = <strong class="kl hi">c</strong>()<br/><strong class="kl hi">for</strong> (i <strong class="kl hi">in</strong> (1:<strong class="kl hi">length</strong>(seq))){<br/>  idx = <strong class="kl hi">c</strong>(idx, a[[i]])<br/>}<br/><br/>corr_mat = <strong class="kl hi">cor</strong>(cust_data[,idx])<br/>corr_mat[<strong class="kl hi">upper.tri</strong>(corr_mat)] = NA<br/>melted_cormat = <strong class="kl hi">melt</strong>(corr_mat, na.rm = TRUE)<br/><em class="ku"># The dimension becomes nx3 matrix</em><br/><br/>melted_cormat %&gt;% <strong class="kl hi">ggplot</strong>(<strong class="kl hi">aes</strong>(x = Var1, y = Var2, fill = value)) +<br/>  <strong class="kl hi">geom_tile</strong>(color = "white") + <br/>  <strong class="kl hi">scale_fill_gradientn</strong>(limit = <strong class="kl hi">c</strong>(-1,1), colors = <strong class="kl hi">hcl.colors</strong>(40, "Earth")) +<br/>  <strong class="kl hi">theme_minimal</strong>() +<br/>  <strong class="kl hi">theme</strong>(axis.text.x = <strong class="kl hi">element_text</strong>(angle = 45, vjust = 1, size = 10, hjust = 1)) + <strong class="kl hi">coord_fixed</strong>() +<br/>  <strong class="kl hi">geom_text</strong>(<strong class="kl hi">aes</strong>(Var1, Var2, label = <strong class="kl hi">round</strong>(value, 2)), color = "black", size = 1.5)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es na"><img src="../Images/0244ce21531efa8b10a8c3e29f42cd60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4eiBasQ6SJzofIKCTr13yQ.png"/></div></div></figure><p id="a605" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du li lj lk kl b">MntMeatProducts</code>和<code class="du li lj lk kl b">NumCataloguePurchases</code>(第13行，第9列)的强正线性相关性(0.72)可能表明，与其他产品相比，通过《家居指南》进行的大量支出用于肉制品。</p><h2 id="f3d6" class="kp je hh bd jf lz ma mb jj mc md me jn ip mf mg jr it mh mi jv ix mj mk jz ml bi translated">镶嵌图/平行集图</h2><p id="183b" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">这些可视化工具可用于研究分类特征之间的关系。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="36b3" class="kp je hh kl b fi kq kr l ks kt">cust_data %&gt;% <strong class="kl hi">ggplot</strong>() +<br/>  <strong class="kl hi">geom_mosaic</strong>(<strong class="kl hi">aes</strong>(x = <strong class="kl hi">product</strong>(Marital_Status, Education), fill = Response)) +<br/>  <strong class="kl hi">theme</strong>(axis.text.x = <strong class="kl hi">element_text</strong>(face = "bold", angle = 90),<br/>        axis.text.y = <strong class="kl hi">element_text</strong>(face = "bold")) +<br/>  <strong class="kl hi">ggtitle</strong>("Mosaic Plot of Response, Marital status and Education")</span><span id="a925" class="kp je hh kl b fi mr kr l ks kt">cust_data %&gt;% <strong class="kl hi">ggplot</strong>() +<br/>  <strong class="kl hi">geom_mosaic</strong>(<strong class="kl hi">aes</strong>(x = <strong class="kl hi">product</strong>(Kidhome, Teenhome), fill = Response)) +<br/>  <strong class="kl hi">ggtitle</strong>("Mosaic Plot of Response, Kidhome and Teenhome")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nb"><img src="../Images/ed62948efd0c57a198eb018f65cfc233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OocQltwJ9G1YpNbTKaqkwQ.png"/></div></div></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nc"><img src="../Images/1937dae2886e0363ba274bb96b081696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZ4GPw1Nm7d_X0A8lN7BPw.png"/></div></div></figure><p id="2725" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过对上述镶嵌图的经验观察，我们知道1)已婚和同居的<code class="du li lj lk kl b">Response</code>比率通常小于单身、离婚和寡妇。2)对于没有儿童和青少年的顾客，接受报价的概率相对较高。换句话说，蓝色矩形的面积与整个单元格的面积之比(在上面马赛克图的左下角)代表了假设客户家中没有儿童和青少年时接受报价的条件概率。平行设置图可以在<a class="ae jc" href="http://rpubs.com/JQ_programmer_92/906741" rel="noopener ugc nofollow" target="_blank"> RPubs </a>上发布的html文档中找到。</p><p id="6425" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">小提琴图/分组盒图</strong></p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6cbd" class="kp je hh kl b fi kq kr l ks kt">seq = <strong class="kl hi">c</strong>("Income", "Education", "Marital", "min")<br/>idx_plot = <strong class="kl hi">sapply</strong>(seq, <strong class="kl hi">function</strong>(x) <strong class="kl hi">grep</strong>(x, <strong class="kl hi">colnames</strong>(cust_data)))<br/><br/>idx = <strong class="kl hi">c</strong>()<br/><strong class="kl hi">for</strong> (i <strong class="kl hi">in</strong> (1:<strong class="kl hi">length</strong>(seq))){<br/>  idx = <strong class="kl hi">c</strong>(idx, idx_plot[[i]])<br/>}<br/>cust_data %&gt;% dplyr::<strong class="kl hi">select</strong>(idx) %&gt;% <br/>  <strong class="kl hi">ggplot</strong>(<strong class="kl hi">aes</strong>(x = Education, y = Income, fill = Education)) +<br/>  <strong class="kl hi">geom_violin</strong>(scale = "count", draw_quantiles = <strong class="kl hi">c</strong>(0.25, 0.5, 0.75)) + <strong class="kl hi">stat_summary</strong>(fun = mean, geom = "point", shape=21, size=1.5, color = "red") + <strong class="kl hi">ylim</strong>(0, 2e+05)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nd"><img src="../Images/88b98b8d42c297c3d65884f739e9e408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9hPSHR0C83F60WwoKPOA_A.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Distribution of Customer annual household income under different educational backgrounds.</figcaption></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ne"><img src="../Images/10bc5367bd4d55e4a4ab1fb5020b8115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFvmIc1nddEfwYZiWx038Q.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Distribution of Customer annual household income under different marital statuses.</figcaption></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nf"><img src="../Images/4878a117d70e851eb37dd680e975b4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NB6IrveAOGxch3gzxqK2yg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Distribution of Customer annual household income under different minimum number of household members (household size).</figcaption></figure><p id="0cf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据上面的小提琴情节，</p><ul class=""><li id="1267" class="ll lm hh ig b ih ii il im ip ln it lo ix lp jb lq lr ls lt bi translated">与其他教育层次相比,"基础"教育层次的收入通常较低。</li><li id="5ef3" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">所有婚姻状况的收入都差不多。</li><li id="32b6" class="ll lm hh ig b ih lu il lv ip lw it lx ix ly jb lq lr ls lt bi translated">家庭规模较小的客户家庭年收入较高。</li></ul><p id="26de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">分组箱线图用于显示不同教育背景、婚姻状况和家庭规模的客户在不同类型产品上的消费金额分布。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="bd68" class="kp je hh kl b fi kq kr l ks kt">seq = <strong class="kl hi">c</strong>("Mnt", "Education", "Marital", "min")<br/>idx_plot = <strong class="kl hi">sapply</strong>(seq, <strong class="kl hi">function</strong>(x) <strong class="kl hi">grep</strong>(x, <strong class="kl hi">colnames</strong>(cust_data)))<br/># Alternative, unlist() function could be used to flatten the nested list<br/>idx = <strong class="kl hi">c</strong>()<br/><strong class="kl hi">for</strong> (i <strong class="kl hi">in</strong> (1:<strong class="kl hi">length</strong>(seq))){<br/>  idx = <strong class="kl hi">c</strong>(idx, idx_plot[[i]])<br/>}<br/>cust_data %&gt;% dplyr::<strong class="kl hi">select</strong>(idx) %&gt;% <br/>  <strong class="kl hi">pivot_longer</strong>(<strong class="kl hi">starts_with</strong>("Mnt"), names_to = "purchase_types",<br/>               values_to = "amount_spent") %&gt;% <br/>  <strong class="kl hi">ggplot</strong>(<strong class="kl hi">aes</strong>(x = Education, y = amount_spent)) +<br/>  <strong class="kl hi">geom_boxplot</strong>(fill = "chocolate2", notch = TRUE) + <strong class="kl hi">stat_summary</strong>(fun = mean, geom = "point", shape=21, size=1.5, color = "red") + <strong class="kl hi">theme_classic</strong>() + <strong class="kl hi">facet_wrap</strong>(~purchase_types, ncol = 2, scales = "free_y")</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ng"><img src="../Images/56da389c63d7005bd4461c85c5a9553f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsp6ujiyEHwgBIQnkzOr8g.png"/></div></div></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nh"><img src="../Images/aa0f125b084d6b8ebe0478ab8c9c794c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rzSt4MvdVPKkgvg3x9oMA.png"/></div></div></figure><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ni"><img src="../Images/510d903a921eb3602dccf1fa0cdabde2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i4SjOrDAsG8nLS4e-5OiGg.png"/></div></div></figure><p id="448c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看看顶部分组箱线图的右下方(“MntWines”)。博士箱线图的等级不与其他等级重叠，表明具有博士学历的客户在葡萄酒上花费的中值在统计上不同于其他教育水平较低的客户。代表不同群体平均值的红点也显示了博士客户在葡萄酒上的较高消费。根据底部分组箱线图，在所有产品类型中，家庭人口越多，花费越少。</p><h1 id="2beb" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结束语</h1><p id="ea35" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">数据可视化是一种非常强大和有用的技术，可以快速粗略地理解数据模式，并最终导致更好的决策。我想引用<a class="ae jc" href="https://www.tableau.com/learn/articles/data-visualization" rel="noopener ugc nofollow" target="_blank">这篇在线文章</a>中的一句话来结束我的发言:</p><blockquote class="nj nk nl"><p id="6a37" class="ie if ku ig b ih ii ij ik il im in io nm iq ir is nn iu iv iw no iy iz ja jb ha bi translated">一个好的可视化可以讲述一个故事，去除数据中的噪音，突出有用的信息。</p></blockquote><p id="ef44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将继续进行聚类分析和客户排名，这将是本文第二部分<a class="ae jc" href="https://jq0112358.medium.com/customer-personality-analysis-ii-cluster-analysis-and-customer-ranking-bdad75000b33" rel="noopener">的重点。</a></p><p id="f636" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章的所有代码都可以在<a class="ae jc" href="https://github.com/Jacky-lim-data-analyst/programmer.git" rel="noopener ugc nofollow" target="_blank"> Github </a>(“客户细分”文件夹)和<a class="ae jc" href="http://rpubs.com/JQ_programmer_92/906741" rel="noopener ugc nofollow" target="_blank"> RPubs </a>上找到。感谢阅读。祝您愉快！</p></div><div class="ab cl np nq go nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ha hb hc hd he"><p id="3c35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[1]:ka ggle帖子上的数据集描述没有显示<code class="du li lj lk kl b">Income</code>变量的货币。</p><p id="0bd2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[2]:为了万无一失，我们不会将这种前后移动的线性关系扩展到两个以上的特征。例如，随着A和B的增加，C也增加。相关性测量用于量化变量的<em class="ku">对之间的线性关系。如果要检查3个变量的关系，3D散点图是一个不错的选择。</em></p><div class="nw nx ez fb ny nz"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="oa ab dw"><div class="ob ab oc cl cj od"><h2 class="bd hi fi z dy oe ea eb of ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="og l"><h3 class="bd b fi z dy oe ea eb of ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="oh l"><p class="bd b fp z dy oe ea eb of ed ef dx translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on lb nz"/></div></div></a></div></div></div>    
</body>
</html>