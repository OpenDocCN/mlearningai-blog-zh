<html>
<head>
<title>Saving Your Machine Learning Model In Python: pickle.dump()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中保存机器学习模型:pickle.dump()</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/saving-your-machine-learning-model-in-python-pickle-dump-b01ae60a791c?source=collection_archive---------0-----------------------#2022-12-28">https://medium.com/mlearning-ai/saving-your-machine-learning-model-in-python-pickle-dump-b01ae60a791c?source=collection_archive---------0-----------------------#2022-12-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="31b2" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">本文通过pickle库向您介绍python中对象序列化和反序列化的概念。当您阅读完本文时，您将能够将您的模型无缝地序列化/保存为pickle文件，并在同一个或另一个python文件中反序列化/打开它以备后用，解决您在使用pickle时可能遇到的问题。</h2></div></div><div class="ab cl iw ix go iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="ha hb hc hd he"><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8430c09563b88a38ac54c2fd5496e055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dNHNc9QMdUPnncdiK6E2IQ.png"/></div></div></figure></div><div class="ab cl iw ix go iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="ha hb hc hd he"><h1 id="3650" class="jp jq hh bd jr js jt ju jv jw jx jy jz in ka io kb iq kc ir kd it ke iu kf kg bi translated">内容</h1><ul class=""><li id="6bbb" class="kh ki hh kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">泡菜基础介绍。</li><li id="08b4" class="kh ki hh kj b kk kz km la ko lb kq lc ks ld ku kv kw kx ky bi translated">和泡菜一起工作。</li><li id="2195" class="kh ki hh kj b kk kz km la ko lb kq lc ks ld ku kv kw kx ky bi translated">常见错误及其解决方法。</li><li id="4379" class="kh ki hh kj b kk kz km la ko lb kq lc ks ld ku kv kw kx ky bi translated">结论。</li></ul></div><div class="ab cl iw ix go iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="ha hb hc hd he"><h2 id="9535" class="le jq hh bd jr lf lg lh jv li lj lk jz ko ll lm kb kq ln lo kd ks lp lq kf lr bi translated">泡菜基础介绍。</h2><p id="843f" class="pw-post-body-paragraph ls lt hh kj b kk kl ii lu km kn il lv ko lw lx ly kq lz ma mb ks mc md me ku ha bi translated">Pickle是用于对象序列化/反序列化的python标准库之一。Pickle序列化以字节格式将对象保存到文件中，而反序列化是序列化的逆过程。当试图将一个对象序列化到pickle文件中时，有必要首先声明<strong class="kj hi">字节/二进制</strong>格式，否则会遇到错误。列表、元组、字典、转换器、模型和许多其他对象都可以被pickle/serialize，但是，本文主要关注机器学习模型的序列化和反序列化。</p><h2 id="9a94" class="le jq hh bd jr lf lg lh jv li lj lk jz ko ll lm kb kq ln lo kd ks lp lq kf lr bi translated">使用Pickle:模型序列化</h2><p id="afc9" class="pw-post-body-paragraph ls lt hh kj b kk kl ii lu km kn il lv ko lw lx ly kq lz ma mb ks mc md me ku ha bi translated">要使用pickle库，您必须首先导入该库，代码行为"<strong class="kj hi">导入pickle "，y </strong>如果您愿意，也可以使用别名，如下所示"<strong class="kj hi">导入pickle作为pk" </strong>:</p><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="ebee" class="mk jq hh mg b be ml mm l mn mo"># Import style 1 (Without Alias)<br/>import pickle<br/><br/># Import style 2 (With Alias)<br/>import pickle as pk</span></pre><p id="eee0" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">在使用您选择的样式导入pickle库之后，就该打开/创建一个文件并将对象转储到该文件中了。打开文件时，需要指定<strong class="kj hi">文本模式</strong>，分别是<strong class="kj hi"> <em class="mu">【写入】</em></strong><strong class="kj hi"><em class="mu">(w)</em></strong><strong class="kj hi"><em class="mu">二进制模式</em></strong><strong class="kj hi"><em class="mu">(b)</em></strong><em class="mu"/>进行序列化操作。我将讨论两种模型序列化的方法，它们是:</p><blockquote class="mv mw mx"><p id="baf3" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated"><strong class="kj hi">方法一</strong></p></blockquote><p id="4a71" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">要使用“长方法”保存文件，请执行以下操作:</p><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="5e11" class="mk jq hh mg b be ml mm l mn mo"># Saving model to pickle file<br/>with open("desired-model-file-name.pkl", "wb") as file: # file is a variable for storing the newly created file, it can be anything.<br/>    pickle.dump(model, file) # Dump function is used to write the object into the created file in byte format.</span></pre><p id="4a62" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">第一行以二进制写模式打开一个文件，并将新创建的文件存储在“文件”变量中，第二行将模型对象写入文件，并默认保存在与存储python文件的文件相同的目录/文件夹中，但您可以在<strong class="kj hi"> open </strong>函数中指定您自己的文件路径以及desired-model-file-name.pkl。</p><blockquote class="mv mw mx"><p id="d391" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">方法2</p></blockquote><p id="5789" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">要使用速记方法保存文件，请执行以下操作:</p><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="adcb" class="mk jq hh mg b be ml mm l mn mo">pickle.dump(model, open("desired-model-file-name.pkl", "wb"))</span></pre><p id="a117" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">这段令人惊叹的一行代码完成了前面方法所做的一切，但只用了一行代码。作为初学者，我建议您坚持使用第一种方法，直到您对文件创建有了更好的理解，然后再使用这种一行程序方法。第一种方法的优势在于，带有函数的<strong class="kj hi">在保存模型后自动为您关闭文件，而对于一行程序方法，您必须利用<strong class="kj hi"> close() </strong>函数来关闭文件。</strong></p><h2 id="070b" class="le jq hh bd jr lf lg lh jv li lj lk jz ko ll lm kb kq ln lo kd ks lp lq kf lr bi translated">使用Pickle:模型反序列化</h2><p id="6432" class="pw-post-body-paragraph ls lt hh kj b kk kl ii lu km kn il lv ko lw lx ly kq lz ma mb ks mc md me ku ha bi translated">反序列化，序列化过程的逆过程也一样简单。为了反序列化一个文件，还需要指定<strong class="kj hi">文本模式</strong>，分别是<strong class="kj hi"><em class="mu">read</em></strong><strong class="kj hi"><em class="mu">(r)</em></strong>和<strong class="kj hi"> <em class="mu">二进制模式</em></strong><strong class="kj hi"><em class="mu">(b)</em></strong>进行反序列化操作<strong class="kj hi"> <em class="mu">。</em></strong>read模式告诉编译器文件已经存在，需要做的就是读入二进制文本并将其转换回原始对象。为此，我还将讨论两种方法。</p><blockquote class="mv mw mx"><p id="71f7" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">方法1</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="5304" class="mk jq hh mg b be ml mm l mn mo"># Opening saved model<br/>with open("desired-model-file-name.pkl", "rb") as file:<br/>    model = pickle.load(file)<br/><br/># The model has now been deserialized, next is to make use of it as you normally would.<br/>prediction = model.predict([[2,112,68,22,94,34.1,0.315,26]]) # Passing in variables for prediction<br/>print("The result is",prediction[0]) # Printing result</span></pre><p id="160a" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">第一行代码指定要以字节格式打开的文件，然后将该文件存储在“file”变量中，第二行代码加载作为模型的文件的内容，并将其存储在“model”变量中，然后可以正常使用。</p><blockquote class="mv mw mx"><p id="8b1a" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">方法2</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="aa2f" class="mk jq hh mg b be ml mm l mn mo"># Open saved model using 2nd method<br/>model_mtd2 = pickle.load(open("desired-model-file-name.pkl", "rb"))<br/><br/># Now, to make use of the model as you normally would<br/>result = model_mtd2.predict([[3,193,70,31,0,34.9,0.241,25]])<br/>print("The result is", result[0])</span></pre><p id="58ec" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">和以前一样，这个惊人的一行代码只用一行代码就完成了第一个方法所做的事情，之后这个模型就可以照常使用了。</p><h1 id="332a" class="jp jq hh bd jr js nb ju jv jw nc jy jz in nd io kb iq ne ir kd it nf iu kf kg bi translated">常见错误及其解决方法</h1><blockquote class="mv mw mx"><p id="a617" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">常见错误1:试图在不指定字节/二进制格式的情况下进行序列化。</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="a777" class="mk jq hh mg b be ml mm l mn mo"># Attempting to serialize without specifying byte/binary format.<br/>with open("desired-model-file-name.pkl", "w") as file:<br/>    pickle.dump(model, file)<br/><br/>&gt;&gt;&gt; Output Below<br/>---------------------------------------------------------------------------<br/>TypeError                                 Traceback (most recent call last)<br/>c:\Users\samsung\Documents\Projects\Article specific\model-serialization-deserialization\model-serialization-deserialization.ipynb Cell 10 in &lt;cell line: 2&gt;()<br/>      1 # Attempting to serialize without specifying byte/binary format.<br/>      2 with open("desired-model-file-name.pkl", "w") as file:<br/>----&gt; 3     pickle.dump(model, file)<br/><br/>TypeError: write() argument must be str, not bytes</span></pre><p id="0b88" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">当试图序列化一个对象时，如果忘记指定二进制文本模式(b)，编译器将抛出上面的错误。简单的解决方法是在<strong class="kj hi">‘w’</strong>打开文本模式之前或之后包含<strong class="kj hi">‘b’</strong>。</p><blockquote class="mv mw mx"><p id="0e12" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">常见错误2:试图用读取文本模式进行序列化</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="317d" class="mk jq hh mg b be ml mm l mn mo"># Attempting to serialize with read text mode<br/>with open("desired-model-file-name.pkl", "rb") as file:<br/>    pickle.dump(model, file)<br/><br/>&gt;&gt;&gt; Output Below<br/>---------------------------------------------------------------------------<br/>UnsupportedOperation                      Traceback (most recent call last)<br/>c:\Users\samsung\Documents\Projects\Article specific\model-serialization-deserialization\model-serialization-deserialization.ipynb Cell 11 in &lt;cell line: 2&gt;()<br/>      1 # Attempting to serialize with read text mode<br/>      2 with open("desired-model-file-name.pkl", "rb") as file:<br/>----&gt; 3     pickle.dump(model, file)<br/><br/>UnsupportedOperation: write</span></pre><p id="40d1" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">使用读文本模式告诉你的编译器你正在试图获取信息而不是把信息放入文件，因此当出现这样的错误时，编译器简单地建议你使用写文本模式<strong class="kj hi">‘w’</strong>，你可以把它放在<strong class="kj hi">‘b’</strong>文本模式之前或之后。</p><blockquote class="mv mw mx"><p id="930a" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">常见错误3:试图在没有写/写文本模式的情况下进行序列化/反序列化</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="a6f3" class="mk jq hh mg b be ml mm l mn mo"># Attempting to serialize without specifying write text mode<br/>with open("desired-model-file-name.pkl", "b") as file:<br/>    pickle.dump(model, file)<br/><br/>&gt;&gt;&gt; Output Below<br/>---------------------------------------------------------------------------<br/>ValueError                                Traceback (most recent call last)<br/>c:\Users\samsung\Documents\Projects\Article specific\model-serialization-deserialization\model-serialization-deserialization.ipynb Cell 12 in &lt;cell line: 2&gt;()<br/>      1 # Attempting to serialize without specifying write text mode<br/>----&gt; 2 with open("desired-model-file-name.pkl", "b") as file:<br/>      3     pickle.dump(model, file)<br/><br/>ValueError: Must have exactly one of create/read/write/append mode and at most one plus</span></pre><pre class="ng mf mg mh bn mi mj bi"><span id="9dda" class="mk jq hh mg b be ml mm l mn mo"># Attempting to deserialize without specifying read text mode<br/>with open("desired-model-file-name.pkl", "b") as file:<br/>    pickle.load(file)<br/><br/>&gt;&gt;&gt; Output Below<br/>---------------------------------------------------------------------------<br/>ValueError                                Traceback (most recent call last)<br/>c:\Users\samsung\Documents\Projects\Article specific\model-serialization-deserialization\model-serialization-deserialization.ipynb Cell 13 in &lt;cell line: 2&gt;()<br/>      1 # Attempting to deserialize without specifying read text mode<br/>----&gt; 2 with open("desired-model-file-name.pkl", "b") as file:<br/>      3     pickle.load(file)<br/><br/>ValueError: Must have exactly one of create/read/write/append mode and at most one plus</span></pre><p id="d911" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">试图在不指定访问模式的情况下访问文件将引发值错误。不指定读模式就不能读，不指定写模式就不能写。要解决此问题，只需在<strong class="kj hi">‘b’</strong>文本模式之前或之后为您想要执行的功能指定适当的模式。</p><blockquote class="mv mw mx"><p id="5436" class="ls lt mu kj b kk mp ii lu km mq il lv my mr lx ly mz ms ma mb na mt md me ku ha bi translated">常见错误4:试图反序列化无效文件</p></blockquote><pre class="je jf jg jh fd mf mg mh bn mi mj bi"><span id="8081" class="mk jq hh mg b be ml mm l mn mo"># Attempting to deserialize invalid file<br/>with open("desired-model-file-name.pkll", "rb") as file:<br/>    pickle.load(file)<br/><br/>&gt;&gt;&gt; Output Below<br/>---------------------------------------------------------------------------<br/>FileNotFoundError                         Traceback (most recent call last)<br/>c:\Users\samsung\Documents\Projects\Article specific\model-serialization-deserialization\model-serialization-deserialization.ipynb Cell 14 in &lt;cell line: 2&gt;()<br/>      1 # Attempting to deserialize invalid file<br/>----&gt; 2 with open("desired-model-file-name.pkll", "rb") as file:<br/>      3     pickle.load(file)<br/><br/>FileNotFoundError: [Errno 2] No such file or directory: 'desired-model-file-name.pkll'</span></pre><p id="aaf3" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">在键入文件名时很容易忘记字母或符号，如果您得到“没有这样的文件”错误信息，这仅仅意味着您犯了一个印刷错误。要解决这个问题，您必须仔细重写文件路径/名称，或者更好的是，复制并粘贴准确的路径/名称，以避免任何错误。</p><h1 id="81ec" class="jp jq hh bd jr js nb ju jv jw nc jy jz in nd io kb iq ne ir kd it nf iu kf kg bi translated">结论</h1><p id="6983" class="pw-post-body-paragraph ls lt hh kj b kk kl ii lu km kn il lv ko lw lx ly kq lz ma mb ks mc md me ku ha bi translated">Pickle是一个非常强大的python库，允许用户存储和以后打开对象。它为您提供了存储模型的多个版本的能力，最重要的是，它使得将您的模型集成到诸如web应用程序之类的应用程序中变得容易。可以很容易地将保存的模型反序列化到服务器端文件中，通过前端的表单或任何其他方法收集模型参数，如果需要，在任何特征工程之后以数组的形式传递到模型中，并且将无缝地提供结果。点击进入GitHub repo <a class="ae nh" href="https://github.com/munas-git/Pickle-article/tree/main" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="38c9" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">通过阅读本文，您现在知道了如何使用pickle库在python中存储和打开您的模型和各种其他对象。</p><p id="79ef" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">你也可以在这里阅读我关于使用<strong class="kj hi"> Flask，HTML &amp; CSS </strong> <a class="ae nh" href="https://blog.devgenius.io/building-a-simple-web-app-for-your-model-flask-html-css-dd6cbd74d1ed" rel="noopener ugc nofollow" target="_blank">创建机器学习模型集成的全栈web应用的文章。</a></p><p id="1613" class="pw-post-body-paragraph ls lt hh kj b kk mp ii lu km mq il lv ko mr lx ly kq ms ma mb ks mt md me ku ha bi translated">就这些了，下次再见…</p><div class="ni nj ez fb nk nl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nm ab dw"><div class="nn ab no cl cj np"><h2 class="bd hi fi z dy nq ea eb nr ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ns l"><h3 class="bd b fi z dy nq ea eb nr ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nt l"><p class="bd b fp z dy nq ea eb nr ed ef dx translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jn nl"/></div></div></a></div></div></div>    
</body>
</html>