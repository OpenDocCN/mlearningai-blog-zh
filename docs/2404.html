<html>
<head>
<title>FastApi And Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FastApi和机器学习</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/fastapi-and-machine-learning-b75ac9c60412?source=collection_archive---------3-----------------------#2022-04-28">https://medium.com/mlearning-ai/fastapi-and-machine-learning-b75ac9c60412?source=collection_archive---------3-----------------------#2022-04-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ab2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发机器学习项目后的下一步是使可部署。传统上，Flask用于部署机器学习模型，但现在有一个更好的替代方案，FastApi。API是应用程序编程接口的首字母缩写，它是一种软件中间体，允许两个应用程序相互通信。FastApi是一个Python web框架，基于OpenAPI规范和JavaScript对象符号模式，用于开发RESTful APIs。OpenAPI规范为HTTP APIs定义了一个标准的、与编程语言无关的接口描述，它允许人类和计算机在不需要访问源代码、附加文档或检查网络流量的情况下发现和理解服务的能力。JSON Schema是一个允许注释和验证JSON文档的词汇表。FastAPI是为了利用现代Python特性而从头构建的。它使用异步服务器网关接口标准来实现与客户端的异步、并发连接，如果需要，它可以使用Web服务器网关接口。异步函数可用于路由和端点。FastAPI允许使用简洁的现代Python代码和类型提示高效地编写web应用程序。它完全支持异步编程，可以与Uvicorn和Gunicorn一起运行。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9fbc921083a3e3cf5f1ec44df3af12b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsBR2FDs8mmIJqceT15ZBg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Fig 1:API Architecture</figcaption></figure><p id="9678" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于轻量级的Starlette ASGI框架/工具包和pydantic，性能非常高。强大的编辑器支持，无处不在的补全和减少人为错误的可能性，大大提高了开发速度。根据nfolytx.com的说法，与Flask和Django等其他主流Python框架相比，FastAPI的速度相当快。以下来自Techempower的得分图表显示了性能差异:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es js"><img src="../Images/6e0fb0e62ce488f7c63a0ab13b81f2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*-WIjOjNAT7qJHBh3uJurgA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Fig 2:Speed comparison</figcaption></figure><h2 id="fe39" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">装置</h2><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="4fa0" class="jt ju hh kp b fi kt ku l kv kw">pip install fastapi<br/>pip install “uvicorn[standard]”<br/>pip install towhee</span></pre><h2 id="874d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated"><strong class="ak">演示FastApi代码</strong></h2><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="b604" class="jt ju hh kp b fi kt ku l kv kw">from fastapi import FastAPI<br/>app = FastAPI()<br/>@app.get("/")<br/>async def root():<br/>return {"Response": "Hello Friend"}</span></pre><p id="9516" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我们将使用Towhee。<a class="ae kx" href="https://github.com/towhee-io/towhee" rel="noopener ugc nofollow" target="_blank"> Towhee </a>是一个开源项目。开源软件是根据许可证发布的。版权所有者授予用户使用、研究、修改和向任何人出于任何目的分发软件及其源代码的权利。开源软件的例子包括GNU/Linux、Mozilla Firefox和VLC media player。</p><p id="fb5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">是一个用于开发ML驱动的数据处理和搜索管道的框架。这是一个Python项目，旨在促进复杂的多阶段机器学习任务的创建和部署，允许每个人——从初学者到大型组织——只需几行代码就可以部署复杂的管道。我们将上传一个图像，并得到它的嵌入。嵌入被定义为“离散变量的低维、学习的连续向量表示，以翻译高维向量。它们使机器学习模型更有效，更容易使用，并与其他模型一起使用。”应用编程接口可以用swagger ui测试，有了交互探索，直接从浏览器调用和测试你的API。它可以在最新版本的Chrome、Safari、Firefox和Edge上运行。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ky"><img src="../Images/409a4a04b8e43ec75727fcd32b741a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TYt8cLknuMyXGj_WeTHFCw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Fig 3:Api testing</figcaption></figure><h1 id="ee39" class="kz ju hh bd jv la lb lc jz ld le lf kd lg lh li kg lj lk ll kj lm ln lo km lp bi translated">密码</h1><p id="cf4d" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">在/Image路由中，predict_api函数获取输入文件，并检查上传的文件是否是有效的图像。使用read_imagefile()函数处理该文件。使用io python模块将输入流转换为枕形图像。embedding_gen(图像:图像。Image)处理枕头图像并获取嵌入内容，然后使用json.dumps(image_emb.tolist())函数将嵌入内容转换为json友好因子。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lv"><img src="../Images/f578cccb234a9b6b80bc25814730b604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VgK5VGUTnePmhY2-U8C6w.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Fig 4:Towhee Image decode</figcaption></figure><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="a2f3" class="jt ju hh kp b fi kt ku l kv kw">#IMPORT LIBRARIES<br/>import uvicorn<br/>from fastapi import FastAPI, File, UploadFile<br/>from io import BytesIO<br/>import numpy as np<br/>from towhee import pipeline<br/>from PIL import Image<br/>from  towhee.utils.pil_utils import from_pil<br/>from towhee.utils.ndarray_utils import to_ndarray<br/>import json</span><span id="9ff8" class="jt ju hh kp b fi lw ku l kv kw">#FILE TO PILLOW IMAGE<br/>def read_imagefile(<em class="lx">file</em>) -&gt; Image.Image:<br/>  image = Image.open(BytesIO(<em class="lx">file</em>))<br/>  return image</span><span id="df2c" class="jt ju hh kp b fi lw ku l kv kw">#PILLOW TO JSON FRIENDLY OUTPUT USING JSON AND TOWHEE<br/>def embedding_gen(<em class="lx">image</em>: Image.Image) -&gt; np.ndarray:<br/>  image_obj=from_pil(<em class="lx">image</em>)<br/>  image_emb=to_ndarray(image_obj)<br/>  image_emb=json.dumps(image_emb.tolist())<br/>  return image_emb<br/>#APP</span><span id="c603" class="jt ju hh kp b fi lw ku l kv kw">app = FastAPI()<br/>#this code is for image based towhee api only<br/>@app.post("/image")<br/>#FILE INPUT AND FILE CHECKING<br/>async def predict_api(<em class="lx">file</em>: UploadFile = File(...)):<br/>  extension = <em class="lx">file</em>.filename.split(".")[-1] in ("jpg", "jpeg", "png")<br/>  if not extension:<br/>    return "Image must be jpg or jpeg or png format!"<br/>#FILE PROCESSING<br/>  image = read_imagefile(await <em class="lx">file</em>.read())<br/>  emd=embedding_gen(image)<br/>  return {"Image_Embeddings":emd}</span><span id="12e0" class="jt ju hh kp b fi lw ku l kv kw">#SERVER<br/>if __name__ == "__main__":<br/>  uvicorn.run(app, <em class="lx">debug</em>=True)</span></pre><p id="48d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">查看其他有趣的文章:</p><p id="b054" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kx" href="https://frankzliu.com/blog/a-gentle-introduction-to-vector-databases" rel="noopener ugc nofollow" target="_blank">矢量数据库简介<br/> </a> <a class="ae kx" href="https://docs.towhee.io/tutorials/reverse-image-search/" rel="noopener ugc nofollow" target="_blank">使用嵌入的逆向图像搜索<br/> </a> <a class="ae kx" href="https://docs.towhee.io/tutorials/music-recognition-system/" rel="noopener ugc nofollow" target="_blank">音乐识别系统</a></p><p id="b6a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你喜欢这篇文章，请给<a class="ae kx" href="http://github.com/towhee-io/towhee" rel="noopener ugc nofollow" target="_blank">一颗星</a>。感谢您阅读这篇文章。如果您有任何反馈，请告诉我:)</p><div class="ly lz ez fb ma mb"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hi fi z dy mg ea eb mh ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">medium.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp jm mb"/></div></div></a></div></div></div>    
</body>
</html>