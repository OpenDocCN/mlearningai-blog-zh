<html>
<head>
<title>Bayesian Spline Modelling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">贝叶斯样条建模</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/bayesian-spline-modelling-5669d8437ca6?source=collection_archive---------2-----------------------#2022-12-20">https://medium.com/mlearning-ai/bayesian-spline-modelling-5669d8437ca6?source=collection_archive---------2-----------------------#2022-12-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="ab35" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">一个电磁频率实验的案例</h2></div><p id="211d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这篇文章将对一项实验中患者的纵向数据进行建模，该实验研究了在N-back任务中2G辐射对ERP的影响。实验包括两个连续的40分钟的脑电图记录，中间有大约10分钟的停顿。在实验过程中，受试者接受了电磁辐射或非电磁辐射(假的)，这是由计算机控制的随机平衡设计。无论是参与者还是实验者都不知道EMF或sham应用于哪个阶段，这为实验提供了双盲条件。脑电图用63电极帽记录。</p><p id="878e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇文章中，我将向你展示我使用贝叶斯样条建模来模拟脑电图数据的方法。这不会是我关于贝叶斯建模的第一篇文章，也不会是最后一篇。</p><p id="0a27" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于这是未来某个时候用于出版的商业数据，我不能分享这些数据，但我能做的是分享足够的细节来分析类似规模和/或设计的研究。</p><p id="1295" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们开始吧。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="acf2" class="kb kc hh jx b be kd ke l kf kg">library(data.table)<br/>library(ggplot2)<br/>library(dplyr)<br/>library(readxl)<br/>library(tidyr)<br/>library(brms)<br/>library(tidybayes)<br/>library(emmeans)<br/>library(bayesplot)<br/>library(bayesrules)<br/>library(rethinking)<br/>library(forcats)<br/>library(lme4)<br/>library(bayestestR)<br/>library(modelr)<br/>library(mgcViz)</span></pre><p id="b402" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我输入数据。文件df包含了我必须加载的所有单独的Excel文件，我没有在这里显示。从那里，我们可以构建多个文件。为了给出数据的指示，最好意识到每个参与者进入两组中的一组——或者EMF先开然后关，或者反之亦然。这意味着每个患者有两个样本，波形范围从-200到660毫秒。假设280-320毫秒的波形包含的信息最多。</p><p id="d647" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就目前而言，这应该能提供足够的背景信息，让我们对这些数据有所了解，当然这并不是我们所有的数据。此外，这里显示的最终分析当然不会是用于手稿的最终分析，但至少你会知道如何使用贝叶斯框架运行样条建模。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="01a5" class="kb kc hh jx b be kd ke l kf kg">df_280_320&lt;-df%&gt;%<br/>  filter(Time&gt;=280 &amp; Time &lt;=300)%&gt;%<br/>  group_by(Subject, RF, Treatm)%&gt;%<br/>  summarize(Frontal = sum(Frontal), <br/>            TemporalR = sum(TemporalR),<br/>            TemporalL = sum(TemporalL),<br/>            Central = sum(Central),<br/>            Parietal = sum(Parietal),<br/>            Occipital = sum(Occipital))%&gt;%<br/>  tidyr::pivot_longer(<br/>    cols = Frontal:Occipital,<br/>    names_to = "Location",<br/>    values_to = "Value",<br/>    values_drop_na = TRUE)%&gt;%<br/>  ungroup()%&gt;%<br/>  mutate(loc = if_else(Treatm == "OFF_ON" &amp; RF =="OFF", 1, <br/>                       if_else(Treatm == "ON_OFF" &amp; RF =="ON", 1, 2)))%&gt;%<br/>  group_by(Subject, Treatm, Location)%&gt;%<br/>  arrange(Subject, Location, loc)%&gt;%<br/>  summarize(Value = Value - lag(Value))%&gt;%<br/>  ungroup()%&gt;%<br/>  tidyr::drop_na()<br/>table(df_280_320$Subject, df_280_320$Treatm)<br/>      <br/>       OFF_ON ON_OFF<br/>  1001      6      0<br/>  1002      6      0<br/>  1003      0      6<br/>  1004      6      0<br/>  1005      6      0<br/>  1006      0      6<br/>  1007      6      0<br/>  1008      0      6<br/>  1009      0      6<br/>  1010      0      6<br/>  1011      0      6<br/>  1012      6      0<br/>  1013      6      0<br/>  1014      0      6<br/>  1015      6      0<br/>  1016      6      0<br/>  1017      6      0<br/>  1018      0      6<br/>  1019      0      6<br/>  1020      0      6<br/>  1021      0      6<br/>  1022      6      0<br/>  1023      6      0<br/>  1024      6      0<br/>  1025      6      0<br/>  1026      6      0<br/>  1027      0      6<br/>  1028      0      6<br/>  1029      0      6<br/>  1030      0      6<br/>  1031      6      0<br/>  1033      0      6</span></pre><p id="e177" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以看到每个患者属于其中一种治疗，并且每个治疗有两个部分:开和关。下面您可以看到每个位置和治疗的整个波形的平均值和标准偏差。标准差和平均值一样能提供信息，如果不是更多的话。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="c2c5" class="kb kc hh jx b be kd ke l kf kg">df_280_320%&gt;%<br/>+   group_by(Location, Treatm)%&gt;%<br/>+   summarise(mean = mean(Value), <br/>+             sd = sd(Value))<br/>`summarise()` has grouped output by 'Location'. You can override using the `.groups`<br/>argument.<br/># A tibble: 12 x 4<br/># Groups:   Location [6]<br/>   Location  Treatm    mean    sd<br/>   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;<br/> 1 Central   OFF_ON -1.76   2.00 <br/> 2 Central   ON_OFF -0.829  1.89 <br/> 3 Frontal   OFF_ON  0.0175 1.99 <br/> 4 Frontal   ON_OFF  0.415  1.34 <br/> 5 Occipital OFF_ON  0.0394 2.19 <br/> 6 Occipital ON_OFF -0.651  1.32 <br/> 7 Parietal  OFF_ON -0.837  1.42 <br/> 8 Parietal  ON_OFF -0.852  1.14 <br/> 9 TemporalL OFF_ON  0.555  1.11 <br/>10 TemporalL ON_OFF  0.814  0.750<br/>11 TemporalR OFF_ON  1.08   1.45 <br/>12 TemporalR ON_OFF  0.622  1.19 </span></pre><p id="cf52" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面，你可以看到整个数据集。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="c35c" class="kb kc hh jx b be kd ke l kf kg">df_all&lt;-df%&gt;%<br/>  select(Subject, Time, RF, Treatm,<br/>         Frontal,TemporalR,TemporalL,<br/>         Central,Parietal,Occipital )%&gt;%<br/>  group_by(Subject, Time, RF, Treatm)%&gt;%<br/>  tidyr::pivot_longer(<br/>    cols = Frontal:Occipital,<br/>    names_to = "Location",<br/>    values_to = "Value",<br/>    values_drop_na = TRUE)%&gt;%<br/>  ungroup()%&gt;%<br/>  mutate(loc = if_else(Treatm == "OFF_ON" &amp; RF =="OFF", 1, <br/>                       if_else(Treatm == "ON_OFF" &amp; RF =="ON", 1, 2)))%&gt;%<br/>  arrange(Subject, Location, loc)<br/>table(df_all$Subject, df_all$Treatm)<br/>      <br/>       OFF_ON ON_OFF<br/>  1001    528      0<br/>  1002    528      0<br/>  1003      0    528<br/>  1004    528      0<br/>  1005    528      0<br/>  1006      0    528<br/>  1007    528      0<br/>  1008      0    528<br/>  1009      0    528<br/>  1010      0    528<br/>  1011      0    528<br/>  1012    528      0<br/>  1013    528      0<br/>  1014      0    528<br/>  1015    528      0<br/>  1016    528      0<br/>  1017    528      0<br/>  1018      0    528<br/>  1019      0    528<br/>  1020      0    528<br/>  1021      0    528<br/>  1022    528      0<br/>  1023    528      0<br/>  1024    528      0<br/>  1025    528      0<br/>  1026    528      0<br/>  1027      0    528<br/>  1028      0    528<br/>  1029      0    528<br/>  1030      0    528<br/>  1031    528      0<br/>  1033      0    528</span></pre><p id="e45d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，我将转移到最重要的部分，也就是不同之处。因为每个病人都有两个相同波形的样本，所以我可以计算每个病人之间的差异。这种患者内部的差异是比较治疗的关键，因为人们会预期不同治疗的患者内部差异不同。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="4364" class="kb kc hh jx b be kd ke l kf kg">df_all_diff&lt;-df%&gt;%<br/>  select(Subject, Time, RF, Treatm,<br/>         Frontal,TemporalR,TemporalL,<br/>         Central,Parietal,Occipital )%&gt;%<br/>  group_by(Subject, Time, RF, Treatm)%&gt;%<br/>  tidyr::pivot_longer(<br/>    cols = Frontal:Occipital,<br/>    names_to = "Location",<br/>    values_to = "Value",<br/>    values_drop_na = TRUE)%&gt;%<br/>  ungroup()%&gt;%<br/>  mutate(loc = if_else(Treatm == "OFF_ON" &amp; RF =="OFF", 1, <br/>                       if_else(Treatm == "ON_OFF" &amp; RF =="ON", 1, 2)))%&gt;%<br/>  group_by(Subject, Time, Treatm, Location)%&gt;%<br/>  arrange(Subject, Location, loc)%&gt;%<br/>  summarize(Value = Value - lag(Value))%&gt;%<br/>  ungroup()%&gt;%<br/>  tidyr::drop_na()<br/>table(df_all_diff$Subject, df_all_diff$Treatm)<br/>      <br/>       OFF_ON ON_OFF<br/>  1001    264      0<br/>  1002    264      0<br/>  1003      0    264<br/>  1004    264      0<br/>  1005    264      0<br/>  1006      0    264<br/>  1007    264      0<br/>  1008      0    264<br/>  1009      0    264<br/>  1010      0    264<br/>  1011      0    264<br/>  1012    264      0<br/>  1013    264      0<br/>  1014      0    264<br/>  1015    264      0<br/>  1016    264      0<br/>  1017    264      0<br/>  1018      0    264<br/>  1019      0    264<br/>  1020      0    264<br/>  1021      0    264<br/>  1022    264      0<br/>  1023    264      0<br/>  1024    264      0<br/>  1025    264      0<br/>  1026    264      0<br/>  1027      0    264<br/>  1028      0    264<br/>  1029      0    264<br/>  1030      0    264<br/>  1031    264      0<br/>  1033      0    264</span></pre><p id="b1ab" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我给你看看那是什么样子，如果进展顺利的话。下面，你可以看到，对于一个病人和六个记录的大脑区域，两个波形和它们的差异。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="4656" class="kb kc hh jx b be kd ke l kf kg">ggplot()+<br/>  geom_line(data=df_all_diff[df_all_diff$Subject==1001,], <br/>            aes(x=Time, <br/>                y=Value, <br/>                group=Subject),<br/>            col="black")+<br/>  geom_text(data=df_all_diff[df_all_diff$Subject==1001,], <br/>            aes(x=Time,<br/>                y=Value, <br/>                label=round(Value,1), <br/>                group=Subject), <br/>            col="black")+<br/>  geom_line(data=df_all[df_all$Subject==1001,], <br/>            aes(x=Time, <br/>                y=Value, <br/>                group=Subject*loc, <br/>                color=factor(RF)))+<br/>  geom_text(data=df_all[df_all$Subject==1001,], <br/>            aes(x=Time,<br/>                y=Value, <br/>                label=round(Value,1), <br/>                group=Subject*loc, <br/>                color=factor(RF)))+<br/>  facet_wrap(~Location)+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kh"><img src="../Images/6c998e1b9670bcb5b83ab9e8f5fc6973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qB0RurDdnJ_HQ7CVnFkz2A.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The waveforms of a single patient, per brain region and treatment, and its difference (in black). As you can see the waveforms are not the same in each brain region and is especially informative around 250–400.</figcaption></figure><p id="378f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，让我们用箱线图来看看不同患者、不同治疗和不同脑区之间的差异。查看箱线图的平均值和范围是有好处的。虽然我们在一个病人身上有很多数据，但我们没有那么多跨病人的数据——每组只有16个。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="2c83" class="kb kc hh jx b be kd ke l kf kg">df_all_diff%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kt"><img src="../Images/c94b604735f1adfce50daaae52b80268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRMGXD5iFQWOHX3VuO1h5Q.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The data across patients and per treatment and brain location as a function of time (ms).</figcaption></figure><p id="f45f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">正如你所看到的，有相当多的变化，这种变化可能取决于平均水平。这就是为什么我想评估变异系数(CV ),并查看在哪些地方变异超过了平均值(变异系数计算标准偏差与平均值的比率)。下面，我将通过汇总患者、每次治疗和大脑位置来准备数据。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="6506" class="kb kc hh jx b be kd ke l kf kg">df_all_diff%&gt;%<br/>  group_by(Time, Treatm, Location)%&gt;%<br/>  summarise(mean = mean(Value), <br/>            std = sd(Value, na.rm=TRUE),<br/>            cv= std/mean)<br/><br/>`summarise()` has grouped output by 'Time', 'Treatm'. You can<br/>override using the `.groups` argument.<br/># A tibble: 528 x 6<br/># Groups:   Time, Treatm [88]<br/>    Time Treatm Location      mean   std     cv<br/>   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;<br/> 1  -200 OFF_ON Central   -0.0687  0.573  -8.34<br/> 2  -200 OFF_ON Frontal    0.0756  0.721   9.53<br/> 3  -200 OFF_ON Occipital  0.247   0.842   3.41<br/> 4  -200 OFF_ON Parietal   0.045   0.684  15.2 <br/> 5  -200 OFF_ON TemporalL -0.121   0.469  -3.89<br/> 6  -200 OFF_ON TemporalR -0.0881  0.574  -6.51<br/> 7  -200 ON_OFF Central   -0.0969  0.269  -2.78<br/> 8  -200 ON_OFF Frontal   -0.0225  0.289 -12.9 <br/> 9  -200 ON_OFF Occipital  0.0737  0.440   5.97<br/>10  -200 ON_OFF Parietal   0.00250 0.276 110.  <br/># ... with 518 more rows<br/><br/>df_all_diff%&gt;%<br/>  group_by(Time, Treatm, Location)%&gt;%<br/>  summarise(mean = mean(Value), <br/>            std = sd(Value, na.rm=TRUE),<br/>            cv= std/mean)%&gt;%<br/>  ggplot(.)+<br/>  geom_line(aes(x=Time, <br/>                y=cv,<br/>                col=factor(Treatm)))+<br/>  geom_point(aes(x=Time, <br/>                y=cv,<br/>                col=factor(Treatm)))+<br/>  facet_wrap(~Location)+<br/>  geom_vline(xintercept = 280, lty=1, size=2, col="black")+<br/>  geom_vline(xintercept = 320, lty=1, size=2,col="black")+<br/>  geom_vline(xintercept = 200, lty=1, size=2,col="purple")+<br/>  geom_vline(xintercept = 400, lty=1, size=2,col="purple")+<br/>  labs(x="Time", <br/>       y="Coefficient of Variation", <br/>       col="Treatment")+<br/>  theme_bw()+<br/>  ylim(-100,100)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kt"><img src="../Images/b58fcea70d9c9817c53c388a3c0241b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aoWLn_puiwm3N0s53aSIUg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The black line represents the 280–320 region and the purple line the 200–400 region. These are important regions and as you can see much more stable then the rest of the waveforms. However, certain brain regions such as the frontal or occipital do display a higher CV ratio.</figcaption></figure><p id="413a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从分析的角度来看，关键是波形中的信号可以被检测到(如果存在的话),这意味着变化不应该太极端。高变异区域仍然很重要，当然也是信息的一部分，但是它们确实使精确定位差异变得更加困难。最后，贝叶斯方法的重点是收集信息，而不是发现(统计)意义，所以我们将重点放在这一点上。</p><p id="4fe3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我再往后移一点，深入分析我们正在分析的波形。这些数据不容易建模。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="719d" class="kb kc hh jx b be kd ke l kf kg">df%&gt;%filter(Subject==1001)%&gt;%<br/>ggplot(., <br/>       aes(x=Time, <br/>           y=Frontal, <br/>           col=RF))+<br/>  geom_hline(yintercept = 0, col="black", lty=1)+<br/>  geom_vline(xintercept = 0, col="black", lty=1)+<br/>  geom_line()+<br/>  geom_point()+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ku"><img src="../Images/f95e47d4fba3230978b16bd6e7f450eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vAQLwoJXbR_b-UwnwCCd0w.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">As you can see, for a single patient, there is plenty of data captured yet the form is not that easy to discern nor predict. At least, not the first time, but one could quite accurately predict the form of the “OFF” part once you know the “ON” part.</figcaption></figure><p id="12e9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看看所有的主题，然后缩小范围，以便更好地了解数据的模式，特别是波形，在特定的时间范围内。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="61ce" class="kb kc hh jx b be kd ke l kf kg">df%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Frontal, <br/>             col=RF))+<br/>  geom_line()+<br/>  facet_wrap(~Subject, scales="free")+<br/>  theme_bw()<br/>df%&gt;%filter(Time&gt;=280 &amp; Time &lt;=300)%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Frontal, <br/>             col=RF))+<br/>  geom_line()+<br/>  facet_wrap(~Subject, scales="free")+<br/>  theme_bw()<br/>df%&gt;%filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Frontal, <br/>             col=RF))+<br/>  geom_line()+<br/>  facet_wrap(~Subject, scales="free")+<br/>  theme_bw()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/053c943e33545b79c7fc55e4b713aa8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*pcnUKKoSNgtZRZFSZU1nDQ.png"/></div></figure><figure class="kv ki kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/35b1a80560552adcaab489f869a2d9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*O9yiKm4z_LAdjJghkf-Kpw.png"/></div></figure><figure class="kv ki kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/547916b402e04f49cb372e1bdc51323b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*YgvsbSyHFT8WT5OfR6CkrA.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx lb di lc ld">Left: overall time in ms. Middle: 280–320 ms. Right: 250–400 ms.</figcaption></figure></div><p id="d337" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据是相当分散的，为了对包含这种粒度级别的数据建模，我们可以开始研究样条。我真的很喜欢样条曲线，因为它们将数据和模型分割在一起，而不会过度拟合(因为交叉验证、指定结和限制结的数量)。<em class="le"> geom_smooth </em>命令将自动应用黄土函数，该函数可能会过度拟合。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="369b" class="kb kc hh jx b be kd ke l kf kg">df%&gt;%filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Occipital, <br/>             col=RF))+<br/>  geom_smooth()+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lf"><img src="../Images/6000bb6f197e3bf32596db6f1757859d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiaOOUzqKXR-Jeb6_jSZYg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The two parts of the treatments (ON / OFF) across bot treatments and subjects, but narrowing done for the occipital region. As you can see, the data is quite noisy but can be well approximated using a loess function which is the standard of the <strong class="bd lg">geom_smooth </strong>command.</figcaption></figure><p id="e489" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们仔细看看每种治疗方法，利用差异，展示每个大脑区域。我将使用标准的geom_smooth函数(黄土函数)，并使用由模型自动放置的五个节点指定一个b样条。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="8e70" class="kb kc hh jx b be kd ke l kf kg">df_all_diff%&gt;%filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Value, <br/>             col=Treatm, <br/>             fill=Treatm))+<br/>  geom_smooth()+<br/>  theme_bw()+<br/>  facet_wrap(~Location, scales="free")<br/><br/><br/>df_all_diff%&gt;%filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Value, <br/>             col=Treatm, <br/>             fill=Treatm))+<br/>  geom_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = TRUE)+<br/>  theme_bw()+<br/>  facet_wrap(~Location, scales="free")</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki lh kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/3c1457660a813557e01fb8d5b6b4ccdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*O19l09Fc6YvYciaoc7QaNw.png"/></div></figure><figure class="kv ki li kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/9542e546efc918a638feb83827b97fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*YJF5Q3c9effB__h3zoQUzg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx lj di lk ld">It seems that the standard <strong class="bd lg">geom_smooth </strong>function (left) is less overfitting then the <strong class="bd lg">b-spline</strong>, which means that using five knots is probably too much.</figcaption></figure></div><p id="9080" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在绘制差异图时，我想知道是否最好将每个病人的两个样本联系起来，看看我是否能发现差异。有点像A/B测试。为了做到这一点，我必须在每个实验对象的实验的第二部分加上660毫秒。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="5938" class="kb kc hh jx b be kd ke l kf kg">df%&gt;%<br/>  mutate(Time2 = if_else(Treatm=="ON_OFF" &amp; RF=="OFF", Time+880, if_else(<br/>    Treatm=="OFF_ON" &amp; RF=="ON", Time+880, Time)))%&gt;%<br/>  select(-c(`time/channel`, RF, Time, Session_one, Session_two))%&gt;%<br/>  tidyr::pivot_longer(!c(Subject, Treatm, Time2), names_to = "Brain_Region", values_to = "Value")%&gt;%<br/>  ggplot(., <br/>         aes(x=Time2, <br/>             y=Value,<br/>             group=Subject,<br/>             col=factor(Treatm)))+<br/>  geom_line()+<br/>  facet_grid(rows=vars(Brain_Region))+<br/>  theme_bw()+<br/>  geom_vline(xintercept = 660, col="black", lty=1, size=3)+<br/>  labs(x="Time", <br/>       y="Scores", <br/>       col="Treatment", <br/>       title="Frontal scores as a function of treatment")</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ll"><img src="../Images/b9a691682be7289154b5c8c031c40f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qc6ZQZPJ64qTehMAMWVWEg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The data for each patient, connected. The black line is the separation between the first and the second part for each patient. As you can see it is not so easy to spot a change, since this is not a traditional A/B test. This is just a second part of the data collection, which is a rerun. So, in the end, not useful.</figcaption></figure><p id="8b57" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们再来看看之前使用的箱线图，看看我们是否能找到更好的模式，看看不同时间和每个大脑区域的平均值和变化。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="8b3e" class="kb kc hh jx b be kd ke l kf kg">df_all_diff%&gt;%<br/>  filter(Location=="Frontal")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  filter(Location=="Central")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  filter(Location=="Occipital")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  filter(Location=="Parietal")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  filter(Location=="TemporalL")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  filter(Location=="TemporalR")%&gt;%<br/>  ggplot(., <br/>         aes(x=factor(Time), <br/>             y=Value, <br/>             fill=factor(Treatm)))+<br/>  geom_boxplot()+<br/>  facet_wrap(~Location)+<br/>  theme_bw()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki lm kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/932c0185b484ed17646fc6f81d44ae11.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*X2Uh01yiqRFTdbHiWxVwtw.png"/></div></figure><figure class="kv ki ln kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/3636345d947ce49da45dc9351a093bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*nDr-zNJDY_7LJFRR9yvdDA.png"/></div></figure><figure class="kv ki lo kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/73a3f6242c88fd8598181d0a80085b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*1J4CQTi0s9aDK74gW1X1Lg.png"/></div></figure></div><div class="ab cb"><figure class="kv ki lp kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/6da416dc096973a498207a9f6ead4cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*W7mGzHUZwH87rJA955C5yA.png"/></div></figure><figure class="kv ki lq kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/f4f025da33b2f13e9cb1525bdc95c803.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*6JRyLsA_AHnt8ebUgDsqkQ.png"/></div></figure><figure class="kv ki lr kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/b3f4862c01b03e4aaf1871a80bd4ae79.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*c5oXRwB23xUuSZhkmIcUPA.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx ls di lt ld">Once again, a lot of variation across the treatments.</figcaption></figure></div><p id="2262" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">那么，相关性呢。我们能把一些大脑区域的数据联系起来吗？请记住，大脑区域数据来自每个患者。所以事实上，我们对每个病人有12个时间序列(或纵向数据):6个大脑区域* 2个样本。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="5e21" class="kb kc hh jx b be kd ke l kf kg">df%&gt;%select(-c(`time/channel`, RF, Time, Session_one, Session_two, Subject))%&gt;%<br/>  filter(Treatm=="ON_OFF")%&gt;%<br/>  GGally::ggcorr()<br/>df%&gt;%select(-c(`time/channel`, RF, Time, Session_one, Session_two, Subject))%&gt;%<br/>  filter(Treatm=="OFF_ON")%&gt;%<br/>  GGally::ggcorr()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki lu kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/765c41f3174e7a7777be4b3be7e26fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*gDaj1f4ID9hhzOFN2wbPJg.png"/></div></figure><figure class="kv ki lv kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/e852acf3e24ab47202d3cfae988c521e.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*xo_hDUtmPN7_J6ka-2GgNg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx lw di lx ld">Correlations differ somewhat in strength per treatment part, but nothing too noteworthy. What is good to note is that there ARE correlations between adjacent brain regions.</figcaption></figure></div><p id="18f7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">波形的280-320毫秒部分是生物学上的重要部分，因此我将把重点放在250-400毫秒波形上。虽然280–320属于250–400，但它确实构成了一幅不同的画面。尤其是在变化如此显著的数据中。让我们使用不同的绘图方法来更深入地研究特定的模式。如果你觉得这是大量的绘图和图形探索，那么欢迎来到数据分析的世界。在建模之前，我至少有50%的时间在看数据。如果我不做模特了…</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="321c" class="kb kc hh jx b be kd ke l kf kg">df_280_320%&gt;%<br/>  ggplot(aes(x=Value, fill=Treatm))+<br/>  geom_density(alpha=0.5)+<br/>  facet_wrap(~Location, scales="free")+<br/>  theme_bw()<br/>df_250_400%&gt;%<br/>  ggplot(aes(x=Value, fill=Treatm))+<br/>  geom_density(alpha=0.5)+<br/>  facet_wrap(~Location, scales="free")+<br/>  theme_bw()<br/>df_280_320%&gt;%<br/>  ggplot(aes(x=Location, y=Value, col=Treatm))+<br/>  geom_boxplot()+<br/>  theme_bw()<br/>df_250_400%&gt;%<br/>  ggplot(aes(x=Location, y=Value, col=Treatm))+<br/>  geom_boxplot()+<br/>  theme_bw()<br/>df_280_320%&gt;%<br/>  ggplot(aes(x=Location, y=Value, col=Treatm, group=Subject))+<br/>  geom_point()+<br/>  geom_line()+<br/>  theme_bw()<br/>df_250_400%&gt;%<br/>  ggplot(aes(x=Location, y=Value, col=Treatm, group=Subject))+<br/>  geom_point()+<br/>  geom_line()+<br/>  theme_bw()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki ly kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/0e27770acf42a855d1f435bd98451e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*dus064xpL0avUJL6O4yclg.png"/></div></figure><figure class="kv ki lz kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/d0b184e3e949b97ee36be3d7fd4ed6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*KKLZiNgLN-kYMeIXl8XCQA.png"/></div></figure></div><div class="ab cb"><figure class="kv ki ma kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/0a45b7e4496a861506298ce8b921d8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*m-FxbfujgFdvqRa9mp8k9A.png"/></div></figure><figure class="kv ki mb kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/e2da27a266b0017fabc83fea05c74a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*u7XbhGptALB6jKgb1bFLyw.png"/></div></figure></div><div class="ab cb"><figure class="kv ki mc kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/0bcf7a3d05b56399b5acd96e6118b204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*9kDHQ_WA1dNN8wA2zg6oSw.png"/></div></figure><figure class="kv ki md kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/fcffad85e36c5342f6e1fa38be7db6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*BXPFOG5iLOYhvIuo56v4Qg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx me di mf ld">Yes, these is variation within the brain regions and treatments and yes, there is a signal, but it is difficult to pinpoint if the treatments truly produce difference waveforms and thus different differences between waveforms within a patient. I am starting to think that the assessment and modelling of the variation becomes more interesting than just looking for differences between the groups.</figcaption></figure></div><p id="7a96" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们将之前的平滑图重叠在我们已经看到的变化之上，以更好地了解它们的可用性，考虑到目前的高水平变化。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="e885" class="kb kc hh jx b be kd ke l kf kg">df_all_diff%&gt;%<br/>  ggplot(., <br/>         aes(x=Time, <br/>             y=Value, <br/>             color=factor(Treatm), <br/>             fill=factor(Treatm)))+<br/>  geom_point(alpha=0.2)+<br/>  geom_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = TRUE)+<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>df_all_diff%&gt;%<br/>  ggplot(.)+<br/>  geom_line(aes(x=Time, <br/>                 y=Value,<br/>                 group=Subject,<br/>                 col=factor(Treatm)), alpha=0.2)+<br/>  stat_summary(aes(x=Time, <br/>                   y=Value,<br/>                   group=factor(Treatm), <br/>                   col=factor(Treatm)), <br/>               fun=mean, geom="line", size=2)+<br/>  facet_wrap(~Location)+<br/>  geom_vline(xintercept = 280, lty=2, col="black")+<br/>  geom_vline(xintercept = 320, lty=2, col="black")+<br/>  geom_vline(xintercept = 200, lty=2, col="purple")+<br/>  geom_vline(xintercept = 400, lty=2, col="purple")+<br/>  labs(x="Time", <br/>       y="Difference", <br/>       col="Treatment")+<br/>  theme_bw()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki mg kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/942d1fef8e514996890a7cb0cf3f931f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*XhMP2t9Tova-j4OVjE9mtQ.png"/></div></figure><figure class="kv ki mh kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/6b46878b00b14cb998d36c446e886abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*V-j0q5Ufy6PvVPt2gb5lHQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mi di mj ld">The spline to the left and the line data to the right in which I have tried to highlight the 250–400 and 280–320 regions. As you can see from the right, there does seem to be some interesting patterns in certain brain regions like the central part of the brain. But these are also tricky images — they show the mean surrounded by variation which means that the mean is actually quite useless. This is better depicted to the left using the spline plots. However, even here, the central region shows a difference that seems to persist.</figcaption></figure></div><p id="ce16" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">好了，我相信我们已经做了足够的图形探索。是时候开始使用我们用来绘制数据的相同类型的样条来建模数据了。为此，我将使用广义加性模型(GAM的)和广义加性混合模型(GAMM的)来搜索使用样条的信息。为了尽可能避免过度拟合，我将应用交叉验证。对于R来说，<em class="le"> mgcv </em>封装是黄金标准。</p><p id="31db" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为位置对结果有如此巨大的影响，我将告诉模型在每个位置拟合不同的样条。为了对模型(和数据)的稳定性有所了解，我还会要求10节。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="e078" class="kb kc hh jx b be kd ke l kf kg">df_all_diff$Location&lt;-factor(df_all_diff$Location)<br/>df_all_diff$Treatm&lt;-factor(df_all_diff$Treatm)<br/>mod_gam1 = mgcv::gam(Value ~ Location+ s(Time,by=Location, k=10) + Treatm, <br/>                     data = df_all_diff)<br/>summary(mod_gam1)<br/><br/>Family: gaussian <br/>Link function: identity <br/><br/>Formula:<br/>Value ~ Location + s(Time, by = Location, k = 10) + Treatm<br/><br/>Parametric coefficients:<br/>                   Estimate Std. Error t value Pr(&gt;|t|)    <br/>(Intercept)       -0.099885   0.019554  -5.108 3.33e-07 ***<br/>LocationFrontal    0.251456   0.025603   9.822  &lt; 2e-16 ***<br/>LocationOccipital  0.068281   0.025603   2.667  0.00767 ** <br/>LocationParietal  -0.014560   0.025603  -0.569  0.56959    <br/>LocationTemporalL  0.130767   0.025603   5.108 3.33e-07 ***<br/>LocationTemporalR  0.183153   0.025603   7.154 9.16e-13 ***<br/>TreatmON_OFF      -0.003823   0.014782  -0.259  0.79591    <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>Approximate significance of smooth terms:<br/>                            edf Ref.df      F p-value    <br/>s(Time):LocationCentral   8.675  8.969 21.097 &lt; 2e-16 ***<br/>s(Time):LocationFrontal   6.611  7.741  9.536 &lt; 2e-16 ***<br/>s(Time):LocationOccipital 6.869  7.964  2.948 0.00279 ** <br/>s(Time):LocationParietal  8.062  8.765 17.143 &lt; 2e-16 ***<br/>s(Time):LocationTemporalL 8.660  8.967  9.021 &lt; 2e-16 ***<br/>s(Time):LocationTemporalR 7.202  8.230  7.781 &lt; 2e-16 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>R-sq.(adj) =  0.0787   Deviance explained = 8.44%<br/>GCV = 0.46438  Scale est. = 0.46147   n = 8448</span></pre><p id="ff66" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面显示的结果应该很简单-它使用频率统计和最大似然估计将统计显著性与p值联系起来。检查模型的更好方法是应用内置的<em class="le"> gam.check </em>函数并绘制结果。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="acc5" class="kb kc hh jx b be kd ke l kf kg">&gt; mgcv::gam.check(mod_gam1, k.rep = 1000)<br/><br/>Method: GCV   Optimizer: magic<br/>Smoothing parameter selection converged after 20 iterations.<br/>The RMS GCV score gradient at convergence was 1.068344e-07 .<br/>The Hessian was positive definite.<br/>Model rank =  61 / 61 <br/><br/>Basis dimension (k) checking results. Low p-value (k-index&lt;1) may<br/>indicate that k is too low, especially if edf is close to k'.<br/><br/>                            k'  edf k-index p-value<br/>s(Time):LocationCentral   9.00 8.67    0.98    0.12<br/>s(Time):LocationFrontal   9.00 6.61    0.98    0.15<br/>s(Time):LocationOccipital 9.00 6.87    0.98    0.14<br/>s(Time):LocationParietal  9.00 8.06    0.98    0.16<br/>s(Time):LocationTemporalL 9.00 8.66    0.98    0.14<br/>s(Time):LocationTemporalR 9.00 7.20    0.98    0.15</span></pre><p id="b3cf" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">模型似乎还好，虽然每个位置10节有点多。让我们也用图形检查一下。</p><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ll"><img src="../Images/e1c4580b0363ad0988b6817ee86e9412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTFnzDHx3LkL4C8vpYSHrA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Residuals are not adhering completely to the assumptions of normality and homogeneity.</figcaption></figure><p id="8228" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看看样条函数。记住，我要求六个样条(每个大脑区域一个)，每个样条由十个结组成。枕骨区域是唯一没有达到统计学显著性的样条，至少给出了一个概念，也许结的数量对于这种特殊的模式来说太多了。换句话说——这个模式没有我想象的那么不稳定，而且可以用一种更简单的方式来建模。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="9ca2" class="kb kc hh jx b be kd ke l kf kg">par(mfrow = c(3, 2))<br/>plot(mod_gam1)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mk"><img src="../Images/0afea402bc638647d56703a1a0bea6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIOyoDInrQwQe9dHR62ZTw.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The splines as fit from the model. The occipital region does not really need such a heavy spline. The rest shows quite a wiggled patterns that lends itself for spline modelling.</figcaption></figure><p id="2b53" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当然，我们可以通过使用基于<em class="le"> ggplot </em>库的不同库来扩充内置绘图。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="5c20" class="kb kc hh jx b be kd ke l kf kg">gratia::draw(mod_gam1)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mk"><img src="../Images/6a6da781e5c9ad03d9c5f29c15f52463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-irXvYbkPs0rc9TF_mGXPw.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The occipital region looks quite wiggly as well here, but in a much more cyclical pattern. The rest shows shifts. However, without discerning the difference between the treatments, the graphs do not really help much in finding an answer to the question if being in one treatment or the other changes the EEG pattern of a patient.</figcaption></figure><p id="6b9f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后就是<em class="le"> mgcViz </em>包。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="f040" class="kb kc hh jx b be kd ke l kf kg">b&lt;-mgcViz::getViz(mod_gam1)<br/>print(plot(b, allTerms = T), pages = 1)<br/>mgcViz::qq(b, rep = 20, showReps = T, CI = "none", a.qqpoi = list("shape" = 19), a.replin = list("alpha" = 0.2))<br/>check(b,<br/>      a.qq = list(method = "tnorm", <br/>                  a.cipoly = list(fill = "light blue")), <br/>      a.respoi = list(size = 0.5), <br/>      a.hist = list(bins = 10))<br/><br/>Method: GCV   Optimizer: magic<br/>Smoothing parameter selection converged after 20 iterations.<br/>The RMS GCV score gradient at convergence was 1.068344e-07 .<br/>The Hessian was positive definite.<br/>Model rank =  61 / 61 <br/><br/>Basis dimension (k) checking results. Low p-value (k-index&lt;1) may<br/>indicate that k is too low, especially if edf is close to k'.<br/><br/>                            k'  edf k-index p-value<br/>s(Time):LocationCentral   9.00 8.67    0.99    0.29<br/>s(Time):LocationFrontal   9.00 6.61    0.99    0.36<br/>s(Time):LocationOccipital 9.00 6.87    0.99    0.34<br/>s(Time):LocationParietal  9.00 8.06    0.99    0.40<br/>s(Time):LocationTemporalL 9.00 8.66    0.99    0.36<br/>s(Time):LocationTemporalR 9.00 7.20    0.99    0.33</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki ml kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/3d0f0f129f16f3baac97e9f1ff71c874.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*VISEtxed5ZBjMVJBjrxX9Q.png"/></div></figure><figure class="kv ki mm kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/c9be7bf73aa1cf498e1d374a76ee9a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*CkJtfKOiwBoIkOcfnq43LQ.png"/></div></figure><figure class="kv ki mn kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/5ff4268f46e0364c0cb9d2c1450d4e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*q8bZ9VLEPMG588-f-YunIg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mo di mp ld">Same results as before, but with added resampling. To the left you can now also see the main effects of location and treatment. For location we have already known that it is an important effect, but for treatment the effect remains much more unclear. The graphical analysis used before does not offer much help and also here, it seems that one the treatments has NO variation (?). Such a finding could very much hint at a model that is overfitted.</figcaption></figure></div><p id="8139" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是一个模型，在这个模型中，我将要求每个处理使用单独的样条。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="c20a" class="kb kc hh jx b be kd ke l kf kg">mod_gam2 = mgcv::gam(Value ~ Location+ s(Time,by=Treatm, k=10) + Treatm, <br/>                     data = df_all_diff)<br/>mgcv::gam.check(mod_gam2, k.rep = 1000)<br/><br/>Method: GCV   Optimizer: magic<br/>Smoothing parameter selection converged after 10 iterations.<br/>The RMS GCV score gradient at convergence was 1.475121e-07 .<br/>The Hessian was positive definite.<br/>Model rank =  25 / 25 <br/><br/>Basis dimension (k) checking results. Low p-value (k-index&lt;1) may<br/>indicate that k is too low, especially if edf is close to k'.<br/><br/>                       k'  edf k-index p-value<br/>s(Time):TreatmOFF_ON 9.00 1.51    0.99    0.25<br/>s(Time):TreatmON_OFF 9.00 1.00    0.99    0.24<br/><br/><br/>gratia::draw(mod_gam2)<br/>concurvity(mod_gam2)<br/>             para s(Time):TreatmOFF_ON s(Time):TreatmON_OFF<br/>worst    0.8571429         1.786408e-25         2.001350e-25<br/>observed 0.8571429         1.850499e-29         1.218342e-32<br/>estimate 0.8571429         4.495956e-28         4.272275e-28<br/><br/>b&lt;-mgcViz::getViz(mod_gam2)<br/>check(b,<br/>      a.qq = list(method = "tnorm", <br/>                  a.cipoly = list(fill = "light blue")), <br/>      a.respoi = list(size = 0.5), <br/>      a.hist = list(bins = 10))<br/>Method: GCV   Optimizer: magic<br/>Smoothing parameter selection converged after 10 iterations.<br/>The RMS GCV score gradient at convergence was 1.475121e-07 .<br/>The Hessian was positive definite.<br/>Model rank =  25 / 25 <br/><br/>Basis dimension (k) checking results. Low p-value (k-index&lt;1) may<br/>indicate that k is too low, especially if edf is close to k'.<br/><br/>                       k'  edf k-index p-value<br/>s(Time):TreatmOFF_ON 9.00 1.51       1    0.38<br/>s(Time):TreatmON_OFF 9.00 1.00       1    0.40</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki mq kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/d3e870d76b41fab421306f5b7939a4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fiHyiFLc4SZCfahBWvXrmA.png"/></div></figure><figure class="kv ki mq kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/54049872e013fdd70a113024cccb4485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*SXvDDRGemT3pxhoD_iZ81w.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mr di ms ld">Model results clearly show that if location is not included in a more vigorous way the model leaves somewhat to be desired. In other words, the location of the brain in which the EEG was captured holds more information that then the treatment a subject was assigned to.</figcaption></figure></div><p id="2c86" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们也可以通过比较模型来评估这种说法。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="a7c1" class="kb kc hh jx b be kd ke l kf kg">anova(mod_gam1, mod_gam2, test = "Chisq")<br/>Analysis of Deviance Table<br/><br/>Model 1: Value ~ Location + s(Time, by = Location, k = 10) + Treatm<br/>Model 2: Value ~ Location + s(Time, by = Treatm, k = 10) + Treatm<br/>  Resid. Df Resid. Dev      Df Deviance  Pr(&gt;Chi)    <br/>1    8390.4     3874.0                               <br/>2    8438.1     4152.8 -47.772  -278.85 &lt; 2.2e-16 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br/><br/>AIC(mod_gam1,mod_gam2)<br/>               df      AIC<br/>mod_gam1 54.08007 17496.05<br/>mod_gam2 10.51381 17996.12</span></pre><p id="0636" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">事实上，第一个模型比第二个模型更好，这意味着每个位置的单独样条模型比每个治疗的单独样条更好地被数据支持。</p><p id="0122" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于数据来源于患者，并且我们有每个患者的多个数据点(并且数据点本身是自相关的),因此将GAM模型扩展到GAMM模型会很好。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="0d95" class="kb kc hh jx b be kd ke l kf kg">mod_gam3 = gamm4::gamm4(Value ~ Location+ s(Time,by=Location) + Treatm, <br/>                        random=~(1|Subject), data = df_all_diff)<br/>mod_gam3$gam<br/>mod_gam3$mer<br/><br/>plot(mod_gam3$gam)<br/>Family: gaussian <br/>Link function: identity <br/><br/>Formula:<br/>Value ~ Location + s(Time, by = Location) + Treatm<br/><br/>Estimated degrees of freedom:<br/>8.28 6.25 5.30 7.56 7.63 6.61  total = 48.63 <br/><br/>lmer.REML score: 17636.23 <br/><br/><br/><br/>plot(mod_gam3$mer)<br/>Linear mixed model fit by REML ['lmerMod']<br/>REML criterion at convergence: 17636.23<br/>Random effects:<br/> Groups   Name                      Std.Dev.<br/> Subject  (Intercept)               0.0000  <br/> Xr.4     s(Time):LocationTemporalR 1.7752  <br/> Xr.3     s(Time):LocationTemporalL 2.9119  <br/> Xr.2     s(Time):LocationParietal  2.7979  <br/> Xr.1     s(Time):LocationOccipital 1.0056  <br/> Xr.0     s(Time):LocationFrontal   1.5169  <br/> Xr       s(Time):LocationCentral   4.5066  <br/> Residual                           0.6797  <br/>Number of obs: 8448, groups:  <br/>Subject, 32; Xr.4, 8; Xr.3, 8; Xr.2, 8; Xr.1, 8; Xr.0, 8; Xr, 8<br/>Fixed Effects:<br/>                 X(Intercept)               XLocationFrontal  <br/>                    -0.099885                       0.251456  <br/>           XLocationOccipital              XLocationParietal  <br/>                     0.068281                      -0.014560  <br/>           XLocationTemporalL             XLocationTemporalR  <br/>                     0.130767                       0.183153  <br/>                XTreatmON_OFF    Xs(Time):LocationCentralFx1  <br/>                    -0.003823                       0.038188  <br/>  Xs(Time):LocationFrontalFx1  Xs(Time):LocationOccipitalFx1  <br/>                    -0.034531                      -0.254505  <br/> Xs(Time):LocationParietalFx1  Xs(Time):LocationTemporalLFx1  <br/>                    -0.171399                       0.336391  <br/>Xs(Time):LocationTemporalRFx1  <br/>                     0.110113  </span></pre><p id="9542" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">根据这个模型，增加随机分量对最小化剩余分量没有任何作用。这意味着从GAM到GAMM的转换没有添加任何信息。我们可以绘制并直观地检查模型的表现。由于模型由两个模型(GAM和MER模型)的集成组成，我也可以绘制两个部分。事实上，我将不得不分别绘制它们。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="f796" class="kb kc hh jx b be kd ke l kf kg">plot(mod_gam3$gam)<br/>plot(mod_gam3$mer)</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki mt kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/f5b64b7245e403d9618236a5e373fa3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*--UYKr1wXiY6XS9ULHucBg.png"/></div></figure><figure class="kv ki mu kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/e46f1d8372124842932476d51f1c784b.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*3isU5I4eq7LfjmlfJ6ZvkQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mv di mw ld">The splines coming from the GAM part shown to the left and the residuals coming from the MER part to the right. Residuals look somewhat okay.</figcaption></figure></div><p id="cfb9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我使用基本的<em class="le"> lmer </em>函数对数据建模，然后应用样条，会怎么样？好吧，我最后得到的是很多参数，仍然没有从随机截距中得到解释的方差。模型中必须有所改变。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="f0f5" class="kb kc hh jx b be kd ke l kf kg">fit&lt;-lmer(Value ~ splines::bs(Time,5)*Location*Treatm+(1|Subject), <br/>          data = df_all_diff)<br/>summary(fit)<br/><br/>Linear mixed model fit by REML ['lmerMod']<br/>Formula: Value ~ splines::bs(Time, 5) * Location * Treatm + (1 | Subject)<br/>   Data: df_all_diff<br/><br/>REML criterion at convergence: 17672.5<br/><br/>Scaled residuals: <br/>    Min      1Q  Median      3Q     Max <br/>-5.1045 -0.5112  0.0012  0.5055  5.8069 <br/><br/>Random effects:<br/> Groups   Name        Variance Std.Dev.<br/> Subject  (Intercept) 0.0000   0.0000  <br/> Residual             0.4682   0.6843  <br/>Number of obs: 8448, groups:  Subject, 32<br/><br/>Fixed effects:<br/>                                                      Estimate Std. Error t value<br/>(Intercept)                                          -0.006205   0.124698  -0.050<br/>splines::bs(Time, 5)1                                -0.222783   0.241892  -0.921<br/>splines::bs(Time, 5)2                                 0.778134   0.177183   4.392<br/>splines::bs(Time, 5)3                                -1.557075   0.228961  -6.801<br/>splines::bs(Time, 5)4                                 0.686644   0.186682   3.678<br/>splines::bs(Time, 5)5                                -0.088036   0.180222  -0.488<br/>LocationFrontal                                      -0.031311   0.176350  -0.178<br/>LocationOccipital                                     0.291694   0.176350   1.654<br/>LocationParietal                                      0.199977   0.176350   1.134<br/>LocationTemporalL                                    -0.218000   0.176350  -1.236<br/>LocationTemporalR                                    -0.111474   0.176350  -0.632<br/>TreatmON_OFF                                         -0.032629   0.176350  -0.185<br/>splines::bs(Time, 5)1:LocationFrontal                 0.512373   0.342086   1.498<br/>splines::bs(Time, 5)2:LocationFrontal                -1.105375   0.250575  -4.411<br/>splines::bs(Time, 5)3:LocationFrontal                 2.029441   0.323800   6.268<br/>splines::bs(Time, 5)4:LocationFrontal                -0.151254   0.264008  -0.573<br/>splines::bs(Time, 5)5:LocationFrontal                 0.286643   0.254872   1.125<br/>splines::bs(Time, 5)1:LocationOccipital              -0.320674   0.342086  -0.937<br/>splines::bs(Time, 5)2:LocationOccipital              -0.920669   0.250575  -3.674<br/>splines::bs(Time, 5)3:LocationOccipital               1.263202   0.323800   3.901<br/>splines::bs(Time, 5)4:LocationOccipital              -0.880373   0.264008  -3.335<br/>splines::bs(Time, 5)5:LocationOccipital              -0.220418   0.254872  -0.865<br/>splines::bs(Time, 5)1:LocationParietal               -0.518464   0.342086  -1.516<br/>splines::bs(Time, 5)2:LocationParietal                0.083274   0.250575   0.332<br/>splines::bs(Time, 5)3:LocationParietal                0.007770   0.323800   0.024<br/>splines::bs(Time, 5)4:LocationParietal               -0.667745   0.264008  -2.529<br/>splines::bs(Time, 5)5:LocationParietal               -0.206607   0.254872  -0.811<br/>splines::bs(Time, 5)1:LocationTemporalL               0.804571   0.342086   2.352<br/>splines::bs(Time, 5)2:LocationTemporalL              -1.165478   0.250575  -4.651<br/>splines::bs(Time, 5)3:LocationTemporalL               2.460331   0.323800   7.598<br/>splines::bs(Time, 5)4:LocationTemporalL              -0.696576   0.264008  -2.638<br/>splines::bs(Time, 5)5:LocationTemporalL               0.139232   0.254872   0.546<br/>splines::bs(Time, 5)1:LocationTemporalR               0.653222   0.342086   1.910<br/>splines::bs(Time, 5)2:LocationTemporalR              -1.327438   0.250575  -5.298<br/>splines::bs(Time, 5)3:LocationTemporalR               2.836979   0.323800   8.762<br/>splines::bs(Time, 5)4:LocationTemporalR              -1.170976   0.264008  -4.435<br/>splines::bs(Time, 5)5:LocationTemporalR               0.464149   0.254872   1.821<br/>splines::bs(Time, 5)1:TreatmON_OFF                    0.134668   0.342086   0.394<br/>splines::bs(Time, 5)2:TreatmON_OFF                   -0.288278   0.250575  -1.150<br/>splines::bs(Time, 5)3:TreatmON_OFF                    0.762567   0.323800   2.355<br/>splines::bs(Time, 5)4:TreatmON_OFF                   -0.439044   0.264008  -1.663<br/>splines::bs(Time, 5)5:TreatmON_OFF                    0.216905   0.254872   0.851<br/>LocationFrontal:TreatmON_OFF                         -0.086358   0.249397  -0.346<br/>LocationOccipital:TreatmON_OFF                       -0.041804   0.249397  -0.168<br/>LocationParietal:TreatmON_OFF                        -0.014295   0.249397  -0.057<br/>LocationTemporalL:TreatmON_OFF                        0.157587   0.249397   0.632<br/>LocationTemporalR:TreatmON_OFF                        0.070040   0.249397   0.281<br/>splines::bs(Time, 5)1:LocationFrontal:TreatmON_OFF   -0.156327   0.483783  -0.323<br/>splines::bs(Time, 5)2:LocationFrontal:TreatmON_OFF    0.760626   0.354366   2.146<br/>splines::bs(Time, 5)3:LocationFrontal:TreatmON_OFF   -0.634830   0.457922  -1.386<br/>splines::bs(Time, 5)4:LocationFrontal:TreatmON_OFF    0.295937   0.373364   0.793<br/>splines::bs(Time, 5)5:LocationFrontal:TreatmON_OFF   -0.267030   0.360444  -0.741<br/>splines::bs(Time, 5)1:LocationOccipital:TreatmON_OFF  0.027671   0.483783   0.057<br/>splines::bs(Time, 5)2:LocationOccipital:TreatmON_OFF  0.359626   0.354366   1.015<br/>splines::bs(Time, 5)3:LocationOccipital:TreatmON_OFF -1.088830   0.457922  -2.378<br/>splines::bs(Time, 5)4:LocationOccipital:TreatmON_OFF  0.269381   0.373364   0.721<br/>splines::bs(Time, 5)5:LocationOccipital:TreatmON_OFF -0.087426   0.360444  -0.243<br/>splines::bs(Time, 5)1:LocationParietal:TreatmON_OFF   0.169916   0.483783   0.351<br/>splines::bs(Time, 5)2:LocationParietal:TreatmON_OFF  -0.252128   0.354366  -0.711<br/>splines::bs(Time, 5)3:LocationParietal:TreatmON_OFF  -0.277775   0.457922  -0.607<br/>splines::bs(Time, 5)4:LocationParietal:TreatmON_OFF   0.402255   0.373364   1.077<br/>splines::bs(Time, 5)5:LocationParietal:TreatmON_OFF   0.041977   0.360444   0.116<br/>splines::bs(Time, 5)1:LocationTemporalL:TreatmON_OFF -0.363102   0.483783  -0.751<br/>splines::bs(Time, 5)2:LocationTemporalL:TreatmON_OFF  0.288951   0.354366   0.815<br/>splines::bs(Time, 5)3:LocationTemporalL:TreatmON_OFF -0.785173   0.457922  -1.715<br/>splines::bs(Time, 5)4:LocationTemporalL:TreatmON_OFF  0.319481   0.373364   0.856<br/>splines::bs(Time, 5)5:LocationTemporalL:TreatmON_OFF -0.276941   0.360444  -0.768<br/>splines::bs(Time, 5)1:LocationTemporalR:TreatmON_OFF -0.349997   0.483783  -0.723<br/>splines::bs(Time, 5)2:LocationTemporalR:TreatmON_OFF  0.663091   0.354366   1.871<br/>splines::bs(Time, 5)3:LocationTemporalR:TreatmON_OFF -1.431663   0.457922  -3.126<br/>splines::bs(Time, 5)4:LocationTemporalR:TreatmON_OFF  0.996570   0.373364   2.669<br/>splines::bs(Time, 5)5:LocationTemporalR:TreatmON_OFF -0.563605   0.360444  -1.564<br/><br/>Correlation matrix not shown by default, as p = 72 &gt; 12.<br/>Use print(x, correlation=TRUE)  or<br/>    vcov(x)        if you need it<br/><br/>optimizer (nloptwrap) convergence code: 0 (OK)<br/>boundary (singular) fit: see help('isSingular')<br/><br/>sjPlot::plot_model(fit, type="diag")<br/>sjPlot::plot_model(fit, type="pred")</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki mx kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/49f5096641559fc1d9a07f4a26ad7ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*SvTlwDeHe8vM5wtU99Rqdw.png"/></div></figure><figure class="kv ki my kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/986006d69c288c166b5f6a09cdc35316.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*6he89ZsxLSUx-mlCcbDlMw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mz di na ld">The same result, plot differently. I find the peak and valley at 0.05 (fitted values) strange. I am not sure why I am having them.</figcaption></figure></div><div class="ab cb"><figure class="kv ki nb kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/bb4e6b98064103c08e495051c2560ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*oInQD6dXjrGoRqEms2d9KQ.png"/></div></figure><figure class="kv ki nc kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/2c62732f0dbba3b932e3d60418aef4c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*nw1BCiRlq2EPdDMv9lUV2g.png"/></div></figure><figure class="kv ki nd kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/4c6c71122185de104a9a48cb1c6cb529.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*37zWHjrYgIvGYwJEmTbTBw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx ne di nf ld">Well, the residuals have for sure some long tails and quite a peak. The random intercept is zero so the plot should not surprise us.</figcaption></figure></div><p id="24a5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我之前提到过位置数据嵌套在主题中。然而，我下面的做法是完全错误的。我制作了一个模型，在这个模型中，我将主题嵌套在位置中。当然，模型将按照要求执行，但是让我们看看会发生什么。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="a261" class="kb kc hh jx b be kd ke l kf kg">fit&lt;-lmer(Value ~ splines::bs(Time,5)*Treatm+(1 + Location|Subject), <br/>          data = df_all_diff)<br/>summary(fit)<br/><br/>Linear mixed model fit by REML ['lmerMod']<br/>Formula: Value ~ splines::bs(Time, 5) * Treatm + (1 + Location | Subject)<br/>   Data: df_all_diff<br/><br/>REML criterion at convergence: 16620.1<br/><br/>Scaled residuals: <br/>    Min      1Q  Median      3Q     Max <br/>-5.1255 -0.5463  0.0039  0.5590  5.7472 <br/><br/>Random effects:<br/> Groups   Name              Variance Std.Dev. Corr                         <br/> Subject  (Intercept)       0.1190   0.3450                                <br/>          LocationFrontal   0.1963   0.4431   -0.50                        <br/>          LocationOccipital 0.4131   0.6427   -0.86  0.06                  <br/>          LocationParietal  0.1228   0.3504   -0.71 -0.21  0.96            <br/>          LocationTemporalL 0.1946   0.4411   -0.90  0.66  0.61  0.41      <br/>          LocationTemporalR 0.2611   0.5110   -0.93  0.62  0.65  0.49  0.86<br/> Residual                   0.4017   0.6338                                <br/>Number of obs: 8448, groups:  Subject, 32<br/><br/>Fixed effects:<br/>                                   Estimate Std. Error t value<br/>(Intercept)                         0.01734    0.04721   0.367<br/>splines::bs(Time, 5)1              -0.03428    0.09147  -0.375<br/>splines::bs(Time, 5)2               0.03885    0.06700   0.580<br/>splines::bs(Time, 5)3              -0.12412    0.08658  -1.434<br/>splines::bs(Time, 5)4               0.09216    0.07059   1.305<br/>splines::bs(Time, 5)5              -0.01087    0.06815  -0.159<br/>TreatmON_OFF                       -0.01932    0.06676  -0.289<br/>splines::bs(Time, 5)1:TreatmON_OFF  0.02269    0.12936   0.175<br/>splines::bs(Time, 5)2:TreatmON_OFF  0.01508    0.09475   0.159<br/>splines::bs(Time, 5)3:TreatmON_OFF  0.05952    0.12244   0.486<br/>splines::bs(Time, 5)4:TreatmON_OFF -0.05844    0.09983  -0.585<br/>splines::bs(Time, 5)5:TreatmON_OFF  0.02473    0.09638   0.257<br/><br/>Correlation of Fixed Effects:<br/>            (Intr) sp::(T,5)1 sp::(T,5)2 sp::(T,5)3 sp::(T,5)4 sp::(T,5)5 TON_OF s::(T,5)1: s::(T,5)2: s::(T,5)3: s::(T,5)4:<br/>spl::(T,5)1 -0.833                                                                                                          <br/>spl::(T,5)2 -0.417  0.001                                                                                                   <br/>spl::(T,5)3 -0.691  0.765     -0.230                                                                                        <br/>spl::(T,5)4 -0.572  0.351      0.606     -0.029                                                                             <br/>spl::(T,5)5 -0.722  0.644      0.179      0.648      0.131                                                                  <br/>TretmON_OFF -0.707  0.589      0.295      0.488      0.404      0.510                                                       <br/>s::(T,5)1:T  0.589 -0.707     -0.001     -0.541     -0.248     -0.455     -0.833                                            <br/>s::(T,5)2:T  0.295 -0.001     -0.707      0.162     -0.429     -0.127     -0.417  0.001                                     <br/>s::(T,5)3:T  0.488 -0.541      0.162     -0.707      0.021     -0.458     -0.691  0.765     -0.230                          <br/>s::(T,5)4:T  0.404 -0.248     -0.429      0.021     -0.707     -0.093     -0.572  0.351      0.606     -0.029               <br/>s::(T,5)5:T  0.510 -0.455     -0.127     -0.458     -0.093     -0.707     -0.722  0.644      0.179      0.648      0.131    <br/>optimizer (nloptwrap) convergence code: 0 (OK)<br/>boundary (singular) fit: see help('isSingular')<br/></span></pre><pre class="ng jw jx jy bn jz ka bi"><span id="bb7f" class="kb kc hh jx b be kd ke l kf kg">sjPlot::plot_model(fit, type="diag")<br/>sjPlot::plot_model(fit, type="pred")<br/>pred&lt;-broom.mixed::augment(fit)</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki nh kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/05a042b8a4ba555cf8e8d9af6fc0c4ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*xSsJuAPwoyoB4_cOe9UcPQ.png"/></div></figure><figure class="kv ki ni kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/f558f150fb2b9f4364a2fde213d442d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*9Qc-x1dAqfwg-agkz9ezsw.png"/></div></figure></div><div class="ab cb"><figure class="kv ki nj kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/60e3c419b71963cac1862146e6c251ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*LbGPPrTmm2f682pQ1-Py9w.png"/></div></figure><figure class="kv ki nk kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/c1618af3db1e14dc7b9bf60f632cd3fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*XPwdRnGRGBdYs9YOsZqYqw.png"/></div></figure></div><div class="ab cb"><figure class="kv ki nl kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/0083753c8180729e161ae4e3ab899933.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*GSBSmxZySdeHfudcnw29EA.png"/></div></figure><figure class="kv ki nm kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/3f734c69d5f162dd848f0f290ba6b87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*jsJ65bPUqLdakD0ReJy4cw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx nn di no ld">The residuals are somewhat heavy on the tails, the random intercepts perform as they should and the conditional effects are also okay. The residuals definitly have more homogeneity, so all in all the model meets the asumptions of a linear mixed model better than it did before.</figcaption></figure></div><p id="b906" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">另一个评估测试是将拟合值与观察值进行比较。让我们根据每个治疗和每个位置来评估通过最大似然法获得的结果的有效性。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="57de" class="kb kc hh jx b be kd ke l kf kg">ggplot(pred, <br/>       aes(x=Value, y=.fitted, col=Treatm))+<br/>  geom_point()+<br/>  facet_wrap(~Location, ncol=2)+<br/>  theme_bw()+<br/>  geom_abline(intercept=0, slope=1, col="black", lty=2)+<br/>  xlim(-2,2)+<br/>  ylim(-2,2)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ll"><img src="../Images/aca7191780182ac8e09c433361fdce5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t0I52qMZoXO7vtzigNoG7Q.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">This is NOT good at all. Hence, the model is not good.</figcaption></figure><p id="0cda" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们尝试一个不同的模型，在这个模型中，我在寻找一种处理重尾的方法。为此，我将运行一个简单的线性模型，包括受试者特定的截距，以及时间(样条)、治疗和位置的主要影响。然后我将添加一个Box-Cox变换。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="ebb0" class="kb kc hh jx b be kd ke l kf kg">fitlm&lt;-lm(Value ~ splines::bs(Time,5)+as.factor(Treatm)+<br/>            as.factor(Location)+as.factor(Subject), data=df_all_diff)<br/>par(mfrow=c(2,2));plot(fitlm)<br/>boxcox(fitlm,lambda=seq(-2,2,by=0.1),plotit=T)<br/>Error in boxcox.default(fitlm, lambda = seq(-2, 2, by = 0.1), plotit = T) : <br/>  response variable must be positive</span></pre><p id="3179" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">那并不顺利。这是因为有些值是负值，并且对数转换不适用于负值。所以我必须加上一个常数，让它们都变成正的。</p><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es np"><img src="../Images/5c7682c2c6cbe09ae708399c8025d24d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gM-mdyNrmQjjr0lQYbzl5g.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">As you can see the linear model still has some heavy tail residuals.</figcaption></figure><p id="dab8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">查看结果值描述符，我可以看到最小值是-3.29。让我们给每个值加4。因为我把数据加到所有的值上，增加了一个常数4，我没有改变变量之间的关系。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="97b4" class="kb kc hh jx b be kd ke l kf kg">summary(df_all_diff$Value)<br/>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. <br/>-3.290000 -0.360000  0.010000  0.001386  0.370000  4.400000 <br/><br/>df_all_diff$Value2&lt;-df_all_diff$Value + 4<br/>fitlm&lt;-lm(Value2 ~ splines::bs(Time,5)+as.factor(Treatm)+<br/>            as.factor(Location)+as.factor(Subject), data=df_all_diff)<br/>par(mfrow=c(2,2));plot(fitlm)<br/><br/><br/>#   -2   --&gt;  1/Y2<br/>#   -1   --&gt;  1/Y1<br/>#   -0.5  --&gt;  1/(Sqrt(Y))<br/>#   0     --&gt;  log(Y)<br/>#   0.5   --&gt;  Sqrt(Y)<br/>#   1     --&gt;  Y<br/>#   2     --&gt;  Y^2<br/><br/><br/>boxcox(fitlm,lambda=seq(-2,2,by=0.1),plotit=T)<br/>bc1&lt;-boxcox(fitlm,lambda=seq(-2,2,by=0.1),plotit=T)<br/>which.max(bc1$y)<br/>[1] 77<br/>LV&lt;-bc1[1]$x[as.numeric(which.max(bc1$y))]<br/>LV <br/>[1] 1.070707</span></pre><p id="8cac" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Box-Cox提供了1.07作为lambda值，这意味着我必须将所有值提高1.07的幂。这几乎不会增加什么。因此，对数据进行Box-Cox变换不会消除重尾残差的问题。这意味着我必须更好地指定型号。</p><div class="js jt ju jv fd ab cb"><figure class="kv ki nq kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/9b920626bfc7abd95ff728dee0e07d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*_X1eEhXf2n_jYJmU2lyluA.png"/></div></figure><figure class="kv ki nr kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/c70469188d63629689be99f604711e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*35C-qiZajn-12-bnMJTCdQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx ns di nt ld">Model residuals pre-transformation (left) and Box-Cox results (right). The chosen transformation power is 1.07.</figcaption></figure></div><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="f5d4" class="kb kc hh jx b be kd ke l kf kg">df_all_diff$ValueBC&lt;-df_all_diff$Value^1.070707<br/>fitBC&lt;-lm(ValueBC ~ splines::bs(Time,5)+as.factor(Treatm)+<br/>            as.factor(Location)+as.factor(Subject), data=df_all_diff)<br/>par(mfrow=c(2,2));plot(fitBC)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nu"><img src="../Images/e08b6bfe854bf1508f3f69a352f687cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fYx_h9NNZk01wwUOjgmLrQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">And the residuals from the Box-Cox transformed data — as you can see, this is NOT good. By adding a constant and transforming that constant, I have built a somehwat natural boundary. Perhaps adding the constant was not that wise, but it should not change the interrelationship of the variables.</figcaption></figure><p id="8f5f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我稍微改变一下模型呢？似乎将结的数量从5个增加到10个可以提高模型拟合度。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="71da" class="kb kc hh jx b be kd ke l kf kg">fitlm&lt;-lm(Value ~ splines::bs(Time,5)+as.factor(Treatm)+<br/>            as.factor(Location)+as.factor(Subject), data=df_all_diff)<br/>fitlm2&lt;-lm(Value ~ splines::bs(Time,10)*as.factor(Location)+as.factor(Treatm)+<br/>             as.factor(Subject), data=df_all_diff)<br/>par(mfrow=c(2,2));plot(fitlm2)<br/>AIC(fitlm,fitlm2)<br/>       df      AIC<br/>fitlm  43 18036.44<br/>fitlm2 98 17584.51</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nv"><img src="../Images/64b31a5222fe6909732c3bfd4d8dbfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMWcEPcXyPMaOHm_Lxr7Pg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">But the heavy tails remain.</figcaption></figure><p id="c536" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">也许我们有一些有影响的观察结果导致了这种干扰。请再次注意，我指定随机截距的方式是不正确的。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="d810" class="kb kc hh jx b be kd ke l kf kg">fit&lt;-lmer(Value ~ splines::bs(Time,5)*Treatm+(1 + Location|Subject), <br/>          data = df_all_diff)<br/>fit.inf&lt;- influence.ME::influence(fit, "Subject")<br/>dfbetas(fit.inf, parameters=c(2:6))<br/>plot(fit.inf,<br/>     which="dfbetas",<br/>     parameters=c(2:6),<br/>     xlab="DFbetaS",<br/>     ylab="Subject")</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nw"><img src="../Images/2748f6c4152f586443e1e656ee4d828f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FvFmYU7ikBX0FupzW5_s0w.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Nothing really sticks out.</figcaption></figure><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="a5f9" class="kb kc hh jx b be kd ke l kf kg">plot(fit.inf, which="cook",<br/>     cutoff=4/length(unique(df_all_diff$Subject)),sort=TRUE,<br/>     xlab="Cook´s Distance",<br/>     ylab="Subject")</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nx"><img src="../Images/7a658d0c42432c66aa91c1b8ebd1ea60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0tSJDIN119lCcf_IvIIWA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">And also not using the Cook’s distance.</figcaption></figure><p id="5c85" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">尽管没有一个受试者跨过了库克距离的门槛，我们还是把最高的那个踢出去，看看会发生什么。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="90d7" class="kb kc hh jx b be kd ke l kf kg">fit2 &lt;- exclude.influence(fit, "Subject", "1022")<br/>sjPlot::plot_model(fit2, type="diag")</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ny"><img src="../Images/16bd69c7c0ab36d5a999e607b9b452c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WYm_g2GfxCXyKuCwHppNQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Not really an improvement.</figcaption></figure><p id="542f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">好了，游戏时间结束了。以前的模型未正确指定，因为位置应与主题嵌套。我要做的是运行几个从大到小的模型，然后基于方差分析和AIC拟合优度测试对它们进行比较。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="c634" class="kb kc hh jx b be kd ke l kf kg">fit3.1&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>                      (1 + splines::ns(Time,3)|Subject)+<br/>                      (1 + splines::ns(Time,3)|Subject:Location), <br/>                   data = df_all_diff)<br/>fit3.2&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>                     (1 + splines::ns(Time,5)|Subject)+<br/>                     (1 + splines::ns(Time,5)|Subject:Location), <br/>                   data = df_all_diff)<br/>fit3.3&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>                     (0 + splines::ns(Time,5)|Subject)+<br/>                     (1 + splines::ns(Time,5)|Subject:Location), <br/>                   data = df_all_diff)<br/>fit3.4&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>               (1 + splines::ns(Time,5)|Subject:Location), <br/>             data = df_all_diff)<br/>fit3.5&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>             (0 + splines::ns(Time,5)|Subject:Location), <br/>           data = df_all_diff)<br/>anova(fit3.1, fit3.2, fit3.3, fit3.4, fit3.5)<br/>refitting model(s) with ML (instead of REML)<br/>Data: df_all_diff<br/>Models:<br/>fit3.5: Value ~ splines::ns(Time, 5) * Treatm + (0 + splines::ns(Time, 5) | Subject:Location)<br/>fit3.1: Value ~ splines::ns(Time, 5) * Treatm + (1 + splines::ns(Time, 3) | Subject) + (1 + splines::ns(Time, 3) | Subject:Location)<br/>fit3.4: Value ~ splines::ns(Time, 5) * Treatm + (1 + splines::ns(Time, 5) | Subject:Location)<br/>fit3.3: Value ~ splines::ns(Time, 5) * Treatm + (0 + splines::ns(Time, 5) | Subject) + (1 + splines::ns(Time, 5) | Subject:Location)<br/>fit3.2: Value ~ splines::ns(Time, 5) * Treatm + (1 + splines::ns(Time, 5) | Subject) + (1 + splines::ns(Time, 5) | Subject:Location)<br/>       npar   AIC   BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    <br/>fit3.5   28 14000 14197 -6972.0    13944                         <br/>fit3.1   33 14923 15155 -7428.5    14857    0.0  5          1    <br/>fit3.4   34 13892 14132 -6912.0    13824 1032.9  1     &lt;2e-16 ***<br/>fit3.3   49 13922 14267 -6912.0    13824    0.0 15          1    <br/>fit3.2   55 13934 14321 -6912.0    13824    0.0  6          1    <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></pre><pre class="ng jw jx jy bn jz ka bi"><span id="9a16" class="kb kc hh jx b be kd ke l kf kg">fit3.6&lt;-lmer(Value ~ splines::ns(Time,5)+Treatm+<br/>               (0 + splines::ns(Time,5)|Subject:Location), <br/>             data = df_all_diff) <br/><br/>AIC(fit3.1, fit3.2, fit3.3, fit3.4, fit3.5, fit3.6)<br/>       df      AIC<br/>fit3.1 33 14969.25<br/>fit3.2 55 13976.64<br/>fit3.3 49 13964.64<br/>fit3.4 34 13934.64<br/>fit3.5 28 14043.17<br/>fit3.6 23 14022.14<br/><br/><br/>fit3.4&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>               (1 + splines::ns(Time,5)|Subject:Location), <br/>             data = df_all_diff)<br/>sjPlot::plot_model(fit3.4, type="diag")<br/>sjPlot::plot_model(fit3.4, type="pred")</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki nz kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/28afa33c82023019ea65d23b32f9dc36.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*lLM-d1gAIrIH_X049_ADnw.png"/></div></figure><figure class="kv ki oa kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/30c2930d5064a19cf52f0ea8c3bc71fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*Z-gFU4boDfTFoU0D1wsI4g.png"/></div></figure></div><div class="ab cb"><figure class="kv ki ob kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/e151d173f8e291d35cb812468c1d8426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*ATYVyb3uEQu80Zi_Ip9zMw.png"/></div></figure><figure class="kv ki oc kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/c1375237c7a2792787a13093154bb2e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*yWGnu_-pldLBS1hi8wTXjA.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx od di oe ld">This is looking MUCH MUCH better. I think I have nailed it, at least to the degree in which the residuals look comfortably close to the underlying assumptions of the mathematical model.</figcaption></figure></div><div class="ab cb"><figure class="kv ki of kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/79ee306524f21b151331fadcb5563071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*XEtx7lOJw-HVM-dX7AUEqw.png"/></div></figure><figure class="kv ki og kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/643fd6634688053d2886897e3e5fc531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*8BnNDSozGnDtyEfAT5ezPw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mr di ms ld">Does not make the treatment perform better, but that should not be the aim. The aim is to find the model that is best supported by the data and it seems I have found that model, for now.</figcaption></figure></div><p id="2a81" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们还可以通过观察预测图和观察图来进行评估。记得上次糟透了。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="769a" class="kb kc hh jx b be kd ke l kf kg">fit3.4&lt;-lmer(Value ~ splines::ns(Time,5)*Treatm+<br/>               (1 + splines::ns(Time,5)|Subject:Location), <br/>             data = df_all_diff)<br/>pred&lt;-broom.mixed::augment(fit3.4)<br/>ggplot(pred, <br/>       aes(x=Value, y=.fitted, col=Treatm))+<br/>  geom_point()+<br/>  facet_wrap(~Location, ncol=2)+<br/>  theme_bw()+<br/>  geom_abline(intercept=0, slope=1, col="black", lty=2)+<br/>  xlim(-2,2)+<br/>  ylim(-2,2)</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es oh"><img src="../Images/bf6821f78ead531b7f1fe333e3c9b1ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJA1e-2y07jRs8U5JXoJ0A.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">And this is looking much better. The ON_OFF group is easier to predict which should not surprise you — the OFF_ON has more volatility in its difference. That is something to keep in mind.</figcaption></figure><p id="4177" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从这里开始，贝叶斯分析的步骤非常简单。尤其是如果你不使用先验，因为贝叶斯分析没有定义信息先验，并没有真正不同于最大似然分析。我将使用与我使用的<em class="le"> lmer </em>相同的模型。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="b32c" class="kb kc hh jx b be kd ke l kf kg">bayes_spline1 &lt;- brm(Value ~ s(Time,k=5, by=interaction(Treatm)) + Treatm + <br/>                       (1 + splines::ns(Time,5)|Subject:Location), <br/>                     data = df_all_diff,<br/>                     family = gaussian(),<br/>                     sample_prior = TRUE,<br/>                     save_pars = save_pars(all = TRUE),<br/>                     chains=4, <br/>                     cores=6,<br/>                     iter = 4000,<br/>                     warmup = 1000)<br/>summary(bayes_spline1)<br/><br/><br/> Family: gaussian <br/>  Links: mu = identity; sigma = identity <br/>Formula: Value ~ s(Time, k = 5, by = interaction(Treatm)) + Treatm + (1 + splines::ns(Time, 5) | Subject:Location) <br/>   Data: df_all_diff (Number of observations: 8448) <br/>  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;<br/>         total post-warmup draws = 12000<br/><br/>Smooth Terms: <br/>                                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>sds(sTimeinteractionTreatmOFF_ON_1)     0.27      0.31     0.01     1.19 1.00     2189     1728<br/>sds(sTimeinteractionTreatmON_OFF_1)     0.27      0.33     0.01     1.27 1.00     1996     1623<br/><br/>Group-Level Effects: <br/>~Subject:Location (Number of levels: 192) <br/>                                         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>sd(Intercept)                                0.28      0.03     0.22     0.34 1.00     1627     4065<br/>sd(splines::nsTime51)                        0.77      0.05     0.68     0.88 1.00     3864     6274<br/>sd(splines::nsTime52)                        1.10      0.07     0.98     1.25 1.00     2213     3574<br/>sd(splines::nsTime53)                        1.02      0.06     0.91     1.15 1.00     3802     4554<br/>sd(splines::nsTime54)                        0.59      0.09     0.43     0.76 1.01      606     1429<br/>sd(splines::nsTime55)                        0.60      0.04     0.52     0.68 1.00     5622     7370<br/>cor(Intercept,splines::nsTime51)             0.22      0.11     0.00     0.45 1.00     1261     1670<br/>cor(Intercept,splines::nsTime52)            -0.02      0.12    -0.25     0.20 1.01      879     1481<br/>cor(splines::nsTime51,splines::nsTime52)    -0.59      0.06    -0.71    -0.45 1.00     1403     1350<br/>cor(Intercept,splines::nsTime53)             0.23      0.11     0.01     0.45 1.01      650     1253<br/>cor(splines::nsTime51,splines::nsTime53)     0.11      0.09    -0.06     0.27 1.00     2326     5123<br/>cor(splines::nsTime52,splines::nsTime53)    -0.23      0.08    -0.38    -0.07 1.00     2215     3958<br/>cor(Intercept,splines::nsTime54)            -0.63      0.10    -0.78    -0.41 1.00     1087     2985<br/>cor(splines::nsTime51,splines::nsTime54)    -0.48      0.13    -0.73    -0.23 1.00      750     1272<br/>cor(splines::nsTime52,splines::nsTime54)     0.14      0.13    -0.12     0.37 1.01     1277     2071<br/>cor(splines::nsTime53,splines::nsTime54)     0.20      0.12    -0.04     0.43 1.01     1271     2724<br/>cor(Intercept,splines::nsTime55)             0.56      0.10     0.36     0.74 1.00     1099     2019<br/>cor(splines::nsTime51,splines::nsTime55)     0.13      0.09    -0.04     0.31 1.00     3294     6559<br/>cor(splines::nsTime52,splines::nsTime55)    -0.14      0.09    -0.31     0.04 1.00     3734     7252<br/>cor(splines::nsTime53,splines::nsTime55)    -0.14      0.09    -0.30     0.03 1.00     5507     7442<br/>cor(splines::nsTime54,splines::nsTime55)    -0.05      0.13    -0.31     0.21 1.00     1970     3959<br/><br/>Population-Level Effects: <br/>                                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>Intercept                           0.01      0.03    -0.05     0.06 1.00     3809     1676<br/>TreatmON_OFF                       -0.00      0.04    -0.08     0.07 1.00     4260     4842<br/>sTime:interactionTreatmOFF_ON_1     0.02      0.28    -0.58     0.62 1.00     4522     1526<br/>sTime:interactionTreatmON_OFF_1     0.07      0.28    -0.49     0.73 1.00     3334     2189<br/><br/>Family Specific Parameters: <br/>      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>sigma     0.49      0.00     0.49     0.50 1.00     8657     7427<br/><br/>Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS<br/>and Tail_ESS are effective sample size measures, and Rhat is the potential<br/>scale reduction factor on split chains (at convergence, Rhat = 1).</span></pre><p id="0f22" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从rhat值中可以看出，该模型的性能已经足够好了，但是我们还是用图形来检查一下。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="23e2" class="kb kc hh jx b be kd ke l kf kg">pp_check(bayes_spline1, ndraws=100)<br/>pp_check(bayes_spline1, type = "ecdf_overlay",ndraws=100)<br/>csms &lt;- conditional_smooths(bayes_spline1)<br/>plot(csms)<br/>conditional_effects(bayes_spline1)</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki nj kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/a60e33e8bfe2209c4f9a77574ac5855e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*9RjE-fukLhN8h2O3pcYPDg.png"/></div></figure><figure class="kv ki nk kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/80a2dbff46f92c8be73ea090b7713e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*SNtIMRFW32OBIFPY5qBkxw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx lw di lx ld">Seems sufficient, although the high peak is difficult to mimic.</figcaption></figure></div><p id="630e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从那里我们可以更好地了解条件估计。</p><div class="js jt ju jv fd ab cb"><figure class="kv ki oi kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/c9a50a17b3ec394d430799a7e00cda76.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*8opOt80wiWTlv0CkSLXDEg.png"/></div></figure><figure class="kv ki oj kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/19331b32f23ccf4ead5cbecae4b75c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*MwmE2WMZQhCgbBcl9kcXxA.png"/></div></figure></div><div class="ab cb"><figure class="kv ki ok kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/ef787432ff5970213a8975fe3a630cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*rgDmvw8Ej5lOZ8A98554Rg.png"/></div></figure><figure class="kv ki ol kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/e227ce29dd238f8c224d197fd97b8585.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*RUPfqdE7AmxjM3Nwxhpb8Q.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx om di on ld">The conditional estimates do not hint at a difference between the treatments, but to get a really good idea I need to look closer per location. Already early on, from the plots, we could see that the location effect needs to be taken into account.</figcaption></figure></div><p id="01d7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了考虑位置因素，我将从模型中提取后验数据，然后将其与观测数据进行比较。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="1334" class="kb kc hh jx b be kd ke l kf kg">df_all_diff %&gt;%<br/>  add_epred_draws(bayes_spline1, <br/>                  ndraws=50) %&gt;%<br/>  ggplot(aes(x = Time, <br/>             y = Value, <br/>             color = as.factor(Treatm), <br/>             group=Subject)) +<br/>  geom_line(aes(y = .epred, group = paste(Subject, .draw)), alpha = 0.5) +<br/>  geom_point(data = df_all_diff, aes(color = as.factor(Treatm)), alpha=0.1)+<br/>  facet_wrap(~Location)+<br/>  labs(color="Treatment")+<br/>  theme_bw()<br/><br/>df_all_diff %&gt;%<br/>  add_epred_draws(bayes_spline1, <br/>                  ndraws=50) %&gt;%<br/>  ggplot(aes(x = Time, <br/>             y = Value, <br/>             color = as.factor(Treatm), <br/>             group=Subject)) +<br/>  geom_line(aes(y = .epred, group = paste(Subject, .draw)), alpha = 0.5) +<br/>  geom_point(data = df_all_diff, color = "black", alpha=0.2)+<br/>  facet_wrap(~Location)+<br/>  labs(color="Treatment")+<br/>  theme_bw()</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki oo kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/a7bdebcdab016c3bbd9e7f5a04437e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*7O9sWtx7o0bdYt0qFfcrow.png"/></div></figure><figure class="kv ki op kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/98d1b12d921e9b294ec33447096fb102.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*YExplhcByNf0zWVwH2mZtg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx oq di or ld">From the posterior draws it becomes very clear how volatile the data is. Nevertheless, the posterior draws do mimic the data will which gives me a stronger belief that this model is to quite some degree supported by the data.</figcaption></figure></div><p id="d890" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从上面我们可以向前看，并开始在预定义的时间点上比较治疗和每个位置。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="0a29" class="kb kc hh jx b be kd ke l kf kg">bayes_spline1 %&gt;%<br/>  recover_types(bayes_spline1) %&gt;%<br/>  emmeans::emmeans( ~ Treatm | Time, <br/>                    at = list(Time = c(260,280,300,320,340,360,380,400))) %&gt;%<br/>  emmeans::contrast(method = "pairwise") %&gt;%<br/>  gather_emmeans_draws() %&gt;%<br/>  ggplot(aes(x = .value, <br/>             y = contrast)) +<br/>  stat_halfeye(alpha=0.5)+<br/>  geom_vline(xintercept = 0, lty=2, col="red")+<br/>  facet_wrap(~Time, scales="free")+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es os"><img src="../Images/0c845788db891e59e91d75a85a43ca0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeoaG4ofrKNnHA_EJkHnkA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">As you can see, there is little evidence to support a difference between treatments, per time-point, overall.</figcaption></figure><p id="7b52" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们再次添加位置参数。我将首先使用后面的绘图来绘制它。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="d981" class="kb kc hh jx b be kd ke l kf kg">df_all_diff %&gt;%<br/>  add_epred_draws(bayes_spline1, <br/>                  ndraws=50) %&gt;%<br/>  group_by(Subject, Location, Treatm) %&gt;%<br/>  summarize(ValueObs = mean(Value), <br/>            ValueEpred = mean (.epred))%&gt;%<br/>  ggplot(.)+<br/>  geom_point(aes(x=as.factor(Treatm), <br/>                 y=ValueObs), <br/>             alpha=0.2)+<br/>  geom_boxplot(aes(x=as.factor(Treatm),<br/>                   y = ValueEpred), <br/>               alpha = 0.5) +<br/>  facet_wrap(~Location)+<br/>  theme_bw()<br/><br/>grid = df_all_diff %&gt;%data_grid(Treatm, Time, Subject, Location)<br/>means = grid %&gt;%add_epred_draws(bayes_spline1)<br/>preds = grid %&gt;%add_predicted_draws(bayes_spline1)<br/>df_all_diff %&gt;%<br/>  filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  ggplot(aes(x = Value, y = Treatm)) +<br/>  stat_halfeye(aes(x = .epred), scale = 0.6, <br/>               position = position_nudge(y = 0.175), data = means) +<br/>  stat_interval(aes(x = .prediction), data = preds) +<br/>  geom_point(data = df_all_diff) +<br/>  scale_color_brewer()+theme_bw()+<br/>  facet_wrap(~Location, scales="free")+<br/>  labs(x="Difference score",<br/>       y="Session")</span></pre><div class="js jt ju jv fd ab cb"><figure class="kv ki ot kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/fb47376a781cca411e38105013d9449d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*Ep1sa4HiEAf_z3DRrxi6MQ.png"/></div></figure><figure class="kv ki ou kx ky kz la paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><img src="../Images/aaa94f380645d9926b14d198f52b1dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*KluQOh3eQjYCHeYD1kyUjg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx mi di mj ld">From the posterior draws the volatility difference becomes clear, once again, but the overall volatility (or variation) is so big that there is probably no difference to be detected. However, as you could see from the graphics in the beginning, the central location does shift between treatments.</figcaption></figure></div><p id="ec79" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们再深入一点。每次治疗、每个时间点和每个位置，我想将后验图与观察值进行比较。</p><pre class="js jt ju jv fd jw jx jy bn jz ka bi"><span id="40b4" class="kb kc hh jx b be kd ke l kf kg">df_all_diff %&gt;%<br/>  add_epred_draws(bayes_spline1, <br/>                  ndraws=200) %&gt;%<br/>  filter(Time&gt;=250 &amp; Time &lt;=400)%&gt;%<br/>  group_by(Subject, Time, Location, Treatm) %&gt;%<br/>  summarize(ValueObs = mean(Value), <br/>            ValueEpred = mean (.epred))%&gt;%<br/>  ggplot(.)+<br/>  geom_point(aes(x=as.factor(Time), <br/>                 y=ValueObs,<br/>                 group=as.factor(Treatm),<br/>                 col=as.factor(Treatm)), <br/>             alpha=0.2)+<br/>  geom_boxplot(aes(x=as.factor(Time),<br/>                   y = ValueEpred,<br/>                   col=as.factor(Treatm)), <br/>               alpha = 0.5) +<br/>  facet_wrap(~Location)+<br/>  theme_bw()</span></pre><figure class="js jt ju jv fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ov"><img src="../Images/ae92717d5e55f5e51323055391988d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSET_H1qgGNvXd4vxXr4dg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The boxplots seem to hint at linear lines for each location and each treatment. It shows how volatile the data is. However, once again, the central location does hint at a persistent difference, as does the occipital region.</figcaption></figure><p id="15cd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我就讲到这里。当然，还有很多要补充的。例如，这个分析不是一个完整的贝叶斯分析，因为我们没有指定先验，我想添加每个时间点和大脑位置的治疗之间的后验绘制比较。所有这些都将被添加到最终的出版分析中，到时候，我会在这里添加链接。</p><p id="1a8c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你有任何问题，或者有什么不对或不对的地方，请让我知道！</p><div class="ow ox ez fb oy oz"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="pa ab dw"><div class="pb ab pc cl cj pd"><h2 class="bd hi fi z dy pe ea eb pf ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="pg l"><h3 class="bd b fi z dy pe ea eb pf ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ph l"><p class="bd b fp z dy pe ea eb pf ed ef dx translated">medium.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn kn oz"/></div></div></a></div></div></div>    
</body>
</html>