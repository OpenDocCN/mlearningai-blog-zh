<html>
<head>
<title>Building Movie Recommendation System with Surprise and python.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Surprise和python构建电影推荐系统。</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-movie-recommendation-system-with-surprise-and-python-e905de755c61?source=collection_archive---------1-----------------------#2021-03-04">https://medium.com/mlearning-ai/building-movie-recommendation-system-with-surprise-and-python-e905de755c61?source=collection_archive---------1-----------------------#2021-03-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b720" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">完成人:<a class="jc jd ge" href="https://medium.com/u/cac8f1becf29?source=post_page-----e905de755c61--------------------------------" rel="noopener" target="_blank">莫尼拉</a>、<a class="jc jd ge" href="https://medium.com/u/20e1553c7e2c?source=post_page-----e905de755c61--------------------------------" rel="noopener" target="_blank">艾莎·Y·哈卡米</a>、<a class="jc jd ge" href="https://medium.com/u/87f03ec137ee?source=post_page-----e905de755c61--------------------------------" rel="noopener" target="_blank">拉马哈尔比</a>和<a class="jc jd ge" href="https://medium.com/u/c026f26badf6?source=post_page-----e905de755c61--------------------------------" rel="noopener" target="_blank">默罕默德·阿拉里</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/67f74715d46ab50ea700859b90eca6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*P5LT-1q7A44eoJTV"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">source: shorturl.at/fltG7</figcaption></figure><h1 id="3cb5" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">问题标识</h1><p id="9b62" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在STC提供的Jawwy服务中开发IPTV推荐系统。Python和JupyterLab是使用Sklearn库实现推荐系统的工具。其目的是为当地公司创造商业价值，以改善他们的服务，STC被选中与他们的服务Jawwy一起参与该项目，因为他们在开放数据计划中共享其数据。</p><h2 id="85be" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">在这篇博客中，我们将使用惊奇方法建立一个推荐模型</h2><p id="d11a" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi"> Surprise </strong>是一个Python scikit，用于构建和分析处理显式评级数据的推荐系统。</p><h2 id="ca9a" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">惊喜的设计考虑了以下目的:</h2><ul class=""><li id="3fda" class="lh li hh ig b ih ko il kp ip lj it lk ix ll jb lm ln lo lp bi translated">让用户完全控制他们的实验</li><li id="5003" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">提供各种现成的预测算法，如基线算法、邻域法</li><li id="5896" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">使新算法思想的实现变得容易。</li><li id="4787" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">提供评估、分析和比较算法性能的工具。使用强大的CV迭代器可以非常容易地运行交叉验证过程(受sci-kit-learn优秀工具的启发)。</li></ul><p id="e782" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将使用<a class="ae lv" href="http://www2.informatik.uni-freiburg.de/~cziegler/BX/" rel="noopener ugc nofollow" target="_blank"> j </a> awwy IPTV数据集开发推荐系统算法，使用<a class="ae lv" href="http://surpriselib.com/" rel="noopener ugc nofollow" target="_blank">惊奇库</a>，它是由<a class="ae lv" href="http://nicolas-hug.com/" rel="noopener ugc nofollow" target="_blank"> Nicolas Hug </a>构建的。让我们开始吧！</p><h1 id="4e7c" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">资料组</h1><p id="47c4" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">沙特运营商STC为其DSL客户推出了一项名为InVision的交互式IPTV服务，以配合斋月的开始。这项服务最初在三个主要城市利雅得、吉达和达曼提供，整个斋月期间免费。InVision提供免费电视频道和付费电视套餐、节目时移、节目录制、宗教和纪录片节目的视频点播库，以及观看过去七天播出的节目的电视追播服务。此外，用户可以通过控制面板选择节目和电影。</p><p id="8337" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们赞赏STC在支持数据社区方面发挥的作用，当时STC启动了开放数据计划，通过支持对数据科学感兴趣的研究人员，使他们能够通过应用和实践探索和处理数据，帮助培养符合2030愿景的懂技术的沙特一代。</p><p id="9d01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由8k内29，487个用户行为组成的数据全部显示在3m行中。我们不仅从用户的所有行为模式中提取汁液，也从电影本身中提取汁液。</p><h1 id="84d4" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">建模</h1><p id="2195" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在之前的帖子中，我们讨论了推荐系统的两种最流行的方法是<a class="ae lv" href="https://en.wikipedia.org/wiki/Collaborative_filtering" rel="noopener ugc nofollow" target="_blank">协同过滤</a>和<a class="ae lv" href="https://www.analyticsvidhya.com/blog/2015/08/beginners-guide-learn-content-based-recommender-systems/" rel="noopener ugc nofollow" target="_blank">基于内容的推荐</a>。在这篇博客中，我们将重点讨论协同过滤方法，即:向用户推荐过去有相似品味和偏好的人喜欢的项目。换句话说，这种方法通过使用用户之间的相似性来预测未知的评级。</p><h2 id="ca9d" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">惊喜模型</h2><p id="35d8" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><em class="lw">惊喜</em>提供了一个评分预测的估计器集合，实现了经典算法，如主要的基于相似性的算法，以及基于矩阵分解的算法，如奇异值分解或NMF。它还支持模型评估工具，如交叉验证迭代器和内置度量。</p><p id="03dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于<strong class="ig hi">惊喜</strong>不支持隐式<strong class="ig hi">评分</strong>，我们的数据集没有如下所示的重要数据:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/72dd604245e91c527d9c591528149eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03qdj72KtpOLoLBUXU3J8g.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">The head of the dataframe.</figcaption></figure><p id="d884" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们做了一些特征工程来获得每个用户/电影的观看评级，其想法是将观看比率视为一个评级。</p><p id="9700" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">问题在于该数据集中电影和系列之间的差异，电影的总时长如下:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mc"><img src="../Images/f0b61e41d5ae4facdbbc56f9f5d1ebcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwKjvefL4T1W-DKaRus3Sg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">sample of movie</figcaption></figure><p id="ba40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">而系列是这样的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es md"><img src="../Images/20b26b384aa4c54880ead2f1c257d2a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6k76D3Vx-4E0WtgVVCI2ug.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">sample of series</figcaption></figure><p id="e282" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于电影节目，很容易获得观看比率，并将其作为用户评级处理，方法是使用regex remove (min)单词，该单词以持续时间中的分钟数为后缀，这是IMDB中每部电影的总持续时间，然后将时间从分钟转换为秒，之后将持续时间除以duration_second，这是用户观看这部特定电影的持续时间。</p><p id="aca1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不幸的是，我们不能对连续剧/电视节目应用这些步骤，因为持续时间是针对该季的，而不是该连续剧一集的总持续时间，当我们试图从外部数据集获得这些数据时，我们面临其他问题，即一些连续剧/电视节目将会丢失，还有许多不同的电影具有相同的名称，如<a class="ae lv" href="https://www.imdb.com/title/tt3281548/" rel="noopener ugc nofollow" target="_blank">小妇人</a>和<a class="ae lv" href="https://www.imdb.com/title/tt0110367/" rel="noopener ugc nofollow" target="_blank">小妇人</a>。</p><p id="9480" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们将数据集分成2个数据帧，第一个数据帧用于<code class="du me mf mg mh b">TV Show</code>的<em class="lw"> merged_df_series </em>，第二个数据帧用于<code class="du me mf mg mh b">Movie</code>节目的<em class="lw"> merged_df_movie </em></p><p id="12fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于分配总时长的<code class="du me mf mg mh b">TV Show</code>节目，我们使用<code class="du me mf mg mh b">.max()</code>返回每个节目/电视节目的用户在duration_seconds内的最大值作为总时长，因为我们没有数据集的总时长</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="c05a" class="kt jr hh mh b fi mm mn l mo mp">df_series_duration=merged_df_series.groupby(‘program_name’)[[‘duration_seconds’]].max()</span></pre><p id="3d3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加上average_watching和total_duration，我们会把它作为惊喜模型的目标。</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="7433" class="kt jr hh mh b fi mm mn l mo mp">#average_watching<br/>merged_df_series[“average_watching”] = merged_df_series.apply(lambda x: 1 if x[‘duration_seconds’] &gt; df_series_duration.loc[x.program_name,’duration_seconds’] else x[‘duration_seconds’]/df_series_duration.loc[x.program_name,’duration_seconds’], axis=1)</span><span id="4ac9" class="kt jr hh mh b fi mq mn l mo mp"># total_duration <br/>merged_df_series[“total_duration”]= merged_df_series.apply(lambda x: df_series_duration.loc[x.program_name,’duration_seconds’],axis=1)</span></pre><h2 id="dbf6" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">系列数据集的头部:</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mr"><img src="../Images/20895557f4fe505a7072921030337411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GKbBEdq9YsUwNztIbxIOVw.png"/></div></div></figure><p id="e484" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请记住，平均收视率代表每个用户观看特定节目的比率。</p><p id="41f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于<code class="du me mf mg mh b">Movie</code>计划:</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="085b" class="kt jr hh mh b fi mm mn l mo mp"># Extract minute by using (regex) and convert to appropriate type <br/>merged_df_movie[‘total_duration’] = merged_df_movie[‘duration’].str.replace(r’min’, ‘’)<br/>merged_df_movie[‘duration_seconds’] = pd.to_numeric((merged_df_movie[‘duration_seconds’]) , errors=’coerce’).astype(‘Int64’)<br/>merged_df_movie[‘total_duration’] = pd.to_numeric((merged_df_movie[‘total_duration’]) , errors=’coerce’).astype(‘Int64’)</span><span id="9087" class="kt jr hh mh b fi mq mn l mo mp"># convert from min to sec<br/>merged_df_movie[‘total_duration’]=(merged_df_movie[‘total_duration’]*60)</span></pre><p id="736d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果持续时间秒的值&gt;总持续时间，则将总持续时间的值分配给持续时间秒:</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="30f2" class="kt jr hh mh b fi mm mn l mo mp">merged_df_movie[“duration_seconds”] = merged_df_movie.apply(lambda x: x[‘total_duration’] if x[‘duration_seconds’] &gt; x[‘total_duration’] else x[‘duration_seconds’], axis=1)</span></pre><p id="ee1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">添加average_watching特性，我们会将其作为惊喜模型的目标。</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="e5a6" class="kt jr hh mh b fi mm mn l mo mp">merged_df_movie[‘average_watching’]=merged_df_movie[‘duration_seconds’]/merged_df_movie[‘total_duration’]</span></pre><h2 id="8038" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">电影数据集的头:</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ms"><img src="../Images/de8a30f47de15e21406dda6b1657b00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seOGJe8H0UvnqPJfa45zYg.png"/></div></div></figure><h1 id="5ddb" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">连接数据帧</h1><ul class=""><li id="19af" class="lh li hh ig b ih ko il kp ip lj it lk ix ll jb lm ln lo lp bi translated">连接merged_df_movie和merged_df_series并检查异常值。</li></ul><p id="d4df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据集如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mt"><img src="../Images/a8fe7f05e4dbaaf8dd93d4d0bf2a4687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EceQaxlUb2jfERj4MxVeLA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">Sample of the merged dataset</figcaption></figure><p id="50cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些EDA:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mu"><img src="../Images/a83a1ecd1cf7390cc07e646313c1de9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLcTRyHG1xSQu1iPvFiq5w.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mv"><img src="../Images/49a416187202045f50927e0ba91f6d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*HJjA7-jhH0uOQ9PVz_rjKg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">most-watched program</figcaption></figure><p id="6dd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据中的大部分节目观看次数少于3次，极少数节目观看次数多，尽管观看次数最多的节目已经被观看了2312次</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mw"><img src="../Images/94fddbb852fd737c7b2a64f06152990b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2XxUUrwgUO73t6hxdsVkSQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">Distribution Of Number of Watching Per User</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mx"><img src="../Images/d7eb33b000e08975d8390138f3a78495.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*4jaMNwWfqJmV0svxjtPYhw.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">most-active users</figcaption></figure><p id="558b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据中的大多数用户观看的节目少于10个，观看次数不多的用户不多，尽管最活跃的用户观看了136个节目。</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="f682" class="kt jr hh mh b fi mm mn l mo mp">reader = Reader(rating_scale=(0.03, 1.0))<br/>data = Dataset.load_from_df(df_data[[‘user_id’, ‘show_id’, ‘average_watching’]], reader)</span><span id="7e30" class="kt jr hh mh b fi mq mn l mo mp">benchmark = []<br/># Iterate over all algorithms<br/>for algorithm in [SVD(), SVDpp(), SlopeOne(), NMF(), NormalPredictor(), KNNBaseline(), KNNBasic(),<br/> KNNWithMeans(), KNNWithZScore(), BaselineOnly()]:<br/> # Perform cross validation<br/> results = cross_validate(algorithm, data, measures=[‘RMSE’], cv=3, verbose=False)<br/> <br/> # Get results &amp; append algorithm name<br/> tmp = pd.DataFrame.from_dict(results).mean(axis=0)<br/> tmp = tmp.append(pd.Series([str(algorithm).split(‘ ‘)[0].split(‘.’)[-1]], index=[‘Algorithm’]))<br/> benchmark.append(tmp)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es my"><img src="../Images/a44c2fa7978c9d34195f5a73cf46ae00.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*RuS6B1umdwO2GTO42baAmw.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">various algorithms and their scores</figcaption></figure><h1 id="4801" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">训练和预测</h1><p id="5a85" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><code class="du me mf mg mh b">BaselineOnly</code>算法给出了最佳rmse，因此，我们将使用<code class="du me mf mg mh b">BaselineOnly</code>进行训练和预测，并使用交替最小二乘法(ALS)。</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="13a1" class="kt jr hh mh b fi mm mn l mo mp"><br/>print(‘Using ALS’)<br/>bsl_options = {‘method’: ‘als’,<br/> “random_state”:250,<br/> ‘n_epochs’: 5,<br/> ‘reg_u’: 12,<br/> ‘reg_i’: 5<br/> }<br/>algo = BaselineOnly(bsl_options)<br/>cross_validate(algo, data, measures=[‘RMSE’], cv=3, verbose=False)</span><span id="4d9d" class="kt jr hh mh b fi mq mn l mo mp">Using ALS<br/>Estimating biases using als...<br/>Estimating biases using als...<br/>Estimating biases using als...</span></pre><p id="b651" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出局:</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="9d9a" class="kt jr hh mh b fi mm mn l mo mp">{'test_rmse': array([0.32846883, 0.32829109, 0.32849049]),<br/> 'fit_time': (0.05880260467529297, 0.04584360122680664, 0.06278657913208008),<br/> 'test_time': (0.1285717487335205, 0.14949917793273926, 0.12757420539855957)}</span></pre><p id="5bff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用<code class="du me mf mg mh b">train_test_split()</code>对给定大小的训练集和测试集进行采样，并使用rmse的精度度量。然后，我们将使用<code class="du me mf mg mh b">fit()</code>方法在训练集上训练算法，使用<code class="du me mf mg mh b">test()</code>方法从测试集返回预测。</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="1331" class="kt jr hh mh b fi mm mn l mo mp">trainset, testset = train_test_split(data, test_size=0.25)<br/>algo = BaselineOnly(bsl_options)<br/>predictions = algo.fit(trainset).test(testset)<br/>accuracy.rmse(predictions)</span></pre><p id="c2dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出局:</p><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="ea26" class="kt jr hh mh b fi mm mn l mo mp">Estimating biases using als...<br/>RMSE: 0.3295</span></pre><p id="dd10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了详细检查我们的预测，我们将建立一个包含所有预测的熊猫数据框。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mz"><img src="../Images/4a996fe405e4342e34d3fd4c58844b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ve6Kqp5d1Zt9JdP0I0AAfw.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">The predictions in detail</figcaption></figure><h2 id="58d1" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">用户的13618行为</h2><ul class=""><li id="d14f" class="lh li hh ig b ih ko il kp ip lj it lk ix ll jb lm ln lo lp bi translated">这里我们将研究一个特定用户的观看行为，他的ID是(13618)</li></ul><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="ba6a" class="kt jr hh mh b fi mm mn l mo mp"># user_id is the 13618<br/>ratings = newdf.loc[newdf[‘user_id’] == 13618]<br/># obtain the required data of this user<br/>ratings=ratings[[‘user_id’, ‘show_id’, ‘average_watching’]]<br/>ratings</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es na"><img src="../Images/26744b2068d4160e4aa5f6a71b6bb783.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*Sihu_0d8F4UkPfLJXILGew.png"/></div></figure><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="86cf" class="kt jr hh mh b fi mm mn l mo mp"># get the list of the movie ids<br/>unique_ids = newdf[‘show_id’].unique()</span><span id="5214" class="kt jr hh mh b fi mq mn l mo mp"># get the list of the ids that the userid 13618 has watched<br/>iids1001 = newdf.loc[newdf[‘user_id’]==13618, ‘show_id’]</span><span id="e287" class="kt jr hh mh b fi mq mn l mo mp"># remove the rated movies for the recommendations<br/>movies_to_predict = np.setdiff1d(unique_ids,iids1001)</span></pre><h2 id="9aa3" class="kt jr hh bd js ku kv kw jw kx ky kz ka ip la lb ke it lc ld ki ix le lf km lg bi translated">用户13618的推荐方案</h2><pre class="jf jg jh ji fd mi mh mj mk aw ml bi"><span id="d419" class="kt jr hh mh b fi mm mn l mo mp">algo = BaselineOnly(bsl_options)<br/>algo.fit(data.build_full_trainset())</span><span id="cd8a" class="kt jr hh mh b fi mq mn l mo mp">my_recs = []<br/>for iid in movies_to_predict:<br/> my_recs.append((iid, algo.predict(uid=’13618',iid=iid).est))<br/>pd.DataFrame(my_recs, columns=[‘iid’, ‘predictions’]).sort_values(‘predictions’, ascending=False).head(10)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nb"><img src="../Images/ca324040a65a53d693f48be3834bda9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*y6y6KbSzBLP0HAG4PJwTkg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Prediction estimators</figcaption></figure><p id="6892" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就是这样！我希望你喜欢带着<a class="ae lv" href="https://surprise.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">惊喜</a>的推荐(或者说，评级预测)之旅。</p><p id="8aa1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">参考:</p><ul class=""><li id="e243" class="lh li hh ig b ih ii il im ip nc it nd ix ne jb lm ln lo lp bi translated"><a class="ae lv" href="https://surprise.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">惊喜’文档</a></li><li id="0de3" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">【https://actsusanli.medium.com/ T4】</li><li id="d7bf" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><a class="ae lv" href="https://predictivehacks.com/how-to-run-recommender-systems-in-python/" rel="noopener ugc nofollow" target="_blank">https://predictive hacks . com/how-to-run-recommender-systems-in-python/</a></li></ul></div></div>    
</body>
</html>