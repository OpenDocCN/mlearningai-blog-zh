<html>
<head>
<title>Object detection with Angular, Firebase and Google Cloud Vision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular、Firebase和谷歌云视觉进行物体检测</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/object-detection-with-angular-firebase-and-google-cloud-vision-acb69bc5f07?source=collection_archive---------4-----------------------#2022-11-23">https://medium.com/mlearning-ai/object-detection-with-angular-firebase-and-google-cloud-vision-acb69bc5f07?source=collection_archive---------4-----------------------#2022-11-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="8ba4" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Angular、Firebase和Google Cloud Vision创建一个无缝的对象检测应用程序。没有痛苦，只有收获。</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es iw"><img src="../Images/155b5ab071a38907f062641053bb42cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*Ns72fEbYO5-73Nz9fAaa5g.png"/></div></figure><p id="a1cb" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">今天机器视觉真的很强大，它的趋势很高。但并不是所有的IT公司都雇佣数据科学家，或者能够持续努力从零开始创建机器学习应用程序，因此创建执行对象检测的应用程序和软件可能非常困难。</p><p id="93ab" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我想向大家展示一个简单易用的应用程序，它是作为2022年11月<a class="ae ka" href="https://gdg.community.dev/events/details/google-gdg-palermo-presents-community-showcase-november-2022-part-2/" rel="noopener ugc nofollow" target="_blank"> GDG帕勒莫社区展第二部分</a>的用例创建的，它使用以下工具执行对象检测:</p><ul class=""><li id="0419" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated"><strong class="jg hi">棱角分明；</strong></li><li id="7513" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><strong class="jg hi">火基功能；</strong></li><li id="dfca" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><strong class="jg hi">谷歌云视界</strong>(GCP)；</li></ul><p id="8ca3" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Google Cloud Vision是一个非常强大的工具，它能做的事情之多令人印象深刻。例如，您可以执行对象检测(以及我们稍后将看到的)，或者OCR，甚至人脸识别。它有很多功能，每个功能都有自己的定价，令人惊讶的是:它非常便宜。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/edfe5f9ab3c9e7c784d8a85b5d6ce194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TK1TfWRQ3s3o7lTb-ZmVNA.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Google Cloud Vision pricing table</figcaption></figure><p id="78f8" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">通常我们认为云是一个昂贵的解决方案，事实并非如此(见<a class="ae ka" href="https://cloud.google.com/vision/pricing" rel="noopener ugc nofollow" target="_blank">谷歌云视觉定价</a>)。正如你所看到的，你每月只需为5k的请求支付约1.5美元(外加1000个免费请求)，想象一下，你想从零开始自己实现这个特性，成本要大得多。</p><p id="25c6" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">云视觉中的对象检测有几个特征。当您对图像执行预测时，此工具会响应以下信息:</p><ul class=""><li id="b9e1" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated"><em class="ky">对象描述</em>；</li><li id="407e" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><em class="ky">置信度得分</em>；</li><li id="1ea7" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><em class="ky"> …其他信息</em>；</li></ul></div><div class="ab cl kz la go lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ha hb hc hd he"><p id="83cc" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">对于这个应用程序，我们将使用Firebase函数作为堡垒，以保持对请求的控制。通过这种方式，我们可以检查<strong class="jg hi">用户是否通过了认证</strong>(例如:Firebase功能支持Firebase认证)<strong class="jg hi"> </strong>或者他的每月请求配额是否已用尽，此外，Cloud Vision将保持私有，只有Firebase功能可以使用服务帐户访问它。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lg"><img src="../Images/d754280301a85c151d847a01bcec41e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulmcXJY-firit3TZI_trgg.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Architectural Schema</figcaption></figure><p id="805f" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">为了实现这个应用程序，我们将使用:</p><ul class=""><li id="5a82" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated">Firebase CLI；</li><li id="e25f" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://www.npmjs.com/package/firebase" rel="noopener ugc nofollow" target="_blank"> Firebase函数SDK</a>；</li><li id="d205" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://github.com/angular/angularfire" rel="noopener ugc nofollow" target="_blank">角火</a>；</li><li id="f7cf" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://github.com/googleapis/nodejs-vision#readme" rel="noopener ugc nofollow" target="_blank">云视界for NodeJS</a>；</li></ul><h1 id="2e01" class="lh li hh bd lj lk ll lm ln lo lp lq lr in ls io lt iq lu ir lv it lw iu lx ly bi translated">我们来编码吧！</h1><h2 id="3a62" class="lz li hh bd lj ma mb mc ln md me mf lr jn mg mh lt jr mi mj lv jv mk ml lx mm bi translated">云</h2><p id="c08e" class="pw-post-body-paragraph je jf hh jg b jh mn ii jj jk mo il jm jn mp jp jq jr mq jt ju jv mr jx jy jz ha bi translated">对于云，我们必须:</p><ul class=""><li id="6011" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated"><strong class="jg hi">通过<a class="ae ka" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">控制台</a>创建</strong>一个firebase <strong class="jg hi">项目</strong>并且<strong class="jg hi">升级到火焰平原</strong>，这样它也会创建GCP项目并且让我们可以访问ML工具。</li><li id="a98e" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated">进入GCP <a class="ae ka" href="https://console.cloud.google.com/welcome" rel="noopener ugc nofollow" target="_blank">控制台</a>并选择创建的项目。</li><li id="8e8a" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated">搜索产品<strong class="jg hi">云视觉</strong>和<strong class="jg hi">启用API</strong></li><li id="6533" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated">转到IAM &gt; Service Account，为用户firebase-adminsdk创建一个json密钥并下载它。</li></ul><p id="2561" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">完成了:<strong class="jg hi">我们的云已经准备好了</strong>。现在转到代码。</p><h2 id="4bb9" class="lz li hh bd lj ma mb mc ln md me mf lr jn mg mh lt jr mi mj lv jv mk ml lx mm bi translated">燃烧基函数</h2><p id="3e8d" class="pw-post-body-paragraph je jf hh jg b jh mn ii jj jk mo il jm jn mp jp jq jr mq jt ju jv mr jx jy jz ha bi translated">现在我们要创建我们的Firebase函数。首先，我们需要Firebase CLI ( <a class="ae ka" href="https://firebase.google.com/docs/cli" rel="noopener ugc nofollow" target="_blank">官方文档</a>)，所以我们可以使用Firebase模拟器并使用CLI创建代码库。</p><pre class="ix iy iz ja fd ms mt mu bn mv mw bi"><span id="b1c5" class="mx li hh mt b be my mz l na nb">firebase init</span></pre><p id="811b" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">然后让cli指导我们准备代码，安装云函数和仿真器；然后将“service-account.json”放入<code class="du nc nd ne mt b">functions</code>文件夹并进行认证:</p><pre class="ix iy iz ja fd ms mt mu bn mv mw bi"><span id="834d" class="mx li hh mt b be my mz l na nb">export GOOGLE_APPLICATION_CREDENTIALS="service-account.json"</span></pre><p id="bffd" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">然后打开文件<code class="du nc nd ne mt b">functions/src/index.ts</code>并创建应用程序:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ku kv et er es kw kx bd b be z dx">Firebase Functions</figcaption></figure><p id="8809" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">并且功能完成。这里不需要更多的代码，所以我们可以使用仿真器开始我们的功能:</p><pre class="ix iy iz ja fd ms mt mu bn mv mw bi"><span id="13df" class="mx li hh mt b be my mz l na nb">npm --prefix "functions" run serve</span></pre><p id="ead4" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">通过这种方式，函数将在localhost:5001(或者您为模拟器选择的任何端口)上可达，函数的名称是<code class="du nc nd ne mt b">annotateImage</code>。</p><h2 id="507f" class="lz li hh bd lj ma mb mc ln md me mf lr jn mg mh lt jr mi mj lv jv mk ml lx mm bi translated">Angular应用</h2><p id="5661" class="pw-post-body-paragraph je jf hh jg b jh mn ii jj jk mo il jm jn mp jp jq jr mq jt ju jv mr jx jy jz ha bi translated">让我们看看最后一步:棱角分明。为了帮助我们，我们将使用<code class="du nc nd ne mt b">@angular/fire</code>，所以我们需要将其添加到angular项目中，并让原理图指导我们配置云功能(可调用)，此外，cli将为我们创建一个新的应用程序到firebase项目中(我们也可以使用现有的一个)。</p><pre class="ix iy iz ja fd ms mt mu bn mv mw bi"><span id="b70b" class="mx li hh mt b be my mz l na nb">✔ Packages installed successfully.<br/>? What features would you like to setup? Cloud Functions (callable)<br/>Using firebase-tools version 11.16.0<br/>? Which Firebase account would you like to use? myemailtoaccess@email.com<br/>✔ Preparing the list of your Firebase projects<br/>? Please select a project: GDG-Object-Detection<br/>✔ Preparing the list of your Firebase WEB apps<br/>? Please select an app: object-detection<br/>✔ Downloading configuration data of your Firebase WEB app<br/>UPDATE src/app/app.module.ts (1715 bytes)<br/>UPDATE src/environments/environment.ts (977 bytes)<br/>UPDATE src/environments/environment.prod.ts (370 bytes)</span></pre><p id="e9bb" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">原理图默认配置<code class="du nc nd ne mt b">environment.ts</code>和<code class="du nc nd ne mt b">app.module.ts</code>。我遇到了Angular 15的一个问题，所以要修复它，导入模块，而不是使用工厂并添加<code class="du nc nd ne mt b">USE_EMULATOR</code>提供者:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="3734" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">然后创建一个服务来与Firebase函数通信:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="ef5e" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">然后将服务与组件连接起来:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="e927" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">创建一个转换管道，按分数对结果进行排序:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="8c8d" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">最后将结果打印成html:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="e28d" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">仅此而已！现在我们可以运行我们的应用程序了:</p><pre class="ix iy iz ja fd ms mt mu bn mv mw bi"><span id="646b" class="mx li hh mt b be my mz l na nb">ng serve</span></pre><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es nh"><img src="../Images/7ee297d669c9f968c266978c5691521a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vBGjC6GxOR7y2o1fOZ1Ojw.gif"/></div></div></figure><h1 id="1906" class="lh li hh bd lj lk ll lm ln lo lp lq lr in ls io lt iq lu ir lv it lw iu lx ly bi translated">结论</h1><p id="6681" class="pw-post-body-paragraph je jf hh jg b jh mn ii jj jk mo il jm jn mp jp jq jr mq jt ju jv mr jx jy jz ha bi translated">在几行代码中，我们创建了一个简单的应用程序，它使用一些强大的工具识别用户提供的图像中的对象。</p><p id="e614" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">您可以在以下存储库中找到代码的完整版本:</p><ul class=""><li id="56a5" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated"><a class="ae ka" href="https://github.com/mts88/object-recognition-angular-gcp-function/tree/object-detection" rel="noopener ugc nofollow" target="_blank">https://github . com/MTS 88/object-recognition-angular-GCP-Function/tree/object-detection</a>(Firebase函数)</li><li id="5663" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://github.com/mts88/object-recognition-angular-gcp/tree/object-detection" rel="noopener ugc nofollow" target="_blank">https://github . com/MTS 88/object-recognition-Angular-GCP/tree/object-detection</a>(Angular App)</li></ul></div><div class="ab cl kz la go lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ha hb hc hd he"><p id="e58f" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><em class="ky">那都是乡亲们！</em></p><div class="ni nj ez fb nk nl"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nm ab dw"><div class="nn ab no cl cj np"><h2 class="bd hi fi z dy nq ea eb nr ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ns l"><h3 class="bd b fi z dy nq ea eb nr ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nt l"><p class="bd b fp z dy nq ea eb nr ed ef dx translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jc nl"/></div></div></a></div></div></div>    
</body>
</html>