<html>
<head>
<title>Bayesian Optimization of a Laser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">激光器的贝叶斯优化</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/bayesian-optimization-of-a-laser-b5af3d553ad5?source=collection_archive---------4-----------------------#2022-03-18">https://medium.com/mlearning-ai/bayesian-optimization-of-a-laser-b5af3d553ad5?source=collection_archive---------4-----------------------#2022-03-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="998c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我以前的帖子中，我探索了如何实现<a class="ae jc" rel="noopener" href="/@natsunoyuki/gaussian-process-models-7ebce1feb83d">高斯过程回归模型</a>、<a class="ae jc" rel="noopener" href="/@natsunoyuki/simulating-lasers-with-python-1e00cf0dd5d9">模拟激光</a>，以及使用Python 执行<a class="ae jc" rel="noopener" href="/@natsunoyuki/bayesian-optimization-with-python-85c66df711ec">贝叶斯优化。在这篇文章中，我们将把所有的东西放在一起，用贝叶斯优化来优化激光器！</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/91699b0792f72b1eb9932c2bd3f4cd54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8I9-i21XMznKSZuS6dv-GA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Aurora. Photo by <a class="ae jc" href="https://unsplash.com/@kencheungphoto?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ken Cheung</a> on <a class="ae jc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>.</figcaption></figure><h1 id="2beb" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">优化激光器</h1><p id="c782" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">激光是极其复杂和变化无常的东西——它们需要很长时间来稳定，依赖于大量的参数，并且仅仅是调整就需要大量的资源。例如，在<a class="ae jc" href="https://arxiv.org/pdf/1909.05963.pdf" rel="noopener ugc nofollow" target="_blank">直线加速器相干光源</a>，技术人员需要主动调整多个控制参数，以实现特定的光束特性。这个调优过程占用了宝贵的时间，这些时间本可以用来做实验！</p><p id="7f92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数优化算法不适于调谐激光器，部分原因是所需的计算资源过多，部分原因是激光器的复杂程度，部分原因是许多优化算法容易陷入局部最小值。因此，为了调整激光器，我们需要优化一个昂贵的黑盒函数，这正是贝叶斯优化所做的！</p><p id="d47b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在下一节中，我们将了解如何使用贝叶斯优化来针对目标输出功率优化激光器的泵浦强度。</p><h1 id="7e81" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">激光器贝叶斯优化的Python代码</h1><p id="12a8" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们使用<code class="du kw kx ky kz b"><a class="ae jc" href="https://github.com/fmfn/BayesianOptimization" rel="noopener ugc nofollow" target="_blank">bayes_opt</a></code>库来执行贝叶斯优化。使用<a class="ae jc" href="https://github.com/natsunoyuki/FDTD/blob/main/src/fdtd/fdtd1d_laser.py" rel="noopener ugc nofollow" target="_blank"> my GitHub FDTD库</a>中的<code class="du kw kx ky kz b">fdtd1d_laser</code>对激光进行模拟。</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="a91e" class="le ju hh kz b fi lf lg l lh li">import numpy as np<br/>import matplotlib.pyplot as plt<br/>from fdtd import fdtd1d_laser<br/>from bayes_opt import BayesianOptimization, UtilityFunction</span></pre><p id="fcc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">给定一些目标输出功率，我们将优化最佳泵浦强度<code class="du kw kx ky kz b">D0</code>来使用。因此，我们定义了一个函数来运行和测量某一泵浦强度下的激光器输出功率<code class="du kw kx ky kz b">D0</code>。</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="04a2" class="le ju hh kz b fi lf lg l lh li">def run_and_measure_laser(D0, n_iter = 50000, t_measure = 10000):<br/>    # Run 1D FDTD laser simulation for pump strength D0.<br/>    fdtd = fdtd1d_laser(D0 = D0)<br/>    fdtd.run(initiate_pulse = True, n_iter = n_iter)</span><span id="b157" class="le ju hh kz b fi lj lg l lh li">    # "Measure" the output power.<br/>    E = np.abs(fdtd.E_measure)[-t_measure:]<br/>    t = np.arange(0, len(E) * fdtd.dt, fdtd.dt)<br/>    P = np.trapz(E, t)<br/>    return P</span></pre><p id="1677" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们定义一个函数，它接受一个输入<code class="du kw kx ky kz b">target_power</code>以及要运行的优化迭代次数。该功能在<code class="du kw kx ky kz b">D0</code>的某个试验值下运行激光，测量激光输出功率并与<code class="du kw kx ky kz b">target_power</code>进行比较。优化器然后通过最小化输出功率和<code class="du kw kx ky kz b">target_power</code>之间的差异来迭代地对<code class="du kw kx ky kz b">D0</code>进行调整。</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="1bd8" class="le ju hh kz b fi lf lg l lh li">def optimize_laser(target_power, n_iter = 15):<br/>    # Initialize the optimizer.<br/>    pbounds = {"D0": [1, 20]} # Search bounds.<br/>    optimizer = BayesianOptimization(f = None, pbounds = pbounds,<br/>                                     random_state = 42)<br/>    # Upper confidence bounds utility function.<br/>    utility = UtilityFunction(kind = "ucb", kappa = 1.96, xi = 0.01)</span><span id="dc9f" class="le ju hh kz b fi lj lg l lh li">    D0s = np.array([np.nan] * n_iter)<br/>    lasing_powers = D0s.copy()<br/>    targets = D0s.copy()</span><span id="6ee4" class="le ju hh kz b fi lj lg l lh li">    # Iterate the optimizer for n_iter iterations.<br/>    for i in range(n_iter):<br/>        # Optimizer suggests a value of D0 to try based on <br/>        # historical results.<br/>        next_point = optimizer.suggest(utility)</span><span id="08f7" class="le ju hh kz b fi lj lg l lh li">        # Perform the lasing measurements.<br/>        lasing_power = run_and_measure_laser(**next_point)</span><span id="0ce7" class="le ju hh kz b fi lj lg l lh li">        # Minimize the difference between lasing power and<br/>        # target_power.<br/>        target = -np.abs(lasing_power - target_power)</span><span id="0a82" class="le ju hh kz b fi lj lg l lh li">        # Store the results for output.<br/>        D0s[i] = next_point["D0"]<br/>        lasing_powers[i] = lasing_power<br/>        targets[i] = target</span><span id="3584" class="le ju hh kz b fi lj lg l lh li">        try:<br/>            # Update the optimizer with the evaluation results.<br/>            # This needs to be in try-except structure in order<br/>            # to prevent repeat errors from occuring.<br/>            optimizer.register(params = next_point, target = target)<br/>        except:<br/>            pass</span><span id="612b" class="le ju hh kz b fi lj lg l lh li">    return optimizer, D0s, lasing_powers, targets</span></pre><p id="9650" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们运行优化器20次迭代，目标功率为215233。</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="71f3" class="le ju hh kz b fi lf lg l lh li">target_power = 215233<br/>n_iter = 20</span><span id="b4bf" class="le ju hh kz b fi lj lg l lh li">optimization_results = optimize_laser(target_power, n_iter)</span><span id="4e65" class="le ju hh kz b fi lj lg l lh li">optimizer = optimization_results[0]<br/>D0s = optimization_results[1]<br/>lasing_powers = optimization_results[2]<br/>targets = optimization_results[3]</span><span id="0e1b" class="le ju hh kz b fi lj lg l lh li"># Get the best results.<br/>D0 = optimizer.max["params"]["D0"]<br/>target = optimizer.max["target"]<br/>lasing_power = int(lasing_powers[np.where(D0s == D0)[0]][0])</span><span id="91ce" class="le ju hh kz b fi lj lg l lh li"># Plot the optimization iterations.<br/>plt.figure(figsize = (15, 5))<br/>plt.plot(range(1, 1+len(optimizer.space.target)), <br/>         optimizer.space.target, "-o")<br/>plt.grid(True)<br/>plt.xlabel("Iteration", fontsize = 14)<br/>plt.ylabel("-|lasing_power - target_power|", fontsize = 14)<br/>plt.xticks(range(1, 1+len(optimizer.space.target)))<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/77e20d6b0d08897f406b74b29b9f0bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6_OZIfPir3x3KDlDTNziQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Bayesian optimization iterations of a laser for a target output power. Image created by the author.</figcaption></figure><p id="c3f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们发现在20次迭代中，优化器设法确定对于泵浦强度为<code class="du kw kx ky kz b">D0 = 9.943</code>的情况，我们得到的输出功率为<code class="du kw kx ky kz b">lasing_power = 214871</code>，这非常接近于215233的原始目标。</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="1bed" class="le ju hh kz b fi lf lg l lh li">print("Optimized pump strength value: {:.3f}.".format(D0))<br/>print("Output power: {}.".format(lasing_power))</span><span id="ccef" class="le ju hh kz b fi lj lg l lh li"><br/>&gt;&gt;&gt; Optimized pump strength value: 9.943. <br/>&gt;&gt;&gt; Output power: 214871.</span></pre><h1 id="4b4e" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结束语</h1><p id="4cc3" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">在这篇文章中，我们使用贝叶斯优化来优化模拟1D激光器的泵浦强度，以获得一些目标输出功率。这是一个非常简单的案例研究，我们为一个目标变量优化一个输入变量。在现实中，激光器要复杂得多，对于一组多个输入变量，将同时优化多个目标变量。为此，我们需要使用<a class="ae jc" href="https://pymoo.org" rel="noopener ugc nofollow" target="_blank">多目标优化</a>，这比上面执行的单目标优化更复杂。</p><h1 id="9b12" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">参考</h1><p id="6fdc" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">J.杜里斯，d .肯尼迪，a .哈努卡，J. Shtalenkova，A. Edelen，A. Egger，T. Cope和D. Ratner。<a class="ae jc" href="https://arxiv.org/pdf/1909.05963.pdf" rel="noopener ugc nofollow" target="_blank">自由电子激光器的贝叶斯优化</a>，列特物理学评论。<strong class="ig hi"> 124 </strong>，124801，2020。</p><div class="ll lm ez fb ln lo"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hi fi z dy lt ea eb lu ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">medium.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc jn lo"/></div></div></a></div></div></div>    
</body>
</html>