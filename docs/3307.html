<html>
<head>
<title>Dplyr vs. SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dplyr与SQL</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/dplyr-vs-sql-c7277abc9482?source=collection_archive---------4-----------------------#2022-08-17">https://medium.com/mlearning-ai/dplyr-vs-sql-c7277abc9482?source=collection_archive---------4-----------------------#2022-08-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="70f5" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用SQL和Tidyverse的Dplyr包进行数据操作</h2></div><p id="6dd6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi js translated">plyr是tidyverse包的一部分，被称为数据操作语法。结构化查询语言(SQL)是一种专用语言，用于与存储在数据库中的数据进行交互。在本文中，我们将比较dplyr和SQL的查询结构的异同。SQL和dplyr都是行业标准，在工业界和学术界都同样使用。SQL中的<code class="du kb kc kd ke b">SELECT</code>是一个用于选择列子集的子句，dplyr中的<code class="du kb kc kd ke b">select(dataset, col01, col02, ...)</code>动词用于相同的任务，类似地，<code class="du kb kc kd ke b">WHERE</code>子句和<code class="du kb kc kd ke b">filter(dataset, col01 &gt; val1, ...)</code>动词分别用于过滤SQL和dplyr中的数据集。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kf"><img src="../Images/01ca99a4d988882dbd6947b06819b8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Isuqyts8CSDeTG66"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx">Photo by <a class="ae kv" href="https://unsplash.com/@dancristianpaduret?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dan Cristian Pădureț</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="8fb8" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">资料组</h1><p id="8f12" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">我们将使用<a class="ae kv" href="https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/mtcars" rel="noopener ugc nofollow" target="_blank"> mtcars数据集</a>。下面给出了<code class="du kb kc kd ke b">CSV and batabase</code>文件。对于数据库文件，我使用SQLite。您可以在SQLite 的<a class="ae kv" href="https://sqlitebrowser.org/" rel="noopener ugc nofollow" target="_blank"> DB浏览器中打开<code class="du kb kc kd ke b">.db</code>文件。</a></p><ul class=""><li id="1fea" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated"><a class="ae kv" href="https://raw.githubusercontent.com/aimlresearcher/datasets/main/mtcars.csv" rel="noopener ugc nofollow" target="_blank"> mtcars.csv </a></li><li id="0315" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated"><a class="ae kv" href="https://github.com/aimlresearcher/datasets/blob/main/mtcars.db" rel="noopener ugc nofollow" target="_blank"> mtcars.db </a></li></ul><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="563f" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">选择</h1><p id="2fb8" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">我们想从mtcars数据集中选择英里/(美国)加仑(<code class="du kb kc kd ke b">mpg</code>)、气缸数(<code class="du kb kc kd ke b">cyl</code>)和总马力(<code class="du kb kc kd ke b">hp</code>)。</p><ul class=""><li id="1ab0" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated"><strong class="iy hi"> dplyr </strong>具有用于返回所需列的<code class="du kb kc kd ke b">select</code>动词</li><li id="ca80" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated"><strong class="iy hi"> SQL </strong>有<code class="du kb kc kd ke b">SELECT</code>子句来选择所需的列</li></ul><h2 id="3b54" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="af07" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="caec" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">限制性的</h1><p id="51b2" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">如果您想要返回数据集的前n行，您需要使用下面的dplyr和SQL命令。</p><ul class=""><li id="8b59" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated"><strong class="iy hi"> dplyr </strong>有<code class="du kb kc kd ke b">head(n = k)</code>功能返回顶部<code class="du kb kc kd ke b">k</code>行</li><li id="0104" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated"><strong class="iy hi"> SQL </strong>有<code class="du kb kc kd ke b">LIMIT k</code>子句返回顶部<code class="du kb kc kd ke b">k</code>行</li></ul><h2 id="ebb2" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="f055" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="18ae" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">包括…在内</h1><p id="4fee" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">要计算数据集中的总行数，您需要应用以下dplyr和SQL命令</p><ul class=""><li id="e6a2" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated">dplyr有<code class="du kb kc kd ke b">summary(count = n())</code>函数统计数据集中的所有记录。</li><li id="42d3" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL有<code class="du kb kc kd ke b">COUNT(*)</code>函数返回数据表中的记录总数</li></ul><h2 id="ddf7" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="d89a" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="74d7" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">安排</h1><p id="0e0a" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">对数据集进行排序是数据科学中一项非常重要的任务。SQL和dplyr有以下函数对数据集进行排序</p><ul class=""><li id="d7b8" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated"><strong class="iy hi"> dplyr </strong>有<code class="du kb kc kd ke b">arrange(col1, desc(col2), ...)</code>动词，用于按<code class="du kb kc kd ke b">col1</code>和<code class="du kb kc kd ke b">col2</code>等列对数据集进行排序。数据集将按列<code class="du kb kc kd ke b">col1</code>升序排序，按列<code class="du kb kc kd ke b">col2</code>降序排序。</li><li id="3259" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated"><strong class="iy hi"> SQL </strong>有<code class="du kb kc kd ke b">ORDER BY</code>子句对数据集进行排序</li><li id="b178" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">我们已经给出了三个对<code class="du kb kc kd ke b">mtcars</code>数据集进行排序的例子</li><li id="c2e2" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">在第一个例子中，我们根据<code class="du kb kc kd ke b">mpg</code>列的升序对<code class="du kb kc kd ke b">mtcars</code>数据集进行排序。</li><li id="79f0" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">在第二个例子中，我们根据<code class="du kb kc kd ke b">mpg</code>列的降序对<code class="du kb kc kd ke b">mtcars</code>数据集进行排序。</li><li id="08e7" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">在第三个示例中，我们根据<code class="du kb kc kd ke b">mpg</code>列的升序和<code class="du kb kc kd ke b">model</code>列的降序对<code class="du kb kc kd ke b">mtcars</code>数据集进行排序。</li></ul><h2 id="83e9" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="865e" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="d9ee" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">派生列</h1><p id="e231" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">例如，您想要将每加仑英里数<em class="mx"> </em> <code class="du kb kc kd ke b">mpg,</code>和重量(1000磅)<em class="mx"> </em> <code class="du kb kc kd ke b">wt </code>转换为每加仑千克数<code class="du kb kc kd ke b">kpl</code>和<code class="du kb kc kd ke b">wt_kg</code></p><ul class=""><li id="1bd9" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated">dplyr具有用于创建新列的<code class="du kb kc kd ke b">mutate(new_col = old_col*some_val, ...)</code>动词</li><li id="2441" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL在下面给出的<code class="du kb kc kd ke b">SELECT</code>子句中创建驱动程序列。</li></ul><h2 id="8a22" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="33bf" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="aa9e" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">过滤</h1><p id="d6a8" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">您可以按数据集中任何列的升序或降序对数据集进行排序。下面给出了SQL和dplyr函数</p><ul class=""><li id="4fd6" class="lt lu hh iy b iz ja jc jd jf lv jj lw jn lx jr ly lz ma mb bi translated">dplyr有<code class="du kb kc kd ke b">filter(gear == 4)</code>动词来过滤数据集</li><li id="8bd5" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL有<code class="du kb kc kd ke b">WHERE</code>子句来过滤数据库中的记录</li><li id="c4f4" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated"><code class="du kb kc kd ke b">gear</code>的数据类型是<code class="du kb kc kd ke b">factor </code>，我们需要将其转换为<code class="du kb kc kd ke b">numeric</code>，因为<code class="du kb kc kd ke b">less than</code>运算符不对factor数据类型进行操作。</li><li id="4866" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">我们展示了用dplyr和SQL过滤数据的三个例子</li><li id="ffd2" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">首先，我们用条件<code class="du kb kc kd ke b">gear == 4</code>过滤mtcars数据集</li><li id="8f75" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">其次，我们使用条件<code class="du kb kc kd ke b">gear == 4 and cyl &lt;= 6.</code>过滤mtcars数据集</li><li id="b5c8" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">其次，我们使用条件<code class="du kb kc kd ke b">gear == 4 or cyl &lt;= 6.</code>过滤mtcars数据集</li></ul><h2 id="577b" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="946d" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="a822" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">分组</h1><p id="0258" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">GROUP BY语句将具有相同值的数据集的行分组到汇总行中，如<strong class="iy hi">“查找每个类别中的齿轮数”</strong>。</p><p id="fc8c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">GROUP BY语句通常与聚合函数(COUNT()、MAX()、MIN()、SUM()、AVG())一起使用，按一个或多个列对结果集进行分组。</p><p id="2e5e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面给出了对数据进行分组的dplyr和SQL代码</p><h2 id="2b82" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="c0d9" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="7fe5" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">8.平均的</h1><ul class=""><li id="af63" class="lt lu hh iy b iz lo jc lp jf my jj mz jn na jr ly lz ma mb bi translated">dplyr有<code class="du kb kc kd ke b">summarise(mean_wt = mean(wt), ...)</code>动词来计算平均值</li><li id="c4e9" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL有<code class="du kb kc kd ke b">AVG()</code>来计算平均值</li></ul><h2 id="0740" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="e066" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="3322" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">差异</h1><ul class=""><li id="89a0" class="lt lu hh iy b iz lo jc lp jf my jj mz jn na jr ly lz ma mb bi translated">dplyr有<code class="du kb kc kd ke b">summarise(var_wt = var(wt), ...)</code>动词来计算方差</li><li id="e34b" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL有<code class="du kb kc kd ke b">VAR(wt)</code>来计算<code class="du kb kc kd ke b">wt </code>列的方差</li></ul><h2 id="b304" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="0cb4" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="3aab" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">11.最小值、最大值、总和、范围</h1><ul class=""><li id="c33d" class="lt lu hh iy b iz lo jc lp jf my jj mz jn na jr ly lz ma mb bi translated">dplyr有<code class="du kb kc kd ke b">summarise(MIN = min(as.numeric(gear)), ...)</code>动词计算不同的汇总函数。</li><li id="2b88" class="lt lu hh iy b iz mc jc md jf me jj mf jn mg jr ly lz ma mb bi translated">SQL有<code class="du kb kc kd ke b">MIN(wt), MAX(wt), SUM(wt), RANGE</code>来计算<code class="du kb kc kd ke b">wt </code>列的平均值</li></ul><h2 id="d179" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">DPLYR</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="de8f" class="mj kx hh bd ky mk ml mm lc mn mo mp lg jf mq mr li jj ms mt lk jn mu mv lm mw bi translated">结构化查询语言</h2><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="1fc7" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">结论</h1><p id="3a0c" class="pw-post-body-paragraph iw ix hh iy b iz lo ii jb jc lp il je jf lq jh ji jj lr jl jm jn ls jp jq jr ha bi translated">在本文中，我们学习了dplyr和SQL查询的结构。我们学习了如何使用SQL和dplyr对数据集进行过滤、限制、排序、选择和分组。</p><div class="nb nc ez fb nd ne"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hi fi z dy nj ea eb nk ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">medium.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns kp ne"/></div></div></a></div></div></div>    
</body>
</html>