<html>
<head>
<title>Playing MOBA game using Deep Reinforcement Learning — part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用深度强化学习玩MOBA游戏——第四部分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/playing-moba-game-using-deep-reinforcement-learning-part-4-5fdfbff753df?source=collection_archive---------3-----------------------#2022-04-11">https://medium.com/mlearning-ai/playing-moba-game-using-deep-reinforcement-learning-part-4-5fdfbff753df?source=collection_archive---------3-----------------------#2022-04-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/84ce13377b596524330cea55c896487d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omCEFerMJnkh2JY0r-dUXQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image From <a class="ae it" href="https://wallpapercave.com" rel="noopener ugc nofollow" target="_blank">Wallpapercave</a></figcaption></figure><p id="4151" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在以前的帖子中，我们使用深度强化学习来训练一个代理，以赢得限于中间车道的游戏。</p><p id="64f7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Dota2有大量状态和动作的情况下，即使地图区域和英雄数量有限，训练也需要至少1周的时间。我们可以预计将需要一个多月的时间来训练代理人使用地图的所有区域和英雄。在这种情况下，我们可以首先通过监督学习用人类专家数据训练代理模型，然后将其用于强化学习以提高训练速度。</p><p id="85eb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Dota2的情况下，重放文件使用Google Protobuf协议保存为dem文件扩展名。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/546d01a884d5612ed0eb8af9c67dd4d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7mAqxTZETbzHvAb7ap3u2A.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Flowchart of Dota2 replay parsing</figcaption></figure><p id="9969" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以根据cmd、size读取存储在dem文件中的数据，这些数据是在每个数据流的开头读取的。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Rendering replay information of Dota2</figcaption></figure><p id="0be0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">解析后的数据可以直接用于训练代理模型，也可以通过GUI显示，以便快速查看重放文件。</p><p id="15ad" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇文章中，为了便于解释，我截取了一小部分代码。完整的代码可在这里，包括图形用户界面:<a class="ae it" href="https://github.com/kimbring2/MOBA_RL/tree/main/dota2_replay" rel="noopener ugc nofollow" target="_blank">https://github.com/kimbring2/MOBA_RL/tree/main/dota2_replay</a>。</p><h1 id="fb46" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">解析演示类型</h1><p id="d113" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">解析从打开dem文件开始，检查filestamp是否是一个特定的单词。例如，Dota2客户端5550版本记录的重播文件的文件标记是“PBDEMS2”。如果这一步通过了，我们可以进行下一步。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Filestamp read forDota2 replay file</figcaption></figure><p id="d7f1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下一步是通过读取cmd数据来决定下一个数据流使用哪种Protobuf协议。您可以在demo.proto文件中检查每个cmd的数据结构。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">First part of demo.proto file</figcaption></figure><p id="9fdf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据体大小由cmd之后读取的数据决定。对于SendTables或ClassInfo，解析到此结束。然而，在DemoPacket的情况下，我们需要再解析一次数据体。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Demo type parsing for Dota2 replay file</figcaption></figure><h2 id="78ff" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">1.解析发送表</h2><p id="7d75" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">在Dota2的情况下，数据有各种形式，如int、float、string和array。当解析重放文件时，我们需要使用正确的解码器类型。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">SendTables parsing part</figcaption></figure><p id="5ea8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">发送表解析部分选择用于解析详细数据的解码器。</p><h2 id="f0c9" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">2.解析ClassInfo</h2><p id="dd0c" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">ClassInfo部分选择demo_class，稍后需要它来解析详细数据。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Parsing the ClassInfo data</figcaption></figure><h1 id="6bbd" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">解析演示数据包</h1><p id="a84f" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">在DemoPacket的情况下，我们需要像第一种情况一样按照这个顺序读取cmd，size。然后，我们需要根据cmd决定需要哪种类型的Google Protobuf，并根据大小读取数据。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Parsing the DemoPacket data</figcaption></figure><h2 id="f9e4" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">1.正在解析ServerInfo</h2><p id="38c5" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">ServerInfo信息的参数因客户端版本而异。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div></figure><p id="9179" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，当确定分组实体cmd处class_id的读取长度时，使用max_classes。game_dir可用于检查生成重放文件的客户机的信息。</p><h2 id="b5a6" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">2.解析CreateStringTable</h2><p id="13f6" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">StringTable是一种查找表，稍后在游戏中将int类型值转换为实际名称时会用到。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">StringTable for Dota2 replay parsing</figcaption></figure><h2 id="702a" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">3.解析包潜力</h2><p id="fbb4" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">PacketEntities是Dota 2重播解析中最复杂和耗时的部分，在这里我们可以获得游戏中存在的所有英雄、npc、怪物、建筑的位置、hp、法力、物品、能力信息。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Information of hero entity</figcaption></figure><p id="71cf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在英雄实体的情况下，信息由id，位置，角度，经验，hp，法力，能力，物品组成。我们可以通过使用我们之前选择的解码器来分离那种信息。</p><h2 id="9473" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">4.解析SpectatorPlayerUnitOrders</h2><p id="7c49" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">尽管我们可以从包潜力中获得关于游戏中所有实体的信息，但它不包含对监督学习至关重要的人类玩家行为。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Parsing SpectatorPlayerUnitOrders data</figcaption></figure><p id="f4cd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">可以从SpectatorPlayerUnitOrders解析此信息。它们包括点击位置、使用物品和能力、攻击目标等。</p><h2 id="4db9" class="ld ka hh bd kb le lf lg kf lh li lj kj jf lk ll kn jj lm ln kr jn lo lp kv lq bi translated">4.解析战斗日志条目</h2><p id="8871" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">英雄获得增益和减益，如果它接近的基础，塔或其他英雄有一个特定单位的光环。我们代理还需要使用该信息作为模型的状态。</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lc jy l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Parsing the CombatLogEntry data from Dota2 replay</figcaption></figure><p id="7740" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些数据可以从CombatLogEntry中获得。实际上，那部分给出的值是int类型的。我们可以使用该值作为您之前获得的StringTable的索引，以查找实体的字符串类型名称。</p><h1 id="1008" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="9e31" class="pw-post-body-paragraph iu iv hh iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">在这篇文章中，我们研究了如何从Dota2的重放文件中提取数据用于监督学习。我们可以使用这些信息来训练代理在特定的状态下遵循特定的动作。</p><div class="lr ls ez fb lt lu"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hi fi z dy lz ea eb ma ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">medium.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi in lu"/></div></div></a></div></div></div>    
</body>
</html>