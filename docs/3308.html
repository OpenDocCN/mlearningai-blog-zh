<html>
<head>
<title>Pytorch &amp; C++ #1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pytorch &amp; C++ #1</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/pytorch-c-1-5c4d0f7f27a4?source=collection_archive---------5-----------------------#2022-08-17">https://medium.com/mlearning-ai/pytorch-c-1-5c4d0f7f27a4?source=collection_archive---------5-----------------------#2022-08-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2df193ef8fcb85dc3308b62b246c4add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCzSulsaZvXvQktwYMRTPw.png"/></div></div></figure><h1 id="ec09" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="041b" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在本系列中，我将尝试提供Pytorch c++ API的示例/实践/项目。如果你是这个系列的新手，可以在潜水前查看一下<a class="ae kl" rel="noopener" href="/@yozkose3/pytorch-c-intro-b50571762162">第一篇博客</a>。在这个故事中，让我们通过Torch张量来熟悉cpp中的张量运算。了解了这个背景之后，我们将会更好地理解下面的项目&amp;实践。所有代码都可以在<a class="ae kl" href="https://github.com/EmreOzkose/pytorch_cpp" rel="noopener ugc nofollow" target="_blank">这个Github repo </a>中获得。</p><div class="km kn ez fb ko kp"><a href="https://github.com/EmreOzkose/pytorch_cpp" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hi fi z dy ku ea eb kv ed ef hg bi translated">GitHub-EmreOzkose/py torch _ CPP:py torch CPP API示例/实践</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">github.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld in kp"/></div></div></a></div><h1 id="0eda" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">内容</h1><ol class=""><li id="d9e4" class="le lf hh jp b jq jr ju jv jy lg kc lh kg li kk lj lk ll lm bi translated">描述环境。</li><li id="1af1" class="le lf hh jp b jq ln ju lo jy lp kc lq kg lr kk lj lk ll lm bi translated">如何运行代码？</li><li id="eab0" class="le lf hh jp b jq ln ju lo jy lp kc lq kg lr kk lj lk ll lm bi translated">编码。<br/> a .玩弄基本张量运算。<br/> b .举例:从零开始写焦损</li></ol><h1 id="2a2c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">环境</h1><p id="955a" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我在本系列的第一篇博客中提到了我是如何安装Pytorch Cpp API的。除此之外，我在Ubuntu 20.04.3上使用的是VS Code 1.69.2。我安装了下面的cpp扩展。</p><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/54a5d317926b7d225ba379833abb3cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*jpX8tgTn5KcPF4o4uqvreg.png"/></div></figure><h2 id="87a4" class="lx iq hh bd ir ly lz ma iv mb mc md iz jy me mf jd kc mg mh jh kg mi mj jl mk bi translated">扩展版本</h2><ul class=""><li id="b4db" class="le lf hh jp b jq jr ju jv jy lg kc lh kg li kk ml lk ll lm bi translated">C/C++ for Visual Studio代码版本1.11.5</li><li id="3001" class="le lf hh jp b jq ln ju lo jy lp kc lq kg lr kk ml lk ll lm bi translated">C++智能感知v0.2.2</li><li id="8c6e" class="le lf hh jp b jq ln ju lo jy lp kc lq kg lr kk ml lk ll lm bi translated">C/C++扩展包1.2.0版</li></ul><h1 id="991a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">怎么跑</h1><p id="bfe7" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在这篇博客中，我们将只使用1个脚本。下面给出了运行步骤。</p><ol class=""><li id="1d27" class="le lf hh jp b jq mm ju mn jy mo kc mp kg mq kk lj lk ll lm bi translated">创建一个文件夹来存储脚本和构建</li><li id="f78a" class="le lf hh jp b jq ln ju lo jy lp kc lq kg lr kk lj lk ll lm bi translated">创建名为main.cpp的脚本</li></ol><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="620d" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">3.创建CMakeFile</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="43ad" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">文件结构应该如下所示:</p><figure class="lt lu lv lw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mw"><img src="../Images/39a5919644ecbcf6b4f48801d8ea5e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*VeewNoHH-1cfRojQCIIvsg.png"/></div></div></figure><p id="1d98" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">4.构建并运行:</p><pre class="lt lu lv lw fd mx my mz na aw nb bi"><span id="4392" class="lx iq hh my b fi nc nd l ne nf">cd build<br/>cmake -DCMAKE_PREFIX_PATH=/path/to/libtorch ..<br/>cmake --build . --config Release<br/>./simple-tensor-operations</span></pre><p id="6482" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">仅此而已！我们将只在下面的部分更改main.cpp文件。</p><h1 id="3d89" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">编码</h1><p id="6fb6" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">ATen是一个张量库，你可以在CPU和GPU上进行操作。然而，Aten张量类缺乏可微性。在这一点上，torch定义了一个类似的张量类，其中这个张量类包括了ATen张量类的所有能力和可微性。这也叫<a class="ae kl" href="https://pytorch.org/cppdocs/#autograd" rel="noopener ugc nofollow" target="_blank">亲笔签名</a>。我们将使用Torch::Tensor类而不是ATen::Tensor来练习，因为除了可微性之外没有任何区别。</p><h2 id="086b" class="lx iq hh bd ir ly lz ma iv mb mc md iz jy me mf jd kc mg mh jh kg mi mj jl mk bi translated">基本操作</h2><p id="93a5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">Torch::tensor包括Python Tensor类的所有功能。让我们定义2个随机张量。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="60f7" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">我们可以做基本的数学运算。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="7f24" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">张量类还提供管理给定张量的形状。您可以将2D矩阵转换为1D向量，或者删除/添加维度。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="4e39" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">张量也可以叠加。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="f651" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">当然，设备操作也很重要。我们可以通过torch::cuda读取设备信息。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="197f" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">我们也可以将非线性函数应用于张量。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><h2 id="1aa1" class="lx iq hh bd ir ly lz ma iv mb mc md iz jy me mf jd kc mg mh jh kg mi mj jl mk bi translated">示例:从头开始编写焦点丢失</h2><p id="94ae" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">让我们从头开始练习写焦损所学的内容。我们将<a class="ae kl" href="https://github.com/facebookresearch/fvcore/blob/main/fvcore/nn/focal_loss.py" rel="noopener ugc nofollow" target="_blank">原焦损函数</a>转换为cpp版本。可以就此打住，自己试着写:)。</p><p id="0acf" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">第一步是从头开始写Sigmoid。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="5834" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">第二步是写二元交叉熵损失。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="f8ab" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">最后，焦点损失定义如下。</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="cc6c" class="pw-post-body-paragraph jn jo hh jp b jq mm js jt ju mn jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ha bi translated">现在，让我们举几个函数的例子</p><figure class="lt lu lv lw fd ii"><div class="bz dy l di"><div class="mr ms l"/></div></figure><h2 id="5766" class="lx iq hh bd ir ly lz ma iv mb mc md iz jy me mf jd kc mg mh jh kg mi mj jl mk bi translated">结论</h2><p id="605e" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在这篇博客中，我们练习了Pytorch cpp API的基本操作。所有代码都可以在<a class="ae kl" href="https://github.com/EmreOzkose/pytorch_cpp" rel="noopener ugc nofollow" target="_blank">这个Github Repo </a>中找到。在本系列的后续博客中，我们将继续使用torch::nn。</p><div class="km kn ez fb ko kp"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hi fi z dy ku ea eb kv ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">medium.com</p></div></div><div class="ky l"><div class="ng l la lb lc ky ld in kp"/></div></div></a></div></div></div>    
</body>
</html>