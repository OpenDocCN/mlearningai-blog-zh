<html>
<head>
<title>Building a dataset with web scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用web抓取构建数据集</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-a-dataset-with-web-scraping-e96a9bd6af1c?source=collection_archive---------2-----------------------#2022-09-01">https://medium.com/mlearning-ai/building-a-dataset-with-web-scraping-e96a9bd6af1c?source=collection_archive---------2-----------------------#2022-09-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/474be7d0193be9d7f3a027ad46e29124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPvQ4An5LRHVX9mgHI0kJg.png"/></div></div></figure><div class=""/><div class=""><h2 id="27c7" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">如何使用BeautifulSoup从Kijiji广告中收集图像</h2></div><p id="2859" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">有时候，在一个数据项目的开始，我们可用的数据可能不足，甚至不存在。您可能会尝试在公开可用的数据源中查找数据集，但是您可能无法找到您要查找的内容。这就是web抓取发挥作用的地方，它是一种在web上自动收集数据以构建自己的数据集的技术。</p><h2 id="4843" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">什么是网页抓取？</h2><p id="14fa" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">网络搜集包括以自动方式收集网站上的数据。它可以是文本、图像或任何类型的数据。</p><p id="b64d" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">为此，我们编写一个脚本来下载页面内容(通常是HTML格式)，然后从中选择所需的元素。这就是我们将在本文中教给你的。</p><p id="d491" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated"><strong class="jj ht">免责声明:</strong>有些网站比其他网站更容易被抓取，这些网站实施了保护措施，以防止抓取机器人抓取其内容。比如，如果你的目标是刮谷歌，我祝你好运。在本文中，出于教学原因，我举了一个相对简单的例子。此外，一个抓取脚本在时间上是冻结的，一个网站可以发展，然后脚本将不再工作。</p></div><div class="ab cl ld le go lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ha hb hc hd he"><h2 id="adc6" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">用例—自行车图像</h2><p id="b844" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">假设我们想要收集各种品牌的自行车图像，以便稍后构建自行车品牌分类模型。这样的数据集似乎不存在，这就是为什么我们决定创建一个。</p><p id="2a7e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在这种情况下，广告网站可能是一个有趣的数据来源。例如，<a class="ae lk" href="https://www.kijiji.ca/" rel="noopener ugc nofollow" target="_blank"> Kijiji </a>是一个加拿大的广告分类系统。</p><p id="e6e3" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">因此，行动计划是搜索“公路车”类别中的每个目标品牌。</p><h2 id="db1b" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">设置搜索URL</h2><p id="04f6" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">首先，我们通过以下步骤定位要抓取的页面的URL:</p><ul class=""><li id="11cf" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated">浏览到<a class="ae lk" href="https://www.kijiji.ca/" rel="noopener ugc nofollow" target="_blank">吉吉吉</a></li><li id="fc45" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated">将类别设置为“自行车&gt;道路”</li><li id="7137" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated">将文本查询设置为某个自行车品牌，如“specialized”</li><li id="edc5" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated">将位置设置为“加拿大”以在整个网站上执行搜索</li></ul><p id="187a" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">因此，搜索提示应该如下所示:</p><figure class="ma mb mc md fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lz"><img src="../Images/b063105fea271509b077bc827fe0a2bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ceacmlWok0eZSjhLm0SLHA.png"/></div></div></figure><p id="1ae0" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">之后，URL将被设置为:</p><blockquote class="me mf mg"><p id="5160" class="jh ji mh jj b jk jl it jm jn jo iw jp mi jr js jt mj jv jw jx mk jz ka kb kc ha bi translated"><a class="ae lk" href="https://www.kijiji.ca/b-road-bike/canada/specialized/k0c648l0?rb=true" rel="noopener ugc nofollow" target="_blank">https://www . kiji Ji . ca/b-road-bike/Canada/specialized/k0c 648 l 0？rb =真</a></p></blockquote><p id="e15a" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">请注意，我们指定的搜索参数包含在其中。</p><p id="74b2" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">一次搜索通常会产生几页结果。如果我们浏览到下一页，我们将获得包含页码的URL:</p><blockquote class="me mf mg"><p id="c4b9" class="jh ji mh jj b jk jl it jm jn jo iw jp mi jr js jt mj jv jw jx mk jz ka kb kc ha bi translated"><a class="ae lk" href="https://www.kijiji.ca/b-road-bike/canada/specialized/page-2/k0c648l0?rb=true" rel="noopener ugc nofollow" target="_blank">https://www . kiji Ji . ca/b-road-bike/Canada/specialized/page-2/k0c 648 l 0？rb =真</a></p></blockquote><p id="3098" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">稍后，这将有助于在脚本中导航结果页面。</p><h2 id="2a70" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">获取图像链接</h2><p id="b5ba" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">既然我们有了所需内容的URL，我们只需要在页面代码中定位图像。为此，右键单击广告图像，然后单击“检查”。将会打开以下侧栏:</p><figure class="ma mb mc md fd hj er es paragraph-image"><div class="er es ml"><img src="../Images/79b862e05eb257eaacceace88bfa7d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*yKqCL5tcIfKanWK6jOUtWA.png"/></div><figcaption class="mm mn et er es mo mp bd b be z dx">Browser inspection tool</figcaption></figure><p id="008e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们已经找到了一个图像链接！您知道手动执行这项任务来收集所有的图像链接会很繁琐。这就是为什么web抓取使用脚本来自动完成这项任务。</p><p id="618e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要正式定位图像，我们必须找到“选择器”。右键单击前一个突出显示的块，然后单击“复制&gt;复制选择器”。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div class="er es mq"><img src="../Images/5dbc294e6b58dde77c1320a8c56427dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*2s1mWj9NVzZ_SDqdmBv_jA.png"/></div><figcaption class="mm mn et er es mo mp bd b be z dx">Selector drop-down menu</figcaption></figure><p id="39d2" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">您将在剪贴板中看到类似这样的内容:</p><blockquote class="me mf mg"><p id="20b6" class="jh ji mh jj b jk jl it jm jn jo iw jp mi jr js jt mj jv jw jx mk jz ka kb kc ha bi translated"># main page content &gt; div . layout-3 &gt; div . col-2 &gt; main &gt; div:n-child(2)&gt; div:n-child(4)&gt; div &gt; div . left-col &gt;<strong class="jj ht">div . image&gt;picture&gt;img</strong></p></blockquote><p id="4615" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">该选择器指示HTML代码块中图像链接的精确位置。最后用粗体显示的部分是下一步感兴趣的部分。</p><h2 id="d027" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">编写图像链接集合的脚本</h2><p id="820f" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">我们终于有了写剧本的所有素材。我们将使用Python和以下库:</p><ul class=""><li id="9755" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated"><strong class="jj ht">请求</strong> <em class="mh"> </em>下载网页</li><li id="b386" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><strong class="jj ht"> BeautifulSoup </strong>解析返回的页面</li><li id="deee" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><strong class="jj ht"> Pandas </strong>将结果保存在CSV文件中</li></ul><p id="c887" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在我们的场景中，假设我们想要为品牌“giant”、“specialized”和“trek”收集图像。因此，我们有一个主循环，遍历品牌，然后再遍历页面。我们根据<strong class="jj ht">请求</strong>下载每个页面，然后用<strong class="jj ht"> BeautifulSoup </strong>解析它。最后，我们可以提取图像链接并将它们保存在一个<strong class="jj ht"> Pandas </strong>数据框中。</p><figure class="ma mb mc md fd hj"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="275f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">让我们来看看关于实现的一些细节。您可能会注意到在第39行的图片链接上使用了<code class="du mt mu mv mw b">.replace("200-jpg", "1600-jpg")</code>。这是因为Kijiji图像在他们的服务器上以不同的分辨率存储，我们选择了一个更高的分辨率。在第43行，选择器<code class="du mt mu mv mw b">div.resultsHeadingContainer-781502691 &gt; span</code>用于获取到当前页面为止显示的结果数与结果总数的比较(获取方式同上)。正则表达式在下一行提取这些数字。这让我们知道什么时候到达最后一页。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div class="er es mx"><img src="../Images/8e4005f8f45e1a199da29b8d5d2dec1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*cr-3hgcwvS07m1D2H_37nw.png"/></div><figcaption class="mm mn et er es mo mp bd b be z dx">Preview of the resulting data frame</figcaption></figure><h2 id="00eb" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">下载图片</h2><p id="a72a" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">最后一步是从收集的链接中下载图片。为此，我们使用一个简单的脚本，再次依赖于<strong class="jj ht">熊猫</strong>和<strong class="jj ht">请求</strong>。我们使用<strong class="jj ht"> Tqdm </strong>显示进度条。</p><figure class="ma mb mc md fd hj"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="95be" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">脚本可能需要一些时间来运行。最后，您将获得一个<code class="du mt mu mv mw b">images</code>文件夹，其中包含每个品牌的文件夹！然后，我们可以分析、清理或预处理图像。为了收集更多的数据，我们可以在其他网站上重复这个操作。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div class="er es my"><img src="../Images/a9068d6af2e3a3c70221f9408823d9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*7V5bIXUinsQ09lI2XhhF_Q.png"/></div><figcaption class="mm mn et er es mo mp bd b be z dx">Sample of the downloaded images</figcaption></figure></div><div class="ab cl ld le go lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ha hb hc hd he"><h2 id="962b" class="kd ke hs bd kf kg kh ki kj kk kl km kn jq ko kp kq ju kr ks kt jy ku kv kw kx bi translated">结论</h2><p id="81ca" class="pw-post-body-paragraph jh ji hs jj b jk ky it jm jn kz iw jp jq la js jt ju lb jw jx jy lc ka kb kc ha bi translated">在本文中，我们看到了如何使用Python执行web抓取来构建数据集。Web抓取是一个功能强大的工具，具有广泛的应用。作为数据从业者，知道如何获取数据是一项很有价值的技能。</p><p id="74b8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我希望这篇文章是有用的，并且你从中学到了一些东西。感谢您的阅读！</p><blockquote class="me mf mg"><p id="a069" class="jh ji mh jj b jk jl it jm jn jo iw jp mi jr js jt mj jv jw jx mk jz ka kb kc ha bi translated">灵感:<a class="ae lk" rel="noopener" href="/@kaineblack/web-scraping-kijiji-ads-with-python-ef81a49e0e9e">https://medium . com/@ kaine black/web-scraping-kiji Ji-ads-with-python-ef 81 a 49 E0 e 9 e</a></p><p id="1f62" class="jh ji mh jj b jk jl it jm jn jo iw jp mi jr js jt mj jv jw jx mk jz ka kb kc ha bi translated">再进一步:【https://realpython.com/beautiful-soup-web-scraper-python/】T2</p></blockquote><div class="hg hh ez fb hi mz"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd ht fi z dy ne ea eb nf ed ef hr bi translated">Mlearning.ai提交建议</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">medium.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn ho mz"/></div></div></a></div></div></div>    
</body>
</html>