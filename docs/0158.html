<html>
<head>
<title>How To Load Data Into Google BigQuery on Dataproc and AutoML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Dataproc和AutoML上将数据加载到Google BigQuery中</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-load-data-into-google-bigquery-on-dataproc-and-automl-9d29e7edcd5b?source=collection_archive---------3-----------------------#2021-02-23">https://medium.com/mlearning-ai/how-to-load-data-into-google-bigquery-on-dataproc-and-automl-9d29e7edcd5b?source=collection_archive---------3-----------------------#2021-02-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="20a9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">Google Dataproc是什么？</h1><p id="2388" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Dataproc是一个低成本的Google云平台集成，易于使用的托管Spark和Hadoop服务，可用于批处理、流和机器学习用例。</p><h1 id="db75" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">什么是Google BigQuery？</h1><p id="1b41" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">BigQuery是一个企业级数据仓库，利用Google基础设施的处理能力实现高性能SQL查询。</p><h1 id="49df" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">将数据加载到Google BigQuery和AutoML</h1><p id="5263" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这篇博客中，我们将回顾StreamSets Transformer中的ETL数据管道，<a class="ae ka" href="https://streamsets.com/products/dataops-platform/transformer-etl/" rel="noopener ugc nofollow" target="_blank">一个Spark ETL引擎</a>，从纽约州(FDNY)消防局接收存储在Google云存储(GCS)中的真实世界数据，对其进行转换，并将精选的数据存储在Google BigQuery中。</p><p id="9e60" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">一旦转换后的数据在Google BigQuery中可用，它将在AutoML中用于训练机器学习模型，以预测FDNY的平均事件响应时间。</p><h1 id="5b4d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">抽样资料</h1><p id="721e" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">该数据集可通过<a class="ae ka" href="https://opendata.cityofnewyork.us/" rel="noopener ugc nofollow" target="_blank">纽约市开放数据</a>网站获得。2009–2018年的历史数据集包含FDNY的平均响应时间。数据按事故类型(假警报、医疗紧急情况等)、行政区以及特定月份的事故数量进行划分。</p><p id="620d" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">以下是示例FDNY数据的样子:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ad20" class="kp if hh kl b fi kq kr l ks kt">YEARMONTH,INCIDENTCLASSIFICATION,INCIDENTBOROUGH,INCIDENTCOUNT,AVERAGERESPONSETIME 2009/07,All Fire/Emergency Incidents,Citywide,40850,04:27 2009/07,False Alarm,Citywide,2655,04:07 2009/07,Medical Emergencies,Manhattan,4895,04:17 2009/07,Medical False Alarm,Citywide,408,04:13 2009/07,NonMedical Emergencies,Manhattan,4446,04:51 2009/07,NonStructural Fires,Citywide,1495,04:19 2009/08,All Fire/Emergency Incidents,Citywide,41723,04:30</span></pre><h1 id="e6ae" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">数据管道概述</h1><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/ebf1709a018f7a4feb15392927db5e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WDfzmnS9uOgG2BLP.png"/></div></div></figure><p id="d222" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">在StreamSets Transformer中运行管道之前，您可以根据配置的Dataproc集群预览管道，以检查数据结构、数据类型，并验证每个阶段的转换。这也是一个很好的方法。关于管线预览的更多信息，请参考<a class="ae ka" href="https://streamsets.com/getting-started/download-install-transformer-etl/#1607012180138-5c9bcd0f-a9f2" rel="noopener ugc nofollow" target="_blank">调试数据管线</a> <a class="ae ka" href="https://streamsets.com/documentation/transformer/latest/help/transformer/Preview/Preview-Title.html#concept_zlk_byt_cmb" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/7685b7a1ce0294209e5b36aae8ebfdd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mUX-j5eJ0Ju68W6H.png"/></div></div></figure><h1 id="abfb" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">删除未来信息</h1><p id="1236" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">因为这是一个历史数据集，我们用它来训练机器学习模型，所以我们需要删除月初未知的信息。在这种情况下，即<em class="lc"> INCIDENTCOUNT </em>要从每条记录中移除该字段，我们将使用一个<a class="ae ka" href="https://streamsets.com/documentation/transformer/latest/help/transformer/Processors/FieldRemover.html#concept_svw_dxf_fhb" rel="noopener ugc nofollow" target="_blank">字段移除器</a>处理器。</p><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/4f8e059cf86ec86257615963a2c4b9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PuNsg653rAMY0BvR.png"/></div></div></figure><h1 id="5c67" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">数据转换</h1><p id="e44d" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">机器学习模型中的标签或目标变量是数字数据类型。在这种情况下，<em class="lc"> AVERAGERESPONSETIME </em>的字段值按以下步骤转换:</p><ul class=""><li id="460b" class="ld le hh je b jf kb jj kc jn lf jr lg jv lh jz li lj lk ll bi translated">删除“:”使用表达式— <strong class="je hi"> <em class="lc">替换(AVERAGERESPONSETIME，“:，”)</em> </strong></li><li id="edba" class="ld le hh je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll bi translated">使用<a class="ae ka" href="https://streamsets.com/documentation/transformer/latest/help/transformer/Processors/SparkSQLExp.html#concept_akj_gsz_mhb" rel="noopener ugc nofollow" target="_blank"> Spark SQL </a>表达式—<strong class="je hi"><em class="lc">round((average response time/100)* 60+(average response time % 100))</em></strong></li></ul><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/765a62f3a53bdef7bc91e0d51042d636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ev9Fex6J5trhyU5w.png"/></div></div></figure><h1 id="9e39" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">数据管道执行</h1><p id="d629" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">运行<a class="ae ka" href="https://streamsets.com/products/dataops-platform/transformer-etl/" rel="noopener ugc nofollow" target="_blank"> StreamSets Transformer </a>数据管道可以实时显示各种指标。例如，每个阶段的批处理时间如下所示。这是开始研究微调处理和转换的好方法。</p><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/2ddafd6fc0a6bd9a12989885a9e454ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4US1kQ5UDI_9HoFt.png"/></div></div></figure><h1 id="2f97" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">谷歌大查询</h1><p id="7ae3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">一旦管道成功运行，就会自动创建Google BigQuery表(如果尚不存在),并将转换后的数据插入到表中。如下所示，该数据集可随时用于查询。</p><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/c87fb3c2f26f0ec84c3aec4cd1eeffc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KUOt03O3WYu9on3L.png"/></div></div></figure><p id="4707" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">存储的转换数据可以直接从BigQuery表导入，用于在<a class="ae ka" href="https://cloud.google.com/automl/docs" rel="noopener ugc nofollow" target="_blank"> AutoML </a>中训练机器学习模型。</p><p id="8ece" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">使用AutoML，你可以建立在谷歌的机器学习能力之上，创建定制的机器学习模型。</p><h1 id="7959" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">输入数据</h1><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/0603890f863d38146789fc0f304a6c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BoS1WPRnMzIMGwnL.png"/></div></div></figure><h1 id="2d49" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">选择目标列</h1><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/dd09126db3058aebd40431632acebd8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ai9qL-mWX7fpINYB.png"/></div></div></figure><h1 id="8d5b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">训练机器学习模型</h1><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/d33019042f4f30511b057a4d02bd85c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TlKWYirCJ951v_Cw.png"/></div></div></figure><figure class="kg kh ki kj fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/35524818b8dfaf4a40d707fa7e22aa36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y3TomjP8uEJZdKMb.png"/></div></div></figure><p id="09f0" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">就是这样！我们从将原始的真实世界的数据加载到Google BigQuery，到在AutoML中创建一个机器学习模型，而无需任何编码或脚本！</p><h1 id="f49c" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">构建您的Spark ETL和ML数据管道</h1><p id="164d" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">不言而喻，训练模型、评估它们、模型版本化以及为模型的不同版本服务都是非常重要的任务，这不是本文的重点。尽管如此，StreamSets Transformer使得将数据加载到Google BigQuery和AutoML变得非常容易。</p><p id="0940" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">查看这些有用的资源，快速开始运行您的<a class="ae ka" href="https://streamsets.com/getting-started/download-install-transformer-etl/#1603730763837-927d0686-eb52" rel="noopener ugc nofollow" target="_blank"> Spark ETL数据管道</a>。这里有一些其他与机器学习相关的技术博客，你可能会有兴趣阅读:</p><p id="4fde" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated">了解关于谷歌云平台的<a class="ae ka" href="https://streamsets.com/solutions/streamsets-for-google/" rel="noopener ugc nofollow" target="_blank">流集的更多信息。</a></p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="49d3" class="pw-post-body-paragraph jc jd hh je b jf kb jh ji jj kc jl jm jn kd jp jq jr ke jt ju jv kf jx jy jz ha bi translated"><em class="lc">原载于2021年2月23日https://streamsets.com</em><em class="lc">T21</em><a class="ae ka" href="https://streamsets.com/blog/how-to-load-data-into-google-bigquery-on-dataproc-and-automl/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>