<html>
<head>
<title>Real-time Style Transfer with AdaIN, Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AdaIN的实时风格转换，已说明</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/real-time-style-transfer-with-adain-explained-f9fa185959aa?source=collection_archive---------1-----------------------#2021-03-06">https://medium.com/mlearning-ai/real-time-style-transfer-with-adain-explained-f9fa185959aa?source=collection_archive---------1-----------------------#2021-03-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0ae2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近我得到了一台<a class="ae jc" href="https://opencv.org/introducing-oak-spatial-ai-powered-by-opencv/" rel="noopener ugc nofollow" target="_blank"> OAK-1 </a>(一台内置人工智能芯片的相机)，不知道该怎么处理它。我最近还看了<a class="ae jc" href="https://arxiv.org/pdf/1703.06868.pdf" rel="noopener ugc nofollow" target="_blank">2017年的论文介绍自适应实例规范化(AdaIN) </a>，很喜欢。</p><p id="3232" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就是这个项目的由来。给定一个输入图像(比如一幅画)，我想将橡树的视频转换成该图像的风格。我没有做任何新的事情，但我认为无论如何都会很有趣。</p><p id="a805" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这第一篇文章将涵盖一些基础知识以及我将使用的技术；如果你已经是深度学习的实践者，我会<a class="ae jc" href="https://arxiv.org/pdf/1703.06868.pdf" rel="noopener ugc nofollow" target="_blank">阅读原文</a>。在第二篇文章中，我将讨论重新实现模型和训练，在最后一篇文章中，我将把事情转移到OAK-1。</p><h1 id="5ca4" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">关于OAK-1的更多信息</h1><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/975167ef8e4831c024d5b0660197b661.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*E21GUcG8Sxnts1yJl6d3Kg.jpeg"/></div></div></figure><p id="0896" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里…它的价格大约为99美元，具有4K视频和一个机载神经网络芯片。</p><h1 id="89b9" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">CNN基础</h1><p id="d346" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我不会在这里详尽地介绍卷积神经网络(CNN ),但是我会对这个项目的其余部分进行足够多的基础介绍。</p><p id="adde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数图像由3个通道组成；红色、绿色和蓝色。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ks"><img src="../Images/26c65fac88acd473473d0727a274131c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*VwAlL_NNLu8lKtK8yXCkzw.png"/></div></div></figure><p id="ebb5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷积层是一个函数，它接受一个2D数组堆栈(例如，一个RGB图像)，并将其转换为另一个2D数组堆栈。因此，一个层可能会接收64x64 RGB图像(64x64x3)，并输出四个32x32输出(32x32x4)。四个输出中的每一个都称为特征图。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kt"><img src="../Images/9546b9ef9c308fb2e0d51b1cc2f01888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*R_-ioskmhrrNNOz9BLDC1Q.png"/></div></div></figure><p id="24c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们将一堆卷积层堆叠在一起，我们就会得到一个卷积神经网络(CNN)。第一层做简单的事情，如检测线，而后面的层检测更复杂的模式，如不同种类的斑点。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ku"><img src="../Images/d2b0d6a24cf1819ef41e0983a875d906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Fw1V7y_4kLFrMJ7hDRDCA.png"/></div></div></figure><p id="257f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">CNN很酷的一点是，如果我们每层都有足够多的特征地图，足够多的层，以及大量的标记数据，我们就可以模拟几乎任何我们想要的函数。例如，照片是狗还是猫。</p><h1 id="7e79" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">编码器和解码器</h1><p id="6cce" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">大多数CNN会添加越来越多的特征地图，直到他们输出一些我们有的问题的答案。这里有一个例子:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kv"><img src="../Images/f698d69ce1ab8e56d66b39a45483227e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npr1nQd3ZeejB0WFXnap0w.png"/></div></div></figure><p id="9b22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">碰巧的是，如果我们去掉CNN的最后几层，通常得到的特征地图仍然能告诉我们很多信息。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kv"><img src="../Images/542ff98c610b7d575b4061b731d3e4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDRewNS6DB3INjcvMF7GYQ.png"/></div></div></figure><p id="c408" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它们告诉我们如此多的信息，如果我们设计一个接受这些特征地图的CNN，我们可以训练它输出原始图像。然后我们称第一个CNN为<em class="kw">编码器</em>，第二个CNN为<em class="kw">解码器</em>。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kx"><img src="../Images/74d07e5b0b236b838ec7d313e1332a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ofjBNwMvF2ZYBpf89vAJw.png"/></div></div></figure><h1 id="1092" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">特征地图统计</h1><p id="b1f3" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我们就快到了…</p><p id="d6fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷积层之后的每个特征图将具有平均值和方差。AdaIn论文的作者提出的强有力的见解是，这些统计数据告诉我们大量关于图像的风格。</p><p id="0ae7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个特征图的统计数据可能会告诉我们图像的平滑度，而另一个特征图的统计数据可能会告诉我们蓝线的宽度(这只是一个例子)。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ky"><img src="../Images/2cbb26e54163040df0e2d8efaf57b127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEtH8VW-lcEOuZjfODCjxw.png"/></div></div></figure><p id="766f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设我们有一张照片，对它进行编码后，我们计算每个特征图的平均值和方差。现在假设我们对一幅画做同样的事情。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kz"><img src="../Images/f3da1105b26cae082fb4e13719ce2de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSUp0OWfmX7KL9w_EJxsyQ.png"/></div></div></figure><p id="6f7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，照片的特征地图的统计数据与绘画的特征地图的统计数据不匹配。这告诉我们，图像有不同的风格。</p><p id="21dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们可以标准化照片编码的每个特征图，使得每个特征图具有均值0和方差1。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es la"><img src="../Images/b78b597185561a2cd59047de8771f676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3A48dqQ-Yl8copZrRKz_Q.png"/></div></div></figure><p id="a262" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们可以乘以照片编码中相应特征图的标准偏差，并在照片编码中添加相应特征图的平均值。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lb"><img src="../Images/4bd69959c34b0ff9a6e17bd154d838ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLBIKxPaxaRhRsRliywLjQ.png"/></div></div></figure><p id="f526" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本质上，我们已经修改了照片的编码，这样每个特征图都与绘画编码中的相应特征图具有相同的统计数据。这一步称为自适应实例规范化，或AdaIn。“自适应”部分来自于我们可以为任何绘画做这件事，“实例规范化”部分来自于我们只需要一个输入图像和样式图像就可以做这件事。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lc"><img src="../Images/ba431884c1d5e4563804a902e28e720a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmXcBhFJkA4TZah1mjjzGA.png"/></div></div></figure><p id="03fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为特征地图统计决定了图像的风格，所以在我们解码照片的标准化和缩放编码后，我们将得到绘画风格的照片。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lc"><img src="../Images/da3e554dd5413e6f7e02d9c3850d9a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLrL69FZT5Bom3ha27DlgA.png"/></div></div></figure><h1 id="e193" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">网络教学</h1><p id="e8dd" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">下一个问题是:我们到底如何做到这一切？对于编码器，我们可以只使用别人为图像分类训练的模型(如AdaIn作者所做的)，而不改变它的功能(其权重)。但是解码器需要被训练来以不同的风格重建图像。</p><p id="e435" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们希望解码器做两件事。首先，解码器应该输出与目标样式匹配的图像。为此，我们比较了特征图统计数据:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ld"><img src="../Images/512b5c4ff5beffd7b6e80a87b3c68ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xv1-qbeu82fi8ojsXE6gzA.png"/></div></div></figure><p id="2afd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以用下面的函数来衡量解码器在数字上做得有多差:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es le"><img src="../Images/320883bb67bb5f006726a8bcdbde7983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ad19xLYeuY3so34jy1Fb3Q.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Out is the output image, Style is the style image, and stats computes the mean and variance for each feature map.</figcaption></figure><p id="9b42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">直观地说，这计算了输出样式离样式图像的样式有多远；如果目标样式非常平滑，则输出图像也应该非常平滑。</p><p id="9ac0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二，解码器应该输出与给定的输入特征图的内容相匹配的图像。为此，我们比较特征映射值(<em class="kw">而不是</em>统计值):</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ld"><img src="../Images/b38ccf5f46c283c5a0476cb223f4bd27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7glDLGj_OEvPMg6pKawVg.png"/></div></div></figure><p id="a300" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从数字上看，这是:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es le"><img src="../Images/a8bcfc80fa8feaa62db73a4c3479d07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LAR7CikLCldAJCTi6POaJg.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Input is the image we are trying to stylize</figcaption></figure><p id="9b32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">直观地说，这将计算输出要素地图与输入要素地图的距离。换句话说，汽车看起来应该还是汽车。</p><p id="97cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">实际上，我们不只是用编码器的输出来计算这些损失函数；我们也使用编码器的中间层。此外，为了平衡内容损失、样式损失以及哪些层更重要，我们引入了一些缩放因子λ。</p><p id="c98e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就引出了下面的损失函数:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es le"><img src="../Images/6b10e4c902154433e3a2a19daa9f738c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4AeZhVGP-20enp6gWqBBLQ.png"/></div></div></figure><p id="d7fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以用梯度下降来最小化这个损失函数。这超出了本文的范围，但我希望我们试图做的事情背后的想法是有意义的。</p><p id="f953" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">整个系统在训练期间看起来如下:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lj"><img src="../Images/27070c80be213908e750f66103f751f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXeXwSBJAnFsm13r7XQQnA.png"/></div></div></figure><p id="7bae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">概括一下，这是我们实际使用该系统时的情况:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lc"><img src="../Images/da3e554dd5413e6f7e02d9c3850d9a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLrL69FZT5Bom3ha27DlgA.png"/></div></div></figure><p id="b5d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">暂时就这样吧！我已经在编写模型方面取得了相当大的进展，所以请关注下一次更新。</p><p id="4790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kw">本帖镜像自</em> <a class="ae jc" href="https://antiprojects.com/adain/real-time-style-transfer-with-adain-explained" rel="noopener ugc nofollow" target="_blank"> <em class="kw">我的网站</em> </a> <em class="kw">。</em></p><p id="a93f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kw">范例风格图像从</em> <a class="ae jc" href="https://www.amazon.com/iCoostor-Numbers-Acrylic-Painting-Beginner/dp/B07N2V38XZ" rel="noopener ugc nofollow" target="_blank"> <em class="kw">这里的</em> </a> <em class="kw">。</em></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lk"><img src="../Images/0163a7a611c79c59970d5aef58d62d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Iph6WP-248U_RMtERir2g.png"/></div></div></figure></div></div>    
</body>
</html>