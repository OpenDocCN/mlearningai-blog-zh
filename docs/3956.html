<html>
<head>
<title>How To Sync Data Between Two Databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在两个数据库之间同步数据</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-sync-data-between-two-databases-27b9607937b1?source=collection_archive---------8-----------------------#2022-11-14">https://medium.com/mlearning-ai/how-to-sync-data-between-two-databases-27b9607937b1?source=collection_archive---------8-----------------------#2022-11-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="45a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们如何同步两个数据库，既复制所有初始数据，然后查找新的和更新的后续记录，并只对这些更改进行增量复制？</p><h1 id="f1f2" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">自动化(免费)解决方案</h1><p id="69fa" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><a class="ae kf" href="https://www.redactics.com/?utm_campaign=delta_database_syncs&amp;utm_medium=web&amp;utm_source=hashnode" rel="noopener ugc nofollow" target="_blank">redtics</a>将在你自己的基础设施上运行，开发者可以免费使用(我们正在开源我们以开发者为中心的产品)。这是一个纯SQL解决方案，非常轻量级。增量更新接近实时复制(并且轻量级足以处理激进的表操作并发)，并且足够快，对于许多用例来说，每隔几分钟左右运行一次。</p><h1 id="166b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">自制的解决方案</h1><p id="30d4" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">如果你想自己做这件事，这里有一个很好的方法:</p><ol class=""><li id="3466" class="kg kh hh ig b ih ii il im ip ki it kj ix kk jb kl km kn ko bi translated">确保您希望同步的每个表都有数字主键，就像大多数基于SQL的数据库一样(通常是自动递增的)。</li><li id="9128" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">然后，考虑到新主键的大小总是在增加，为了识别新行，您可以创建SQL查询来搜索主键值比您的最后一个主键大的记录。</li><li id="5cfa" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">对于更新，请确保您的主表有一个更新日期字段，该字段在每次更新记录时都会更新。然后，您可以使用SQL来搜索比您最近的更新更新的最后更新日期。如果您需要搜索比当前时间稍早的日期，这是没有问题的，因为对现有数据重新应用相同的更新通常没有坏处。</li><li id="9ae5" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">如果您想向目标数据库写入新数据，您需要一种策略来防止主键冲突。我们喜欢的一种方法是创建一个类似于<code class="du ku kv kw kx b">source_primary_key</code>的新列，使用上述两种方法生成CSV(没有标题)(一个CSV用于新行，一个CSV用于更新)，然后将这个CSV通过管道传输到awk以删除主键列，并将其值移动到source_primary_key列。例如，如果主键列是第一列，source_primary_key是第五列:<code class="du ku kv kw kx b">cat /path/to/csv.csv | gawk -vOFS=, -F "," "{print $2,$3,$4,$5,$1}" | [your SQL client]</code>。我们发现<a class="ae kf" href="https://github.com/dbro/csvquote" rel="noopener ugc nofollow" target="_blank">这个库</a>对于处理包含引号的数据是必要的。</li><li id="e5c5" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">对于行删除，我们通常建议软删除记录，这将被视为更新，因为将<code class="du ku kv kw kx b">disabled</code>字段的值设置为true也会更新该行的上次更新日期。</li></ol><p id="f1de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请让我知道，如果你有任何方法的运气！</p><div class="ky kz ez fb la lb"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hi fi z dy lg ea eb lh ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp lq lb"/></div></div></a></div></div></div>    
</body>
</html>