<html>
<head>
<title>Drowsiness Detection using cv2 in Python — interesting project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的cv2进行睡意检测——有趣的项目</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/drowsiness-detection-using-cv2-in-python-interesting-project-623a6a3b4393?source=collection_archive---------3-----------------------#2022-10-12">https://medium.com/mlearning-ai/drowsiness-detection-using-cv2-in-python-interesting-project-623a6a3b4393?source=collection_archive---------3-----------------------#2022-10-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8b79f63e948f3992b587966ffd3e822a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5zRY3G0joPevwXsUU2_UA.png"/></div></div></figure><p id="0b88" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">嘿，在这个博客中，我们将建立一个<strong class="ir hi">睡意检测</strong>应用程序，它将检测视频中的人是否变得昏昏欲睡。</p><p id="4e50" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个非常<strong class="ir hi">有趣而简单的项目</strong>，甚至不到80行代码，所以没有任何进一步的原因，让我们做吧…</p><p id="4ce4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">【https://machinelearningprojects.net/drowsiness-detection/】点击此处阅读完整博客—<a class="ae jn" href="https://machinelearningprojects.net/drowsiness-detection/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi"/></a></p><p id="dce7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">点击此处查看视频—<a class="ae jn" href="https://youtu.be/lq096rDZB9Y" rel="noopener ugc nofollow" target="_blank">https://youtu.be/lq096rDZB9Y</a></p><h1 id="e1dd" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">偷偷看我们的输出</h1><p id="4202" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><strong class="ir hi">注意——你在这里听不到警报声，因为它是GIF格式的，你可以看看我博客上的视频</strong><a class="ae jn" href="https://machinelearningprojects.net/drowsiness-detection/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">https://machinelearningprojects.net/drowsiness-detection/</strong></a></p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es kr"><img src="../Images/183e80c202b8b3a03cd772fdce273eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*yYjk2n660aNc9Hok7vAwfw.gif"/></div></figure><h1 id="76c2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">睡意检测代码</h1><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f033" class="lb jp hh kx b fi lc ld l le lf">from imutils import face_utils<br/>import dlib<br/>import cv2<br/>from pygame import mixer</span><span id="35d3" class="lb jp hh kx b fi lg ld l le lf">thres = 6</span><span id="a681" class="lb jp hh kx b fi lg ld l le lf">mixer.init()<br/>sound = mixer.Sound('alarm.wav')</span><span id="d6df" class="lb jp hh kx b fi lg ld l le lf">dlist = []</span><span id="64b6" class="lb jp hh kx b fi lg ld l le lf">detector = dlib.get_frontal_face_detector()<br/>predictor = dlib.shape_predictor("shape_predictor_68_face_landmarks.dat")</span><span id="516c" class="lb jp hh kx b fi lg ld l le lf">cap = cv2.VideoCapture(0)</span><span id="c516" class="lb jp hh kx b fi lg ld l le lf">def dist(a,b):<br/>    x1,y1 = a<br/>    x2,y2 = b<br/>    return ((x1-x2)**2 + (y1-y2)**2)**0.5<br/> <br/>while True:<br/>    # Getting out image by webcam <br/>    _, image = cap.read()<br/>    # Converting the image to gray scale<br/>    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)<br/>        <br/>    # Get faces into webcam's image<br/>    rects = detector(gray, 0)<br/>    <br/>    # For each detected face, find the landmark.<br/>    for (i, rect) in enumerate(rects):<br/>        # Make the prediction and transfom it to numpy array<br/>        shape = predictor(gray, rect)<br/>        shape = face_utils.shape_to_np(shape)<br/>    <br/>        # Draw on our image, all the finded cordinate points (x,y) <br/>        for (x, y) in shape:<br/>            cv2.circle(image, (x, y), 2, (0, 255, 0), -1)<br/>        <br/>        le_38 = shape[37]<br/>        le_39 = shape[38]<br/>        le_41 = shape[40]<br/>        le_42 = shape[41]</span><span id="fb0e" class="lb jp hh kx b fi lg ld l le lf">        re_44 = shape[43]<br/>        re_45 = shape[44]<br/>        re_47 = shape[46]<br/>        re_48 = shape[47]<br/>        </span><span id="732a" class="lb jp hh kx b fi lg ld l le lf">        dlist.append((dist(le_38,le_42)+dist(le_39,le_41)+dist(re_44,re_48)+dist(re_45,re_47))/4&lt;thres)<br/>        if len(dlist)&gt;10:dlist.pop(0)</span><span id="e64b" class="lb jp hh kx b fi lg ld l le lf">        # Drowsiness detected<br/>        if sum(dlist)&gt;=4:<br/>            try:<br/>                sound.play()<br/>            except:<br/>                pass<br/>        else:<br/>            try:<br/>                sound.stop()<br/>            except:<br/>                pass<br/>        <br/>    # Show the image<br/>    cv2.imshow("Output", image)<br/>    <br/>    if cv2.waitKey(5) &amp; 0xFF == 27:<br/>        break</span><span id="209f" class="lb jp hh kx b fi lg ld l le lf">cv2.destroyAllWindows()<br/>cap.release()</span></pre><ul class=""><li id="05ea" class="lh li hh ir b is it iw ix ja lj je lk ji ll jm lm ln lo lp bi translated">第1–4行:导入所需的库。</li><li id="8a04" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第6行:<strong class="ir hi">设置一个阈值</strong>(将在前面的代码中看到)。</li><li id="2532" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第8–9行:<strong class="ir hi">使用pygame模块</strong>创建闹钟声音，以便在应用程序中进一步使用。</li><li id="8fb4" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第11行:我们将在前面使用的空列表。</li><li id="5710" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第13行:使用<strong class="ir hi"> dlib人脸检测器</strong>。</li><li id="1b1e" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第14行:使用<strong class="ir hi"> dlib地标检测器检测眼点</strong>。</li><li id="48d9" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第16行:<strong class="ir hi">初始化cap对象稍后使用网络摄像头</strong>。</li><li id="d893" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第18–21行:一个简单的距离函数<strong class="ir hi">，它计算两个坐标之间的距离</strong>。</li><li id="c6ce" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第25行:从网络摄像头读取图像。</li><li id="8ccd" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第27行:<strong class="ir hi">转换成灰度</strong>。</li><li id="473f" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第30行:检测人脸。</li><li id="8ed9" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第33行:开始遍历这些面。</li><li id="2d28" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">Lin 35–36:<strong class="ir hi">获取68个人脸标志，并将其转换为NumPy数组</strong>。</li><li id="06b1" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第39–40行:画出所有的地标。</li><li id="995e" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第42–50行:提取所需的眼睛标志。</li><li id="517d" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">对于左眼，我们将提取<strong class="ir hi"> 38、39、42和41 </strong>。</li><li id="4bf4" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">对于右眼，我们将提取<strong class="ir hi"> 44、45、48和47 </strong>。</li><li id="dc24" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated"><em class="lv">在阅读下一步之前，先阅读下面的算法。</em></li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/b7bda51805e531b03ebeca3a2857c498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KPX7rz8ev2B8Jxgo.jpg"/></div></div></figure><ul class=""><li id="8a22" class="lh li hh ir b is it iw ix ja lj je lk ji ll jm lm ln lo lp bi translated">第54行:<strong class="ir hi">该行负责保持dlist=10 </strong>的大小。</li><li id="c299" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">删除从前面开始，添加在最后完成。</li><li id="fb8f" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">这就像一个排队系统。</li><li id="6100" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第57–66行:<strong class="ir hi">当列表</strong>中至少有4个Trues时，播放警报。当他们少于4时停止。</li><li id="3729" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第69行—显示图像。</li><li id="45c8" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第71–72行:当用户点击<strong class="ir hi"> ESC </strong>键时停止应用程序。</li><li id="8f8e" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第74–75行:<strong class="ir hi">关闭所有cv2窗口并释放网络摄像头</strong>。</li></ul><h1 id="1649" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">用于检测睡意的算法:</h1><ul class=""><li id="5996" class="lh li hh ir b is km iw kn ja lx je ly ji lz jm lm ln lo lp bi translated"><strong class="ir hi">找出38–42、39–41、44–48和45–47地标之间的距离，并找出这四个地标的平均值。</strong></li><li id="94aa" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated"><strong class="ir hi">如果这个平均值大于我们最初定义的阈值，在我们的dlist中追加/添加一个True。</strong></li><li id="34a1" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated"><strong class="ir hi">如果我们的dlist包含4个或更多的Trues，这意味着在连续4帧中，检测到睡意，因此播放警报。</strong></li><li id="90e8" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">我们保留了4或更多的概念，因为如果我们不这样做，我们的程序将会发出警报，即使我们眨眼也是假阳性。</li></ul><h1 id="eea9" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">输出</h1><p id="8410" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><strong class="ir hi">注意——你不会在这里听到警报声，因为它是GIF格式的，你可以查看我博客上的视频</strong><a class="ae jn" href="https://machinelearningprojects.net/drowsiness-detection/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">https://machinelearningprojects.net/drowsiness-detection/</strong></a></p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es kr"><img src="../Images/183e80c202b8b3a03cd772fdce273eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*yYjk2n660aNc9Hok7vAwfw.gif"/></div></figure><h1 id="353a" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">要下载源代码，请访问我的博客—<a class="ae jn" href="https://machinelearningprojects.net/drowsiness-detection/" rel="noopener ugc nofollow" target="_blank">https://machinelearningprojects.net/drowsiness-detection/</a></h1><h1 id="164f" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">执行睡意检测的其他想法:</h1><ul class=""><li id="3265" class="lh li hh ir b is km iw kn ja lx je ly ji lz jm lm ln lo lp bi translated">一种方法是我们上面执行的。</li><li id="de90" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第二种方式可以是<strong class="ir hi">在面部图像上训练神经网络</strong>。</li><li id="37fc" class="lh li hh ir b is lq iw lr ja ls je lt ji lu jm lm ln lo lp bi translated">第三种方式可以是<strong class="ir hi">在眼睛图像上训练神经网络</strong>。</li></ul><p id="1f61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是你如何使用cv2 和dlib在python中执行<strong class="ir hi">睡意检测。</strong></p><p id="2a48" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">查看我的其他</strong> <a class="ae jn" href="https://machinelearningprojects.net/machine-learning-projects/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi">机器学习项目</strong></a><strong class="ir hi"/><a class="ae jn" href="https://machinelearningprojects.net/deep-learning-projects/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">深度学习项目</strong></a><strong class="ir hi"/><a class="ae jn" href="https://machinelearningprojects.net/opencv-projects/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">计算机视觉项目</strong></a><strong class="ir hi"/><a class="ae jn" href="https://machinelearningprojects.net/nlp-projects/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">NLP项目</strong> </a> <strong class="ir hi">，以及</strong> <a class="ae jn" href="https://machinelearningprojects.net/flask-projects/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi">烧瓶项目</strong> </a> <strong class="ir hi"/></p><h2 id="812a" class="lb jp hh bd jq ma mb mc ju md me mf jy ja mg mh kc je mi mj kg ji mk ml kk mm bi translated"><a class="ae jn" href="https://mlearning.substack.com/about" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">成为MLearning.ai </strong>的作家T3】</a></h2><div class="mn mo ez fb mp mq"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hi fi z dy mv ea eb mw ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne in mq"/></div></div></a></div></div></div>    
</body>
</html>