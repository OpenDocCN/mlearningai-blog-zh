<html>
<head>
<title>A pain killer for managing ML lifecycle. Part-1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理ML生命周期的止痛药。第一部分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/a-pain-killer-for-managing-ml-lifecycle-part-1-70adb7c19c3a?source=collection_archive---------7-----------------------#2022-08-02">https://medium.com/mlearning-ai/a-pain-killer-for-managing-ml-lifecycle-part-1-70adb7c19c3a?source=collection_archive---------7-----------------------#2022-08-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a8b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将了解mlflow及其组件之一——跟踪。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/5c55b04c1e0c620e8bf61a64a2c16aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pLeSROIk7pgRSc1Y"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@fatosi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fatos Bytyqi</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="jt ju jv"><p id="9f73" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated">自动化的目标不是让人们失去工作，而是让所有普通的费力的任务自动化，这样我们人类就可以做创造性的工作。</p></blockquote></div><div class="ab cl ka kb go kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ha hb hc hd he"><h1 id="7dcb" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">介绍</h1><p id="7d5f" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi lk translated">机器学习(ML)开发带来了许多超越传统软件开发生命周期的新的复杂性。与传统的软件开发不同，ML工程师希望尝试多种算法、工具和参数来获得最佳结果，他们需要跟踪这些信息来重现工作。此外，ML工程师需要使用许多不同的系统来生产模型。</p><h1 id="a15c" class="kh ki hh bd kj kk lt km kn ko lu kq kr ks lv ku kv kw lw ky kz la lx lc ld le bi translated">关于读者</h1><p id="11bd" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">面向熟悉机器学习算法基础和在生产中运行机器学习应用的数据科学家和软件/机器学习工程师。读者应该熟悉Bash、Python和一些面向对象编程的基础知识，这将有助于更好地掌握代码。</p><h1 id="f4c9" class="kh ki hh bd kj kk lt km kn ko lu kq kr ks lv ku kv kw lw ky kz la lx lc ld le bi translated">MLflow之旅</h1><h2 id="f23c" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated"><strong class="ak">什么是MLflow？</strong></h2><p id="fa77" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">MLflow是一个管理端到端机器学习生命周期的开源平台。它提供了四个主要功能——跟踪、项目、模型和模型注册。我们将在后面的章节中了解每个组件。</p><h2 id="5fbc" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">为什么是MLflow？</h2><p id="fd1a" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">MLflow与库无关。你可以用任何机器学习库和任何编程语言来使用它，因为所有的函数都可以通过<a class="ae js" href="https://mlflow.org/docs/latest/rest-api.html#rest-api" rel="noopener ugc nofollow" target="_blank"> REST API </a>和<a class="ae js" href="https://mlflow.org/docs/latest/cli.html#cli" rel="noopener ugc nofollow" target="_blank"> CLI </a>来访问。</p><p id="6025" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">MLflow内置了与大多数著名的、大量使用的机器学习库的集成。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mm"><img src="../Images/ccc70822f9aa63baea7842f1faeb2f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogQDemTneluobrxNsg-Dgw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Source: from mlflow.org</figcaption></figure><h2 id="eb27" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">MLflow的组件:</h2><ol class=""><li id="995d" class="mn mo hh ig b ih lf il lg ip mp it mq ix mr jb ms mt mu mv bi translated">跟踪—实验跟踪(记录和查询)</li><li id="df4c" class="mn mo hh ig b ih mw il mx ip my it mz ix na jb ms mt mu mv bi translated">项目—可重复运行(打包格式可在任何平台上运行)</li><li id="2577" class="mn mo hh ig b ih mw il mx ip my it mz ix na jb ms mt mu mv bi translated">模型—打包模型(格式支持各种部署工具)</li><li id="3849" class="mn mo hh ig b ih mw il mx ip my it mz ix na jb ms mt mu mv bi translated">注册表—用于存储、注释、发现和管理的中央存储库。</li></ol><h2 id="5fc7" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">MLflow跟踪:跟踪实验/运行</h2><p id="8af3" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">MLflow跟踪组件是一个API和UI，用于在运行机器学习代码时记录参数、代码版本、指标和输出文件，并在以后可视化结果。MLflow Tracking允许您使用<a class="ae js" href="https://mlflow.org/docs/latest/python_api/index.html#python-api" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae js" href="https://mlflow.org/docs/latest/rest-api.html#rest-api" rel="noopener ugc nofollow" target="_blank"> REST </a>、<a class="ae js" href="https://mlflow.org/docs/latest/R-api.html#r-api" rel="noopener ugc nofollow" target="_blank"> R API </a>和<a class="ae js" href="https://mlflow.org/docs/latest/java_api/index.html#java-api" rel="noopener ugc nofollow" target="_blank">Java API</a>API来记录和查询实验。</p><p id="2e02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本练习中，我们将使用(Tensorflow) Keras模型，该模型使用MNIST数据集进行模型训练。</p><p id="2650" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个简单的场景中，MLflow客户端使用以下接口来记录MLflow实体和工件:</p><ul class=""><li id="e90b" class="mn mo hh ig b ih ii il im ip nb it nc ix nd jb ne mt mu mv bi translated">一个<strong class="ig hi">localaartifactrepository</strong>的实例(用来存储工件)</li><li id="d389" class="mn mo hh ig b ih mw il mx ip my it mz ix na jb ne mt mu mv bi translated">一个<strong class="ig hi">文件存储</strong>的实例(用于保存MLflow实体)</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nf"><img src="../Images/f620687fd2e30838f0b095f1cf9ef03c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YppPKsYR6C4VgmaBZmvHbw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Image sourced from mlflow.org</figcaption></figure><p id="7ff3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">项目结构:</strong></p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="3b6f" class="ly ki hh nh b fi nl nm l nn no">- src  <br/>    - train.py        # model training code<br/>    - utils.py        # utility functions<br/>- requirements.txt<br/>- Makefile<br/>- README.md</span></pre><p id="8a6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个结构可以在<a class="ae js" href="https://github.com/venkatkollimarla/tf-keras-with-mlflow" rel="noopener ugc nofollow" target="_blank"> github仓库中看到。</a></p><p id="7fd0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们先来看看train.py，了解一下mlflow是怎么回事</p><p id="eb5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们从记录包的版本开始:</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="fb47" class="ly ki hh nh b fi nl nm l nn no">print(" Versions:")    <br/>print(" MLflow Version:", mlflow.__version__)    <br/>print(" TensorFlow version:", tf.__version__)    <br/>print(" Keras version:", keras.__version__)    <br/>print(" Python Version:", platform.python_version())    <br/>print(" Operating System:",platform.system()+"-"+platform.release())    <br/>print(" Tracking URI:", mlflow.tracking.get_tracking_uri())</span></pre><p id="42e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们调用main()函数，该函数从命令行接受选项，并调用其他函数来执行模型训练:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="np nq l"/></div></figure><p id="7d43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，我们在运行培训文件时记录从命令行收到的选项，为了处理命令行参数/选项，我们使用了一个名为<a class="ae js" href="https://pypi.org/project/click/" rel="noopener ugc nofollow" target="_blank">的python包，单击</a>。</p><p id="410d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们为我们使用的每一种包设置了自动日志。MLflow有自己的ML库风格，这里我们使用keras，tensorflow来做这个练习。</p><p id="c796" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以设置一个实验，使用:</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="347d" class="ly ki hh nh b fi nl nm l nn no">mlflow.set_experiment("Keras_TF_MLflow")</span></pre><p id="e423" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将给定的实验设置为活动实验。实验必须通过实验名称指定名称，或者通过实验id指定ID。实验名称和ID <em class="jw">不能同时指定</em>。</p><p id="70fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">什么是跑步？</p><p id="ab4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Run是项目中的一段代码。可以将运行记录到本地文件、数据库或跟踪服务器(远程)。要远程记录运行，我们需要设置URI(例如:<strong class="ig hi"> MLFLOW_TRACKING_URI </strong>环境变量或通过API<strong class="ig hi">ml flow . set _ TRACKING _ uri()</strong>)到跟踪服务器的URI或调用。</p><h2 id="dd05" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated"><strong class="ak">每次运行记录以下信息:</strong></h2><blockquote class="jt ju jv"><p id="ab72" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi">开始&amp;结束时间:</strong>运行的开始和结束时间</p><p id="d3ea" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi">神器</strong>它是任何格式的输出文件。我们可以制作图像、模型和数据文件作为人工制品。</p><p id="adec" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi">代码版本:</strong>用于运行的Git提交散列。</p><p id="a2fa" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi">度量</strong>是键-值对(键:度量，值:数值)。运行更新这些指标和MLflow记录，并可视化指标历史记录。</p><p id="aeed" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi">参数</strong>这些是您选择的变量和跟踪信息的键值对。</p><p id="3ab3" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><strong class="ig hi"> Source: </strong>启动运行的文件名，或项目名</p></blockquote><p id="181d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以从MLflow python API开始实验:</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="d8f4" class="ly ki hh nh b fi nl nm l nn no"># start mlflow experiment<br/>with mlflow.start_run() as run:<br/>    print("MLflow:")<br/>    print("run_id:",run.info.run_id)<br/>    print("experiment_id:",run.info.experiment_id)</span></pre><p id="71b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于每次运行/实验，MLflow都会生成一个名为run_id的唯一id。</p><p id="ef10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在当前运行下设置标记:标记使您能够以不同的方式对MLflow运行进行分类，例如，通过版本、环境或任何有用的附加信息。</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="1878" class="ly ki hh nh b fi nl nm l nn no">mlflow.set_tag("version.mlflow", mlflow.__version__)<br/>mlflow.set_tag("version.keras", keras.__version__)<br/>mlflow.set_tag("version.tensorflow", tf.__version__)</span></pre><p id="e487" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，调用train()函数:模型训练代码</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="ef73" class="ly ki hh nh b fi nl nm l nn no">train(run, model_name, data_path, epochs, batch_size, mlflow_custom_log)</span></pre><p id="14c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在训练代码中，我们记录参数、工件和度量。</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="96cf" class="ly ki hh nh b fi nl nm l nn no"># logging parameters<br/>mlflow.log_param("epochs", epochs)</span><span id="6283" class="ly ki hh nh b fi nr nm l nn no"># log metrics<br/>mlflow.log_metric("test_acc", test_acc)<br/>mlflow.log_metric("test_loss", test_loss)</span><span id="f288" class="ly ki hh nh b fi nr nm l nn no"># logging artifacts<br/># write model as json file<br/>with open("model.json", "w") as f:<br/>    f.write(model.to_json())<br/>mlflow.log_artifact("model.json")</span></pre><p id="8456" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">MLflow的美妙之处在于可以通过python API访问所有自动记录的信息，例如，我们可以获取结束运行时自动记录的参数和指标。</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="66ea" class="ly ki hh nh b fi nl nm l nn no">tags = {k: v for k, v in run.data.tags.items() if not k.startswith("mlflow.")}</span><span id="96c4" class="ly ki hh nh b fi nr nm l nn no">artifacts = [f.path for f in MlflowClient().list_artifacts(run.info.run_id, "model")]</span><span id="cd6c" class="ly ki hh nh b fi nr nm l nn no">print("run_id: {}".format(run.info.run_id))</span><span id="14a7" class="ly ki hh nh b fi nr nm l nn no">print("artifacts: {}".format(artifacts))</span><span id="010d" class="ly ki hh nh b fi nr nm l nn no">print("params: {}".format(run.data.params))</span><span id="429f" class="ly ki hh nh b fi nr nm l nn no">print("metrics: {}".format(run.data.metrics))</span><span id="8b69" class="ly ki hh nh b fi nr nm l nn no">print("tags: {}".format(tags))</span></pre><h2 id="eebb" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">自动记录信息的输出:</h2><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="68a3" class="ly ki hh nh b fi nl nm l nn no"><strong class="nh hi">run_id</strong>: 438ff1601184438d83fd7257f7ebaad7</span><span id="35be" class="ly ki hh nh b fi nr nm l nn no"><strong class="nh hi">artifacts</strong>: ['model/MLmodel', 'model/conda.yaml', 'model/data', 'model/python_env.yaml', 'model/requirements.txt']</span><span id="0748" class="ly ki hh nh b fi nr nm l nn no"><strong class="nh hi">params</strong>: {'shuffle': 'True', 'initial_epoch': '0', 'validation_split': '0.0', 'opt_name': 'RMSprop', 'opt_rho': '0.9', 'use_multiprocessing': 'False', 'opt_decay': '0.0', 'opt_momentum': '0.0', 'opt_centered': 'False', 'epochs': '15', 'validation_steps': 'None', 'opt_epsilon': '1e-07', 'batch_size': '128', 'sample_weight': 'None', 'class_weight': 'None', 'workers': '1', 'opt_learning_rate': '0.001', 'max_queue_size': '10', 'validation_freq': '1', 'steps_per_epoch': 'None', 'validation_batch_size': 'None'}</span><span id="e491" class="ly ki hh nh b fi nr nm l nn no"><strong class="nh hi">metrics</strong>: {'loss': 0.0031751864589750767, 'test_acc': 0.9819999933242798, 'test_loss': 0.08936446905136108, 'accuracy': 0.9991833567619324}</span><span id="5dec" class="ly ki hh nh b fi nr nm l nn no"><strong class="nh hi">tags</strong>: {'mlflow_custom_log': 'True', 'mlflow_autolog': 'True', 'version.mlflow': '1.27.0', 'version.tensorflow': '2.9.1', 'keras_autolog': 'True', 'version.keras': '2.9.0', 'tensorflow_autolog': 'False'}</span></pre><p id="fe86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您通过<code class="du ns nt nu nh b">python train.py</code>运行train.py时，您应该会看到如下所示的输出:</p><pre class="jd je jf jg fd ng nh ni nj aw nk bi"><span id="a543" class="ly ki hh nh b fi nl nm l nn no">Versions:<br/>  MLflow Version: 1.27.0<br/>  TensorFlow version: 2.9.1<br/>  Keras version: 2.9.0<br/>  Python Version: 3.9.12<br/>  Operating System: Linux - 5.15.0-41-generic<br/>  Tracking URI: file:///home/user/Documents/mlflow/tf-keras-with-mlflow/mlruns<br/>Options:<br/>  experiment_name: None<br/>  model_name: None<br/>  data_path: None<br/>  epochs: 5<br/>  batch_size: 128<br/>  mlflow_autolog: False<br/>  keras_autolog: False<br/>  tensorflow_autolog: False<br/>  mlflow_custom_log: True<br/>MLflow:<br/>  run_id: 09eacfb5b55b4b5c80d04a5ad8df9202<br/>  experiment_id: 0<br/>Data:<br/>  x_train.shape: (60000, 28, 28)<br/>  y_train.shape: (60000,)<br/>  x_test.shape: (10000, 28, 28)<br/>  y_test.shape: (10000,)<br/>Data after reshape:<br/>  x_train.shape: (60000, 784)<br/>  y_train.shape: (60000, 10)<br/>  x_test.shape: (10000, 784)<br/>  y_test.shape: (10000, 10)<br/>2022-07-31 15:03:07.332176: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.332385: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.348190: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.348375: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.348546: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.348706: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.349508: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA<br/>To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.<br/>2022-07-31 15:03:07.488034: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.488245: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.488431: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.488602: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.488772: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.488939: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977196: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977385: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977514: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977634: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977751: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.977871: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1532] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 6111 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 3070 Ti, pci bus id: 0000:2d:00.0, compute capability: 8.6<br/>2022-07-31 15:03:07.986639: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2022-07-31 15:03:07.986787: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1532] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 4557 MB memory:  -&gt; device: 1, name: NVIDIA GeForce RTX 3070 Ti, pci bus id: 0000:2e:00.0, compute capability: 8.6<br/>Model: "sequential"<br/>_________________________________________________________________<br/> Layer (type)                Output Shape              Param #   <br/>=================================================================<br/> dense (Dense)               (None, 512)               401920    <br/>                                                                 <br/> dense_1 (Dense)             (None, 10)                5130      <br/>                                                                 <br/>=================================================================<br/>Total params: 407,050<br/>Trainable params: 407,050<br/>Non-trainable params: 0<br/>_________________________________________________________________<br/>Epoch 1/5<br/>2022-07-31 15:03:09.168737: I tensorflow/stream_executor/cuda/cuda_blas.cc:1786] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.<br/>469/469 [==============================] - 1s 1ms/step - loss: 0.2549 - accuracy: 0.9264<br/>Epoch 2/5<br/>469/469 [==============================] - 1s 1ms/step - loss: 0.1036 - accuracy: 0.9700<br/>Epoch 3/5<br/>469/469 [==============================] - 1s 1ms/step - loss: 0.0682 - accuracy: 0.9793<br/>Epoch 4/5<br/>469/469 [==============================] - 1s 1ms/step - loss: 0.0497 - accuracy: 0.9851<br/>Epoch 5/5<br/>469/469 [==============================] - 1s 1ms/step - loss: 0.0373 - accuracy: 0.9889<br/>model.type: &lt;class 'keras.engine.sequential.Sequential'&gt;<br/>313/313 [==============================] - 0s 959us/step - loss: 0.0702 - accuracy: 0.9782</span><span id="dd48" class="ly ki hh nh b fi nr nm l nn no">test_acc: 0.9782000184059143<br/>test_loss: 0.07024893909692764</span><span id="d759" class="ly ki hh nh b fi nr nm l nn no">313/313 [==============================] - 0s 736us/step</span><span id="4e09" class="ly ki hh nh b fi nr nm l nn no">predictions: <br/>[[3.1528469e-10 1.1598875e-10 3.0181579e-06 ... 9.9999166e-01<br/>  5.4656804e-09 6.9436197e-08]<br/> [2.1681883e-10 6.6627585e-08 9.9999988e-01 ... 8.6149736e-18<br/>  3.7009340e-09 6.4560381e-17]<br/> [3.4180054e-08 9.9791569e-01 1.2183580e-04 ... 7.6266791e-04<br/>  1.1498076e-03 2.7741667e-06]<br/> ...<br/> [3.5684854e-12 1.1527137e-09 2.4483357e-10 ... 1.7940902e-05<br/>  1.3565266e-05 3.1980551e-05]<br/> [1.9024797e-11 3.4837304e-12 3.3940390e-12 ... 8.4827475e-12<br/>  1.7171697e-05 1.2332011e-12]<br/> [2.7282201e-10 4.8090130e-15 3.1331862e-10 ... 1.3495739e-16<br/>  2.8885052e-12 4.3286051e-13]]</span><span id="87bc" class="ly ki hh nh b fi nr nm l nn no">run_id: 438ff1601184438d83fd7257f7ebaad7<br/>artifacts: ['model/MLmodel', 'model/conda.yaml', 'model/data', 'model/python_env.yaml', 'model/requirements.txt']<br/>params: {'shuffle': 'True', 'initial_epoch': '0', 'validation_split': '0.0', 'opt_name': 'RMSprop', 'opt_rho': '0.9', 'use_multiprocessing': 'False', 'opt_decay': '0.0', 'opt_momentum': '0.0', 'opt_centered': 'False', 'epochs': '15', 'validation_steps': 'None', 'opt_epsilon': '1e-07', 'batch_size': '128', 'sample_weight': 'None', 'class_weight': 'None', 'workers': '1', 'opt_learning_rate': '0.001', 'max_queue_size': '10', 'validation_freq': '1', 'steps_per_epoch': 'None', 'validation_batch_size': 'None'}<br/>metrics: {'loss': 0.0031751864589750767, 'test_acc': 0.9819999933242798, 'test_loss': 0.08936446905136108, 'accuracy': 0.9991833567619324}<br/>tags: {'mlflow_custom_log': 'True', 'mlflow_autolog': 'True', 'version.mlflow': '1.27.0', 'version.tensorflow': '2.9.1', 'keras_autolog': 'True', 'version.keras': '2.9.0', 'tensorflow_autolog': 'False'}</span></pre><h2 id="caaf" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">使用MLflow用户界面(UI)</h2><p id="a568" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">在终端中运行命令<code class="du ns nt nu nh b">mlflow ui</code></p><blockquote class="jt ju jv"><p id="df04" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated">如果mlflow跟踪ui未启动，请尝试其他端口，因为使用的默认端口是5000，它也可能被其他进程使用。</p><p id="f726" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated"><code class="du ns nt nu nh b"><strong class="ig hi">mlflow ui --port 5001 --host 0.0.0.0</strong></code></p></blockquote><p id="df8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在浏览器中导航至:<a class="ae js" href="http://0.0.0.0:5001" rel="noopener ugc nofollow" target="_blank"> http://0.0.0.0:5001 </a></p><p id="8337" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将看到类似于以下内容的UI启动:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nv"><img src="../Images/8aa6922506b154bb7e17e81e8e3cbb24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8PiHP1XB8A9jNVzSQOWwiw.png"/></div></div></figure><p id="0ad4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每次运行都将显示为一个新行，带有运行时间戳。通过点击日期，您可以查看所有的指标、参数和工件。您可以在<code class="du ns nt nu nh b">csv</code>中下载跟踪数据。</p><p id="b4aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过选择运行并单击compare，我们可以看到每次运行的执行情况。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nw"><img src="../Images/eaf6e2615303c1f09cf7a9b8d6c4222f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ou8GuCXN5qCsAjUS1HT7pQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Comparing multiple runs of an experiment</figcaption></figure><h2 id="7165" class="ly ki hh bd kj lz ma mb kn mc md me kr ip mf mg kv it mh mi kz ix mj mk ld ml bi translated">人们可能想要探索的事情:</h2><ol class=""><li id="7bc4" class="mn mo hh ig b ih lf il lg ip mp it mq ix mr jb ms mt mu mv bi translated">在远程服务器中存储跟踪方面</li><li id="fe68" class="mn mo hh ig b ih mw il mx ip my it mz ix na jb ms mt mu mv bi translated">查询以编程方式运行</li></ol><h1 id="8657" class="kh ki hh bd kj kk lt km kn ko lu kq kr ks lv ku kv kw lw ky kz la lx lc ld le bi translated">关闭</h1><p id="e910" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">在本文中，我们看到了MLflow跟踪功能如何帮助我们自动运行模型训练来捕获各种训练方面，以及我们如何通过内置的UI访问所有自动记录的信息并比较多次运行。</p><p id="adcf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们的下一篇文章中，我们将讨论MLflow项目组件，以及它如何帮助我们以可重用和可复制的方式打包数据科学代码。</p><div class="nx ny ez fb nz oa"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ob ab dw"><div class="oc ab od cl cj oe"><h2 class="bd hi fi z dy of ea eb og ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="oh l"><h3 class="bd b fi z dy of ea eb og ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="oi l"><p class="bd b fp z dy of ea eb og ed ef dx translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo jm oa"/></div></div></a></div></div></div>    
</body>
</html>