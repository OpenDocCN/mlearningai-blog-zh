<html>
<head>
<title>How to deploy ML Model to Cloud and integrate with Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将ML模型部署到云并与Tableau集成</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-deploy-ml-model-to-cloud-and-integrate-with-tableau-54aae634930e?source=collection_archive---------3-----------------------#2022-10-03">https://medium.com/mlearning-ai/how-to-deploy-ml-model-to-cloud-and-integrate-with-tableau-54aae634930e?source=collection_archive---------3-----------------------#2022-10-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7a44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发机器学习模型的整个想法是让目标受众可以使用它。假设您已经训练了一个预测模型并构建了数据管道来转换输入要素。用户需要做的就是用输入值调用模型并接收预测值。我们如何实现这一点？这无需大量编程和昂贵的基础设施即可实现。该模型可以部署在服务器或云上，以便可以通过您的公司网络或web访问它。对于这个演示，我们将把它部署到AWS EC2，并将我们的Tableau仪表板链接到它。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/b436d36de8c48df4165e4dfe92dc20fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PW4uxVWK9igYT8WYYRnZhg.png"/></div></div></figure><p id="6b09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">云提供商通过允许人们部署和运行他们的应用程序，使技术世界民主化</p><ul class=""><li id="918f" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">无需购买和管理硬件</li><li id="539c" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">通过GUI轻松设置</li><li id="f950" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">几分钟内完成安装和拆卸</li><li id="d8fa" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">只为您使用的东西付费</li></ul><p id="d517" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将了解如何在<strong class="ig hi"> AWS EC2 </strong>上部署我们预测住院机会的模型，并从<strong class="ig hi"> Tableau仪表板</strong>访问该模型，以便用户可以选择输入值，预测的百分比值将显示在屏幕上。</p><p id="db3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Tableau允许使用Tabpy访问API的<strong class="ig hi">分析扩展</strong>。<strong class="ig hi"> Tabpy </strong>是由Tableau开发管理的python包。我们将使用tabpy包来集成Tableau dashboard和使用python开发的机器学习模型。请注意，分析扩展仅在<strong class="ig hi"> Tableau桌面</strong>和<strong class="ig hi"> Tableau云</strong>上可用。它不适用于发布到Tableau Public的仪表板。</p><p id="a74f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">简而言之，我们的架构将是这样的:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kc"><img src="../Images/2bb6182958ae48e7ba8e8ec21ae65e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rU0QeOWZDlV7dKF2.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 1: Architecture for ML implementation</figcaption></figure><h1 id="b143" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">设置AWS EC2例程</h1><p id="00e9" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">使用基本配置在AWS EC2上设置一个实例是免费的，但是2GB内存对于tabpy实例来说可能不够用。使用<strong class="ig hi"> t2.medium </strong>有更好的可用性。它配有4GB内存和中低网络性能。此外，ubuntu对于操作系统来说也是一个不错的选择。</p><p id="0f7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于如何设置AWS EC2实例的详细步骤，请参考<a class="ae lk" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS C2/latest/user guide/EC2 _ get started . html</a>。</p><p id="5601" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">记下密钥对名称和公共IPv4 DNS，并保存密钥对，这是后续步骤所必需的。</p><h1 id="b6ad" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">设置服务器</h1><p id="04e0" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">一旦我们启动并运行了AWS EC2实例，让我们进行部署模型所需的设置。Ubuntu自带最新版本的Python。我们将安装pip和tabpy。但是首先，在任何安装之前更新环境是一个好习惯。</p><p id="36df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">按照以下命令从windows命令提示符连接到AWS EC2实例。确保将cd放入保存EC2密钥对的文件夹中。</p><p id="5a48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从windows命令提示符连接到AWS EC2的命令。</p><blockquote class="ll lm ln"><p id="22a9" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">ssh -i "key_name.pem" ubuntu@ <public ipv4="" dns=""/></p></blockquote><p id="a69a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它看起来会像这样</p><blockquote class="ll lm ln"><p id="f976" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">ssh-I " key _ name . PEM " Ubuntu @ ec2–11–222–333–444 . AP-southeast-1 . compute . Amazon AWS . com</p></blockquote><p id="4d57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更新ubuntu环境的命令</p><blockquote class="ll lm ln"><p id="53ec" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">sudo apt-get更新</p></blockquote><p id="ac3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装pip的命令。</p><blockquote class="ll lm ln"><p id="cae7" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">sudo apt-get -y安装python3-pip</p></blockquote><p id="899e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装tabpy的命令。</p><blockquote class="ll lm ln"><p id="d472" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">pip3安装标签</p></blockquote><p id="784f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在安装了tabpy包之后，ssh需要重新初始化才能运行tabpy服务器。</p><p id="1108" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">启动tabpy服务器的命令</p><blockquote class="ll lm ln"><p id="bf5d" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">泰比</p></blockquote><p id="7a3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们的tabpy服务器已经启动并运行，准备好托管ML模型了。让我们将所需的文件传输到AWS EC2。理想情况下，这些应该是保存为pickle文件和Python脚本的模型和数据管道。</p><p id="0867" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将文件传输到AWS EC2的命令</p><blockquote class="ll lm ln"><p id="ad53" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">scp -r -i "key_name.pem "。/AWS _ Files Ubuntu @ ec2–11–222–333–444 . AP-southeast-1 . compute . Amazon AWS . com:~/</p></blockquote><p id="728a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用ls命令确认模型pickle、pre_process pickle以及python脚本deploy_app.py在AWS EC2上。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ls"><img src="../Images/e78960c4205894f906a2516bc33a0687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9gWb-TX-r6UYi0IC.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 2: Model related files moved to AWS EC2 instance</figcaption></figure><p id="14d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在tabpy上部署ML模型的Python脚本</p><pre class="jd je jf jg fd lt lu lv lw aw lx bi"><span id="5118" class="ly ki hh lu b fi lz ma l mb mc">from tabpy.tabpy_tools.client<br/>import Client<br/>import pandas as pd<br/>import numpy as np<br/>import pickle  </span><span id="cf07" class="ly ki hh lu b fi md ma l mb mc">model = pickle.load(open('rf.pkl', 'rb')) <br/>pre_process = pickle.load(open('pre_process.pkl', 'rb'))  </span><span id="1b84" class="ly ki hh lu b fi md ma l mb mc">#Function to receive data, transform it using pipeline, predict #using trained model and return probability of class 1</span><span id="a5f5" class="ly ki hh lu b fi md ma l mb mc">def Hospitalization_Prediction(_arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7, _arg8):<br/>    input_data = np.column_stack([_arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7, _arg8])<br/>    X = pd.DataFrame(input_data, columns=['age', 'MAP', 'triage_acuity', 'triage_heartrate', 'triage_temperature', 'triage_resprate', 'triage_o2sat', 'n_ed_365d'])</span><span id="6d4f" class="ly ki hh lu b fi md ma l mb mc">    result = model.predict_proba(pre_process.transform(X))<br/>    return [probability[1] for probability in result]</span><span id="4bb1" class="ly ki hh lu b fi md ma l mb mc">client = Client('http://localhost:9004/')</span><span id="3b39" class="ly ki hh lu b fi md ma l mb mc"># Connect to TabPy server using the client library<br/>connection = Client('http://localhost:9004/') </span><span id="b11b" class="ly ki hh lu b fi md ma l mb mc">connection.deploy('Hospitalization_Prediction', Hospitalization_Prediction, 'Returns prediction of probability of Hospitalization.', override=True)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/43447a014ca11f3cbcab4b1d37ca6c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*agwjTrisJzZvDC-5.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 3: Python script to deploy ML model to Tabpy</figcaption></figure><p id="c1ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们使用下面的命令运行deploy_app.py</p><blockquote class="ll lm ln"><p id="2f65" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">python3部署_应用程序. py</p></blockquote><p id="98a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">deploy_app.py中的python脚本在tabpy服务器上部署机器学习模型。该脚本也在<a class="ae lk" href="https://github.com/RakenduR/Healthcare_Analytics/tree/main/AWS_Files" rel="noopener ugc nofollow" target="_blank"> Github </a>上分享</p><p id="1bc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行上面的python脚本后，我们可以使用AWS EC2实例的IP地址来验证我们的函数<code class="du mf mg mh lu b">Hospitalization_Prediction</code>在tabpy服务器上可用。9004是tabpy的默认端口。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mi"><img src="../Images/5534fb7316c11f22bee118befb661a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*3vKuTC43OAfmBmrUbDKbGw.png"/></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 4: Tabpy server</figcaption></figure><h1 id="f9cc" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">Tableau仪表板上的设置</h1><p id="33b0" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">现在让我们设置tableau，从Tableau桌面→帮助→设置和性能→管理分析扩展连接访问机器学习模型，如下所示。单击测试连接，测试该功能是否可从Tableau访问。</p><blockquote class="ll lm ln"><p id="2e4e" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">主机名是AWS EC2公共IPv4地址，端口是9004，这是Tabpy的默认端口</p></blockquote><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/2262cdbaaabd2020375bc8fbb5f5f480.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*6YxiuVwMNf46Zs9eRxu5Nw.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 5: Analytics Extension setting on Tableau</figcaption></figure><p id="6488" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以通过更改输入值来试用仪表板，并看到住院百分比已更新。仪表盘分享在<a class="ae lk" href="https://github.com/RakenduR/Healthcare_Analytics" rel="noopener ugc nofollow" target="_blank"> Github </a>上。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/b436d36de8c48df4165e4dfe92dc20fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PW4uxVWK9igYT8WYYRnZhg.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 6: Tableau Dashboard</figcaption></figure><h1 id="ed3d" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">保持Tabpy在服务器上运行的步骤</h1><p id="f10f" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">您现在已经启动并运行了仪表板，但是如果您关闭终端，tabpy将被终止。为了在你没有连接到服务器的时候保持它的运行，我们可以安装<strong class="ig hi"> tmux </strong>这是一个unix类操作系统的终端复用器。</p><ol class=""><li id="3246" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb mk ju jv jw bi translated">使用控制X，控制C停止Tabpy</li><li id="19ad" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb mk ju jv jw bi translated">安装tmux</li></ol><blockquote class="ll lm ln"><p id="a05b" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">sudo安装tmux</p></blockquote><p id="ddcc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.创建名为tabpy的新会话</p><blockquote class="ll lm ln"><p id="3ed0" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">tmux new-s tabby</p></blockquote><p id="7bc1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.通过输入“tabby”在新会话中启动tabby。因此，现在会话是活动的，可以通过键入Cntrl B，d来分离它。现在会话被分离，终端可以被关闭，tableau仪表板将仍然能够访问运行在AWS EC2上的ML模型。</p><p id="02ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.要获取所有活动会话的列表，请使用以下命令</p><blockquote class="ll lm ln"><p id="8ec8" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">tmux ls</p></blockquote><p id="3e2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.为了连接到活动会话，请使用以下命令</p><blockquote class="ll lm ln"><p id="3cb8" class="ie if lo ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">tmux附加会话标签</p></blockquote><p id="20cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面终端截图供参考:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ml"><img src="../Images/7565c8114cc56e2cf4bfdb39a9058565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qFWAK_6-XOagteQT.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Fig 7: Setting to keep Tabpy running</figcaption></figure><p id="479b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就对了。机器学习模型已经启动并运行，可以从任何地方访问Tableau仪表盘。</p><p id="5f14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望这篇文章对你有用。欢迎提出建议和反馈，如有任何疑问，请随时联系我。</p><p id="86cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">继续关注<strong class="ig hi">机器学习项目生命周期</strong>:)中的其他帖子</p><div class="mm mn ez fb mo mp"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hi fi z dy mu ea eb mv ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">medium.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jm mp"/></div></div></a></div></div></div>    
</body>
</html>