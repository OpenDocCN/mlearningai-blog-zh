<html>
<head>
<title>Azure Machine learning Data Labeling and Object detection model (AutoML) Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure机器学习数据标记和对象检测模型(AutoML)模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/azure-machine-learning-data-labeling-and-object-detection-model-automl-model-19ae1dc9555a?source=collection_archive---------4-----------------------#2022-05-28">https://medium.com/mlearning-ai/azure-machine-learning-data-labeling-and-object-detection-model-automl-model-19ae1dc9555a?source=collection_archive---------4-----------------------#2022-05-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="8109" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用数据标记的开源数据集进行对象检测的端到端示例</h1><h1 id="f884" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="9b5c" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="e7d4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储</li><li id="4808" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure机器学习帐户</li><li id="547b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">可可数据集下载—<a class="ae jz" href="https://cocodataset.org/#download" rel="noopener ugc nofollow" target="_blank">https://cocodataset.org/#download</a></li><li id="df31" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">下载2017映像集并解压缩</li><li id="a7f3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">上传到Azure存储</li><li id="f20b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">本文不讨论基础设施的设置</li></ul><h1 id="3031" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">过程</h1><ul class=""><li id="1c17" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">定义用例</li><li id="8b81" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">收集图像</li><li id="fde7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">标签图像</li><li id="9da7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">系统模型化</li><li id="52e1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">以上是构建或实现基于端到端视觉的对象检测模型所涉及的高级过程</li></ul><h1 id="daa2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><ul class=""><li id="3d28" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">登录Azure机器学习工作区</li><li id="c62f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">首先为数据标注工具创建一个数据集</li><li id="eaed" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建新的数据存储和数据集作为文件数据集，并指向存储图像的目录</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/d2e30596a31e337d3bf0cd1abbae4ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y09B8aGEZVsAERxg.jpg"/></div></div></figure><ul class=""><li id="3528" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">图像文件存储在cocotrain2017文件夹下的默认存储中</li><li id="667c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">接下来选择默认的存储和文件夹</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kr"><img src="../Images/967c91e0ec03a8bb3337d51d454d82f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oLsvXkhMl44spTAd.jpg"/></div></div></figure><ul class=""><li id="894f" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">选择包含图像的train2017文件夹</li><li id="649c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">跳过数据验证</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/d29b3d8c6216c7b6a998e34aac40c9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G2duckfTfi-ZJp2u.jpg"/></div></div></figure><ul class=""><li id="7880" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">单击下一步，然后单击创建</li></ul><h1 id="70be" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">数据标记</h1><ul class=""><li id="bb08" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">现在让我们收集标签，用于基于用例的培训</li><li id="d1ec" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">转到AML工作区，然后转到数据标签工具</li><li id="ab31" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击创建添加项目</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kt"><img src="../Images/e49a55fde1d04bf85ceefb9dc3418e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HzBu9jk048LvaqMt.jpg"/></div></div></figure><ul class=""><li id="bb44" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">现在下一个屏幕</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ku"><img src="../Images/c1a82a8502a75eccff8517d6da32994d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RyG-VC-PA917Te1J.jpg"/></div></div></figure><ul class=""><li id="f043" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">禁用供应商，在我们的案例中，我们将使用内部人员来标记</li><li id="530f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">如果您需要标签方面的帮助，请从列表中选择一个合作伙伴</li><li id="8ed0" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后单击下一步</li><li id="2901" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择cocotrain2017作为数据集，用于创建边界框</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kv"><img src="../Images/c7c5a3e26ad457492fc53f8d02685bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R7hSP8jbNqIY9sLl.jpg"/></div></div></figure><ul class=""><li id="7d50" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">然后单击下一步</li><li id="57e8" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">启用增量刷新，该功能允许我们在收集更多图像时向数据集添加更多图像</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kw"><img src="../Images/ea6e63db1ee7c51a9683e32be2acc785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fm0t17Gg5ecM7Roa.jpg"/></div></div></figure><ul class=""><li id="abce" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">在本例中，我们为这个总目录创建了3个标签</li><li id="4dc7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">人</li><li id="edc0" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">食物</li><li id="060c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">动物</li><li id="47a9" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后单击下一步</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kx"><img src="../Images/7d48d7819bd60f125514c7492755a91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-LOXkE8fMgB7fpU3.jpg"/></div></div></figure><ul class=""><li id="7129" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">接下来提供如何贴标签的说明</li><li id="d6f1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">提供URL，如果有一个标签使用它来绘制边界框</li><li id="235e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">如果有任何问题，请提供一个上报途径</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ky"><img src="../Images/8013797a91b57f974b21bafee10c1ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aLD7yyVk95YMBlOW.jpg"/></div></div></figure><ul class=""><li id="d8bc" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">单击下一步</li><li id="01ec" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">接下来启用ML辅助标记</li><li id="ac54" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">这有助于提高贴标项目的效率</li><li id="f47c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">首先，人类贴标机会给图像贴标签</li><li id="0321" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">一旦第一组被标记，机器学习模型从标签中学习</li><li id="cbc4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后ML模型标记图像</li><li id="d31b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">贴标签的人可以检查图像并决定它是否有效</li><li id="e086" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后提交标签进行进一步处理</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kz"><img src="../Images/08ef180186086fb55a585a7b464f312e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SsZRBWLMSfrfRN7G.jpg"/></div></div></figure><ul class=""><li id="5e04" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">然后单击创建项目</li><li id="b9b1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">项目构建完成后，转到项目</li><li id="e1a7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">当您打开项目时，您应该会看到主项目仪表板</li><li id="f5b5" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将AML数据标签项目的链接交给您的贴标机</li><li id="ed92" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">允许有权限来确保标记者只能看到他们被分配到项目</li><li id="f816" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">当贴标机登录时，他们应该能够点击项目和数据标签</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es la"><img src="../Images/f979b665656f0427cbe58247067cb16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UsGVlpr5PQOtqLCt.jpg"/></div></div></figure><ul class=""><li id="ab4b" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">然后单击开始标注</li><li id="6b5d" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">如果您想阅读标签说明，请随时点击该说明</li><li id="9314" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">每个贴标机现在可以标记图像</li><li id="864e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">一旦它们达到初始设定，通常每个贴标机大约75或100个</li><li id="8331" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">ML模型在幕后起作用，并将为图像生成标签</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lb"><img src="../Images/80e66d4f1eee1313ed3a228ac686ac39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y-_Jr26nNFxJPRF_.jpg"/></div></div></figure><ul class=""><li id="b4a0" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">在初始集合被标记后，ML模型从标签中学习</li><li id="b2b0" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">ML标记的图像随后被发送给人工贴标机进行检查</li><li id="8ca7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">图像被标记为任务预标记，这表示ML模型已经标记了图像</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lc"><img src="../Images/f8bfbecd72de267e7c960c78d918e17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hCZRShi3PXrNaJ4L.jpg"/></div></div></figure><ul class=""><li id="90d8" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">如果你对创建的边界框感到满意，那么点击提交</li><li id="3439" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">否则调整边界框，然后提交</li><li id="eafa" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">还要验证它是否被分配了正确的标签</li><li id="7218" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">继续做这个练习，直到整个图像集都被标记</li><li id="6415" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在让我们看看仪表板，以查看贴标机的性能和贴标项目的状态</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ld"><img src="../Images/59866c187b5325685c1c91eb655245cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KNScevZNcCoha0nM.jpg"/></div></div></figure><ul class=""><li id="4c00" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">在上面的仪表板中，您可以看到所有的图像，分配了多少标签，还有多少需要标记</li><li id="bacd" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">还有贴标机的性能，显示有多少图像每个贴标机已标记</li><li id="610e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在底部，您可以看到ML模型训练同时运行训练和推理</li><li id="2a50" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">点击详细信息查看跑步详情</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es le"><img src="../Images/ab06ad3f546951a4c20d349d85575433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FXCCR-IuKYNPEdtX.jpg"/></div></div></figure><ul class=""><li id="8d7d" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">要查看数据，单击数据，然后查看</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lf"><img src="../Images/bda2c68e5bcacc2d3ec29bf16ca7a1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OSIZiV_nTK0QB7Sr.jpg"/></div></div></figure><ul class=""><li id="77ab" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">完成项目后，您可以单击导出</li><li id="8fee" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击提交以创建Azure ML数据集</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es lg"><img src="../Images/465dec819afd898e72629bed4cdf08b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/0*a5Vc1Ba2JktmvDxi.jpg"/></div></figure><h1 id="c5d4" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">用于构建模型的AutoVisionML代码</h1><ul class=""><li id="4a8b" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建计算实例</li><li id="0ca9" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建新的jupter笔记本</li><li id="a603" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">转到Datasets，您应该会看到新导出的数据集</li><li id="aee0" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择的数据集通常以项目名称开头</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lh"><img src="../Images/0916f0bd93e44c27b79f210faaf2cba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PCM-sp6yU4BQX5sY.jpg"/></div></div></figure><ul class=""><li id="7dab" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">转到消费部分并复制数据集信息</li><li id="19d6" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">上面的代码为实验加载数据集</li><li id="f49a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在创建一个新的jupyter笔记本或笔记本</li><li id="2b71" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">导入包含</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="a6d7" class="ln if hh lj b fi lo lp l lq lr">import os<br/>import shutil</span><span id="cd34" class="ln if hh lj b fi ls lp l lq lr">from azureml.core.workspace import Workspace<br/>from azureml.core import Experiment<br/>from azureml.core import Environment</span><span id="c77c" class="ln if hh lj b fi ls lp l lq lr">from azureml.core.compute import ComputeTarget, AmlCompute<br/>from azureml.core.compute_target import ComputeTargetException</span></pre><ul class=""><li id="8395" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">加载数据集进行训练</li><li id="8fb3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">这是来自数据标注项目的数据集</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="0de4" class="ln if hh lj b fi lo lp l lq lr"># azureml-core of version 1.0.72 or higher is required<br/># azureml-dataprep[pandas] of version 1.1.34 or higher is required<br/>from azureml.core import Workspace, Dataset</span><span id="35e0" class="ln if hh lj b fi ls lp l lq lr">subscription_id = 'xxxxx-xxxxxx-xxxxxxxxxxxxxxxx'<br/>resource_group = 'xxxxxx'<br/>workspace_name = 'xxxxxxxx'</span><span id="fdb6" class="ln if hh lj b fi ls lp l lq lr">workspace = Workspace(subscription_id, resource_group, workspace_name)</span><span id="4abf" class="ln if hh lj b fi ls lp l lq lr">dataset = Dataset.get_by_name(workspace, name='cocotrain2017_20220424_180733')<br/>dataset.to_pandas_dataframe()</span></pre><ul class=""><li id="a791" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">确保数据集的名称与我们在上一节中导出的名称相匹配</li><li id="0a56" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">接下来加载工作区</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="120b" class="ln if hh lj b fi lo lp l lq lr">from azureml.core.workspace import Workspace</span><span id="d9e2" class="ln if hh lj b fi ls lp l lq lr">ws = Workspace.from_config()<br/>print('Workspace name: ' + ws.name, <br/>      'Azure region: ' + ws.location, <br/>      'Subscription id: ' + ws.subscription_id, <br/>      'Resource group: ' + ws.resource_group, sep='\n')</span></pre><ul class=""><li id="33e7" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">加载自动图像库</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="efc2" class="ln if hh lj b fi lo lp l lq lr">from azureml.train.automl import AutoMLImageConfig<br/>from azureml.automl.core.shared.constants import ImageTask</span></pre><ul class=""><li id="e33a" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">下一步将是创建一个GPU计算机</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="01d9" class="ln if hh lj b fi lo lp l lq lr">from azureml.core.compute import ComputeTarget, AmlCompute<br/>from azureml.core.compute_target import ComputeTargetException</span><span id="cf51" class="ln if hh lj b fi ls lp l lq lr"># choose a name for your cluster<br/>cluster_name = "gpu-cluster"</span><span id="8733" class="ln if hh lj b fi ls lp l lq lr">try:<br/>    compute_target = ComputeTarget(workspace=ws, name=cluster_name)<br/>    print('Found existing compute target.')<br/>except ComputeTargetException:<br/>    print('Creating a new compute target...')<br/>    compute_config = AmlCompute.provisioning_configuration(vm_size='STANDARD_NC6s_V3', <br/>                                                           max_nodes=4)</span><span id="c91f" class="ln if hh lj b fi ls lp l lq lr">    # create the cluster<br/>    compute_target = ComputeTarget.create(ws, cluster_name, compute_config)</span><span id="663c" class="ln if hh lj b fi ls lp l lq lr">compute_target.wait_for_completion(show_output=True)</span><span id="4d1d" class="ln if hh lj b fi ls lp l lq lr"># use get_status() to get a detailed status for the current cluster. <br/>print(compute_target.get_status().serialize())</span></pre><ul class=""><li id="0af7" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">接下来，我们将使用yolov5运行一个模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="50ff" class="ln if hh lj b fi lo lp l lq lr">from azureml.train.automl import AutoMLImageConfig<br/>from azureml.train.hyperdrive import GridParameterSampling, choice<br/>from azureml.automl.core.shared.constants import ImageTask</span><span id="1fad" class="ln if hh lj b fi ls lp l lq lr">arguments = ["--early_stopping", 1, "--evaluation_frequency", 2]</span><span id="edbe" class="ln if hh lj b fi ls lp l lq lr">automl_image_config_yolov5 = AutoMLImageConfig(task=ImageTask.IMAGE_OBJECT_DETECTION,<br/>                                               compute_target=compute_target,<br/>                                               training_data=dataset,<br/>                                               validation_data=dataset,<br/>                                               hyperparameter_sampling=GridParameterSampling({'model_name': choice('yolov5')}),<br/>                                               #primary_metric='mean_average_precision',<br/>                                               iterations=1)</span></pre><ul class=""><li id="5e2a" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">现在创建一个实验并运行</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="9c4b" class="ln if hh lj b fi lo lp l lq lr">ws = Workspace.from_config()<br/>experiment = Experiment(ws, "coco128-automl-image-object-detection")<br/>automl_image_run = experiment.submit(automl_image_config_yolov5)<br/>automl_image_run.wait_for_completion(wait_post_processing=True)</span></pre><ul class=""><li id="db05" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">等待模型运行</li><li id="0165" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">获得最佳模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="a52f" class="ln if hh lj b fi lo lp l lq lr">best_child_run = automl_image_run.get_best_child()<br/>model_name = best_child_run.properties['model_name']<br/>model = best_child_run.register_model(model_name = model_name, model_path='outputs/model.pt')</span></pre><ul class=""><li id="aadd" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">显示要验证的模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="5a82" class="ln if hh lj b fi lo lp l lq lr">model</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lt"><img src="../Images/1a13db7e8b937f3f58a90a2303ab36c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FfX7Uu2SuB6JtGvk.jpg"/></div></div></figure><ul class=""><li id="40e5" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">现在让我们用不同的超参数运行更多的模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="fab0" class="ln if hh lj b fi lo lp l lq lr">from azureml.automl.core.shared.constants import ImageTask<br/>from azureml.train.automl import AutoMLImageConfig<br/>from azureml.train.hyperdrive import BanditPolicy, RandomParameterSampling<br/>from azureml.train.hyperdrive import choice, uniform</span><span id="0feb" class="ln if hh lj b fi ls lp l lq lr">parameter_space = {<br/>    "model": choice(<br/>        {<br/>            "model_name": choice("yolov5"),<br/>            "learning_rate": uniform(0.0001, 0.01),<br/>            "model_size": choice("small", "medium"),  # model-specific<br/>            #'img_size': choice(640, 704, 768), # model-specific; might need GPU with large memory<br/>        },<br/>        {<br/>            "model_name": choice("fasterrcnn_resnet50_fpn"),<br/>            "learning_rate": uniform(0.0001, 0.001),<br/>            "optimizer": choice("sgd", "adam", "adamw"),<br/>            "min_size": choice(600, 800),  # model-specific<br/>            #'warmup_cosine_lr_warmup_epochs': choice(0, 3),<br/>        },<br/>    ),<br/>}</span><span id="7ea5" class="ln if hh lj b fi ls lp l lq lr">tuning_settings = {<br/>    "iterations": 2,<br/>    "max_concurrent_iterations": 2,<br/>    "hyperparameter_sampling": RandomParameterSampling(parameter_space),<br/>    "early_termination_policy": BanditPolicy(<br/>        evaluation_interval=2, slack_factor=0.2, delay_evaluation=6<br/>    ),<br/>}</span><span id="dfb4" class="ln if hh lj b fi ls lp l lq lr">automl_image_config = AutoMLImageConfig(<br/>    task=ImageTask.IMAGE_OBJECT_DETECTION,<br/>    compute_target=compute_target,<br/>    training_data=dataset,<br/>    validation_data=dataset,<br/>    **tuning_settings,<br/>)</span></pre><ul class=""><li id="4649" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">运行模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="33b1" class="ln if hh lj b fi lo lp l lq lr">automl_image_run = experiment.submit(automl_image_config)<br/>automl_image_run.wait_for_completion(wait_post_processing=True)</span></pre><ul class=""><li id="0bb9" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">显示了模型运行</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lu"><img src="../Images/751c3438b6fad9edae5d15f2ad48ab60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xpz6dEp9QoEjFoWq.jpg"/></div></div></figure><ul class=""><li id="01ee" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">让我们看看指标</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lv"><img src="../Images/94f20814f28e7570c11c73b92961a62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vbEqV5QsPtVAb8RI.jpg"/></div></div></figure><ul class=""><li id="f702" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">让我们看看两个运行图表的指标</li><li id="12a4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择2个管路</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lw"><img src="../Images/e3632d041c60f3abcec826759a76009c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rIwCmCOLH1fKNVFK.jpg"/></div></div></figure><ul class=""><li id="131e" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">浏览并查看可用于日志、模型输出等的其他菜单项</li><li id="3ace" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在，您可以看到创建标签数据集然后运行模型是多么简单和无缝</li><li id="76d4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">本文不包括推理，但是您可以使用该模型进行预测</li></ul><h1 id="12c7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">推理</h1><ul class=""><li id="a0cf" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建支持AKS GPU的集群</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="def2" class="ln if hh lj b fi lo lp l lq lr">from azureml.core.compute import ComputeTarget, AksCompute<br/>from azureml.exceptions import ComputeTargetException</span><span id="0edf" class="ln if hh lj b fi ls lp l lq lr"># Choose a name for your cluster<br/>aks_name = "cluster-aks-gpu"</span><span id="25ee" class="ln if hh lj b fi ls lp l lq lr"># Check to see if the cluster already exists<br/>try:<br/>    aks_target = ComputeTarget(workspace=ws, name=aks_name)<br/>    print('Found existing compute target')<br/>except ComputeTargetException:<br/>    print('Creating a new compute target...')<br/>    # Provision AKS cluster with GPU machine<br/>    prov_config = AksCompute.provisioning_configuration(vm_size="STANDARD_NC6", <br/>                                                        location="eastus2")<br/>    # Create the cluster<br/>    aks_target = ComputeTarget.create(workspace=ws, <br/>                                      name=aks_name, <br/>                                      provisioning_configuration=prov_config)<br/>    aks_target.wait_for_completion(show_output=True)</span></pre><ul class=""><li id="a81f" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">获取模型文件</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="5241" class="ln if hh lj b fi lo lp l lq lr">from azureml.core.model import InferenceConfig</span><span id="6789" class="ln if hh lj b fi ls lp l lq lr">best_child_run.download_file('outputs/scoring_file_v_1_0_0.py', output_file_path='score.py')<br/>environment = best_child_run.get_environment()<br/>inference_config = InferenceConfig(entry_script='score.py', environment=environment)</span></pre><ul class=""><li id="5e8d" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">部署模型</li></ul><pre class="kb kc kd ke fd li lj lk ll aw lm bi"><span id="fdf8" class="ln if hh lj b fi lo lp l lq lr"># Deploy the model from the best run as an AKS web service<br/>from azureml.core.webservice import AksWebservice<br/>from azureml.core.webservice import Webservice<br/>from azureml.core.model import Model<br/>from azureml.core.environment import Environment</span><span id="7a0a" class="ln if hh lj b fi ls lp l lq lr">aks_config = AksWebservice.deploy_configuration(autoscale_enabled=True,                                                    <br/>                                                cpu_cores=1,<br/>                                                memory_gb=50,<br/>                                                enable_app_insights=True)</span><span id="2f11" class="ln if hh lj b fi ls lp l lq lr">aks_service = Model.deploy(ws,<br/>                           models=[model],<br/>                           inference_config=inference_config,<br/>                           deployment_config=aks_config,<br/>                           deployment_target=aks_target,<br/>                           name='automl-image-test',<br/>                           overwrite=True)<br/>aks_service.wait_for_deployment(show_output=True)<br/>print(aks_service.state)</span></pre><ul class=""><li id="f085" class="jc jd hh je b jf km jh kn jj ko jl kp jn kq jp jq jr js jt bi translated">代码示例来自—<a class="ae jz" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-auto-train-image-models" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/machine-learning/how-to-auto-train-image-models</a></li></ul><h1 id="50a1" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">完成的</h1></div><div class="ab cl lx ly go lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ha hb hc hd he"><p id="0316" class="pw-post-body-paragraph me mf hh je b jf km mg mh jh kn mi mj jj mk ml mm jl mn mo mp jn mq mr ms jp ha bi translated"><em class="mt">最初发表于</em><a class="ae jz" href="https://github.com/balakreshnan/Samples2022/blob/main/AzureML/cocoobjdet.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="mt">。</em></p><div class="mu mv ez fb mw mx"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="my ab dw"><div class="mz ab na cl cj nb"><h2 class="bd hi fi z dy nc ea eb nd ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ne l"><h3 class="bd b fi z dy nc ea eb nd ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nf l"><p class="bd b fp z dy nc ea eb nd ed ef dx translated">medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl kk mx"/></div></div></a></div></div></div>    
</body>
</html>