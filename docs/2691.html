<html>
<head>
<title>Getting started with mlflow Experiment tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">mlflow实验跟踪入门</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/getting-started-with-mlflow-tracking-46a0089d6a73?source=collection_archive---------6-----------------------#2022-05-30">https://medium.com/mlearning-ai/getting-started-with-mlflow-tracking-46a0089d6a73?source=collection_archive---------6-----------------------#2022-05-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="7756" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用本地文件夹和SQLite</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/93c1a862d110b0d21cab535c4e55c95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nPf4An92GTcbVSYB"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@rayjkiii?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Raymond Kotewicz</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="372e" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h2><blockquote class="kl km kn"><p id="2f18" class="ko kp kq kr b ks kt ii ku kv kw il kx ky kz la lb lc ld le lf lg lh li lj lk ha bi translated"><a class="ae jm" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank"> MLflow是一个简化机器学习开发的平台，包括跟踪实验，将代码打包成可重复运行的代码，以及共享和部署模型。</a></p></blockquote><p id="ccac" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated"><a class="ae jm" href="https://www.mlflow.org/" rel="noopener ugc nofollow" target="_blank"> mlflow </a>提供的功能之一是以有组织的方式跟踪实验。这篇文章解释了如何开始这样做。我们将考虑一个简单的机器学习示例，并展示如何以两种不同的方式跟踪实验:</p><ul class=""><li id="5667" class="ll lm hh kr b ks kt kv kw jy ln kc lo kg lp lk lq lr ls lt bi translated">使用本地文件夹</li><li id="4fde" class="ll lm hh kr b ks lu kv lv jy lw kc lx kg ly lk lq lr ls lt bi translated">使用SQLite数据库</li></ul><p id="e477" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">跟踪实验有更多的可能性，详细列表可以在mlflow 的<a class="ae jm" href="https://www.mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank">文档中找到。在</a><a class="ae jm" href="https://github.com/froukje/articles/blob/main/03_mlflow.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上可以找到一个jupyter笔记本，上面有这里显示的示例代码。</p><h2 id="d4ab" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">mlflow入门</h2><p id="3bb7" class="pw-post-body-paragraph ko kp hh kr b ks lz ii ku kv ma il kx jy mb la lb kc mc le lf kg md li lj lk ha bi translated">为了使用mflow，我们需要使用<code class="du me mf mg mh b">pip install mlflow.</code>来安装它</p><p id="c161" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">现在，让我们为随机森林回归量定义一个简单的训练函数:</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="cf2c" class="mm jo hh mh b be mn mo l mp mq">def train_rf(X_train, y_train, X_val, y_val, n_estimators=100, max_depth=6):<br/>    <br/>    model = RandomForestRegressor(n_estimators=n_estimators, max_depth=max_depth)<br/>    model.fit(X_train, y_train)<br/>    <br/>    # generate predictions<br/>    y_pred_train = model.predict(X_train).reshape(-1,1)<br/>    y_pred = model.predict(X_val).reshape(-1,1)<br/>    <br/>    # calculate errors<br/>    rmse_train = mean_squared_error(y_pred_train, y_train, squared=False)<br/>    rmse_val = mean_squared_error(y_pred, y_val, squared=False)<br/>    print(f"rmse training: {rmse_train:.3f}\t rmse validation: {rmse_val:.3f}")</span></pre><p id="d387" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">然后，我们可以使用mlflow记录参数、指标等等。这对于分析培训和评估指标如何变化以及比较不同的参数设置非常有用。我们将修改该函数，并记录参数“n_estimators”、“max_depth”和度量“rmse ”,用于训练和验证。</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="2048" class="mm jo hh mh b be mn mo l mp mq">def train_rf(X_train, y_train, X_val, y_val, n_estimators=100, max_depth=6):<br/>    <br/>    model = RandomForestRegressor(n_estimators=n_estimators, max_depth=max_depth)<br/>    model.fit(X_train, y_train)<br/>    <br/>    # generate predictions<br/>    y_pred_train = model.predict(X_train).reshape(-1,1)<br/>    y_pred = model.predict(X_val).reshape(-1,1)<br/>    <br/>    # calculate errors<br/>    rmse_train = mean_squared_error(y_pred_train, y_train, squared=False)<br/>    rmse_val = mean_squared_error(y_pred, y_val, squared=False)<br/>    print(f"rmse training: {rmse_train:.3f}\t rmse validation: {rmse_val:.3f}")<br/>    <br/>    # Logging params and metrics to MLFlow<br/>    mlflow.log_param('n_estimators', n_estimators)<br/>    mlflow.log_param('max_depth', max_depth)<br/>    mlflow.log_metric('rmse_val', rmse_val)<br/>    mlflow.log_metric('rmse_train', rmse_train)</span></pre><h2 id="432a" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">在本地文件夹中跟踪实验</h2><p id="ce04" class="pw-post-body-paragraph ko kp hh kr b ks lz ii ku kv ma il kx jy mb la lb kc mc le lf kg md li lj lk ha bi translated">跟踪我们实验的最简单方法是将所有记录的信息保存在本地文件夹中。我们可以通过使用<code class="du me mf mg mh b">with mlflow.start_run()</code>并在<code class="du me mf mg mh b">with</code>语句中运行我们的模型来实现。创建一个保存运行和所有相关日志的目录<code class="du me mf mg mh b">mlflow</code>。每次我们用命令<code class="du me mf mg mh b">with mlflow.start_run()</code>运行代码，一个新的运行将在相同的实验名称下被创建。默认情况下，该实验被命名为<code class="du me mf mg mh b">0</code>。</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="95a6" class="mm jo hh mh b be mn mo l mp mq">with mlflow.start_run():<br/>    train_rf(X_train, y_train, X_val, y_val, n_estimators=100, max_depth=6)</span></pre><p id="e48f" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">我们通过改变“最大深度”参数来执行模型的新运行。如果我们像上面一样运行它，它将像前面一样存储在当前实验文件夹下，在本例中是用<code class="du me mf mg mh b">experiment_id=0</code>。</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="c9e4" class="mm jo hh mh b be mn mo l mp mq">with mlflow.start_run():<br/>    train_rf(X_train, y_train, X_val, y_val, n_estimators=100, max_depth=None)</span></pre><p id="1170" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">如果我们想在不同的实验下保存我们的结果，我们可以使用<code class="du me mf mg mh b">mlflow.set_experiment()</code>设置一个新的实验。如果实验已经存在，运行将保存在该实验下，如果不存在，将创建一个新的。让我们假设我们有第二个模型(例如XGBoost ),并且我们想要记录一个新实验的结果。我们需要给出实验名称，实验id会自动递增。</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="1dd2" class="mm jo hh mh b be mn mo l mp mq"># defining a new experiment<br/>experiment_name = 'xgboost'<br/>exp_id = mlflow.set_experiment(experiment_name=experiment_name)<br/>with mlflow.start_run():<br/>    train_xgb(X_train, y_train, X_val, y_val, learning_rate=0.1)</span></pre><p id="8eec" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">我们可以在特定的实验名称下运行模型，方法是将<code class="du me mf mg mh b">experiment_id</code>设置为现有的实验。</p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="3254" class="mm jo hh mh b be mn mo l mp mq">with mlflow.start_run(experiment_id=1):<br/>    train_xgb(X_train, y_train, X_val, y_val, learning_rate=0.01)</span></pre><p id="c0cc" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">使用<code class="du me mf mg mh b">tree mlruns</code>我们可以看到文件夹的结构，我们的实验就存储在那里。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mr"><img src="../Images/ae0c41812d11e7b6c033e00e23624369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6TVD-Rqs02A6br4-DNqCA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Structure of the folder where the experiments are stored</figcaption></figure><p id="6209" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">数字0，1，…是不同的实验。在每个文件夹中，我们执行的运行都存储在一个单独的文件夹中，每个运行都以实验id命名。在这个文件夹中，我们可以找到所有的指标、参数和其他我们存储的东西。</p><h2 id="bab4" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">使用Sqlite跟踪实验</h2><p id="8548" class="pw-post-body-paragraph ko kp hh kr b ks lz ii ku kv ma il kx jy mb la lb kc mc le lf kg md li lj lk ha bi translated">或者，记录的结果可以存储在数据库中。Mlflow支持MySQL、Postgres和Sqlite。在这篇文章中，我们将只考虑SQlite对数据库跟踪可能性的概述，可以在mlflow 的<a class="ae jm" href="https://www.mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank">文档中找到。为了告诉mlflow在数据库中存储东西，我们需要将跟踪uri设置为<code class="du me mf mg mh b">mlflow.set_tracking_uri("sqlite:///mlruns.db")</code>。或者，我们可以导出环境变量<code class="du me mf mg mh b">export MLFLOW_TRACKING_URI sqlite:///mlruns.db.</code>，然后像以前一样开始运行。</a></p><pre class="ix iy iz ja fd mi mh mj bn mk ml bi"><span id="7a46" class="mm jo hh mh b be mn mo l mp mq">mlflow.set_tracking_uri("sqlite:///mlruns.db")<br/>with mlflow.start_run(experiment_id=0):<br/>    train_rf(X_train, y_train, X_val, y_val)</span></pre><p id="dbad" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">这将在当前文件夹中创建一个数据库“mlruns.db”。我们可以使用SQLite检查表格，例如，选择存储的指标。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ms"><img src="../Images/edb133f7f71c40b9cde35779243c9254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQa541niFcgjVWP2fm8byA.png"/></div></div></figure><h2 id="486c" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">使用web用户界面进行可视化</h2><p id="498b" class="pw-post-body-paragraph ko kp hh kr b ks lz ii ku kv ma il kx jy mb la lb kc mc le lf kg md li lj lk ha bi translated">我们可以使用mlflow的web UI可视化结果，以分析和比较不同的运行和实验。在第一种情况下，当我们在本地将记录的参数和度量存储在<code class="du me mf mg mh b">.\mlflow</code>中时，我们可以简单地在终端中键入<code class="du me mf mg mh b">mlflow ui</code>来交互式地查看结果。如果我们在创建文件夹<code class="du me mf mg mh b">mlflow</code>的同一个位置，这是可行的。更普遍的是，我们可以使用<code class="du me mf mg mh b">mlflow ui --backend-store-uri file:////absolute-path/mlruns.</code>从其他位置访问该文件夹</p><p id="a6a0" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">在第二种情况下，我们需要更改<code class="du me mf mg mh b">backend-store-uri</code>并使用<code class="du me mf mg mh b">mlflow ui --backend-store-uri sqlite:///mlruns.db</code>。如果我们想从不同的位置访问数据库，我们可以设置路径<code class="du me mf mg mh b">mlflow ui --backend-store-uri sqlite:////absolute-path/mlruns.db</code>。为此，需要安装sqlalchemy，例如<code class="du me mf mg mh b">pip install sqlalchemy.</code></p><p id="7213" class="pw-post-body-paragraph ko kp hh kr b ks kt ii ku kv kw il kx jy kz la lb kc ld le lf kg lh li lj lk ha bi translated">另一个有用的参数是<code class="du me mf mg mh b">--port</code>来改变UI的端口，默认设置为<code class="du me mf mg mh b">5000</code>。这是一个web用户界面的例子。还有很多可视化功能，这只是开始页面。去探索它们吧！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mt"><img src="../Images/ea85668b9ed1e8ecf021f10316ba534a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QsNlxnT_zndlDmk8Xqk_g.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">!Example of the web UI of mlflow</figcaption></figure><h2 id="7754" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">进一步阅读</h2><ul class=""><li id="863a" class="ll lm hh kr b ks lz kv ma jy mu kc mv kg mw lk lq lr ls lt bi translated"><a class="ae jm" href="https://www.mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank">https://www.mlflow.org/docs/latest/tracking.html</a></li><li id="6d88" class="ll lm hh kr b ks lu kv lv jy lw kc lx kg ly lk lq lr ls lt bi translated"><a class="ae jm" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">https://www . ml flow . org/docs/latest/tutorials-and-examples/tutorial . html</a></li><li id="8fab" class="ll lm hh kr b ks lu kv lv jy lw kc lx kg ly lk lq lr ls lt bi translated"><a class="ae jm" href="https://dkhundley.medium.com/?source=post_page-----8b45bfbbb334--------------------------------" rel="noopener"> D. Hundley </a>，<a class="ae jm" href="https://towardsdatascience.com/mlflow-part-1-getting-started-with-mlflow-8b45bfbbb334" rel="noopener" target="_blank"> mlflow part 1入门mlflow </a> (2020)，<a class="ae jm" href="https://towardsdatascience.com/mlflow-part-1-getting-started-with-mlflow-8b45bfbbb334" rel="noopener" target="_blank">https://towardsdatascience . com/ml flow-part-1-入门-mlflow-8b45bfbbb334 </a></li></ul><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/@frauke.albrecht/subscribe"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">每当弗劳克·阿尔布雷特出版时，就收到一封电子邮件。</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">每当弗劳克·阿尔布雷特出版时，就收到一封电子邮件。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jg na"/></div></div></a></div><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/@frauke.albrecht/membership"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">通过我的推荐链接加入媒体</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">阅读Frauke Albrecht的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接支持…</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="np l nl nm nn nj no jg na"/></div></div></a></div><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nq l nl nm nn nj no jg na"/></div></div></a></div></div></div>    
</body>
</html>