<html>
<head>
<title>Modelling the SIMPLE model of memory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立简单的记忆模型</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/modelling-the-simple-model-of-memory-49852b0cd9b1?source=collection_archive---------2-----------------------#2022-11-16">https://medium.com/mlearning-ai/modelling-the-simple-model-of-memory-49852b0cd9b1?source=collection_archive---------2-----------------------#2022-11-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="2ecf" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">贝叶斯认知建模</h2></div><p id="3a6f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇博文中，我将使用Lee &amp; Wagemakers所著的《<a class="ae js" href="https://bayesmodels.com/" rel="noopener ugc nofollow" target="_blank">贝叶斯认知建模</a>》一书中的另一个例子。这本书充满了认知心理学的例子，可以用贝叶斯方法来处理。由于这些例子大多是通过<strong class="iy hi"> WinBUGS </strong>完成的，我想看看我是否能使用<em class="jt"> brms </em>和<em class="jt"> stan </em>来重现它。所以，这就是这篇博文的内容。(我知道这本书也提供了stan代码，但我想看看我能用<em class="jt"> brms </em>走多远，它的功能比base <strong class="iy hi"> STAN </strong>或<strong class="iy hi"> WinBUGS </strong>要少)。</p><p id="c8d5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个例子中，我将对记忆的简单模型进行建模，该模型测量人们保留刺激的能力。你会发现，这个模型的挑战在于它的非线性曲线。</p><p id="c1a8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">背景并不重要，重要的是解决问题的方法。让我通过绘制数据来展示给你看。</p><p id="dac7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是首先，加载库和数据。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="eee9" class="kd ke hh jz b be kf kg l kh ki"># clears workspace:  <br/>rm(list=ls()) <br/>library(dplyr)<br/>library(ggplot2)<br/>library(brms)<br/>library(bayesplot)<br/>library(tidybayes)<br/>library(marginaleffects)</span></pre><pre class="kj jy jz ka bn kb kc bi"><span id="f0f1" class="kd ke hh jz b be kf kg l kh ki">y          &lt;- matrix(scan("CaseStudies/Simple/k_M.txt", sep=","), ncol=40, nrow=6, byrow=T) <br/>n          &lt;- c(1440,1280,1520,1520,1200,1280)<br/>listlength &lt;- c(10,15,20,20,30,40)<br/>pc         &lt;- matrix(scan("CaseStudies/Simple/pc_M.txt", sep=","), ncol=40, nrow=6, byrow=T) <br/>labs       &lt;- scan("CaseStudies/Simple/labs_M.txt", sep="", what="character")<br/>dsets &lt;- 6 <br/>gsets &lt;- 9<br/><br/>y<br/>pc<br/>labs</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kk"><img src="../Images/b6f67393375798cd80734e231cbde022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y51QzuiPjsJUqZLoVED79g.png"/></div></div></figure><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/6ed4cbb2a8ec50ae21023dcbaa259b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1MnQFv5HeJTtCZRzF6oSw.png"/></div></div></figure><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kt"><img src="../Images/2a0df0e1c9bc0328c2ced6965deb8d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0nbvQwNgtxD0Tao6oxaBw.png"/></div></div></figure><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="4a99" class="kd ke hh jz b be kf kg l kh ki">pc&lt;-as.data.frame(t(pc))<br/>colnames(pc)&lt;-labs<br/>d &lt;- pc<br/>Position &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(Position,d)<br/>str(df)<br/>df_long&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=`10-2`:`40-1`,<br/>                      names_to = "Condition",<br/>                      values_to = "PC")<br/>str(df_long)<br/>df_long$Position&lt;-as.numeric(df_long$Position)<br/>df_long&lt;-df_long%&gt;%filter(PC&gt;0)<br/>ggplot(df_long)+<br/>  geom_point(aes(x=Position, <br/>                 y=PC))+<br/>  theme_bw()+<br/>  facet_wrap(~Condition)<br/><br/>ggplot(df_long)+<br/>  geom_point(aes(x=Position, <br/>                 y=PC))+<br/>  geom_smooth(aes(x=Position, <br/>                  y=PC))+<br/>  theme_bw()+<br/>  facet_wrap(~Condition)</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl kv kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/f5485d61b093a5d89bc11c1bb40cbcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*HCx50_iLwAx3ubPdiA6THA.png"/></div></figure><figure class="ku kl la kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/5b95b2b37553a121ca160b0e65bfc84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*1r-lGB8u0RmE1tC0pWFKXg.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx lf di lg lh">These plot show, for six conditions, the percentage correct in relationship to the position of the stimulus to be retained. It is this patterns that we need to model.</figcaption></figure></div><p id="47a6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这本书里，它清楚地展示了这个模型是多么复杂，也是从认知的角度。最有效的模型是机械模型，其中基础理论的各个部分被连接起来形成一个模型，并从中得出预测。该模型也是书中的<strong class="iy hi"> WinBUGS </strong>所制作的，并且可以使用<strong class="iy hi"> STAN </strong>来创建，但是我想使用基本的<em class="jt"> brms </em>来建模它。现在，这并不意味着<em class="jt"> brms </em>是基本的，但是我将会做一个和书上所做的稍微不同的模型。最后，我的工作是建立曲线模型。</p><p id="db22" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我可以使用长格式显示上面的相同图形。为此，我需要做一些额外的转换。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="41f7" class="kd ke hh jz b be kf kg l kh ki">y&lt;-as.data.frame(t(y))<br/>colnames(y)&lt;-labs<br/>d &lt;- y<br/>Position &lt;- rownames(d)<br/>rownames(d) &lt;- NULL<br/>df &lt;- cbind(Position,d)<br/>str(df)<br/>df_long&lt;-df%&gt;%<br/>  tidyr::pivot_longer(cols=`10-2`:`40-1`,<br/>                      names_to = "Condition",<br/>                      values_to = "Y")<br/>df_long$Position&lt;-as.numeric(df_long$Position)<br/>df_long&lt;-df_long%&gt;%<br/>  arrange(Condition, Position)<br/>df_long$N&lt;-rep(n,each=40)<br/>df_long$PC&lt;-df_long$Y/df_long$N<br/>df_long&lt;-df_long%&gt;%filter(PC&gt;0)<br/>ggplot(df_long)+<br/>  geom_point(aes(x=Position, <br/>                 y=PC))+<br/>  geom_smooth(aes(x=Position, <br/>                  y=PC))+<br/>  theme_bw()+<br/>  facet_wrap(~Condition)</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl li kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/d6ce6d559bb70f12c2ff07162406ee69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*vEQLhnvGGIJF7kEAN4LQZg.png"/></div></figure><figure class="ku kl lj kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/f2fb0dcaf7df954665d796eae71d187a.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*XXGj9kqLgG8qdW6Utwpdww.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx lk di ll lh">And here we have the same plot using a different data frame.</figcaption></figure></div><p id="fe17" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，数据完全是非线性的，而且有多种建模方法。我们可以使用样条，一种非线性函数，或者我们可以转换数据，然后通过更简单的解决方案对其建模。让我们先试试最后一个建议。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="215f" class="kd ke hh jz b be kf kg l kh ki">ggplot(df_long)+<br/>  geom_point(aes(x=log10(Position), <br/>                 y=log10(Y)))+<br/>  geom_smooth(aes(x=log(Position), <br/>                  y=log10(Y)))+<br/>  theme_bw()+<br/>  facet_wrap(~Condition)</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lm"><img src="../Images/a25cd675155642fe9f2e5bec07e87cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DehOQrJ0SjHVOxa4RvU-PQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">That did not help. At all.</figcaption></figure><p id="1493" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">建模部分。现在，在<a class="ae js" rel="noopener" href="/mlearning-ai/difference-in-ability-2e823ae447e">之前的</a>例子中，我已经展示了使用基础二项式分布比使用贝塔分布更好。让我们从二项式开始。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="2147" class="kd ke hh jz b be kf kg l kh ki">get_prior(Y | trials(N) ~ <br/>                Position + (1|Condition), <br/>              data = df_long,<br/>              family=binomial(link = "logit"))<br/>fit&lt;-brms::brm(Y | trials(N) ~ <br/>                 Position + (1|Condition), <br/>               data = df_long,<br/>               family=binomial(link = "logit"),<br/>               prior = c(<br/>                 prior(normal(0, 1), class=b, coef=Position ),<br/>                 prior(normal(0, 1), class=Intercept),<br/>                 prior(gamma(1, 1), class=sd, coef=Intercept, group=Condition)), <br/>               chains=4, <br/>               cores=6, <br/>               warmup = 3000,<br/>               iter = 6000)<br/>summary(fit)<br/>plot(fit)<br/>pp_check(fit, ndraws = 500)<br/>pp_check(fit, type = "error_hist", ndraws = 11)<br/>pp_check(fit, type = "scatter_avg", ndraws = 100)<br/>pp_check(fit, type = "stat_2d")<br/>pp_check(fit, type = "loo_pit")<br/><br/><br/>df_long %&gt;%<br/>  add_epred_draws(fit, <br/>                  ndraws=100, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25) +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl ln kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/69735b0316065c9c542e6044e82104ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*1gDG8xkWM73pLTIBtahVww.png"/></div></figure><figure class="ku kl lo kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/aa243f6a7f9662e442bb6d795c7c4568.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*MnbFRLbU0O_zTes8ehHvwA.png"/></div></figure><figure class="ku kl lp kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/50bf22863e24a46ceb1223588737c9bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*JjI3uhT6_TebxplkvMELIQ.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx lq di lr lh">Sampling looks good, but the model is not connecting to the data at all. That does not have to be a problem if you are very much convinced that the priors used are suitable.</figcaption></figure></div><p id="128f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">预测与观察不相关，当你观察偏差时，很难坚持选择的先验和模型是充分的。我不会在那上面打赌。</p><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ls"><img src="../Images/eeff400bc3b0826d78b6b5e68d3c23ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2PzmP44u1Yfavc0HnRutQ.png"/></div></div></figure><p id="d32b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后再做一次尝试，但这次使用样条。样条是建模非线性模式的非常好的方法，但在功能上仍然是线性的。然而，问题是样条常常会失去它的部分解释，尤其是与更难建模的非线性函数相比时。</p><p id="7699" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们在<em class="jt"> brms </em>模型中应用样条，看看我们在哪里结束。样条的<em class="jt"> gp </em>部分构成高斯过程。许多不同类型的样条是可能的。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="1347" class="kd ke hh jz b be kf kg l kh ki">fit4&lt;-brms::brm(Y | trials(N) ~ <br/>                  1 + s(Position, bs="gp") + (1+Position|Condition), <br/>                data = df_long,<br/>                family=binomial(link = "logit"), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/><br/>summary(fit4)<br/>pp_check(fit4, ndraws=500)<br/><br/>df_long %&gt;%<br/>  add_epred_draws(fit4, <br/>                  ndraws=100, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25) +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl lt kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/555be653228f55dd7bedecc28e18b0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*EnyCnAxZGL88bXBjcYwxWQ.png"/></div></figure><figure class="ku kl lu kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/2679d79dbbed14c0821f41fa31bd87ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*n8ICg-uHT73ZlPvTPhgsLA.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx lv di lw lh">The model has no pre-defined prior (only priors coming from the data itself) which makes it a less stable model. Also, which can be clearly seen, is that the spline does not necessarily know how to deal with the data, which looks like a combination of a power function and an exponential.</figcaption></figure></div><p id="9554" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，样条不是拟合数据的最佳方式。当然，还有其他方法，我现在将探索，其中实现非线性函数是最好的可能方式。</p><p id="c185" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae js" rel="noopener" href="/towards-artificial-intelligence/non-linear-models-53e6ea42e207">非线性函数</a>是出了名的难，所以我将从使用单个条件开始。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="c1d8" class="kd ke hh jz b be kf kg l kh ki">df_long_group2&lt;-df_long%&gt;%filter(Condition=="20-1")<br/>plot(df_long_group2$Position, df_long_group2$Y)</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lx"><img src="../Images/ba9b50b642a4cd898d8f3b4158b81bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krYgV5DHYWD-wtazisfB3A.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">For a single condition I show the position and the number of correct. As you can see this is very much a non-linear function.</figcaption></figure><p id="0665" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我想使用<em class="jt"> nls </em>程序应用非线性函数。我现在使用的公式是我在寻找抛物线模型时找到的。正弦函数应该不会让你感到惊讶，因为它可以模拟一个周期的起伏，但我想知道它是否会找到正确的幅度。不管怎样，让我们开始吧。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="f794" class="kd ke hh jz b be kf kg l kh ki">try&lt;-nls(Y ~ b0 + b1*sin(Position)+b2*log(Position), <br/>         data = df_long_group2,<br/>         start = list(b0 = 100, <br/>                      b1 = 100,<br/>                      b2 = 100), <br/>         na.action=na.exclude, <br/>         control=nls.control(maxiter = 1000, tol = 1e-05))<br/>summary(try)<br/>plot(try)<br/>df_long_group2$pred&lt;-predict(try)<br/>ggplot(df_long_group2)+<br/>  geom_point(aes(x=Position, <br/>                 y=Y))+<br/>  geom_line(aes(x=Position, <br/>                y=pred, <br/>                group=Condition), col="red")+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl ly kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/33d001a3d1ccd861d05ce1b506f8b30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*0jXb560VR2T2Gd5bfGjiQw.png"/></div></figure><figure class="ku kl lz kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/f499715a8bd1f8170ffc47c4a19acfa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*_9kbnbGAzb4gDw39iLVGxg.png"/></div></figure><figure class="ku kl ma kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/be73514faa223bbbe8ea39665db422fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*2UPvcy9Xvq7k3_QmkkTiHw.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx mb di mc lh">Models fits, but the predictions are off. We see cycles which we should not see.</figcaption></figure></div><p id="0c23" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">即使模型不好，让我们看看贝叶斯模型如何使用<em class="jt"> brms </em>执行。我将应用书中使用的相同函数和部分先验知识。这些都是非常不明确的前科。你很难称之为贝叶斯分析。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="29e6" class="kd ke hh jz b be kf kg l kh ki">fit2&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     b0 + b1*sin(Position)+b2*log(Position),<br/>                   b0 + b1 + b2 ~ 1 + (1|Condition), nl=TRUE),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(uniform(0, 200), class=b, coef=Intercept, nlpar = "b0"),<br/>                  prior(uniform(0, 200), class=b, coef=Intercept, nlpar = "b1"), <br/>                  prior(uniform(0, 250), class=b, coef=Intercept, nlpar = "b2"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b0"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b1"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b2")), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es md"><img src="../Images/6ff0a500e88d00fb166efa5b238f6989.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnRC3YC6YfHWD6d1ID9MyQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">And here we have the output from the model. Just look at the Rhats produced. If you see values such as these, the prediction plots can be a real treat to see. Not because they are correct, but because they will be all over the place.</figcaption></figure><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es me"><img src="../Images/9093ba7f5c62b5f84fc3dee3d572de81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTWArItiYI71xZaeKqp3PQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">And yes, they are all over the place!</figcaption></figure><p id="a116" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我改变了前科会怎么样？我现在将为位置部分构建统一先验，为比例部分构建伽玛先验。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="4b54" class="kd ke hh jz b be kf kg l kh ki">fit3&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     b0 + b1*sin(Position)+b2*log(Position),<br/>                   b0 + b1 + b2 ~ 1 + (1|Condition), nl=TRUE),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "b0"),<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "b1"), <br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "b2"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b0"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b1"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b2")), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit3)<br/>pp_check(fit3, ndraws=500)</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mf"><img src="../Images/f4f0707c01ccd7f3fdeb1d87199d3bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z156dPfNlwyClOGCWSDXhQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">The model looks better as the Rhat values are normal. This means the sampling is stable, but does not mean the model makes sense. However, stable Rhats are a welcome sight.</figcaption></figure><div class="ju jv jw jx fd ab cb"><figure class="ku kl mg kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/b65c1b8dc3e2a13d34cc560416f82d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*J9jb06Z4-avRyBSeqY6uuQ.png"/></div></figure><figure class="ku kl mh kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/4131dea5827deccd453f5ff782e9feb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*AnmS7Bc2DRxZbgR6kb5nuA.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx mi di mj lh">However, the predictions coming from the model leave much to be desired, behaving very much like a cycle. This should not surprise you, and so it should not surprise you that I will decide that this non-linear function is pretty much useless to model this particular set of observations. Lets move on.</figcaption></figure></div><p id="92af" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">书中使用的特定函数是嵌套的，非常复杂。当然，我可以使用作者应用的STAN代码，但是现在我甚至不想再这样做了。我想看看能不能用非线性的方式来模拟这个模式。但在此之前，我想再绕一圈，那就是应用多项式函数。非常符合样条，它有一些更容易解释的输出。以及它的敏捷。让我们快速评估一下。</p><p id="8f25" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，我将使用线性回归和<em class="jt"> lm </em>函数进行测试。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="dd18" class="kd ke hh jz b be kf kg l kh ki">df_long_group2&lt;-df_long%&gt;%filter(Condition=="20-1")<br/>plot(df_long_group2$Position, df_long_group2$Y)<br/>try&lt;-lm(Y ~ Position + <br/>          I(Position^2) + <br/>          I(Position^3), data=df_long_group2)<br/>summary(try)<br/>df_long_group2$pred&lt;-predict(try)<br/>ggplot(df_long_group2)+<br/>  geom_point(aes(x=Position, <br/>                 y=Y))+<br/>  geom_line(aes(x=Position, <br/>                y=pred, <br/>                group=Condition), col="red")+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl mk kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/63352bc007a0d58aa47d92423fa85279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*hWT3WoJ_igC7Wx23S4LgOA.png"/></div></figure><figure class="ku kl ml kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/f437921f73d01d2e6ac214f651554c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*H8qsjSy7bdDupCnZFAa_1g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx mm di mn lh">The model and its prediction. Not perfect, but not that bad either.</figcaption></figure></div><p id="6d6f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我将使用<em class="jt"> glm </em>函数尝试同样的事情。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="c737" class="kd ke hh jz b be kf kg l kh ki">try&lt;-glm(cbind(Y|N) ~ Position + <br/>          I(Position^2) + <br/>          I(Position^3), <br/>         data=df_long_group2, <br/>         family=binomial)<br/>summary(try)<br/>df_long_group2$pred&lt;-predict(try, df_long_group2, type="link")<br/>ggplot(df_long_group2)+<br/>  geom_point(aes(x=Position, <br/>                 y=Y))+<br/>  geom_line(aes(x=Position, <br/>                y=pred, <br/>                group=Condition), col="red")+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl mo kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/5aaa337dcc1c4ee4e0175507c17fb447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*1mMmZfGUAd3YDNG7iIhYHw.png"/></div></figure><figure class="ku kl mp kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/c38b25bc956a4c40d5291bde9805cc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*382OI_yqbaHtlnriryIdSA.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx mq di mr lh">Not sure what happened, but something went wrong here. The standard errors are huge and so the fit of the model is not as it should be.</figcaption></figure></div><p id="5a82" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我不希望使用正态分布来模拟数据，而是使用二项式。对于先验，我将为位置参数取法线，为比例/精度参数取gamma。这些相当宽。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="ef6f" class="kd ke hh jz b be kf kg l kh ki">get_prior(bf(Y | trials(N) ~ <br/>               Position + <br/>               I(Position^2) + <br/>               I(Position^3) + <br/>               (1|Condition)),<br/>          data= df_long,<br/>          family=binomial(link = "logit"))<br/>fit4&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     Position + <br/>                     I(Position^2) + <br/>                     I(Position^3) +<br/>                   (1|Condition)),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(normal(200, 50), class=Intercept),<br/>                  prior(normal(0,10), class=b, coef=Position),<br/>                  prior(normal(0,10),  class=b, coef=IPositionE2), <br/>                  prior(normal(0,10), class=b, coef=IPositionE3),<br/>                  prior(gamma(4, 4), class=sd, group=Condition)), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit4)<br/>pp_check(fit4, ndraws=500)<br/>df_long %&gt;%<br/>  add_epred_draws(fit4, <br/>                  ndraws=200, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25, col="red") +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw() </span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl ms kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/bd470a0751dda9caa03057d69cf96c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*dw5Uq8yS_yMNcuPQ4Oewuw.png"/></div></figure><figure class="ku kl mt kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/60b911822cee1c0d922c2748a5d88234.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*vf1NWxq5gete0UsZvORZRw.png"/></div></figure><figure class="ku kl mu kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/741483b7ec683bb96a7d1ba82380ec1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*znwuq9zYQZ1ilJiOoVWYDA.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx mv di mw lh">And what I get is another very strange model, nothing I can or should use.</figcaption></figure></div><p id="fabe" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">代替多项式，我可以回复到样条，但这次我将要求模型为每个类别制作样条。这在<em class="jt"> brms </em>中很容易完成。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="b660" class="kd ke hh jz b be kf kg l kh ki">get_prior(bf(Y | trials(N) ~ <br/>               s(Position, by=Condition)),<br/>          data= df_long,<br/>          family=binomial(link = "logit"))</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mx"><img src="../Images/40e3987d8e93db57c48908a55314adb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yN-sRpdkwB4OhqQFS0VdSw.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">The priors I need to specify when building a spline for each condition seperately.</figcaption></figure><p id="f00b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于这个模型，我将坚持统一的先验。再次，这是弱贝叶斯建模，但我不成功使用多项式，所以我希望看到数据将带我去哪里。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="3819" class="kd ke hh jz b be kf kg l kh ki">fit5&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     s(Position, by=Condition)),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(uniform(-10, 10), class=Intercept),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition10M2_1),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition15M2_1),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition20M1_1),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition20M2_1),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition30M1_1),<br/>                  prior(uniform(-10, 10), class=b, coef=sPosition:Condition40M1_1),<br/>                  prior(gamma(1, 1), class=sds)), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit5)<br/>pp_check(fit5, ndraws=500)<br/>df_long %&gt;%<br/>  add_epred_draws(fit5, <br/>                  ndraws=200, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25, col="red") +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl my kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/1412c3710a68aba9cb77b929407deb6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*4OLgwWGVr4kho84vdnd2Uw.png"/></div></figure><figure class="ku kl mz kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/21362eb74fb938f12a1be2dabce45810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*7coLpGQUDM6-Zo9CKI0t3g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx na di nb lh">Rhats look better, but certainly not perfect.</figcaption></figure></div><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nc"><img src="../Images/eb792de58b00b17038a9fcf1ba7c00ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r08tEFqeopaaCqM2YTKGnQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Considering the heavy Rhats I would have expected less dense sampling, but this does not look that bad to be honest.</figcaption></figure><p id="5754" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有预测，看起来也不错。请记住，这是完全的统计，而不是机械建模。但最终，这个模型似乎确实做到了，代价是丢失了一些参数确切含义的信息。</p><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nd"><img src="../Images/b57eac4972aa7e179683b6b5d5b2801a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kf_oL-k1iRUIjTWoK9npQ.png"/></div></div></figure><p id="111c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我仍然不满意，希望最后再看一眼非线性函数。让我们再来一次。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="6564" class="kd ke hh jz b be kf kg l kh ki">df_long_group2&lt;-df_long%&gt;%filter(Condition=="20-1")<br/>plot(df_long_group2$Position, df_long_group2$Y)<br/>try&lt;-nls(Y ~ a1*exp(b1*Position)+c1, <br/>         data = df_long_group2,<br/>         start = list(a1 = 1, <br/>                      b1 = 1,<br/>                      c1 = 1), <br/>         na.action=na.exclude, <br/>         control=nls.control(maxiter = 1000, tol = 1e-05))<br/>summary(try)<br/>df_long_group2$pred&lt;-predict(try)<br/>ggplot(df_long_group2)+<br/>  geom_point(aes(x=Position, <br/>                 y=Y))+<br/>  geom_line(aes(x=Position, <br/>                y=pred, <br/>                group=Condition), col="red")+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl ne kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/65898601a9d60620bfbce7ab863f1478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*EioPdZVcPlc0gndTtDHEHw.png"/></div></figure><figure class="ku kl nf kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/b7723f44a2171d7d3e258f3dc826eae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*U5KhsPSfrconqNTr_AiM2g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx ng di nh lh">Looks very good. Not perfect, but the best one can expect. However, as you can already see, it cannot deal with the initial descent. This is because the data seem to be a combination of a power function and exponential function. I am sure that a model can be constructed, connecting them both, but that model will mostly likely be just as heavy in the parameters as the spline.</figcaption></figure></div><p id="c1f8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们在另一个条件下尝试同样的非线性函数。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="3aee" class="kd ke hh jz b be kf kg l kh ki">df_long_group2&lt;-df_long%&gt;%filter(Condition=="40-1")<br/>plot(df_long_group2$Position, df_long_group2$Y)<br/>try&lt;-nls(Y ~ a1*exp(b1*Position)+c1, <br/>         data = df_long_group2,<br/>         start = list(a1 = 2, <br/>                      b1 = 0.5,<br/>                      c1 = 300), <br/>         na.action=na.exclude, <br/>         control=nls.control(maxiter = 1000, tol = 1e-05))<br/>summary(try)<br/>df_long_group2$pred&lt;-predict(try)<br/>ggplot(df_long_group2)+<br/>  geom_point(aes(x=Position, <br/>                 y=Y))+<br/>  geom_line(aes(x=Position, <br/>                y=pred, <br/>                group=Condition), col="red")+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl ni kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/e016b485648f4a3a7a985704507f561c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*3sIW-t8T7AxYFDRCJyqu1A.png"/></div></figure><figure class="ku kl nj kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/342ef7e5d524a331b284ae8fcddada63.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*vZdVE0QqXtnlnqZkkb38Qw.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx nk di nl lh">Also fits, but once again, it will not model the initial descent.</figcaption></figure></div><p id="a0d5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下一个挑战是将非线性函数放入贝叶斯框架。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="6b67" class="kd ke hh jz b be kf kg l kh ki">get_prior(bf(Y | trials(N) ~ <br/>               a1*exp(b1*Position)+c1,<br/>             a1 + b1 + c1 ~ 1, nl=TRUE),<br/>          data= df_long,<br/>          family=binomial(link = "logit"))<br/>fit7&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     a1*exp(b1*Position)+c1,<br/>                   a1 + b1 + c1 ~ 1, nl=TRUE),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "a1"),<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "b1"), <br/>                  prior(uniform(-400, 400), class=b, coef=Intercept, nlpar = "c1")), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit7)<br/>df_long %&gt;%<br/>  add_epred_draws(fit7, <br/>                  ndraws=100, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25, col="red") +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw()       </span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nm"><img src="../Images/8f62c6051461f9b6f1bbe76cdb6541d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbnaZN7sRgC3nFeY5BEBYA.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Sampling is already taking a turn for the worst.</figcaption></figure><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nn"><img src="../Images/575c6cd051e5da488e5a556315fba59b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-Z5eR_7Vz9QtSqCGtyY1A.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Funny enough, the Bayesian model will try and model the initial descent but then has no parameters left to model the exponential part.</figcaption></figure><p id="b6cd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下一个尝试不会增加太多，但我仍在做，就是建立一个完全非线性的混合模型，其中三个参数可以根据条件变化。对于位置参数，我使用统一的先验，对于比例，我使用伽玛。</p><pre class="ju jv jw jx fd jy jz ka bn kb kc bi"><span id="c53c" class="kd ke hh jz b be kf kg l kh ki">fit7&lt;-brms::brm(bf(Y | trials(N) ~ <br/>                     a1*exp(b1*Position)+c1,<br/>                   a1 + b1 + c1 ~ 1 + (1|Condition), nl=TRUE),<br/>                data= df_long,<br/>                family=binomial(link = "logit"),<br/>                prior = c(<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "a1"),<br/>                  prior(uniform(-10, 10), class=b, coef=Intercept, nlpar = "b1"), <br/>                  prior(uniform(-300, 300), class=b, coef=Intercept, nlpar = "c1"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "a1"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "b1"),<br/>                  prior(gamma(1, 1), class=sd, group=Condition, nlpar = "c1")), <br/>                chains=4, <br/>                cores=6, <br/>                warmup = 3000,<br/>                iter = 6000)<br/>summary(fit7)<br/>df_long %&gt;%<br/>  add_epred_draws(fit7, <br/>                  ndraws=100, <br/>                  allow_new_levels = TRUE) %&gt;%<br/>  ggplot(aes(x = Position, <br/>             y = Y, <br/>             group=Condition)) +<br/>  geom_line(aes(y = .epred, group = paste(Condition, .draw)), alpha = 0.25) +<br/>  geom_point(data = df_long, color="black")+<br/>  facet_wrap(~Condition)+<br/>  theme_bw()</span></pre><div class="ju jv jw jx fd ab cb"><figure class="ku kl no kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/5da77075bc2e1dbcc2a3f831005a7c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*CqNYeQFLN-UFlQogK9NwJw.png"/></div></figure><figure class="ku kl np kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/1b7aec89f1b01d92109a4509ab5a6f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*W5uH0kmmpOKWBGhC81R8-g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx nq di nr lh">Rhats are even worse and if you look at the predictions it is best to close the graph viewer immediately. This is not helping at all.</figcaption></figure></div><p id="d553" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">也许有了更多的先验信息，或者在非线性函数中增加一个参数，我就可以改进这个模型，但是现在只能这样了。</p><p id="33a9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我将坚持使用条件样条模型，它为每个条件构建一个样条函数。这与书中的模型并不完全相同，但它仍然是一个模型。</p><p id="b663" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我的下一个系列中，我将更深入地研究STAN函数本身，它将提供更多的通用性。</p><p id="88ea" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果有什么不对劲，或者你有什么意见，请告诉我！</p><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nd"><img src="../Images/b57eac4972aa7e179683b6b5d5b2801a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kf_oL-k1iRUIjTWoK9npQ.png"/></div></div></figure><div class="ns nt ez fb nu nv"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nw ab dw"><div class="nx ab ny cl cj nz"><h2 class="bd hi fi z dy oa ea eb ob ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="oc l"><h3 class="bd b fi z dy oa ea eb ob ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="od l"><p class="bd b fp z dy oa ea eb ob ed ef dx translated">medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kq nv"/></div></div></a></div></div></div>    
</body>
</html>