<html>
<head>
<title>Using Machine Learning and Company Fundamentals for Beating the Stock Market</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用机器学习和公司基本面战胜股市</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/using-machine-learning-and-company-fundamentals-for-beating-the-stock-market-fa2d4ac438a7?source=collection_archive---------0-----------------------#2022-05-06">https://medium.com/mlearning-ai/using-machine-learning-and-company-fundamentals-for-beating-the-stock-market-fa2d4ac438a7?source=collection_archive---------0-----------------------#2022-05-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="e38c" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">为股票交易建立机器学习模型的实用指南</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/350e8ec3150de7c05bd50c022e082dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pb2H7eaVp8hT32R0"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@charlesdeluvio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">charlesdeluvio</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="51db" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在这篇文章中，我将展示如何构建一个简单的<strong class="jp hi">机器学习</strong>模型分类器，它可以用来帮助投资者选择投资哪些<strong class="jp hi">股票</strong>。</p><p id="809b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这篇文章虽然是介绍性的，但目标读者是具有一些Python和ML知识的人。如果你对ML和交易的更高层次的解释感兴趣，看看这个<a class="ae jm" rel="noopener" href="/@Batmaxx/machine-learning-and-stock-trading-ebf9a87c4297">的帖子</a>。</p><p id="7078" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">将涵盖以下主题:</p><ul class=""><li id="e6c5" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">数据准备—目标和特征创建(<strong class="jp hi">熊猫)</strong></li><li id="4797" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">探索性数据分析(<strong class="jp hi">熊猫概况)</strong></li><li id="5a56" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">建模(<strong class="jp hi"> LightGBM) </strong></li><li id="e06f" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">评估—分类器和投资组合(用<strong class="jp hi"> Plotly可视化)</strong></li></ul><p id="3b63" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">本文中使用的数据和代码可以在我的<a class="ae jm" href="https://github.com/Batmaxx/ml-model-for-stock-trading" rel="noopener ugc nofollow" target="_blank"> GitHub </a>页面上找到。你可以随意克隆这个项目来跟进。</p><p id="0606" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在存储库中，您还会发现一个<strong class="jp hi"> <em class="kx"> README.md </em> </strong>解释了如何设置一个包含所有必需依赖项的环境。</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><h1 id="73ff" class="lf lg hh bd lh li lj lk ll lm ln lo lp in lq io lr iq ls ir lt it lu iu lv lw bi translated">💽数据</h1><p id="3832" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了更容易理解，我创建了一个<strong class="jp hi">样本数据集</strong>，其中包含道琼斯30只成份股<a class="ae jm" href="https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi"/></a>的历史数据。该数据集已经在月级别进行了汇总，并且还创建了一些财务比率。</p><p id="d332" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">原始数据来自一家提供财务数据API的公司Tiingo。</p><h2 id="0b1f" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🔃加载数据集</h2><p id="1748" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">让我们将数据集加载到Pandas中。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ms"><img src="../Images/7047d9c16955bd4bf64f2ece20cd7275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IGk6Unyoa9xZfzZIBdz3A.png"/></div></div></figure><p id="ba21" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">以下是各列的含义:</p><ul class=""><li id="57de" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><em class="kx">股票代号</em>:股票的股票代号</li><li id="9ee3" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">日期</em>:日期(月末)</li><li id="e182" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx"> adjOpen </em>:当月第一天的开盘价(调整后)</li><li id="0c96" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx"> adjClose </em>:当月最后一天的收盘价(调整后)</li><li id="876c" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">price _ rate _ of _ change _ 1M</em>:股票上个月的收益</li><li id="5c4e" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">price _ rate _ change _ 3M</em>:最近3个月的股票收益</li><li id="ba1a" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx"> epsDil </em>:每股收益摊薄</li><li id="61b2" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">资产回报率</em>:资产回报率</li><li id="2a66" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">净资产收益率</em>:净资产收益率</li><li id="671c" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">市盈率</em>:市盈率</li><li id="5bd6" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><em class="kx">负债权益比率</em> : d/e比率</li></ul><h2 id="5bee" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🎯目标创建</h2><p id="83e3" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">我们将构建一个<strong class="jp hi">分类器</strong>模型，其中的目标将是一个<strong class="jp hi">布尔</strong>变量，指示股票在上个月的涨幅是否超过了<em class="kx"> X% </em>。</p><p id="9602" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在此之前，我们假设:</p><ul class=""><li id="ac57" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">我们在每月的第一天以开盘价买入</li><li id="1901" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">我们在这个月的最后一天以收盘价卖出</li><li id="0f38" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">回报是买价和卖价之间的差额(百分比)</li></ul><p id="aee1" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后，目标将采用以下值:</p><ul class=""><li id="be8b" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><code class="du mt mu mv mw b">True</code>如果股票收益高于或等于<em class="kx"> X% </em></li><li id="b099" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><code class="du mt mu mv mw b">False</code>否则</li></ul><p id="3046" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">目标<strong class="jp hi">阈值</strong> <strong class="jp hi"> <em class="kx"> X </em> </strong>的选择是可以使用对过去数据的实验或模拟来确定的。这里我们将保持简洁明了，使用固定的阈值<strong class="jp hi"> 5% </strong>。<br/>随意试验其他阈值(10%、20%……)或者甚至使用止盈止损建立一个更复杂的目标，就像德普拉多建议的<em class="kx">三重障碍法</em>(洛佩兹·德普拉多，M. (2018))。<em class="kx">金融机器学习的进展</em>。约翰·威利&amp;的儿子)。</p><p id="6761" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下面是创建目标的代码。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mx"><img src="../Images/26167590980a9d265d1ca3480847d622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*OpklJjZutV4FbDc4ovPkdg.png"/></div></figure><h2 id="4dd4" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🥗特征创建</h2><p id="b21a" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了简化笔记本，我已经使用原始数据预先计算了一些特征。如果你有兴趣知道我是如何创造它们的，请在评论中告诉我。<br/>我们将使用以下功能来构建模型:</p><ul class=""><li id="46c9" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">价格变化率1M</li><li id="7b80" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">价格变化率3M</li><li id="d8b0" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">艾普斯迪尔</li><li id="32cc" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">资产回报率</li><li id="2517" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">股本回报率</li><li id="4cba" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">价格对收入比率</li><li id="15e7" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">债务对权益比率</li></ul><p id="4cf9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这里非常重要的一步是<strong class="jp hi">将特征值移动一个周期</strong>。</p><p id="01a2" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们为什么要这样做？</p><p id="ba9f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">因为那些特性的实际值只有在月底才知道。我们需要确保用于预测目标的输入数据(特性)在月初可用。通过将特征值移动一个周期，我们确保不会产生<strong class="jp hi">数据泄漏</strong>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="33ba" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后我们需要删除每个ticker的第一行，删除在<code class="du mt mu mv mw b">shift()</code>操作中创建的<code class="du mt mu mv mw b">NaN</code>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="288d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这是包含要素和目标的最终数据集的外观。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es my"><img src="../Images/715c09e0672656261fea858b4293e53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQGlyajGvYRYoe5uUNC_ug.png"/></div></div></figure></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><h1 id="d3e6" class="lf lg hh bd lh li lj lk ll lm ln lo lp in lq io lr iq ls ir lt it lu iu lv lw bi translated">🔍探索性数据分析</h1><p id="830c" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了做一个快速的数据探索，我们将使用<a class="ae jm" href="https://github.com/ydataai/pandas-profiling" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi"> <em class="kx">熊猫图谱</em> </strong> </a>库。这个库非常适合用一行代码构建分析报告，如下所示。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="5d6f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们得到了这个漂亮的<strong class="jp hi">互动报告</strong>，可以随意在笔记本上滚动浏览。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mz"><img src="../Images/4c63b9aca6f38e7629a7a5d517218657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9b5vugswZcIYEHn3swTbJw.png"/></div></div></figure><p id="d628" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从报告中，我们可以看到<strong class="jp hi">数据</strong>总体上是相当<strong class="jp hi">干净</strong>的。</p><p id="7783" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">重要的是要注意到<strong class="jp hi">目标</strong>分布是<strong class="jp hi">不平衡的</strong>，在建模部分要记住这一点！</p><p id="6f71" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们还看到列<code class="du mt mu mv mw b">price_to_earnings_ratio</code>和<code class="du mt mu mv mw b">debt_to_equity_ratio</code>的一些<strong class="jp hi">异常值</strong>。我现在不打算深入探讨这个问题，但是，这个问题在以后的阶段会很有趣。移除或修复这些异常值可能会提高模型的性能。</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><h1 id="c4e8" class="lf lg hh bd lh li lj lk ll lm ln lo lp in lq io lr iq ls ir lt it lu iu lv lw bi translated">🤖建模</h1><p id="1d50" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">现在我们有了一个数据集，我们将使用<a class="ae jm" href="https://lightgbm.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi"> LightGBM </strong> </a>构建一个简单的<strong class="jp hi">分类器</strong>模型。</p><blockquote class="na nb nc"><p id="6253" class="jn jo kx jp b jq jr ii js jt ju il jv nd jx jy jz ne kb kc kd nf kf kg kh ki ha bi translated">LightGBM是一个梯度推进框架，使用基于树的学习算法。</p></blockquote><p id="e568" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我喜欢LightGBM是因为它的<strong class="jp hi">高精度</strong>、<strong class="jp hi">快速训练</strong>，最重要的是它的<strong class="jp hi">易用性</strong>。事实上，您几乎不需要任何预处理就可以让LightGBM模型工作，例如，分类特征或NaN会自动处理。</p><p id="9401" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">因为它是基于树的，所以对环境也更好(😁)并且对于非技术人员来说更容易解释和可视化，导致涉众更容易接受模型。</p><h2 id="6511" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🪓分割数据</h2><p id="1042" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了简单起见，我们将使用简单的<strong class="jp hi">训练/测试</strong>分割，并省略任何更复杂的交叉验证程序。<br/>2020年<strong class="jp hi">的数据将用于测试，之前的数据将用于训练。</strong></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="0cb1" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">👔安装分类器</h2><p id="caf7" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">让我们创建一个分类器估计器，并将其应用于训练数据。我使用默认的超参数，除了<strong class="jp hi"> <em class="kx"> is_unbalance </em> </strong>被设置为<strong class="jp hi"> <em class="kx"> True ( </em> </strong>给定数据集的高级<strong class="jp hi">不平衡</strong>)和<strong class="jp hi"> max_depth </strong>、<strong class="jp hi"> num_leaves、</strong>和<strong class="jp hi"> min_child_samples </strong>被设置为根据lightGBM <a class="ae jm" href="https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html" rel="noopener ugc nofollow" target="_blank">文档</a>的“适当”值。</p><p id="03e8" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">请随意试验其他超参数！</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="d464" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🔮根据测试数据进行预测</h2><p id="fe25" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">一旦模型适合训练数据，我们就可以用它来预测测试数据。在<em class="kx"> df_test </em>中创建了一个新列<strong class="jp hi"> <em class="kx"> buy </em> </strong>，它包含了模型做出的预测。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ng"><img src="../Images/26545aefcfc80837988143d678cdb501.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*PlcqZ9loAryzCnTZqcPo9w.png"/></div></figure><p id="4d65" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">既然我们已经对测试集进行了预测，我们可以继续进行<strong class="jp hi">评估</strong>部分，在这里我们将评估模型的性能。</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><h1 id="20bd" class="lf lg hh bd lh li lj lk ll lm ln lo lp in lq io lr iq ls ir lt it lu iu lv lw bi translated">✅评估模型</h1><p id="560a" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">我们将从两个方面评估模型的性能:</p><ul class=""><li id="f4d8" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><strong class="jp hi">分类器性能</strong>:使用准确度、精确度、召回率等指标。我们可以评估分类器在区分好的<em class="kx">和</em>表现差的股票方面有多好。</li><li id="bb40" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><strong class="jp hi">投资组合表现</strong>:使用回溯测试，我们可以模拟我们会赚到多少钱(或者赚不到！)，并计算总回报、夏普比率、提款等财务指标。</li></ul><h2 id="e5c6" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">📝分类器性能</h2><p id="ac06" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了全面了解分类器的性能，我们将使用来自sklearn的<code class="du mt mu mv mw b">classification_report</code>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nh"><img src="../Images/cddadeb0b866930f761b1245f7041dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*GwNQ3wXZi3lcTVMl6LklYQ.png"/></div></figure><p id="2086" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">总体<strong class="jp hi">精度</strong>为<strong class="jp hi"> 61% </strong>。该模型在预测<em class="kx">假</em>类方面做得相当好(73%的精度，66%的召回率)，但在预测<em class="kx">真</em>类<em class="kx"> </em> (42%的精度，50%的召回率)方面就不太好了。</p><p id="a306" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">考虑到数据集的<strong class="jp hi">高级不平衡</strong>，我们在这种情况下使用<strong class="jp hi">精确度</strong>时应该小心。</p><h2 id="40af" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">📈<strong class="ak">投资组合表现</strong></h2><p id="3656" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">现在让我们更关注模型的财务表现。也就是说，我们能用这种模式赚钱吗？</p><p id="a964" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">为此，我们采取以下假设:</p><ul class=""><li id="006a" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">每个月我们投资<code class="du mt mu mv mw b"><strong class="jp hi">n</strong></code>不同的股票(取决于模型预测)</li><li id="9c74" class="kj kk hh jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">我们在每只股票上投资相同的金额(<code class="du mt mu mv mw b"><strong class="jp hi">1/n</strong></code>)</li></ul><p id="5af9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">有了这些假设，我们可以很容易地计算出策略的月回报，然后计算出总回报或夏普比率等财务指标。</p><p id="4b0a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们首先只选择模型做出正面预测的股票(买入)。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ni"><img src="../Images/b22308c6be4e32f9816dc26087e59c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*m3EAnfp-KSPiixwcXwziRQ.png"/></div></figure><p id="121f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后<strong class="jp hi">汇总</strong>月份级别的数据，以了解<strong class="jp hi">每月挑选多少股票</strong>，以及<strong class="jp hi">的平均回报率</strong>是多少。我们可以使用每月平均回报，因为我们假设我们将投资于每只选定的股票。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nj"><img src="../Images/25c6768ea6a9756eba3241e9f091b4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*bGkUM_CC5dRGZhay6lgVQg.png"/></div></figure><p id="fee7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们可以使用<code class="du mt mu mv mw b">describe()</code>函数来获得一些统计数据。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nk"><img src="../Images/4227a2c7a6d84e6b18e69912013e48eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*CYCsceRk47TZEqbmq02Cfw.png"/></div></figure><p id="4048" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">每月挑选<strong class="jp hi">股票</strong>的数量从<strong class="jp hi"> 3到27 </strong>不等，每月<strong class="jp hi">平均收益</strong>为<strong class="jp hi"> 2.96% </strong>。</p><p id="d779" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">让我们也计算一下<a class="ae jm" href="https://www.investopedia.com/terms/s/sharperatio.asp" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi">夏普比率</strong> </a>，这是一个非常常用的指标，用来评估投资回报与其风险的对比。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nl"><img src="../Images/85ad407c98fddba5dd52c7039a648271.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*dJKVVOuAAK7DxbZbhnVtbA.png"/></div></figure><p id="28d3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">夏普</strong>比<strong class="jp hi"> 1.16 </strong>，还不错:)</p><h2 id="eb86" class="mc lg hh bd lh md me mf ll mg mh mi lp jw mj mk lr ka ml mm lt ke mn mo lv mp bi translated">🎨<strong class="ak">可视化</strong></h2><p id="8a56" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">为了直观显示一段时间内的回报，我们首先需要计算<strong class="jp hi">累积回报</strong>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nm"><img src="../Images/221b860537156196f7c9f5b03be6939a.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*F14xB32vEr7b9YodVgONuA.png"/></div></figure><p id="6ac0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后我们可以用<a class="ae jm" href="https://plotly.com/python/getting-started/" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi"/></a>制作一些漂亮的情节。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nn"><img src="../Images/b8b06b3be29206d922193fb40eb3e301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgAdt2YoUOjwo-MIKDO7kA.png"/></div></div></figure><p id="fb2b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这些初步结果看起来一点也不差，即使3月份左右发生新冠肺炎危机，我们也能在2020年获得<strong class="jp hi"> +36%的回报率</strong>，这非常有希望:)</p><p id="5bd0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然而，为了全面了解情况，我们需要正确看待这些结果，并将其与<strong class="jp hi">基准策略</strong>进行比较。正如我们使用道琼斯的<strong class="jp hi"> 30只股票一样，我们将使用跟踪同一指数的ETF:<a class="ae jm" href="https://www.ssga.com/us/en/intermediary/etfs/funds/spdr-dow-jones-industrial-average-etf-trust-dia" rel="noopener ugc nofollow" target="_blank"><strong class="jp hi">DIA</strong></a>。</strong></p><p id="a4a3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们来加载这个ETF的数据。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es no"><img src="../Images/3fab30070390a29d3d9671aa8ccb836d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkbuo6Y085pbrS6nLuzDkQ.png"/></div></div></figure><p id="7e50" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们计算这个基准策略的夏普比率。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es np"><img src="../Images/e658d6c236c8bfb54234711899d6bcd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*Wqsvxmp1bgX7Y5pvCUc_3A.png"/></div></figure><p id="b474" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">夏普</strong>比<strong class="jp hi"> 0.45 </strong>，这个比ML车型的要低很多！</p><p id="5d88" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">让我们在同一张图上画出这两种策略，以便更好地了解它们的区别。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nq"><img src="../Images/185c77a0d291ee9f70520b57e435866d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODW8KKHdNhDio8AQYTkVyA.png"/></div></div></figure><p id="92b7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">ML模型遵循与基准策略相同的<strong class="jp hi">轨迹，考虑到股票的<strong class="jp hi">集合</strong>仅限于<strong class="jp hi"> 30个报价器，这是有意义的。</strong></strong></p><p id="7c9f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然而，该模型似乎能够区分和挑选高性能股票，导致比基准高3倍的回报率和提高的T2夏普比率，干得好！</p><h1 id="61fe" class="lf lg hh bd lh li nr lk ll lm ns lo lp in nt io lr iq nu ir lt it nv iu lv lw bi translated">🔚结论</h1><p id="d9ee" class="pw-post-body-paragraph jn jo hh jp b jq lx ii js jt ly il jv jw lz jy jz ka ma kc kd ke mb kg kh ki ha bi translated">我希望这篇介绍性的帖子能够给你一些关于如何使用<strong class="jp hi">机器学习</strong>进行<strong class="jp hi">交易</strong>的见解。</p><p id="56a7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">随意摆弄笔记本，尝试不同的算法和特性，或者用权重、止损、获利、费用等改进回溯测试方法。<br/>不过要小心，在金融机器学习中很容易获得“好看”的回溯测试，这是金融专业人士经常强调的事情。在另一篇文章中，我将写关于重复回溯测试的危险，并展示过度拟合一个模型是多么容易，以及嵌套交叉验证是如何帮助降低这种风险。</p><p id="fd3e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果您有任何问题或评论，请发表评论，并关注我以获得更多类似这样的帖子！</p><p id="69fa" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你也可以在交易平台<a class="ae jm" href="https://etoro.tw/3ajuXgr" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi"> eToro </strong> </a>上<strong class="jp hi">关注我</strong>，在这里我使用机器学习作为我投资策略的核心。</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><p id="af4a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><em class="kx">此帖子包含社交交易平台</em> <a class="ae jm" href="https://etoro.tw/3ajuXgr" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> eToro </em> </a>的附属链接</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><div class="ix iy iz ja fd nw"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hi fi z dy ob ea eb oc ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jg nw"/></div></div></a></div></div></div>    
</body>
</html>