<html>
<head>
<title>Machine learning Pipelines Explained✨💡!!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习管道Explained✨💡！！</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/machine-learning-pipelines-explained-ef1094fec9b3?source=collection_archive---------4-----------------------#2022-07-17">https://medium.com/mlearning-ai/machine-learning-pipelines-explained-ef1094fec9b3?source=collection_archive---------4-----------------------#2022-07-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6e27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本博客将向你解释在机器学习问题中实现流水线的简单方法。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a3120624a8eb7a63ae737ba2fcf65bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*P5xgi_5JoA_edV3bainqdw.png"/></div></div></figure><blockquote class="jp jq jr"><p id="9a13" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">因此，首先我们将从导入所有用于数据操作和数据可视化的基本库开始，我们将导入歌曲流行度预测的<strong class="ig hi"> Kaggle数据集</strong>。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="1edc" class="ka kb hh jw b fi kc kd l ke kf">import numpy as np <em class="jc"># linear algebra</em><br/>import pandas as pd <em class="jc"># data processing, CSV file I/O (e.g. pd.read_csv)<br/></em>import seaborn as sns #data visualization library<br/>import matplotlib.pyplot as plt #data visualization library</span><span id="b54e" class="ka kb hh jw b fi kg kd l ke kf">import warnings # ignoring warnings<br/>warnings.filterwarnings('ignore')<br/><br/><br/>import os<br/>for dirname, _, filenames <strong class="jw hi">in</strong> os.walk('/kaggle/input'):<br/>    for filename <strong class="jw hi">in</strong> filenames:<br/>        print(os.path.join(dirname, filename))</span><span id="cc54" class="ka kb hh jw b fi kg kd l ke kf">Output:</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/b403d239a53f644a590028be7dc4d256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*esLgJov74WeALOswtgqbNQ.png"/></div></div></figure><blockquote class="jp jq jr"><p id="2ebc" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">然后我们将使用<strong class="ig hi"> pandas.read_csv() </strong>函数从训练集和测试集读取数据并提交样本。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="5fd1" class="ka kb hh jw b fi kc kd l ke kf">train=pd.read_csv("/kaggle/input/song-popularity-prediction/train.csv")<br/>test=pd.read_csv("/kaggle/input/song-popularity-prediction/test.csv")<br/>submission=pd.read_csv("/kaggle/input/song-popularity-prediction/sample_submission.csv")</span></pre><blockquote class="jp jq jr"><p id="c682" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">读取数据集后，我们将通过查看数据集中前五行和所有列来浏览数据集。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="ea71" class="ka kb hh jw b fi kc kd l ke kf">train.head()<br/>Output:</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/25c21ab4ff68f4663640fea551bc58df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYGmesBmyg6IN1ELg-qC-g.png"/></div></div></figure><blockquote class="jp jq jr"><p id="1a16" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">然后，我们将查看数据集的每一列中是否有任何空值，因为大多数ML算法都不能处理空值，所以空值需要通过某些值进行估算，所以我们有8列需要估算空值。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="ea17" class="ka kb hh jw b fi kc kd l ke kf">train.isna().sum()<br/>Output:</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/eb888c12defa27369ddd043f7c2d7a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hn4V9NcD4O4PiAg_y6wkFQ.png"/></div></div></figure><blockquote class="jp jq jr"><p id="45dc" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们将看到数据集的形状，因为该数据集包含<strong class="ig hi"> 28000 </strong>行和<strong class="ig hi"> 14 </strong>列。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="a508" class="ka kb hh jw b fi kc kd l ke kf">x_train.shape<br/>Output: ( 28000,14 )</span></pre><blockquote class="jp jq jr"><p id="0e9f" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">因此，在获得一些数据后，我们将使用sklearn模块中的训练和测试分割数据为训练数据(70%数据)和验证数据(30%数据)。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="20a1" class="ka kb hh jw b fi kc kd l ke kf">from sklearn.model_selection import train_test_split<br/>x_train,x_test,y_train,y_test=train_test_split(train.drop("song_popularity",axis=1),train["song_popularity"],test_size=0.3,random_state=0)</span></pre><blockquote class="jp jq jr"><p id="5599" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们正在导入sklearn模块，用于编码数值和分类值，缩放整个数据集的值，并使用决策树算法。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="d80f" class="ka kb hh jw b fi kc kd l ke kf">from sklearn.impute import SimpleImputer # imputing numeric values<br/>from sklearn.preprocessing import OneHotEncoder # imputing catogerical values<br/>from sklearn.preprocessing import StandardScaler # scaling values<br/>from sklearn.tree import DecisionTreeClassifier # Tree algorithm</span></pre><blockquote class="jp jq jr"><p id="b707" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们正在从sklearn模块中导入列转换器和管道来转换值，并为我们的整个ML流程创建一个管道，以避免数据泄漏，并在没有重复的情况下制作生产就绪代码，如果我们有任何需要预测的新点可以直接输入管道。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="5bc3" class="ka kb hh jw b fi kc kd l ke kf">from sklearn.compose import ColumnTransformer #to transform column<br/>from sklearn.pipeline import Pipeline,make_pipeline # to make pipeine</span></pre><blockquote class="jp jq jr"><p id="9191" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们使用默认策略输入所有空值列，即使用列转换器，这使得读取和使用所有输入步骤成为一个列转换器对象<strong class="ig hi"> trf1 </strong>。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="69a7" class="ka kb hh jw b fi kc kd l ke kf">trf1=ColumnTransformer([<br/>    ("impute values1",SimpleImputer(),[1]),<br/>    ("impute values2",SimpleImputer(),[2]),<br/>    ("impute values3",SimpleImputer(),[3]),<br/>    ("impute values4",SimpleImputer(),[4]),<br/>    ("impute values5",SimpleImputer(),[5]),<br/>    ("impute values7",SimpleImputer(),[7]),<br/>    ("impute values8",SimpleImputer(),[8])],remainder="passthrough")</span></pre><blockquote class="jp jq jr"><p id="8ac2" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们使用column transformer通过一个热编码输入所有分类值列，这使得读取和使用所有输入步骤成为一个列转换器对象<strong class="ig hi"> trf2 </strong>。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="a7ef" class="ka kb hh jw b fi kc kd l ke kf">trf2=ColumnTransformer([<br/>    ("OHE values6",OneHotEncoder(sparse=False,handle_unknown="ignore"),[6])]<br/>    ,remainder="passthrough")</span></pre><blockquote class="jp jq jr"><p id="f158" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们使用列转换器通过标准缩放器对象缩放所有列，这使得读取和使用所有输入步骤成为一个列转换器对象<strong class="ig hi"> trf3 </strong>。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="3b75" class="ka kb hh jw b fi kc kd l ke kf">trf3=ColumnTransformer([<br/>    ("Scale",StandardScaler(),slice(0,19))])</span></pre><blockquote class="jp jq jr"><p id="d016" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们使用决策树分类器，因为这是一个分类问题，我们使用列转换器，这使得读取和使用所有步骤成为一个列转换器对象变得容易，如<strong class="ig hi"> trf4 </strong>。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="45d2" class="ka kb hh jw b fi kc kd l ke kf">trf4=DecisionTreeClassifier()</span></pre><blockquote class="jp jq jr"><p id="f8d3" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">这里，我们将所有列转换器制作成一个名为pipe的管道，顺序从1到4，这样，所有步骤都将一个接一个地传递到每个列转换器，我们在每个列转换器上执行一个特征工程步骤。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="d328" class="ka kb hh jw b fi kc kd l ke kf">pipe=Pipeline([<br/>    ('trf1',trf1),<br/>    ('trf2',trf2),<br/>    ('trf3',trf3),<br/>    ('trf4',trf4),<br/>])</span></pre><blockquote class="jp jq jr"><p id="e7e9" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">这里我们用sklearn模块中的set_config模块显示我们的管道，当我们调用fit函数时，管道就显示在这里。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="7d14" class="ka kb hh jw b fi kc kd l ke kf">from sklearn import set_config<br/>set_config(display="diagram")</span></pre><blockquote class="jp jq jr"><p id="29fc" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">在这里，我们通过管道对象拟合数据，使用x_train和y_train进行所有特征工程和模型拟合步骤。</p><p id="bb9f" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">输出非常直观地显示所有特征工程和模型拟合步骤，以了解整个管道。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="5202" class="ka kb hh jw b fi kc kd l ke kf">pipe.fit(x_train,y_train)<br/>Output:</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kj"><img src="../Images/6858d0068bba65f7013723a90b00191c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxpyxopUjfReA6PphPhjCw.png"/></div></div></figure><blockquote class="jp jq jr"><p id="cb9e" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们使用管道对象预测验证，并将它们存储在y_pred中。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="8c23" class="ka kb hh jw b fi kc kd l ke kf">y_pred=pipe.predict(x_test)</span></pre><blockquote class="jp jq jr"><p id="c4c9" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们正在导入<strong class="ig hi"> ROC AUC得分</strong>指标，因为这是一个分类问题，需要将各个类别分开。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="0148" class="ka kb hh jw b fi kc kd l ke kf">from sklearn.metrics import roc_auc_score <br/>roc_auc_score(y_test,y_pred)</span><span id="7771" class="ka kb hh jw b fi kg kd l ke kf">Output: 0.5</span></pre><blockquote class="jp jq jr"><p id="6b29" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我们将模型的预测提交到提交文件，这里我们没有得到好的<strong class="ig hi"> ROC AUC分数，</strong>这个博客的目标是教导使用管道和列转换器解决ML问题。</p></blockquote><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="a94a" class="ka kb hh jw b fi kc kd l ke kf">pred=pipe.predict(test)<br/>test['song_popularity'] = pred<br/>submission = test[['id', 'song_popularity']]<br/>submission.to_csv('submission.csv', index=False)</span></pre><p id="6257" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想看Kaggle笔记本的全部代码，请点击这里的链接<a class="ae kk" href="https://www.kaggle.com/code/mahendragundeti/pipelines-approach-in-ml" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="e649" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读！</p><p id="79a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关注我了解更多关于DS和ML的内容。</p><div class="kl km ez fb kn ko"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hi fi z dy kt ea eb ku ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">medium.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc jn ko"/></div></div></a></div></div></div>    
</body>
</html>