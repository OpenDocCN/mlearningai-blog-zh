<html>
<head>
<title>How to specify location for bars and ticks for barplots in matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在matplotlib中为条形图指定条形和刻度的位置</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-specify-location-for-bars-and-ticks-for-barplots-in-matplotlib-490f097eada7?source=collection_archive---------2-----------------------#2022-05-11">https://medium.com/mlearning-ai/how-to-specify-location-for-bars-and-ticks-for-barplots-in-matplotlib-490f097eada7?source=collection_archive---------2-----------------------#2022-05-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3e3fbab1e2182f0ea3e136f5888305f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnXoSBKE4XQSXZhFfxKwgg.png"/></div></div></figure><h1 id="957d" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">摘要</h1><p id="b07d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">本教程一步一步地详细介绍了如何绘制条形图，其中您希望根据您的意愿在自定义位置绘制条形图，并且标签应与相应的条形图一起打印。</p><h1 id="5d12" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="b28e" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">最近，我在做一个数据分析项目，包括一个网站在过去5年里从世界不同国家收到的流量数据集。我希望绘制一个条形图，显示一年中流量最大的前5或前10个国家。</p><p id="5be5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">实现这一点的直接解决方案是为每年绘制五个单独的条形图，然后并排比较它们。然而，我想写一个python代码，在单个条形图中标出流量/点击率最高的前5或前10个国家。</p><h1 id="71c1" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">关于数据集</h1><p id="658e" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我已经将值更改为csv文件的虚拟数字，该文件将用于本例，保持我手头的结构。csv包含一个国家栏和一个5年栏。表中的每个数值都是该国历年来的点击数。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es kq"><img src="../Images/2c247c9002a9ed170b8f322e2ca9a4d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*OjsjyR3rCdX-RfRCjrWwJw.png"/></div></figure><h1 id="8ea5" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">让我们开始工作吧</h1><p id="f139" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><strong class="jp hi"> <em class="kv">导入必要的库</em> </strong></p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="ecc4" class="lb iq hh kx b fi lc ld l le lf">import pandas as pd<br/>import numpy as np</span><span id="4b2f" class="lb iq hh kx b fi lg ld l le lf">import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="3365" class="lb iq hh kx b fi lg ld l le lf">from matplotlib.pyplot import figure</span></pre><p id="f0c2" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi"> <em class="kv">读取数据帧</em> </strong>中的csv</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="c94f" class="lb iq hh kx b fi lc ld l le lf">df = pd.read_csv(‘countries_hits.csv’)<br/>df.head(5)</span></pre><p id="f13f" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">输出:</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es lh"><img src="../Images/c4b38fb1a29377c1b5e2047a4583f3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*pTlQZ_Js_TI1EhCuzqqIcQ.png"/></div></figure><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="0019" class="lb iq hh kx b fi lc ld l le lf">df.shape</span></pre><p id="acc5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">输出:</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es li"><img src="../Images/a8bae8387a5c9253962910cf07743e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:130/format:webp/1*oJUaUiV8a7eFRLrigHkwmQ.png"/></div></figure><h2 id="5baa" class="lb iq hh bd ir lj lk ll iv lm ln lo iz jy lp lq jd kc lr ls jh kg lt lu jl lv bi translated"><strong class="ak">方法:</strong></h2><ol class=""><li id="ec2d" class="lw lx hh jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">我们将提取列表“year”中所有带有年份的列名。这将是一年的循环，并在最后的柱状图中绘制图例。</li><li id="0008" class="lw lx hh jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">我们将对任何给定年份的数据帧进行降序排序，并将该特定年份的切片以及前5个国家的名称和值存储在虚拟数据帧“sorted_df”中</li><li id="2346" class="lw lx hh jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">接下来，我们将编写一个循环，在同一个图表中为每年绘制一个条形图，该图表将是我们的网站在该年收到的点击量。我们还必须确保没有酒吧重叠。</li><li id="9fae" class="lw lx hh jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">最后，我们将编写一个用于显示xticks的循环，这些x ticks将是我们对应条形的国家/地区，然后对我们的图表进行一些修饰性的更新，为图表添加图例和适当的标题。</li></ol><h2 id="415b" class="lb iq hh bd ir lj lk ll iv lm ln lo iz jy lp lq jd kc lr ls jh kg lt lu jl lv bi translated">执行:</h2><p id="4526" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><em class="kv">在我们创建一个函数并将所有内容合并到一个代码单元之前，让我们经历一次循环迭代并理解其中的机制。</em></p><p id="f5fc" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">第一步:</strong></p><p id="6242" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">让我们提取变量“year”中的列名，并将其转换为列表。此外，我们将忽略第一列的标题“国家”。</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="a9a3" class="lb iq hh kx b fi lc ld l le lf">year = df.columns<br/>year = year.tolist()<br/>year.remove(year[0])<br/>year</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/44a6e076286356dd97148effa55ab4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*Gbp8jV9-Sf-3lZrMEb8ILw.png"/></div></figure><p id="d420" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">第二步:</strong></p><p id="fda6" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">声明并初始化将在后续步骤中使用的变量:</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="bec8" class="lb iq hh kx b fi lc ld l le lf">country = []    #to store the top 5 country names<br/>initiate = 0    #to compute the location for bar<br/>start = 0       #to compute the location for bar<br/>stop = 0        #to compute the location for bar<br/>xtick_loc = [] #to store location on which xlabel to be displayed<br/>barWidth = 0.2  #width of bar to be plotted<br/><br/>clicks = None   #to store the top 5 country's click count</span><span id="c529" class="lb iq hh kx b fi lg ld l le lf">value = ‘2018’  #initiate to simulate first iteration of loop<br/>index = 0       #initiate to simulate first iteration of loop</span></pre><p id="486f" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">让我们对数据帧进行排序，并根据需要对其进行切片:</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="9ad5" class="lb iq hh kx b fi lc ld l le lf"><br/>df = df.sort_values(by = [value], ascending = False)</span><span id="0362" class="lb iq hh kx b fi lg ld l le lf">sorted_df = df.iloc[ :5, :index+2]</span><span id="ef29" class="lb iq hh kx b fi lg ld l le lf">sorted_df</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es ml"><img src="../Images/f52f559858cdcc334ff085ebf4031a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*gRMPCP12n4fuzBplNA8BMw.png"/></div></figure><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="0b1d" class="lb iq hh kx b fi lc ld l le lf">clicks = sorted_df.iloc[:, index+1:][value].values.tolist()</span><span id="9b00" class="lb iq hh kx b fi lg ld l le lf">clicks</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mm"><img src="../Images/55b78982a8b8b8acfadcdac56733a762.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*RSeaVQbGVvp7DaeD_y_9rQ.png"/></div></figure><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="8df6" class="lb iq hh kx b fi lc ld l le lf">if len(country) == 0:<br/> country = sorted_df[‘Country’].values.tolist()<br/>else:<br/> country = country + sorted_df[‘Country’].values.tolist()</span><span id="ecc3" class="lb iq hh kx b fi lg ld l le lf">country</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mn"><img src="../Images/7c5ec89ada686ab472cd32177b6d8b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*fCN-JaxpKH615amfyw9LJw.png"/></div></figure><p id="5dfe" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">总结到目前为止所执行的步骤，我们已经获得了“点击”数组，该数组将被传递给plt.bar函数，以根据高度绘制条形图。</p><p id="4ff3" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们还有一个“country”数组，它将被传递给plt.xticks，以便为每个条形绘制适当的分笔成交点，并使读者更容易理解该图。</p><p id="1cd0" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">第三步:</strong></p><p id="2d09" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们已经收集了“什么”的信息到目前为止，我们对这篇文章的主要问题是“哪里？”去策划。</p><p id="e279" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们需要指定每个条从x轴起点的距离。0.对于要在图上绘制的每一年的数据，我们在x轴上有1个单位的杠杆。换句话说，对于2018年，我们可以使用0到1的距离。我们将为2019年及以后的年份指定1到2的范围。</p><p id="9d92" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">因为我们将绘制前5个国家，所以将在提到的范围0到1之间绘制5个条形。因此，我们需要创建一个数组来存储每个条形到x轴的距离，该数组将被传递给plt.bar和plt.xticks，以使用“点击”来绘制条形，并使用“国家”来显示国家名称</p><p id="e156" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们需要一个数组“r ”,以0开始，以1结束，以barwidth(0.2)为增量。</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="2547" class="lb iq hh kx b fi lc ld l le lf">for i in range(0, len(clicks)):<br/> stop += barWidth</span><span id="c130" class="lb iq hh kx b fi lg ld l le lf">stop = round(stop, 2)<br/>r = np.arange(start, stop, barWidth, dtype = float)<br/>stop = round(stop, 2)<br/>start = math.ceil(stop)<br/>stop = math.ceil(stop)</span><span id="38a2" class="lb iq hh kx b fi lg ld l le lf">r</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mo"><img src="../Images/1b471d92cd69257a79e209c02f5e165a.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*0KJmLR_aQ83ODBbSxpvHiw.png"/></div></figure><p id="9fad" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我知道看起来我们已经写了太多行代码来得到一个增量为0.2的数组。我们这样做是为了处理当我们将所有这些代码转换成一个动态且健壮的函数时将会传递的所有参数。</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="73fd" class="lb iq hh kx b fi lc ld l le lf">bar = plt.bar(r, clicks, width = barWidth, edgecolor=’white’, label = value)</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mp"><img src="../Images/41fe4ae148b4716bfe30ca747484ad7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*30HffNGguop7V89LuhHmWw.png"/></div></figure><p id="8149" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们将清空数组，以便能够在下一次迭代中再次使用它，从1.0开始，到2019年的1.8，依此类推。</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="3f05" class="lb iq hh kx b fi lc ld l le lf">for i in range(0, len(r)):<br/> r = np.delete(r, obj = 0, axis = 0)</span></pre><p id="6beb" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">第四步:</strong></p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="eff3" class="lb iq hh kx b fi lc ld l le lf">for x in range(0,len(clicks)):<br/> xtick_loc.append(initiate)<br/> initiate = round(initiate, 2)<br/> initiate += barWidth<br/> initiate = math.ceil(initiate)<br/>xtick_loc</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mq"><img src="../Images/688800b04741c73b41c1d82ec2383ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*1xdbJZrrqb9aY8NOA8ht0w.png"/></div></figure><p id="2b66" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们不会在每次迭代后清空xticks数组。我们将简单地追加所有的位置，重复计算“r”的步骤。</p><p id="521c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们有了绘制简介中显示的图表所需的所有必要组件。让我们将所有代码合并到一个函数中，并给图表添加一些标题和标签，看看效果如何。</p><pre class="kr ks kt ku fd kw kx ky kz aw la bi"><span id="0da3" class="lb iq hh kx b fi lc ld l le lf">def plot(df, barWidth, top_n):<br/>    year = df.columns<br/>    year = year.tolist()<br/>    year.remove(year[0])</span><span id="e9eb" class="lb iq hh kx b fi lg ld l le lf">    country = []<br/>    start = 0<br/>    stop = 0 <br/>    xtick_loc = []<br/>    initiate = 0<br/>    <br/>    figure(figsize=(20, 15), dpi=80)<br/>    <br/>    for index, value in enumerate(year):<br/>        clicks = None<br/>        df = df.sort_values(by = [value], ascending = False)<br/>        sorted_df = df.iloc[ :top_n, :index+2]<br/>        clicks = sorted_df.iloc[:, index+1:][value].values.tolist()</span><span id="df45" class="lb iq hh kx b fi lg ld l le lf">        if len(country) == 0:<br/>            country = sorted_df['Country'].values.tolist()<br/>        else:<br/>            country = country + sorted_df['Country'].values.tolist()</span><span id="41f8" class="lb iq hh kx b fi lg ld l le lf">        for i in range(0, len(clicks)):<br/>            stop += barWidth</span><span id="9321" class="lb iq hh kx b fi lg ld l le lf">        stop = round(stop, 2)<br/>        r = np.arange(start, stop, barWidth, dtype = float)<br/>        stop = round(stop, 2)<br/>        start = math.ceil(stop)<br/>        stop = math.ceil(stop)</span><span id="f782" class="lb iq hh kx b fi lg ld l le lf">        bar = plt.bar(r, clicks,  width = barWidth, edgecolor='white', label = value)</span><span id="5bc3" class="lb iq hh kx b fi lg ld l le lf">        for i in range(0, len(r)):<br/>            r = np.delete(r, obj = 0,  axis = 0)</span><span id="d5a3" class="lb iq hh kx b fi lg ld l le lf">    for value in range(0, len(year)):<br/>        for x in range(0,len(clicks)):<br/>            xtick_loc.append(initiate)<br/>            initiate = round(initiate, 2)<br/>            initiate += barWidth<br/>        initiate = math.ceil(initiate)</span><span id="b2ab" class="lb iq hh kx b fi lg ld l le lf">    plt.title("Distribution of Top 5 Countries with Maximum Hits Yearwise.", fontsize = '18')</span><span id="ca90" class="lb iq hh kx b fi lg ld l le lf">    plt.ylabel('Clicks',fontsize= 18)<br/>    plt.xlabel('Top Ranked Countries', fontsize= 18)<br/>    plt.xticks([xtick_loc for xtick_loc in xtick_loc ], country,rotation ='vertical', fontsize= 15)</span><span id="62c7" class="lb iq hh kx b fi lg ld l le lf">    plt.yticks(fontsize= 15)</span><span id="ef54" class="lb iq hh kx b fi lg ld l le lf">    plt.ticklabel_format(style='plain',useOffset=False, axis ='y')</span><span id="2054" class="lb iq hh kx b fi lg ld l le lf">    plt.grid(b = True, axis = 'y', color = 'green', linestyle = '--', linewidth = 0.5, alpha = 0.7)<br/>    plt.minorticks_on()<br/>    plt.grid(b = True, axis = 'y', which='minor', color='#999999', linestyle='-', alpha=0.2)</span><span id="7b9e" class="lb iq hh kx b fi lg ld l le lf">    plt.legend(fontsize = 15)<br/>    plt.show()</span><span id="2042" class="lb iq hh kx b fi lg ld l le lf">plot(df, 0.2, 5)</span></pre><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3e3fbab1e2182f0ea3e136f5888305f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnXoSBKE4XQSXZhFfxKwgg.png"/></div></div></figure><p id="5b25" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kv">注意:您还可以将barWidth的值更改为0.1，将top_n的值更改为10，并分别观察前10个国家。</em></p><p id="363b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">感谢您阅读文章。请联系任何关于kakadiya95@gmail.com的问题、澄清或版权问题。或者，你可以在我的Linkedin页面上给我发消息。另外，检查我的<a class="ae mr" href="https://github.com/sh4dowbyt3" rel="noopener ugc nofollow" target="_blank"> github </a>账户。</p><div class="ms mt ez fb mu mv"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hi fi z dy na ea eb nb ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj in mv"/></div></div></a></div></div></div>    
</body>
</html>