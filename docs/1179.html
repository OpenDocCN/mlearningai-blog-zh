<html>
<head>
<title>Website Scraping Using Python in Five Steps — Data Science With Craigslist Data Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python分五步进行网站抓取Craigslist数据的数据科学第2部分</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/a-step-by-step-how-to-do-a-data-science-project-with-craigslist-data-part-2-website-scraping-d352351655ee?source=collection_archive---------1-----------------------#2021-10-19">https://medium.com/mlearning-ai/a-step-by-step-how-to-do-a-data-science-project-with-craigslist-data-part-2-website-scraping-d352351655ee?source=collection_archive---------1-----------------------#2021-10-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/ead17ea89e5351529796d00607d44d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ce9QS__fDzsELbhaOA6MVg.png"/></div></div></figure><div class=""/><p id="6e90" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇文章中，我将带你一步一步地了解我从Craigslist收集车辆发布数据的步骤。我使用Python和BeautifulSoup库进行web scrape，这只是从网站获取数据的众多方法之一。理想情况下，一个API最适合这个目的，但是Craigslist没有一个API可以让我得到我需要的数据。</p><p id="b70c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想在Jupyter笔记本上继续学习，完整的代码贴在我的GitHub上。</p><p id="d939" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果在Craigslist上导航到任何城市的<em class="jo">汽车&amp;卡车</em>，你将可以选择查看来自私人卖家和经销商的广告。我选择只从私人卖家那里收集数据，因为这些帖子包含了更多关于待售汽车的可靠信息。我还选择了带图片的帖子，因为我想下载高级项目部分的图片，如图像识别或NLP。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jp"><img src="../Images/3da81f9935f179bf80ab8344e9235a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qckyptsUV0aS63kff-d-Cw.png"/></div></div></figure><p id="ee58" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后，我需要的数据被嵌入到每个车辆帖子页面中，如下图右侧所示。不要担心，如果不是下面的图像中的一切都有意义。我们很快就会谈到这一点。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ju"><img src="../Images/d454cb157bf853822f3497d9a21790dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCE9xAq3AG5-woOvpvuCGA.png"/></div></div></figure><p id="98e3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在视觉上检查了网站之后，我能够想出我将如何构造我的代码的游戏计划。</p><h1 id="7b77" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">概括地说，我抓取网站的五步工作流程如下:</h1><ol class=""><li id="1304" class="kt ku hs ir b is kv iw kw ja kx je ky ji kz jm la lb lc ld bi translated"><strong class="ir ht">第一步:</strong>创建一个我想要获取数据的城市列表</li><li id="be17" class="kt ku hs ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated"><strong class="ir ht">第二步:</strong>导航至每个城市的<em class="jo">汽车&amp;卡车，由车主</em>出售</li><li id="2bd3" class="kt ku hs ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated"><strong class="ir ht">第三步:</strong>对于每个城市，导航至每个可用页面</li><li id="25d4" class="kt ku hs ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated"><strong class="ir ht">第四步:</strong>对于每个可用页面，导航到每个帖子</li><li id="943c" class="kt ku hs ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated"><strong class="ir ht">第五步:</strong>对于每个帖子，获取帖子属性</li></ol><p id="0d33" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是sudo代码的工作版本。</p><h1 id="309f" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">代码</h1><p id="48fa" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">首先，我启动了一个Jupyter notebook实例并导入了必要的库。我们从<em class="jo"> bs4 </em>中导入<em class="jo"> requests </em>模块来处理http请求和<em class="jo"> BeautifulSoup </em>，后者是从网站获取数据的模块。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="4cc7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下一步是在Craigslist上创建一个我们想要导航到的城市列表。这些城市名称必须与Craigslist上的拼写相同。例如旧金山是旧金山湾否则你会得到一个页面没有找到错误。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="839a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在将获得城市内每个页面的链接，然后我们将拥有每个城市的所有页面的列表。每个页面有120个帖子。因此，要转到下一页，我们只需要创建一个页面占位符，并将它递增120，就可以得到下一页。我们继续这个迭代，直到我们到达1800页或更少。我选择1800是因为页面上的帖子通常在30天左右。最终结果是一个包含每个城市所有页面链接的列表。</p><p id="3073" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得每个城市页面的链接，我们将使用一个循环来更改来自<em class="jo">城市</em>列表的基本城市链接中的城市名称，并将其存储在一个名为<em class="jo"> city_link的变量中。</em>我们所做的只是从网站上获取任何一个城市链接，并创建一个占位符链接，该链接带有一个更改城市名称和页码的选项。类似这样的"<a class="ae jn" href="https://sfbay.craigslist.org/d/cars-trucks-by-owner/search/cto?s=120&amp;hasPic=1" rel="noopener ugc nofollow" target="_blank">https://<strong class="ir ht">SF bay</strong>.craigslist.org/d/cars-trucks-by-owner/search/cto？s= <strong class="ir ht"> 1 </strong></a></p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="578f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行上述代码后，我们现在有了一个链接列表，这些链接指向out <em class="jo"> cities </em>列表中每个城市的可用页面。下面是页面链接的一部分。对于所有15个城市，我们总共得到225个页面链接，每个包含120个单独的汽车帖子。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div class="er es lo"><img src="../Images/c0926efbbfbfae33d0b92849bf7c6a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*U-okCwzpxMW7PK-QyJzEdg.png"/></div></figure><figure class="jq jr js jt fd hj er es paragraph-image"><div class="er es lp"><img src="../Images/adbcad69e5f7422a01c73ebee6bbed26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*X1HDqHvVI-qc4Guhmrfaiw.png"/></div></figure><p id="cb79" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们已经有了这个包含在每个城市的<em class="jo">车主出售汽车</em>部分的所有页面的长列表，我们需要导航到每个页面并获得每个单独汽车帖子的链接。也就是120篇文章乘以225页。总之，我们应该结束了大约27，000个链接。所有27，000条都代表Craigslist上的一个特定车辆帖子。</p><p id="f358" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得车辆链接，我们循环遍历上面创建的列表中的每个页面链接，并获得每页的所有120个帖子。我们将这些链接存储在一个名为<em class="jo"> car_urls </em>的列表变量中。</p><p id="db02" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得每篇文章的链接，我们将使用BeautifulSoup来解析网页中的链接。为此，我们从请求库中传递一个到get方法的链接，如果链接存在，它应该返回一个响应代码<em class="jo">&lt;Response[200】&gt;</em>。然后我们将请求对象传递给BeautifulSoup的一个实例，并添加一个<em class="jo"> html.parser </em>标志。然后返回一个html对象，如下所示。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lq"><img src="../Images/1a60ef3b6df0b116649bd4a9438de104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAGzMJ6paIr_37oXKsO10A.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">This is the html object returned by BeautifulSoup</figcaption></figure><p id="b67f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后我们可以告诉<em class="jo"> soup </em>对象使用<em class="jo"> find_all </em>方法在返回的<em class="jo"> html </em>对象中查找我们的车辆链接。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lv"><img src="../Images/b72d6b0d97ca93b8cf48278fe37568f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cu7bSt0fEunZn1X2KrUEug.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">This is the find_all results</figcaption></figure><p id="5afe" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以通过右击你的chrome浏览器并选择inspect很容易地找出链接在哪里。这将打开如下所示的带有页面html结构的面板。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ca"><img src="../Images/fb454b090169427cc711c97310ab0ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e07RxjrbZtaP_6E53bq7xg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">The class_= ‘result-image gallery’ houses all vehicle links in the page</figcaption></figure><p id="d5b8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">html链接由<em class="jo"> href </em>标记表示，但是由于html对象中有许多href，我们还想告诉soup应该查看哪个<em class="jo">类</em>。从上面的例子中，我们想要查看的<em class="jo">类</em>是<em class="jo">结果-图像库</em>类。所有包含的hrefs都指向该页面上的单个车辆帖子，如下所示。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lw"><img src="../Images/9cd231c9296f90b7e228516d3b24b007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vj-o26-u3rUtXEkoimO_Lg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">hrefs contained within the “result-image gallery” class</figcaption></figure><p id="0bb0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后，我们可以将这些链接存储到数据框或csv中，供以后查看。获取所有车辆链接的完整代码如下所示。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="eb5e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们看到，现在我们有24706个汽车帖子的链接，我们现在可以指向BeautifulSoup来抓取数据，但首先我们保存一个副本，以便我们可以随时稍后返回。这一步很简单，我们只需将其保存为csv文件。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lx"><img src="../Images/637fcb2bd7f85f16ca50151f954bfa2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EYWfCEPW3NRh6fdcWsIttg.png"/></div></div></figure><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="8760" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后将文件读回熊猫数据框。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="51da" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好了，现在我们已经有了所有我们需要的链接，让我们开始刮车辆的细节。为此，我们将再次使用BeautifulSoup，但这一次我们将浏览每个车辆帖子页面。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/ead17ea89e5351529796d00607d44d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ce9QS__fDzsELbhaOA6MVg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Some visible vehicle attributes that we want to scrape</figcaption></figure><p id="7495" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同样，我们将每个车辆链接传递给<em class="jo">请求</em>模块，并将结果传递给一个BeautifulSoup对象。然后，我们使用BS对象的find方法从页面中获取车辆属性和任何其他数据。例如，对于价格，我们发现价格<em class="jo">类</em>如下。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div class="er es ly"><img src="../Images/f70414b6d6491bbb4482bb131d098093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*nDla-rYk4Y_4GiakIVMRyw.png"/></div></figure><p id="d6e5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了找到日期时间，我们使用下面的。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div class="er es lz"><img src="../Images/6b8ceaaf3c5658b86676bea8c53cfe62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*R3oXdyasjgyXqWWKobZGBg.png"/></div></figure><p id="a617" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于地理位置，我们从html的<em class="jo">地图框类</em>中解析它们，如下所示。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div class="er es ma"><img src="../Images/661dcd7b695c118ba196f683b8db2716.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*lerMZ4Rf4q__atUOWMuAeg.png"/></div></figure><p id="32b5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里是从每个车辆链接获取车辆属性的完整代码。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="c77b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们从27K车辆链接中获得了所有车辆属性，并将其存储在一个列表列表中。一些最小的清理也是动态完成的，比如创建属性标签，从价格中删除美元符号和逗号。</p><p id="2759" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">每辆车及其属性都存储在列表<em class="jo"> car_final中。</em></p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mb"><img src="../Images/dd625eee5953095d842113def93c26d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjLWxGarJh2K29aleqYRcQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Each vehicle’s attributes stored in a list</figcaption></figure><p id="f34c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并且每个列表都存储在列表<em class="jo">汽车</em>中。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mc"><img src="../Images/19df9bdee3b4d2795bca83ae0a9a2eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x47SO4x0yoAUMY54Yyimbg.png"/></div></div></figure><p id="9503" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，我们必须存储这些数据以供将来分析。我所做的是用属性标签作为键名来创建字典。为此，我创建了一个键/值对字典，其中每个键代表一个列名，然后将字典存储在列表<em class="jo"> car_dicts </em>中。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es md"><img src="../Images/f8c75c56b1be6fea4433a2af609de7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hc_2dKG-bs6n5yIcifsCQA.png"/></div></div></figure><p id="b51f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后将字典列表写入熊猫数据框。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="08e4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后预览数据框，看看我们的数据是否存储正确。</p><figure class="jq jr js jt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es me"><img src="../Images/db33cbc429bedce8c261d5f08e47a448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oR-K1hVimAB-iB7-lHn9Ag.png"/></div></div></figure><p id="9408" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后将数据帧保存到csv或转储到数据库。</p><figure class="jq jr js jt fd hj"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="7b24" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是所有的乡亲。至少现在是这样。我们已经成功地从Craigslist收集了数据。我们现在有一个月内全美15个城市的24000多辆汽车的数据。</p><p id="4050" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请加入我的下一部分，<strong class="ir ht">C</strong><a class="ae jn" rel="noopener" href="/p/2d49bf39dbde"><strong class="ir ht">raigs list Cars For Sale数据项目:第3部分—数据清理</strong> </a>，因为我们执行了一些非常需要的数据清理，如修复数据类型和创建新列。如果您对上述过程有任何反馈，也请告诉我。谢谢大家！</p></div></div>    
</body>
</html>