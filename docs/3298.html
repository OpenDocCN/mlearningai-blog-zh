<html>
<head>
<title>Explainable Convolutional Neural Networks with PyTorch + SHAP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyTorch + SHAP的可解释卷积神经网络</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/explainable-convolutional-neural-networks-with-pytorch-shap-62ffb229a918?source=collection_archive---------2-----------------------#2022-08-16">https://medium.com/mlearning-ai/explainable-convolutional-neural-networks-with-pytorch-shap-62ffb229a918?source=collection_archive---------2-----------------------#2022-08-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a8f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">用PyTorch和SHAP解释卷积神经网络的预测</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/34a5a13edf6208fde3c8eb64e2f4499e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pww3TwNnC2dCLF2H.png"/></div></div></figure><p id="2ecb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">深度学习等复杂技术曾经是一种黑盒模型，因为你无法彻底了解内部发生了什么。然而，像<a class="ae jp" href="https://shap.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> SHAP </a>(匀称的附加解释)这样的工具让它成为过去。有了SHAP，你可以用最少的编码轻松解读深度学习模型的预测。</p><p id="ed6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">CNN不是最容易理解的概念。一个使用数学计算的网络学习图像的<a class="ae jp" href="https://ieeexplore.ieee.org/document/7877043" rel="noopener ugc nofollow" target="_blank">内核</a>，并检测有用的模式来正确分类看不见的图像。如果你想一想，你的大脑也有类似的行为，利用模式看到它面前的图像。例如，如何识别类似于7的东西？一条倾斜的直线，上面有一条水平线，对吗？这也正是CNN中模式的工作方式。</p><p id="ac92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然我们当然可以知道CNN的衡量标准来确定他们的表现，但我们不能完全理解他们是如何得出结果的。SHAP非常适合这个目的，因为它让我们用一种视觉的方式来观察内部。</p><p id="69eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以今天，我们将使用时尚MNIST数据集来展示SHAP是如何工作的。教程对应的笔记本可以在我的<a class="ae jp" href="https://github.com/fenago/blog/blob/main/SHAP_CNN.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="2239" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是我们将如何经历不同的部分:</p><p id="17ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模型架构</p><p id="f629" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">训练模型</p><p id="7f1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与SHAP一起解读结果</p><p id="6242" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">包裹</p><h1 id="3e2f" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">模型架构</h1><p id="7747" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">我们将使用PyTorch来训练时尚MNIST数据集，该数据集在这里<a class="ae jp" href="https://www.kaggle.com/zalando-research/fashionmnist" rel="noopener ugc nofollow" target="_blank">公开发布</a>。PyTorch是一个非常流行的用于深度学习的Python库，它的特性非常丰富。但是，不要担心，即使您以前没有使用PyTorch的经验，因为它只是Python。</p><p id="3140" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在定义架构之前，让我们导入一些必需的库。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="4a59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，让我们定义我们将用来训练我们的神经网络的架构。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="4b86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就是这样！我们现在可以继续训练部分了。</p><h1 id="430b" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">训练模型</h1><p id="f670" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在开始模型训练部分之前，我们需要完成两项重要任务。首先，定义将控制我们训练的变量batch_size和num_epochs，然后，定义我们的<em class="jc"> train() </em>和<em class="jc"> test() </em>函数。所以，让我们开始吧。下面是batch_size和num_epochs在这个场景中的含义。</p><p id="beb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">batch_size:一次训练的图像数量</p><p id="8ca9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">num_epochs:整个数据集从模型中通过的总次数</p><p id="26bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是上面提到的两个任务的代码片段。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="67de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们必须加载并转换数据集，这样才能将其转换为张量并进行归一化。最后，分批整理。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="b44b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们已经为训练模型做好了一切准备。让我们实例化模型，并为之前定义的纪元进行训练。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="3cd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行此单元可能需要一些时间，具体取决于可用的资源。但是，当模型正在训练时，您将能够在单元的输出框中看到训练结果。以下是我的输出区域在训练时的样子:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kv"><img src="../Images/8e343dc91b45b3e316d98acd31fd6335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HTOpHIukkPi1um0OdpyFw.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Image by Author</figcaption></figure><p id="293d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦这个细胞完成执行，我们的模型就完全训练好了！下一步是解释模型的结果。</p><h1 id="a3e7" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">与SHAP一起解读结果</h1><p id="8015" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">SHAP的模型解释非常简单。我们只需调用SHAP的<em class="jc"> DeepExplainer() </em>函数，并提供模型和测试值作为参数。一旦完成，我们将创建几个<em class="jc"> numpy </em>数组来存储shap值和测试值。最后，我们可以使用SHAP的<em class="jc"> image_plot() </em>函数来绘制结果。</p><p id="ddfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以这样编码。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/ad873c329aae2d554d1786868f9d72d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TdINYFfU9NVu9on9.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Image By Author</figcaption></figure><p id="f582" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在最左侧看到输入图像，而每个图像的预测都在各自的行上。随着颜色变红，模型输出增加，增加了模型预测的可信度。至于更蓝的一面，则是相反的情况。</p><p id="e846" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这正是使用SHAP解释模型结果的快捷方式。它不仅速度快，而且还为您提供了模型性能的逻辑概述。</p><h1 id="6aae" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">包裹</h1><p id="cf19" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">深度学习模型曾经是黑匣子，人们看不到里面发生了什么。然而，SHAP在一定程度上改变了这种情况，并提供了一种很好的方式来可视化模型是如何执行的。</p><p id="47b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的文章中，我们使用PyTorch从零开始创建了一个深度学习模型，对来自时尚MNIST数据集的衣服进行分类。此外，我们还看到了如何使用SHAP库轻松解释模型的结果。</p><p id="5e13" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有任何问题或意见，请随时在下面提出。感谢阅读！</p><div class="lb lc ez fb ld le"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hi fi z dy lj ea eb lk ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">medium.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jn le"/></div></div></a></div></div></div>    
</body>
</html>