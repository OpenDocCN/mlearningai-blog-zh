<html>
<head>
<title>Building an Instagram Scraper in 3 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在3分钟内建立一个Instagram刮刀</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/building-a-instagram-scraper-in-3-minutes-a6aac0a2512f?source=collection_archive---------1-----------------------#2021-06-22">https://medium.com/mlearning-ai/building-a-instagram-scraper-in-3-minutes-a6aac0a2512f?source=collection_archive---------1-----------------------#2021-06-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6405b0d317c97d093bbd3a39ef1cb5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5oFE74S1k7TcEdo-D5oaQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image from Instagram</figcaption></figure><p id="e57e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">Twitter是为情感分析、文本分类和机器学习项目收集文本的最广泛使用的来源。Twitter为用户提供了自己的API来抓取他们的文本数据。然而，现在的Instagram更多地被二三十岁的青少年和年轻人使用。不幸的是，你需要自己做一个刮刀或者使用开源库来抓取他们的文本数据或者评论。我发现使用开源库包来抓取Instagram评论极其困难。本文将指导你在<em class="jr"> 3分钟</em>内建立自己的Instagram评论抓取器！</p><h2 id="c347" class="js jt hh bd ju jv jw jx jy jz ka kb kc je kd ke kf ji kg kh ki jm kj kk kl km bi translated">1.安装并加载所需的库包</h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="859b" class="js jt hh ks b fi kw kx l ky kz">import pandas as pd<br/>import time<br/>import re<br/>import os<br/>import csv<br/>import json<br/>from urllib.request import urlopen<br/>from urllib.parse import quote_plus<br/>from bs4 import BeautifulSoup<br/>from selenium import webdriver</span></pre><p id="8fb9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后你需要从这个网站下载网络驱动:【https://chromedriver.chromium.org/downloads T2】</p><p id="dcbd" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将你下载的网络驱动程序(默认情况下可能会命名为<strong class="iv hi"> <em class="jr"> chromedriver </em> </strong>)放在你想要工作的文件夹中。</p><h2 id="6a3d" class="js jt hh bd ju jv jw jx jy jz ka kb kc je kd ke kf ji kg kh ki jm kj kk kl km bi translated">2.保存驱动程序并获取URL</h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="c6aa" class="js jt hh ks b fi kw kx l ky kz">driver = webdriver.Chrome(‘path to your driver’)</span><span id="0165" class="js jt hh ks b fi lb kx l ky kz"># link to the post you want to scrap comments from (This is Kim Kardashian's Instagram URL)<br/>url = "<a class="ae la" href="https://www.instagram.com/p/CQWQDCOgSt9/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/p/CQWQDCOgSt9/</a>"</span><span id="025e" class="js jt hh ks b fi lb kx l ky kz"># Driver will access to the URL<br/>driver.get(url)</span></pre><p id="6df3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后你保存你的驱动程序，并把它放入到你的驱动程序的路径中！所以我的应该是这样的:<em class="jr"> webdriver。chrome('/用户/irenekim/桌面/个人/抓取/chromedriver') </em></p><p id="cffa" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">Instagram允许从公众账号收集评论和图片。还有，只要你用的是公众人物的公开账号，就不算侵犯隐私。但是一定要反复检查，不要侵犯任何人的数据隐私！</p><p id="1833" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">如果你想知道当前的工作目录，你可以用一个简单的代码找到它，它会显示你现在在python中的哪个工作目录:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="df96" class="js jt hh ks b fi kw kx l ky kz">os.getcwd()</span></pre><h2 id="ba4c" class="js jt hh bd ju jv jw jx jy jz ka kb kc je kd ke kf ji kg kh ki jm kj kk kl km bi translated">3.操作你的驱动抓取评论</h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="ae1e" class="js jt hh ks b fi kw kx l ky kz"># Create an empty container to put all the comments inside<br/>comments = []</span></pre><p id="8a02" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这些代码会自动为你点击Instagram上的加载更多按钮！</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="9568" class="js jt hh ks b fi kw kx l ky kz">hasLoadMore = True<br/>while hasLoadMore:<br/>    time.sleep(1)<br/>    try:<br/>        if driver.find_element_by_css_selector('#react-root &gt; section &gt; main &gt; div &gt; div &gt; article &gt; div.eo2As &gt; div.EtaWk &gt; ul &gt; li &gt; div &gt; button &gt; span'):<br/>            driver.find_element_by_css_selector('#react-root &gt; section &gt; main &gt; div &gt; div &gt; article &gt; div.eo2As &gt; div.EtaWk &gt; ul &gt; li &gt; div &gt; button &gt; span').click()<br/>    except:<br/>        hasLoadMore = False</span></pre><p id="f31b" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv hi"> _6lAjh </strong>'是Instagram中用户名的类名。'<strong class="iv hi">find _ elements _ by _ CSS _ selector</strong>中写的路径是Instagram中span按钮加载更多评论的路径。您可以通过右键单击页面并进入'<em class="jr">检验</em>'页面来试验该路径。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f203" class="js jt hh ks b fi kw kx l ky kz">users_list = []<br/>users = driver.find_elements_by_class_name('_6lAjh')</span><span id="ace5" class="js jt hh ks b fi lb kx l ky kz">for user in users:<br/>    users_list.append(user.text)<br/>    <br/>i = 0<br/>texts_list = []</span><span id="72e2" class="js jt hh ks b fi lb kx l ky kz">texts = driver.find_elements_by_css_selector('#react-root &gt; section &gt; main &gt; div &gt; div &gt; article &gt; div.eo2As &gt; div.EtaWk &gt; ul &gt; ul &gt; div &gt; li &gt; div &gt; div &gt; div.C4VMK &gt; span')</span><span id="7e74" class="js jt hh ks b fi lb kx l ky kz">for txt in texts:<br/>    texts_list.append(txt.text)<br/>    i += 1<br/>    comments_count = len(users_list)<br/><br/>for i in range(1, comments_count):<br/>    user = users_list[i]<br/>    text = texts_list[i]<br/>    comments.append(users_list[i])<br/>    comments.append(texts_list[i])<br/>    print("User ",user)<br/>    print("Text ",text)<br/>    print()</span></pre><p id="be1f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">结果应该是这样的！出于隐私考虑，我删除了这里的用户名。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="7454" class="js jt hh ks b fi kw kx l ky kz">User  user1<br/>Text  🙌 I love this 😍<br/><br/>User  user2<br/>Text  Fatherhood ❤️</span></pre><p id="00b5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">调用comments会给你所有的用户名列表和他们的评论。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f494" class="js jt hh ks b fi kw kx l ky kz">['user1',<br/> 'This post is everything ❤️',<br/> 'user2',<br/> 'Kids r adorable']</span></pre><h2 id="c8d1" class="js jt hh bd ju jv jw jx jy jz ka kb kc je kd ke kf ji kg kh ki jm kj kk kl km bi translated">4.为模型训练制作好看的CSV文件</h2><p id="c70c" class="pw-post-body-paragraph it iu hh iv b iw lc iy iz ja ld jc jd je le jg jh ji lf jk jl jm lg jo jp jq ha bi translated">我感兴趣的是分离所有的用户名和他们的评论，因为我们需要的通常是文本，而不是用户名。因此，我将创建一个CSV文件，在“用户”列中包含所有帐户，在“文本”列中包含相应的评论。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="7e45" class="js jt hh ks b fi kw kx l ky kz">rows = []<br/>for user, text in zip(comments[::2], comments[1::2]):<br/>    print(user, text)<br/>    rows.append([user, text])</span><span id="f430" class="js jt hh ks b fi lb kx l ky kz">fields = ["User", "Text"]<br/>filename = "cleanfile.csv"<br/>with open(filename, 'w',  encoding='utf-8', newline='') as csvfile: <br/>    csvwriter = csv.writer(csvfile) <br/>    csvwriter.writerow(fields) <br/>    csvwriter.writerows(rows)<br/></span><span id="5406" class="js jt hh ks b fi lb kx l ky kz">df = pd.read_csv(r"path to your filename")<br/>print(df)</span></pre><p id="02f3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">只是提醒一下，别忘了放。csv在你的路径的末端到你的文件名！</p><p id="ff47" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">结果是一个干净的数据帧:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="2564" class="js jt hh ks b fi kw kx l ky kz">     User                Text<br/>0  user100         I love you Kim<br/>1  user200         Causal nothing, it's called wanting attention<br/>2  user300         This women needs mental health this is just wr...</span></pre><p id="1e34" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">正如你所看到的，有一些刻薄的评论… <br/>我实际上写了我的硕士论文，关于检测网络欺凌的评论，这些评论专门针对使用深度学习的女性！无论如何，这是你创建自己的Instagram评论抓取工具的时候了。</p><p id="c98e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">轻松点。</p></div></div>    
</body>
</html>