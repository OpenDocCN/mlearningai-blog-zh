<html>
<head>
<title>How to create an international soccer match prediction model with python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用python创建国际足球比赛预测模型？</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-to-create-an-international-soccer-match-prediction-model-8245538e1a3a?source=collection_archive---------2-----------------------#2022-11-08">https://medium.com/mlearning-ai/how-to-create-an-international-soccer-match-prediction-model-8245538e1a3a?source=collection_archive---------2-----------------------#2022-11-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/75b633c7c15fb8e862c57e780e79e164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOwKDMORIqck73JCGQF__g.png"/></div></div></figure><p id="0200" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">离卡塔尔世界杯还有不到一个月的时间，球迷们已经在讨论谁会是下一届世界冠军。在本帖中，我们将创建一个预测模型来确定哪支球队最有可能赢得足球比赛并最终赢得世界杯。</p><p id="d9a5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">历史上，足球比赛是由两个队的进球来模拟的，这些进球遵循一种称为泊松分布的概率分布。该分布接收一个名为lambda的参数，并返回从0到无穷大的每个整数的概率。在下图中，我们可以看到使用平均目标数作为预测值时目标分布的拟合程度。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es jn"><img src="../Images/ce394c19ddd155fe6d6cbdc7daed8aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*W2NWrmP96hN7Ty7TPuMQmA.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Image from <a class="ae jw" href="https://soccermatics.readthedocs.io/en/latest/lesson5/DealingRandomness.html" rel="noopener ugc nofollow" target="_blank">Soccermatics</a></figcaption></figure><p id="6a3a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如你所看到的，进球数平均值并不是一个很好的进球数预测值，因为在某些情况下，进球数线与进球数条的实际值相差甚远。为了改善这种情况，我们将尝试使用球队的elo得分(我们在以前的帖子中计算过)和球队的移动平均进球数来预测球队在一场比赛中的进球数。我们将使用的数据将是在<a class="ae jw" href="https://www.kaggle.com/datasets/martj42/international-football-results-from-1872-to-2017" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>中可用的历史数据。</p><p id="6231" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在训练模型之前，我们需要先做一些数据处理。所有的代码都可以在这个帖子的<a class="ae jw" href="https://github.com/danielguerreros/WC-Model" rel="noopener ugc nofollow" target="_blank"> GitHub库中找到。</a></p><p id="6374" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">比赛被过滤，只考虑自1990年以来的重要比赛和友谊赛。主队或客队进球超过6个的比赛被忽略，因为它们是异常值。</p><pre class="jo jp jq jr fd jx jy jz ka aw kb bi"><span id="8c90" class="kc kd hh jy b fi ke kf l kg kh">matches=matches[(pd.to_datetime(matches['date'])&gt;dt.datetime(1989,12,31))&amp;(matches['tournament'].isin(tournaments))]</span><span id="adab" class="kc kd hh jy b fi ki kf l kg kh">matches =matches[['date','home_team','away_team','home_score','away_score','neutral','Elo_a_before','Elo_h_before']]</span><span id="52a7" class="kc kd hh jy b fi ki kf l kg kh">matches = matches[(matches['home_score']&lt;6)&amp;(matches['away_score']&lt;6)].reset_index(drop=True)</span></pre><p id="3ce4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意我会用各队的Elo分数。我在<a class="ae jw" rel="noopener" href="/mlearning-ai/how-to-calculate-elo-score-for-international-teams-using-python-66c136f01048">之前的帖子</a>中解释了如何计算。</p><p id="b548" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于我们将使用泊松分布预测每支球队的进球数，因此我们需要拆分每场比赛的数据，以便每支球队有一行。为此，我们为主场和客场分别创建一组数据，然后将这两组数据连接起来。</p><pre class="jo jp jq jr fd jx jy jz ka aw kb bi"><span id="db41" class="kc kd hh jy b fi ke kf l kg kh">home=matches[["date","home_team","home_score","neutral","Elo_a_before","Elo_h_before"]].rename(columns={'home_team':"Team","home_score":"Goals_for","Elo_a_before":"Elo rival","Elo_h_before":"Elo"})</span><span id="f797" class="kc kd hh jy b fi ki kf l kg kh">away=matches[["date","away_team","away_score","Elo_a_before","Elo_h_before"]].rename(columns={'away_team':"Team","away_score":"Goals_for","Elo_a_before":"Elo","Elo_h_before":"Elo rival"}).assign(neutral=0).assign(local=0)</span><span id="7ced" class="kc kd hh jy b fi ki kf l kg kh">df=pd.concat([home,away],ignore_index=True).sort_values("date").reset_index(drop=True)</span></pre><p id="d62b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们将计算移动平均线作为预测值。为了计算它，我们将使用滚动(3)。mean()函数将前3个数据放入一行，并计算这些数据的平均值。我们对每场比赛使用shift()函数来获得之前的数据，但不包括那场比赛中的进球。</p><p id="ed87" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这些计算之后，我们将有一个数据帧，每场比赛有两行，一行是主场数据，另一行是客场数据。有了这些数据，我们可以继续训练我们的模型。</p><p id="2fe0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了训练模型，我们将使用带有泊松分布参数的statsmodel包。在这种情况下，我们要预测的变量将是进球，如果有主场优势和进球的移动平均值，预测器将是净胜球。</p><pre class="jo jp jq jr fd jx jy jz ka aw kb bi"><span id="252a" class="kc kd hh jy b fi ke kf l kg kh">model = smf.glm(formula="Goals_for ~ local + Moving_goals_for + Elo_difference", data=df,</span><span id="09ee" class="kc kd hh jy b fi ki kf l kg kh">family=sm.families.Poisson()).fit()</span></pre><p id="4537" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们已经将模型训练好并存储在一个变量中。但是现在我们如何预测呢？</p><p id="c4b8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">需要注意的是，模型给我们的是球队的平均进球数。所以我们需要知道每个队进一球、两球等的概率，才能知道赢一场比赛的概率。</p><p id="3ec6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设我们想预测巴西和阿根廷之间的比赛。巴西的Elo为1763，平均进球数为1，而阿根廷的Elo为1733，平均进球数为2。</p><p id="feac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了找到每个目标的概率，我们使用下面的代码</p><pre class="jo jp jq jr fd jx jy jz ka aw kb bi"><span id="3cf8" class="kc kd hh jy b fi ke kf l kg kh">argentina_elo=1733.03<br/>brazil_elo=1763.62</span><span id="4bf4" class="kc kd hh jy b fi ki kf l kg kh">argentina_data = pd.DataFrame(data={'local':0,'Moving_goals_for':2.0,'Elo_difference':argentina_elo-brazil_elo},index=[1])</span><span id="64f4" class="kc kd hh jy b fi ki kf l kg kh">brazil_data = pd.DataFrame(data={'local':0,'Moving_goals_for':1.0,'Elo_difference':brazil_elo-argentina_elo},index=[1])</span><span id="1bed" class="kc kd hh jy b fi ki kf l kg kh"># Get avg goals predicted by model<br/>argentina_avg_goals = model.predict(argentina_data).values[0]<br/>brazil_avg_goals = model.predict(brazil_data).values[0]</span><span id="cc5a" class="kc kd hh jy b fi ki kf l kg kh"># Get probability of score 1 to 5 goals for each teamteam_pred = [[poisson.pmf(i, team_avg) for i in range(0, 5)] for team_avg in [argentina_avg_goals, brazil_avg_goals]]</span></pre><p id="bf61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有了每个队进x个球的概率，我们现在需要可能的组合，这可以用NumPy的外部函数}}来完成</p><pre class="jo jp jq jr fd jx jy jz ka aw kb bi"><span id="75f3" class="kc kd hh jy b fi ke kf l kg kh">np.outer(np.array(team_pred[0]), np.array(team_pred[1]))</span></pre><p id="656e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这样，我们就有了一个数组，其中位置i-j是阿根廷进球“I”和巴西进球“j”的概率。有了这个矩阵，我们就可以计算出阿根廷赢、巴西赢或平局的概率。</p><p id="eb68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">平局的概率将是对角线的和，因为它将是所有结果的概率的和，其中两个得分相同。</p><p id="84ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">阿根廷的概率将是矩阵的下三角之和，巴西的概率将是上三角之和。</p><p id="2a61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这种情况下，概率如下:</p><p id="f69d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">阿根廷:31.3%平局:31.3%巴西:37.4% </strong></p><p id="68ff" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以现在我们有了预测足球比赛的模型。如果你想知道每组谁更有可能通过以及其他根据这个模型的有趣统计，请关注我，我发布新帖时会通知你。</p><div class="kj kk ez fb kl km"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">medium.com</p></div></div><div class="kv l"><div class="kw l kx ky kz kv la in km"/></div></div></a></div></div></div>    
</body>
</html>