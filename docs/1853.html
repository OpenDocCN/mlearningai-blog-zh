<html>
<head>
<title>Penguins from Head to Toe — How Penguins Can Help You Master Image Classification Process</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从头到脚的企鹅——企鹅如何帮助你掌握图像分类过程</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/penguins-from-head-to-toe-how-penguins-can-help-you-master-image-classification-process-8be9cd68121d?source=collection_archive---------5-----------------------#2022-02-04">https://medium.com/mlearning-ai/penguins-from-head-to-toe-how-penguins-can-help-you-master-image-classification-process-8be9cd68121d?source=collection_archive---------5-----------------------#2022-02-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="b8c9" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">创建自定义企鹅图像分类模型的分步指南</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/36166779617595ce0cb1364184db48be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zC65EvuwpoWhPyQ4"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@goosegrease?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Derek Oyen</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="15b9" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">介绍</h1><p id="d134" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">我是一个企鹅爱好者，所以我决定创建自己的企鹅图像小数据集，并在其上训练图像分类模型。这是一个指南，让你跟随我在这个项目上的工作。它可以帮助您为您感兴趣的任何图像分类项目建立自己的模型。</p><h1 id="6c36" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">下载数据</h1><h2 id="f45c" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">谷歌图片下载</h2><p id="6557" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">每个数据项目都必须从一些数据开始。您将使用google-image-download基于从Google Images收集的图像构建您的自定义企鹅数据集。数据集将由4种企鹅组成:阿德利企鹅、下巴颏企鹅、帝企鹅和巴布亚企鹅。</p><p id="6d6f" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated"><a class="ae jm" href="https://github.com/hardikvasa/google-images-download" rel="noopener ugc nofollow" target="_blank"> google-image-download </a>是一个简单的命令行工具，用于根据关键字从google下载图像。要安装它，请运行:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="d6c8" class="lb jo hh lv b fi lz ma l mb mc">git clone <a class="ae jm" href="https://github.com/hardikvasa/google-images-download.git" rel="noopener ugc nofollow" target="_blank">https://github.com/hardikvasa/google-images-download.git</a><br/>cd google-images-download &amp;&amp; python setup.py install</span></pre><p id="ab14" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">不幸的是，这个库中的最新版本已损坏。在它的一个<a class="ae jm" href="https://github.com/Joeclinton1/google-images-download" rel="noopener ugc nofollow" target="_blank">分支</a>中建议了一个修复。</p><h2 id="45e4" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">数据集大小</h2><p id="9b62" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">稍后，您将使用迁移学习来利用预先训练的模型。在这个阶段，你需要决定数据集的大小。</p><p id="2403" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">每种企鹅类型的100个或更少图像的数据集是一个足够小的数据集，可以容易地管理，并且足以让模型在迁移学习设置中学习。但是，这可能会导致模型过度拟合。</p><p id="6d65" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">如果您认为这个数据集大小已经足够了，那么您可以使用下面的下载脚本:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="7ed9" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要运行它:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="160e" class="lb jo hh lv b fi lz ma l mb mc">python penguin_download.py</span></pre><p id="3ee8" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">这个脚本试图下载100张阿德利、下巴颏带、帝企鹅和巴布亚企鹅的图片。每种企鹅都被保存在一个名为“下载/ <penguin type="">”的专用文件夹中。为了减少下载运行时间和改进以后的训练时间，下载的图像是中等大小的。图像大小可以设置为“大”或“图标”，或者根本不传递到库中。</penguin></p><p id="2883" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">注意，阿德利企鹅有一个法语名字，重音在e上，然而谷歌图像下载返回关于这个关键字的非常不相关的结果，即使它是拉丁编码的，所以你将改为搜索“阿德利”..</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="ab fe cl mf"><img src="../Images/d92802ac341ec5e553fb81da3890a8fe.png" data-original-src="https://miro.medium.com/v2/format:webp/0*9z5rODc1qD6SyeFf.jpg"/></div></figure><h2 id="18e6" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">下载每种企鹅类型的100多张图片</h2><p id="4562" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">google-image-download需要一些修改才能下载更多的数据。</p><p id="7079" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">首先，你需要安装<a class="ae jm" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank">硒</a>:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="3847" class="lb jo hh lv b fi lz ma l mb mc">pip install selenium</span></pre><p id="e8ee" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">然后从<a class="ae jm" href="https://sites.google.com/chromium.org/driver/" rel="noopener ugc nofollow" target="_blank">这里</a>下载chromedriver。注意，chromedriver版本应该和你的chrome版本匹配(你可以在这里查看你的chrome版本<a class="ae jm" href="https://www.whatismybrowser.com/detect/what-version-of-chrome-do-i-have" rel="noopener ugc nofollow" target="_blank">)。</a></p><p id="6db6" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">下载完成后，您需要将chromedriver文件复制到包含下载脚本的文件夹中:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="a234" class="lb jo hh lv b fi lz ma l mb mc">cp ~/Downloads/chromedriver .</span></pre><p id="43cd" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">MacOS可能会拒绝运行chromedriver，因此此命令有助于解决问题:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="5665" class="lb jo hh lv b fi lz ma l mb mc">xattr -d com.apple.quarantine chromedriver</span></pre><p id="bbf2" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">下面是修改后的脚本，每个企鹅类型下载150张图片。运行它需要一段时间才能完成，所以现在你可以去喝杯咖啡了。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><h1 id="1815" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">清理数据</h1><p id="5ff4" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">数据清洗是深度学习模型训练过程中至关重要的一步，因为校长<a class="ae jm" href="https://en.wikipedia.org/wiki/Garbage_in,_garbage_out" rel="noopener ugc nofollow" target="_blank">“垃圾进，垃圾出”</a>。如果你用有缺陷或不正确的图像训练模型，它将无法学习，并将给出糟糕的结果。当在小数据集上训练时，这甚至更重要，因为每个图像对训练结果的影响比在由数千或数百万个图像组成的数据集中大得多。</p><p id="b916" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要清理数据，您需要手动浏览图像，并删除所有不相关的图像。这包括绘画，从太远的地方拍摄的企鹅照片，多种企鹅物种的照片，企鹅娃娃的照片等等。所有不是活企鹅的图片都应该被删除。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mg"><img src="../Images/09f57cd59392942b3cd26d0c70ca3bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/0*AVqqsNucuzED6oxn"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">An image of a cute Emperor penguin doll that should be removed from the dataset, <a class="ae jm" href="https://www.bookvine.com/prod-20-1-96-121/baby-emperor-penguin-puppet.htm" rel="noopener ugc nofollow" target="_blank">https://www.bookvine.com/prod-20-1-96-121/baby-emperor-penguin-puppet.htm</a></figcaption></figure><h1 id="7073" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">平衡数据</h1><p id="ccfb" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">由于一些图像下载可能会失败，并且在清理阶段从数据中移除了相当多的图像，因此您可能会获得不平衡的数据集，这意味着一些类获得的图像明显少于其他类。这可能会影响训练结果，有几种方法可以解决这个问题。</p><p id="d2e0" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要了解数据集是如何平衡的，只需计算下载目录中图像的数量。</p><p id="9a23" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要计算企鹅图像，请运行:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="bd53" class="lb jo hh lv b fi lz ma l mb mc">find downloads -type f -not -name ".*" | cut -d/ -f2 | sort | uniq -c</span></pre><p id="e153" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">这些是我在下载了每种企鹅的150张图片并清理了数据集后获得的相关图片的数量:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="0e82" class="lb jo hh lv b fi lz ma l mb mc">119 Adelie Penguin</span><span id="5309" class="lb jo hh lv b fi mh ma l mb mc">124 Chinstrap Penguin</span><span id="1a90" class="lb jo hh lv b fi mh ma l mb mc">103 Emperor Penguin</span><span id="176b" class="lb jo hh lv b fi mh ma l mb mc">126 Gentoo Penguin</span></pre><p id="d52a" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">在这个场景中，职业是相当平衡的。</p><h1 id="fd6a" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">拆分数据</h1><p id="044b" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">为了估计模型的性能，训练测试分割是重要的。我们将把数据分成3个部分:训练、验证和测试，它们的大小分别是数据的80%、10%和10%。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mi"><img src="../Images/243374e0f09f2d9b9c959208a18599c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*fiWfS8dD_CXcu41m.jpg"/></div></figure><p id="204f" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">分割数据集很容易。首先，您需要安装一个名为<a class="ae jm" href="https://pypi.org/project/split-folders/" rel="noopener ugc nofollow" target="_blank"> split-folders </a>的python库:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="8c0c" class="lb jo hh lv b fi lz ma l mb mc">pip install split-folders</span></pre><p id="f367" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">然后，您需要运行以下命令:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="8f31" class="lb jo hh lv b fi lz ma l mb mc">python -c "import splitfolders; splitfolders.ratio('downloads', output='output', seed=1337, ratio=(.8, 0.1, 0.1))"</span></pre><p id="91a9" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">该命令根据指定的比率分割数据集。它生成一个名为“输出”的文件夹，其结构如下:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="3b75" class="lb jo hh lv b fi lz ma l mb mc">ls output/</span><span id="b2de" class="lb jo hh lv b fi mh ma l mb mc"><strong class="lv hi">test</strong>/  <strong class="lv hi">train</strong>/ <strong class="lv hi">val</strong>/</span></pre><p id="cc02" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">每个子文件夹现在都有一个专门的文件夹来存放每一种企鹅。火车文件夹应该是这样的:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="f9f6" class="lb jo hh lv b fi lz ma l mb mc">$ ls output/train/</span><span id="3b0e" class="lb jo hh lv b fi mh ma l mb mc"><strong class="lv hi">Adelie Penguin</strong>/    <strong class="lv hi">Chinstrap Penguin</strong>/ <br/><strong class="lv hi">Emperor Penguin</strong>/   <strong class="lv hi">Gentoo Penguin</strong>/</span></pre><h1 id="8f3b" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">压缩并上传数据</h1><p id="2fb9" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">现在是时候创建一个包含所有图像的zip文件，并将其上传到一个可以在培训期间访问的位置。</p><p id="1656" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要将输出文件夹压缩到名为data.zip的文件中，您需要运行:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="cb39" class="lb jo hh lv b fi lz ma l mb mc">zip -r data.zip output</span></pre><p id="0da4" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">现在把压缩文件上传到你的谷歌硬盘。你会把它作为你的云存储。</p><h1 id="5577" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">火车</h1><p id="53d5" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">(如果您只想运行培训，可以跳过数据集准备阶段，通过<a class="ae jm" href="https://drive.google.com/file/d/1i8Ayy8zsKeI40Lt4pgQOKRZfzJhu1-3I/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">此链接</a>下载数据)</p><h2 id="3621" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">迁移学习</h2><p id="55d5" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">迁移学习是一种技术，允许您使用之前在大型数据集上训练的模型来完成不同但相似的任务。用于图像分类的迁移学习背后的直觉是，如果一个模型在一个足够大和通用的数据集(如ImageNet)上训练，该模型将有效地充当视觉世界的通用模型。</p><p id="617a" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">关于迁移学习的更多信息，你可以参考<a class="ae jm" href="https://cs231n.github.io/transfer-learning/" rel="noopener ugc nofollow" target="_blank"> CS231n笔记。</a></p><h2 id="cad2" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">设置</h2><p id="eec0" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">训练代码就是基于这个<a class="ae jm" href="https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html" rel="noopener ugc nofollow" target="_blank"> PyTorch教程</a>进行迁移学习的。本教程解释了如何使用ResNet18模型的迁移学习来对蚂蚁和蜜蜂这两个类别进行分类。</p><p id="09c3" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">我创建了一个笔记本，对教程代码做了一些修改和改进。笔记本代码可在<a class="ae jm" href="https://github.com/asyaf/fun_mini_projects/blob/master/penguin_classification/transfer_learning_penguin.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="de30" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">这款笔记本被设计成可以在<a class="ae jm" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>上运行。要执行它，您需要做一些更改。我们现在将检查笔记本的主要部分和我添加的修改。</p><h2 id="2bd7" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">将数据加载到Google Colab</h2><p id="122f" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">要让Google Colab访问您的Google Drive，您需要执行以下代码行:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="c2b6" class="lb jo hh lv b fi lz ma l mb mc">from google.colab import drive</span><span id="fa60" class="lb jo hh lv b fi mh ma l mb mc">drive.mount('/content/drive')</span></pre><p id="b391" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">接下来，您需要用Google Drive上的位置替换数据文件的路径:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="4866" class="lb jo hh lv b fi lz ma l mb mc">DATA_FILE = ‘drive/My\ Drive/Data/penguin\ data/data.zip’</span></pre><p id="be72" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">这一阶段的最后一步是解压缩zip文件，以便PyTorch可以访问其中包含的图像:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="9f8e" class="lb jo hh lv b fi lz ma l mb mc">!unzip $DATA_FILE</span></pre><h2 id="f7bb" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">创建数据加载器</h2><p id="2593" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">您需要设置3种类型的数据集:训练、验证和测试。每个数据集都需要对数据进行一些转换:</p><ul class=""><li id="e57c" class="mj mk hh kh b ki lp kl lq ko ml ks mm kw mn la mo mp mq mr bi translated">图像的大小被调整为网络的输入大小，即224*224。</li><li id="084b" class="mj mk hh kh b ki ms kl mt ko mu ks mv kw mw la mo mp mq mr bi translated">数据被转换成张量格式。</li><li id="aa84" class="mj mk hh kh b ki ms kl mt ko mu ks mv kw mw la mo mp mq mr bi translated">根据ImageNet的平均值和标准偏差对图像数据进行标准化(这是一种常见的做法，也在PyTorch 的<a class="ae jm" href="https://pytorch.org/vision/stable/models.html" rel="noopener ugc nofollow" target="_blank">预训练模型文档中进行了说明)</a></li><li id="fa14" class="mj mk hh kh b ki ms kl mt ko mu ks mv kw mw la mo mp mq mr bi translated">为了训练，还增加了随机水平翻转。这允许通过沿水平轴随机翻转图像来创建更多的数据样本。</li></ul><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><h2 id="bd77" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">添加张量板记录</h2><p id="9827" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">Tensorboard是一个用于测量和可视化训练过程的工具。您将通过向训练代码添加几行来跟踪模型的损失和准确性。</p><p id="0686" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要设置tensorboard，请在开始训练前执行以下代码:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="c9e0" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">另外，将下面的代码添加到“train”函数中:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="a764" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">培训结束后，您可以通过运行以下命令来查看收集的指标:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="555b" class="lb jo hh lv b fi lz ma l mb mc">%tensorboard --logdir='./runs'</span></pre><h2 id="4262" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">火车</h2><p id="dfc1" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">通过执行以下命令来运行培训:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="ae21" class="lb jo hh lv b fi lz ma l mb mc">model_ft = train_model(model_ft, criterion, optimizer_ft, exp_lr_scheduler, num_epochs=24)</span></pre><p id="0599" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">在训练过程的最后，您应该看到验证集上最佳模型的准确性。我得到了以下结果:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="75ca" class="lb jo hh lv b fi lz ma l mb mc">Best val Acc: 0.977778</span></pre><p id="8211" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">以下是来自验证集的一些结果示例:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="ab fe cl mf"><img src="../Images/8bddb0e02755e55e98c1ae1cbf15657e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2kMMGj8kG9QqUWRhtjSv-w.png"/></div></figure><h2 id="ed4a" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">测试时运行模型</h2><p id="79d7" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">训练结束后，您可能想知道模型的概括程度。这可以通过在测试集上计算模型的准确性来实现。下面的代码还显示了一些模型出错的图片。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="md me l"/></div></figure><h2 id="b6f6" class="lb jo hh bd jp lc ld le jt lf lg lh jx ko li lj jz ks lk ll kb kw lm ln kd lo bi translated">保存模型</h2><p id="b71e" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">通过运行以下命令将模型保存到文件中:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="6b1e" class="lb jo hh lv b fi lz ma l mb mc">torch.save(model_ft, ‘model.pt’)</span></pre><p id="2105" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">要持久化训练好的模型，您可以下载它:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="1450" class="lb jo hh lv b fi lz ma l mb mc">from google.colab import files</span><span id="f776" class="lb jo hh lv b fi mh ma l mb mc">files.download(‘model.pt’)</span></pre><p id="cc0f" class="pw-post-body-paragraph kf kg hh kh b ki lp ii kk kl lq il kn ko lr kq kr ks ls ku kv kw lt ky kz la ha bi translated">或者通过运行以下命令将其复制到您的Google Drive:</p><pre class="ix iy iz ja fd lu lv lw lx aw ly bi"><span id="8725" class="lb jo hh lv b fi lz ma l mb mc">!cp model.pt "drive/My Drive/Data/"</span></pre><h1 id="cee8" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">结论</h1><p id="a2c4" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">创建自定义图像分类模型是计算机视觉中非常常见的任务。通过利用谷歌图像和现有的预训练模型，这项任务可以在几个小时内完成。希望这个指南能帮你解决你的酷图分类问题，无论是否涉及企鹅。</p><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jg na"/></div></div></a></div></div></div>    
</body>
</html>