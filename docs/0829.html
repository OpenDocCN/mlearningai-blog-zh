<html>
<head>
<title>Intelligent Portfolio Construction: Prediction of Stock Direction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ™ºèƒ½æŠ•èµ„ç»„åˆæ„å»º:è‚¡ç¥¨æ–¹å‘é¢„æµ‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/mlearning-ai/intelligent-portfolio-construction-prediction-of-stock-direction-e1c71f4a725a?source=collection_archive---------0-----------------------#2021-07-30">https://medium.com/mlearning-ai/intelligent-portfolio-construction-prediction-of-stock-direction-e1c71f4a725a?source=collection_archive---------0-----------------------#2021-07-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0667" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨ç½‘ä¸Šæœç´¢å…³äºé‡‘èé¢†åŸŸæœºå™¨å­¦ä¹ æ¨¡å‹çš„æœ‰è¶£å†…å®¹æ—¶ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ç¯‡æäº¤ç»™ä¼¦æ•¦å¸å›½ç†å·¥å­¦é™¢æ•°å­¦å’Œé‡‘èç¡•å£«çš„è®ºæ–‡ã€‚è¿™è¢«å‘½åä¸ºæ™ºèƒ½æŠ•èµ„ç»„åˆæ„å»º:æœºå™¨å­¦ä¹ æ”¯æŒå‡å€¼-æ–¹å·®ä¼˜åŒ–ï¼Œæˆ‘å‘ç°å®ƒéå¸¸é…·ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘å–œæ¬¢ç¬¬äºŒéƒ¨åˆ†ï¼Œåœ¨é‚£é‡Œå­¦ç”Ÿä½¿ç”¨éšæœºæ£®æ—æ¨¡å‹æ¥é¢„æµ‹è‚¡ç¥¨æ–¹å‘ã€‚æˆ‘å†³å®šå°è¯•ç”¨Pythonå¤åˆ¶ä»–çš„æ­¥éª¤(è¿™é‡Œæ˜¯<a class="ae jc" href="https://github.com/RiccardoHub/Intelligent-Portfolio-Construction-Prediction-of-Stock-Direction" rel="noopener ugc nofollow" target="_blank"> GitHubåº“</a>)ã€‚</p><p id="5182" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºæˆ‘æ˜¯å¦‚ä½•å®ç°å¹¶æ‰©å±•è®ºæ–‡ä¸­æå‡ºçš„æƒ³æ³•çš„(<a class="ae jc" href="https://www.imperial.ac.uk/media/imperial-college/faculty-of-natural-sciences/department-of-mathematics/math-finance/Ghali_Tadlaoui_01427211.pdf" rel="noopener ugc nofollow" target="_blank">é“¾æ¥æ­¤å¤„</a>)ã€‚</p><p id="52ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä½¿ç”¨éšæœºæ£®æ—é¢„æµ‹è‚¡ç¥¨æ–¹å‘çš„ä»»åŠ¡åˆ—è¡¨å¦‚ä¸‹:</p><ol class=""><li id="112f" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">è¾“å…¥æ•°æ®</li><li id="dc4f" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">æ•°æ®åŠ å·¥</li><li id="b999" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">ç‰¹å¾æ¨å¯¼</li><li id="89b1" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">éšæœºæ£®æ—åˆ†ç±»å™¨</li></ol><h1 id="5564" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">è¾“å…¥æ•°æ®</h1><p id="c73d" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">è¯¥é¡¹ç›®æ‰€éœ€çš„æ•°æ®æ˜¯OHLCå’Œ8åªè‚¡ç¥¨çš„æˆäº¤é‡ï¼Œå³è‹¹æœã€äºšé©¬é€Šã€èŠ±æ——é›†å›¢ã€CVS Healthã€3Mã€æ˜Ÿå·´å…‹ã€å˜‰ä¿¡ç†è´¢å…¬å¸å’ŒåŸƒå…‹æ£®ç¾å­šã€‚æ ·æœ¬æ—¶é—´è·¨åº¦ä¸º2000å¹´6æœˆ1æ—¥â€”2016å¹´4æœˆ25æ—¥ï¼Œç”¨äºè®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹ï¼Œ2016å¹´4æœˆ25æ—¥â€”2021å¹´7æœˆ26æ—¥ï¼Œç”¨äºéªŒè¯ã€‚</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b0a8" class="ld js hh kz b fi le lf l lg lh">import yfinance as yf<br/><br/>tickers = ['AAPL', 'AMZN', 'C', 'CVS', 'MMM', 'SBUX', 'SCHW', 'XOM']<br/>start = '2000-06-02'<br/>end = '2016-04-26'<br/><br/>AdjClose = yf.download(tickers, start=start, end=end)['Adj Close']<br/>Volume = yf.download(tickers, start=start, end=end)['Volume']<br/>High = yf.download(tickers, start=start, end=end)['High']<br/>Low = yf.download(tickers, start=start, end=end)['Low']<br/>Close = yf.download(tickers, start=start, end=end)['Close']</span></pre><h1 id="32ae" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">æ•°æ®åŠ å·¥</h1><p id="81f6" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">é‡‘èæ•°æ®é€šå¸¸éå¸¸å˜ˆæ‚ï¼Œè¿™æ„å‘³ç€ä¸€æ®µæ•°æ®æºå¸¦äº†ä¸€äº›å®é™…ä¸Šå¹¶ä¸æœ‰ç”¨çš„ä¿¡æ¯ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯æ•°æ®å¹³æ»‘ï¼Œè¿™æ˜¯ä¸€ç§è¯•å›¾æŠ‘åˆ¶çŸ­æœŸå¯å˜æ€§ï¼ŒåŒæ—¶ä¿æŒé•¿æœŸè¶‹åŠ¿å¯è§çš„æ–¹æ³•ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ–¹æ³•æ˜¯æŒ‡æ•°å¹³æ»‘æ³•ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªå¸¸æ•°ğ›¼.å°†t+1æ—¶çš„å¹³æ»‘è°ƒæ•´åçš„æ”¶ç›˜å€¼ç¡®å®šä¸ºt+1æ—¶çš„è§‚æµ‹å€¼å’Œtæ—¶çš„å¹³æ»‘æ•°æ®ä¹‹é—´çš„åŠ æƒå¹³å‡å€¼</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es li"><img src="../Images/6538de37c7c0ed768c67b56d12080c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*gM8sZx8lKuBPG_CserQgxA.png"/></div></figure><p id="9009" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è®ºæ–‡ä¸­ä½¿ç”¨çš„ğ›¼å¸¸æ•°ä¸º0.20ã€‚</p><p id="235a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å†³å®šä¸ä½¿ç”¨ä»»ä½•é¢„åˆ¶å‡½æ•°æ¥æé«˜æˆ‘çš„ç¼–ç¨‹æŠ€èƒ½ã€‚å› æ­¤ï¼Œè¿™äº›ä»£ç è¿œä¸æ˜¯æœ€é«˜æ•ˆæˆ–æœ€ä¼˜é›…çš„ã€‚ç„¶è€Œï¼Œå¦‚æœä½ èƒ½æä¾›ä¸€ä¸ªæ›´æœ‰æ•ˆ/ä¼˜é›…çš„ä»£ç ï¼Œè¯·è¿™æ ·åšï¼</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8536" class="ld js hh kz b fi le lf l lg lh">def exponential_smoothing(df, alpha):<br/>    DF = df.copy().reset_index(drop=True) <br/>    DF.loc[1] = (DF.loc[1]*alpha)+(DF.loc[0]*(1-alpha))<br/>    <br/>    for i in range(2, len(DF)-1):<br/>        DF[i] = (DF[i]*alpha)+(DF[i-1]*(1-alpha))<br/>    <br/>    return DF<br/><br/># Apply the function to all tickers<br/>E = {}<br/>for n in AdjClose.columns:<br/>    E[f'{n}']= exponential_smoothing(AdjClose[n], 0.2)</span></pre><p id="33fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç»“æœå¦‚å›¾1æ‰€ç¤ºã€‚æ­£å¦‚æˆ‘ä»¬åœ¨å·¦ä¾§çœ‹åˆ°çš„ï¼Œå¾ˆéš¾æ³¨æ„åˆ°æ•´ä¸ªæ•°æ®é›†çš„ä»»ä½•å·®å¼‚ã€‚ç„¶è€Œï¼Œé€šè¿‡æ”¾å¤§ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŒ‡æ•°å¹³æ»‘çš„æ•ˆæœã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/b4e2678c40684410d9aa06e38d52bcc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*93YpTSpJ8CiuNJql-ma2VA.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 1: Exponential Smoothing on AAPL</figcaption></figure><h1 id="7ab2" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">ç‰¹å¾æ¨å¯¼</h1><p id="efd9" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºå°†åœ¨éšæœºæ£®æ—åˆ†ç±»å™¨ä¸­ç”¨ä½œè§£é‡Šå˜é‡çš„æŒ‡æ ‡ã€‚</p><p id="8844" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç¬¬ä¸€ä¸ªæŒ‡æ ‡å«åšOn Balance Volumeï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯æ€§çš„äº¤æ˜“åŠ¨é‡æŒ‡æ ‡ï¼Œç”¨æˆäº¤é‡æ¥é¢„æµ‹è‚¡ä»·çš„å˜åŒ–ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lv"><img src="../Images/0b6d52ee984f23486322a233d9c7b126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*0KfKcSGrc-h7y_FLPBK7dQ.png"/></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b2f2" class="ld js hh kz b fi le lf l lg lh">def OBV(df_price, df_volume):<br/>    OBV_df = pd.DataFrame(index=range(len(df_volume.index)), columns=['OBV'])<br/>    OBV_df.iloc[0] = 0<br/>    <br/>    for i in range(1, len(df_price)):<br/>        if df_price[i] &gt; df_price[i-1]:<br/>            OBV_df.loc[i] = (OBV_df.loc[i-1] + df_volume[i])<br/>        elif df_price[i] &lt; df_price[i-1]:<br/>            OBV_df.loc[i] = (OBV_df.loc[i-1] - df_volume[i])<br/>        else:<br/>            OBV_df.loc[i] = (OBV_df.loc[i-1] + 0)<br/>    <br/>    OBV_df.index = df_volume.index<br/>    return OBV_df<br/><br/># Apply the function to all tickers<br/>O = {}<br/>for n in AdjClose.columns:<br/>    O[f'{n}']= OBV(E[n], Volume[n])</span></pre><p id="865d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å›¾2æ˜¾ç¤ºäº†æ­£å¸¸åŒ–çš„OBVå’Œå¹³æ»‘è°ƒæ•´åçš„AAPLæ”¶ç›˜ä»·ã€‚æˆ‘ä»¬ç¨åä¼šå‘ç°ï¼ŒOBVæ˜¯æ¨¡å‹ä¸­ä¿¡æ¯é‡æœ€å°‘çš„ç‰¹å¾ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lw"><img src="../Images/58693f061a85adec636409e2ea3a5b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*teRs-uq_7wNgu9uvoIBHjw.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 2: OBV and Smoothed AdjClose (AAPL)</figcaption></figure><p id="341a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç¬¬äºŒä¸ªæŒ‡æ ‡æ˜¯éšæœºæŒ¯è¡å™¨%Kï¼Œå®ƒå°†å¹³æ»‘ä»·æ ¼ä¸ç»™å®šæ—¶é—´æ®µKå†…çš„é«˜ä½ä»·æ ¼èŒƒå›´è¿›è¡Œæ¯”è¾ƒã€‚å®ƒç”¨äºç”Ÿæˆè¶…ä¹°å’Œè¶…å–äº¤æ˜“ä¿¡å·ï¼Œåˆ©ç”¨0-100çš„æœ‰ç•Œå€¼èŒƒå›´ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lx"><img src="../Images/30eafe887e4746d1b0d9aa6b51aa6dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*KOlDiEU_gL8QNDO8YHbFwA.png"/></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="91e9" class="ld js hh kz b fi le lf l lg lh">def stochastic_oscillator(close, df_low, df_high, K):<br/>    low = df_low.rolling(K).min().reset_index(drop=True)<br/>    high = df_high.rolling(K).max().reset_index(drop=True)<br/>    <br/>    stoch_oscillator = pd.DataFrame()<br/>    stoch_oscillator['Oscillator'] = 100*((close - low)/(high - low))<br/>    <br/>    return stoch_oscillator<br/><br/># Apply the function to all tickers<br/>S = {}<br/>for n in AdjClose.columns:<br/>    S[f'{n}']= stochastic_oscillator(close=E[n], df_low=E[n], df_high=E[n], K=14)</span></pre><p id="032f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç¬¬ä¸‰ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªæŒ‡æ ‡æ˜¯ç§»åŠ¨å¹³å‡çº¿æ”¶æ•›èƒŒç¦»ã€‚è¿™å¯¼è‡´äº†ä¸¤ä¸ªç‰¹å¾ã€‚ç¬¬ä¸€ä¸ªæ˜¯MACDï¼Œå®šä¹‰ä¸º12æœŸå‡çº¿å’Œ26æœŸå‡çº¿ä¹‹å·®ã€‚ç¬¬äºŒä¸ªæ˜¯MACDçš„ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯MACDçš„9æœŸå‡çº¿ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lx"><img src="../Images/a08478b2b2f357788b72270cf461dd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*1ZlsenRriWcqTqsArF79oQ.png"/></div></figure><figure class="ku kv kw kx fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ly"><img src="../Images/bf74ed9a4247d9adf12d25d90cdd7ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*-Rl3IG-60rBdithe7RduXw.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="7766" class="ld js hh kz b fi le lf l lg lh">def MACD(data):<br/>    MA_Fast = data.ewm(span=12,min_periods=12).mean()<br/>    MA_Slow = data.ewm(span=26,min_periods=26).mean()<br/>    MACD = MA_Fast - MA_Slow<br/>    Signal = MACD.ewm(span=9,min_periods=9).mean()<br/><br/>    return pd.DataFrame(index=['MACD', 'Signal'], data [MACD,Signal]).T<br/><br/># Apply the function to all tickers<br/>M = {}<br/>for n in AdjClose.columns:<br/>    M[f'{n}'] = MACD(data=E[n])z</span></pre><p id="b45c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æœ€åï¼Œæˆ‘å°†æ‰€æœ‰å˜é‡è¿æ¥åœ¨ä¸€ä¸ªå­—å…¸ä¸­ã€‚</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="16e3" class="ld js hh kz b fi le lf l lg lh">dict_data = {}<br/>for n in AdjClose.columns:<br/>    dict_data[f'{n}'] = (pd.concat([E[n], <br/>                                    O[n].reset_index(drop=True), <br/>                                    S[n], <br/>                                    M[n]],<br/>                                   axis=1)).set_index(O[n].index)</span></pre><h1 id="e9d3" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">éšæœºæ£®æ—åˆ†ç±»å™¨</h1><p id="4d34" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">æœ¬æ–‡è®­ç»ƒäº†ä¸€ä¸ªéšæœºæ£®æ—åˆ†ç±»å™¨æ¥é¢„æµ‹è‚¡ç¥¨æ–¹å‘ã€‚åè€…ç”±ä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡è¡¨ç¤ºï¼Œå¦‚æœè‚¡ç¥¨ä»·æ ¼åœ¨mæœŸåä¸‹è·Œï¼Œå–å€¼ä¸º-1ï¼›å¦‚æœè‚¡ç¥¨ä»·æ ¼ä¸Šæ¶¨ï¼Œå–å€¼ä¸º1ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºéšæœºæ£®æ—çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€‚</p><p id="be01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç®€è€Œè¨€ä¹‹ï¼Œéšæœºæ£®æ—æ˜¯å¦‚å›¾3æ‰€ç¤ºçš„å†³ç­–æ ‘çš„é›†åˆã€‚æ ‘ä¸­çš„æ¯ä¸ªåˆ†è£‚éƒ½æ˜¯ä¸ºäº†ä¼˜åŒ–ä¸€ä¸ªä½¿æ‚è´¨æœ€å°åŒ–çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¯•å›¾æ‰¾åˆ°ä½¿æ¨¡å‹å°½å¯èƒ½æ˜æ˜¾åœ°å†³å®šæ•°æ®åº”è¯¥å¯¹åº”äºç‰¹å®šç±»åˆ«çš„é˜ˆå€¼ã€‚éšæœºæ£®æ—åˆ†ç±»å™¨ç”±ä»»æ„æ•°é‡çš„æ ‘ç»„æˆï¼Œè¿™äº›æ ‘è¿›è¡Œé¢„æµ‹ï¼Œè·å¾—æ›´å¤šæŠ•ç¥¨çš„ç±»è¢«é€‰ä¸ºæœ€ç»ˆé¢„æµ‹ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lz"><img src="../Images/ff27f8b22d07e21ee0fb0bb33d5c09bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqJYlcV-TAUmtG1ERXlZog.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 3: Decision Tree Example</figcaption></figure><p id="5444" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œåº”è¯¥ä½¿ç”¨ä»¥ä¸‹é€»è¾‘å°†å¹³æ»‘ä»·æ ¼è½¬æ¢ä¸ºåˆ†ç±»å˜é‡ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es ma"><img src="../Images/cb3c1cc2c90c42e4fcc05486040e14a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*DCO1YAt3JSeWX61S6Itz2Q.png"/></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="75be" class="ld js hh kz b fi le lf l lg lh">def finalise_data(DF, column, n):<br/>    df = copy.deepcopy(DF)<br/>    df[column][column] = np.sign(np.log(df[column][column]/df[column][column].shift(n-1)))<br/>    <br/>    return df[column]</span></pre><p id="30f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç°åœ¨ï¼Œåˆ›å»ºæ¨¡å‹çš„ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ã€‚è¿™æ˜¯ä½¿ç”¨Scikit-learnè®­ç»ƒã€æµ‹è¯•å’ŒéªŒè¯çš„ã€‚è¯¥æ¨¡å‹æ‹Ÿåˆäº†ä»2000å¹´1æœˆ6æ—¥åˆ°2016å¹´4æœˆ25æ—¥çš„æ•°æ®ï¼Œå…¶ä¸­80%ç”¨äºè®­ç»ƒï¼Œ20%ç”¨äºæµ‹è¯•ã€‚2021å¹´7æœˆ26æ—¥ä¹‹å‰çš„å‰©ä½™æ•°æ®ç”¨äºéªŒè¯ã€‚ç”¨äºè¯„ä¼°é¢„æµ‹çš„æŒ‡æ ‡æ˜¯å‡†ç¡®åº¦ã€ç²¾ç¡®åº¦ã€å¬å›ç‡å’Œf1_scoreã€‚</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1688" class="ld js hh kz b fi le lf l lg lh">def RFClassifier(DF, column, n, validation=False, validation_DF=None, feature_importance=False):<br/>    data = finalise_data(DF=DF, column=column, n=n)<br/>    data.dropna(axis=0, inplace=True)<br/>    <br/>    X = data[['OBV', 'Oscillator', 'MACD', 'Signal']]<br/>    y = data[column]<br/>    <br/>    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)<br/>    model = RandomForestClassifier(n_estimators=100)<br/>    model.fit(X_train,y_train)<br/>    prediction= model.predict(X_test)<br/>    <br/>    Accuracy = metrics.accuracy_score(y_test, prediction)<br/>    Precision = metrics.average_precision_score(y_test, prediction)<br/>    Recall = metrics.recall_score(y_test, prediction)<br/>    F1_score = metrics.f1_score(y_test, prediction)<br/>    <br/>    if validation ==  True:<br/>        validation_data = finalise_data(DF=validation_DF, column=column, n=n)<br/>        validation_data.dropna(axis=0, inplace=True)<br/>        <br/>        X_validation = validation_data[['OBV', 'Oscillator', 'MACD', 'Signal']]<br/>        y_validation = validation_data[column]<br/>        validation_prediction = model.predict(X_validation)<br/>        <br/>        Accuracy_validation = metrics.accuracy_score(y_validation, validation_prediction)<br/>        Precision_validation = metrics.average_precision_score(y_validation, validation_prediction)<br/>        Recall_validation = metrics.recall_score(y_validation, validation_prediction)<br/>        F1_score_validation = metrics.f1_score(y_validation, validation_prediction)<br/>        <br/>        return n, column,Accuracy_validation, Precision_validation, Recall_validation, F1_score_validation<br/>    <br/>    elif feature_importance == True:<br/>        return pd.Series(model.feature_importances_,(X).columns)<br/>        <br/>    else:<br/>        return n, column, Accuracy, Precision, Recall, F1_score</span></pre><p id="215c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯¥æ¨¡å‹é¢„æµ‹æ¯ä¸ªè‚¡ç¥¨æœªæ¥2åˆ°30å¤©çš„èµ°åŠ¿ã€‚</p><p id="be4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">éªŒè¯é›†çš„æ€»ä½“ç»“æœå¦‚ä¸‹:</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es mb"><img src="../Images/073190b83d769c2159605d536f632ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*sKZ_DVc4nxkMXtvz7pLs_Q.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 4: Validation Set Statistics</figcaption></figure><p id="80f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰æŠ¥ä»·æœºçš„å¹³å‡å‡†ç¡®ç‡ä¸º0.90ã€‚æŸ¥çœ‹æ¯ä¸ªnçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°é¢„æµ‹çº¿æ€§æé«˜ï¼Œç›´åˆ°n=11ï¼Œç„¶ååœ¨ç”±n=[11ï¼Œ12ï¼Œ13ï¼Œ14]ç»„æˆçš„æœ€ä½³è¡¨ç°åŒºåŸŸæ³¢åŠ¨ï¼Œç„¶åæ€¥å‰§ä¸‹é™åˆ°å¹³å‡å€¼çº¦ä¸º0.90çš„å€¼ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lw"><img src="../Images/be939d1a46bcd1f1b045bedf1a54cb08.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*4QjYQFmR-eTZ_C3uET9izA.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 5: Accuracy</figcaption></figure><p id="2cc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æ­¤å¤–ï¼Œè°ƒæŸ¥å˜é‡çš„é‡è¦æ€§è¡¨æ˜ï¼Œä»–ä»¬çš„è§£é‡Šèƒ½åŠ›éšnå˜åŒ–ã€‚</p><figure class="ku kv kw kx fd lj er es paragraph-image"><div class="er es lw"><img src="../Images/4f951fa85fd794cd5e8dc93786c83cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*tulezsSe_0EbePSUrXhzjA.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">Figure 6: Feature Importances</figcaption></figure><p id="3e1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨n = 18ä¹‹å‰ï¼ŒéšæœºæŒ¯è¡å™¨æ˜¯æœ€æœ‰å¸®åŠ©çš„å˜é‡ï¼Œåœ¨n = 18ä¹‹åï¼Œå®ƒä¸æ–­ä¸‹é™ï¼Œæœ€ç»ˆæˆä¸ºæœ€ä¸å…·è§£é‡ŠåŠ›çš„å˜é‡ã€‚ç›¸åï¼Œåœ¨çŸ­æœŸå†…ï¼ŒMACDå’ŒOBVçš„é¢„æµ‹èƒ½åŠ›å¤§è‡´ç›¸å½“ï¼Œç„¶è€Œï¼Œå®ƒé€æ¸æˆä¸ºæœ€æœ‰ç”¨çš„å˜é‡ã€‚MACDä¿¡å·éµå¾ªå…·æœ‰è¾ƒä½å¹…åº¦çš„ç±»ä¼¼è·¯å¾„ã€‚</p><h1 id="40c8" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">ç»“è®º</h1><p id="22fd" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†è®­ç»ƒã€æµ‹è¯•å’ŒéªŒè¯ä¸€ä¸ªéšæœºæ£®æ—æ¨¡å‹çš„æ­¥éª¤ï¼Œè¯¥æ¨¡å‹ç”¨äºé¢„æµ‹8åªè‚¡ç¥¨çš„èµ°å‘ã€‚æ‰€è·å¾—çš„ç»“æœæ˜¯ä»¤äººæ»¡æ„çš„ï¼ŒéªŒè¯é›†çš„é¢„æµ‹çš„å¹³å‡å‡†ç¡®åº¦ä¸º90%ã€‚æ­¤å¤–ï¼Œè¯¥æ¨¡å‹åœ¨é¢„æµ‹æœªæ¥13å¤©çš„æ–¹å‘æ—¶è¾¾åˆ°äº†æœ€é«˜çš„ç²¾ç¡®åº¦ã€‚</p></div></div>    
</body>
</html>