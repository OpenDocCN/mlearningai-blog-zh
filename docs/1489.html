<html>
<head>
<title>Azure Machine learning Deep reinforcement learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure机器学习深度强化学习</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/azure-machine-learning-deep-reinforcement-learning-91fc3e1cd3e1?source=collection_archive---------6-----------------------#2021-12-25">https://medium.com/mlearning-ai/azure-machine-learning-deep-reinforcement-learning-91fc3e1cd3e1?source=collection_archive---------6-----------------------#2021-12-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/26eb3165d10c494f70aef56d86a2488d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C1ICJBMOa0lxhvhv"/></div></div></figure><h1 id="341b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">使用开放式健身房和Tensorflow，Keras</h1><h1 id="4a8f" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">用例</h1><ul class=""><li id="8772" class="jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">使用强化学习并训练深度RL模型</li><li id="efd0" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">使用开放式健身房和Tensorflow</li><li id="b7b9" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">使用Keras</li><li id="55d9" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">安装依赖项</li><li id="0792" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">原创教程复制自—<a class="ae kk" href="https://github.com/nicknochnack/TensorflowKeras-ReinforcementLearning/blob/master/Deep%20Reinforcement%20Learning.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/nicknochnack/tensorflowceras-reinforcement learning/blob/master/Deep % 20 reinforcement % 20 learning . ipynb</a></li><li id="3ae4" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">本教程是在Azure机器学习服务中展示上述作品。</li></ul><h1 id="c95a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">安装依赖项</h1><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="b50b" class="ku iq hh kq b fi kv kw l kx ky">!pip install --upgrade tensorflow<br/>!pip install gym<br/>!pip install keras<br/>!pip install keras-rl2</span><span id="9871" class="ku iq hh kq b fi kz kw l kx ky">!sudo apt-get update<br/>!sudo apt-get install -y xvfb ffmpeg<br/>!pip install 'imageio==2.4.0'<br/>!pip install pyvirtualdisplay<br/>!sudo apt-get install -y python-opengl xvfb</span></pre><ul class=""><li id="c18b" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">我测试tensorflow的时候版本是2.6.0</li><li id="1a6b" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">虚拟显示是开放式体育馆渲染图像或图形的必要手段</li><li id="9146" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">我们的想法是展示我们可以在Azure机器学习的jupyter实验室中运行所有开源代码</li></ul><h1 id="f9b0" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">密码</h1><ul class=""><li id="f544" class="jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">显示张量流版本</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="0d66" class="ku iq hh kq b fi kv kw l kx ky">import tensorflow as tf; <br/>print(tf.__version__)</span></pre><ul class=""><li id="f639" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">现在进口</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="6cc1" class="ku iq hh kq b fi kv kw l kx ky">import gym <br/>import random</span><span id="54d9" class="ku iq hh kq b fi kz kw l kx ky">import os<br/>import io<br/>import base64<br/>from IPython.display import display, HTML</span></pre><ul class=""><li id="723e" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">配置显示器</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="725c" class="ku iq hh kq b fi kv kw l kx ky">from pyvirtualdisplay import Display<br/>display = Display(visible=0, size=(800, 600))<br/>display.start()</span><span id="1edd" class="ku iq hh kq b fi kz kw l kx ky">import matplotlib.pyplot as plt<br/>%matplotlib inline<br/>from IPython import display</span></pre><ul class=""><li id="95bf" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">现在设置开放的健身房环境</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="9162" class="ku iq hh kq b fi kv kw l kx ky">env = gym.make('CartPole-v0')<br/>states = env.observation_space.shape[0]<br/>actions = env.action_space.n</span><span id="ea61" class="ku iq hh kq b fi kz kw l kx ky">actions</span></pre><ul class=""><li id="dc17" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">测试渲染是否正常</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="f848" class="ku iq hh kq b fi kv kw l kx ky">import gym<br/>env = gym.make('CartPole-v0')<br/>env.reset()<br/>env.render()</span></pre><ul class=""><li id="5483" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">创建剧集</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="267a" class="ku iq hh kq b fi kv kw l kx ky">episodes = 10<br/>for episode in range(1, episodes+1):<br/>    state = env.reset()<br/>    done = False<br/>    score = 0 <br/>    <br/>    while not done:<br/>        env.render()<br/>        action = random.choice([0,1])<br/>        n_state, reward, done, info = env.step(action)<br/>        score+=reward<br/>    print('Episode:{} Score:{}'.format(episode, score))</span></pre><ul class=""><li id="60b8" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">现在是时候建立模型了</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="a3af" class="ku iq hh kq b fi kv kw l kx ky">import numpy as np<br/>from tensorflow.keras.models import Sequential<br/>from tensorflow.keras.layers import Dense, Flatten<br/>from tensorflow.keras.optimizers import Adam</span></pre><ul class=""><li id="1ead" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">定义模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="56e0" class="ku iq hh kq b fi kv kw l kx ky">def build_model(states, actions):<br/>    model = Sequential()<br/>    model.add(Flatten(input_shape=(1,states)))<br/>    model.add(Dense(24, activation='relu'))<br/>    model.add(Dense(24, activation='relu'))<br/>    model.add(Dense(actions, activation='linear'))<br/>    return model</span></pre><ul class=""><li id="3040" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">建立模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="7f00" class="ku iq hh kq b fi kv kw l kx ky">model = build_model(states, actions)</span></pre><ul class=""><li id="5be3" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">显示模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="01bd" class="ku iq hh kq b fi kv kw l kx ky">model.summary()</span></pre><ul class=""><li id="9b11" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">深度强化学习包括</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="5092" class="ku iq hh kq b fi kv kw l kx ky">from rl.agents import DQNAgent<br/>from rl.policy import BoltzmannQPolicy<br/>from rl.memory import SequentialMemory</span></pre><ul class=""><li id="e7de" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">定义代理</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="7e48" class="ku iq hh kq b fi kv kw l kx ky">def build_agent(model, actions):<br/>    policy = BoltzmannQPolicy()<br/>    memory = SequentialMemory(limit=50000, window_length=1)<br/>    dqn = DQNAgent(model=model, memory=memory, policy=policy, <br/>                  nb_actions=actions, nb_steps_warmup=10, target_model_update=1e-2)<br/>    return dqn</span></pre><ul class=""><li id="db8d" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">构建并运行模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="ff4b" class="ku iq hh kq b fi kv kw l kx ky">dqn = build_agent(model, actions)<br/>dqn.compile(Adam(lr=1e-3), metrics=['mae'])<br/>dqn.fit(env, nb_steps=50000, visualize=False, verbose=1)</span></pre><ul class=""><li id="9258" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">试验</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="8fe1" class="ku iq hh kq b fi kv kw l kx ky">scores = dqn.test(env, nb_episodes=100, visualize=False)<br/>print(np.mean(scores.history['episode_reward']))</span></pre><ul class=""><li id="ebe4" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">试验</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="6e2d" class="ku iq hh kq b fi kv kw l kx ky">_ = dqn.test(env, nb_episodes=15, visualize=True)</span></pre><ul class=""><li id="5a3e" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">保存评分模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="e304" class="ku iq hh kq b fi kv kw l kx ky">dqn.save_weights('dqn_weights.h5f', overwrite=True)</span></pre><ul class=""><li id="0aa0" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">删除所有内容</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="f0b0" class="ku iq hh kq b fi kv kw l kx ky">del model<br/>del dqn<br/>del env</span></pre><ul class=""><li id="3528" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">现在加载模型</li><li id="ff70" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">用新数据集进行推理测试</li><li id="8e61" class="jn jo hh jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">设置环境并加载保存的模型</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="1285" class="ku iq hh kq b fi kv kw l kx ky">env = gym.make('CartPole-v0')<br/>actions = env.action_space.n<br/>states = env.observation_space.shape[0]<br/>model = build_model(states, actions)<br/>dqn = build_agent(model, actions)<br/>dqn.compile(Adam(lr=1e-3), metrics=['mae'])</span></pre><ul class=""><li id="bacb" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">装载重物</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="e529" class="ku iq hh kq b fi kv kw l kx ky">dqn.load_weights('dqn_weights.h5f')</span></pre><ul class=""><li id="779e" class="jn jo hh jp b jq la js lb ju lc jw ld jy le ka kb kc kd ke bi translated">进行评分</li></ul><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="9dad" class="ku iq hh kq b fi kv kw l kx ky">_ = dqn.test(env, nb_episodes=5, visualize=True)</span></pre><p id="4daa" class="pw-post-body-paragraph lf lg hh jp b jq la lh li js lb lj lk ju ll lm ln jw lo lp lq jy lr ls lt ka ha bi translated"><em class="lu">最初发表于</em><a class="ae kk" href="https://github.com/balakreshnan/Samples2021/blob/main/RL/rlcustomtest1.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="lu">。</em></p><div class="lv lw ez fb lx ly"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm in ly"/></div></div></a></div></div></div>    
</body>
</html>