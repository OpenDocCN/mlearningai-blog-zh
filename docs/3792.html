<html>
<head>
<title>Big Data Analysis at Home: AWS S3 to Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">家庭大数据分析:AWS S3到Python</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/big-data-analysis-at-home-aws-bucket-to-python-69d7ecfb5872?source=collection_archive---------3-----------------------#2022-10-22">https://medium.com/mlearning-ai/big-data-analysis-at-home-aws-bucket-to-python-69d7ecfb5872?source=collection_archive---------3-----------------------#2022-10-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="723f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为一个兼职项目，我使用存储在AWS S3的千兆字节数据练习SQL。我在AWS中构建了一个数据湖，并提取可以在Python中使用的聚合数据。</p><p id="92bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">你需要什么</strong>:</p><ul class=""><li id="dc4f" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">AWS S3</li><li id="95ee" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">AWS胶水</li><li id="35f1" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">AWS雅典娜</li><li id="cfec" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">开源代码库</li><li id="ac26" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">计算机编程语言</li></ul><p id="f055" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(注:要了解关于AWS使用S3 -&gt; Glue -&gt; Athena的数据湖的整体想法，请查看<a class="ae jr" rel="noopener" href="/swlh/tutorial-build-your-data-lake-using-aws-s3-athena-150c1aaa44cf">托默·约斯科维奇的文章</a>。根据我自己的经验，安装AWS S3、Glue和Athena相当困难，但是在谷歌和YouTube上有许多教程，所以你可以搜索它们。)</p><p id="83c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程中，我使用芝加哥Ride-Hail Trips数据集(查看2019年<a class="ae jr" href="https://data.cityofchicago.org/Transportation/Transportation-Network-Providers-Trips-2019/iu3g-qa69" rel="noopener ugc nofollow" target="_blank">和2020年</a><a class="ae jr" href="https://data.cityofchicago.org/Transportation/Transportation-Network-Providers-Trips-2020/rmc8-eqv4" rel="noopener ugc nofollow" target="_blank">的数据)。当我决定使用这个数据集时，我有以下问题。COVID后拼车减少了吗？为了回答这个问题，我存储数据集，提取它们，并首先将它们聚合到daily中，然后使用Python将daily数据再次聚合到monthly中，并显示rideshare模式在COVID前后是如何变化的。计划是比较COVID前后的月平均乘车份额。</a></p><h1 id="75e4" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">自动警报系统</h1><p id="d3f8" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">首先，我在S3存储了27.6和12.1GB的Chicago Ride-Hail Trips数据集。我不会在这里详细介绍如何设置AWS S3，但是在设置好之后，您可以简单地将CSV文件上传到bucket中。我建议你练习这些步骤(AWS S3 -&gt; Glue -&gt; Athena)，例如使用小于100 MB的少量CSV数据。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/193833b5979024e25566457601f48009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bB85zUnCS2ozMbJH.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">image by Author</figcaption></figure><p id="6209" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其次，我使用AWS Glue抓取数据集。根据我对阅读<a class="ae jr" rel="noopener" href="/swlh/tutorial-build-your-data-lake-using-aws-s3-athena-150c1aaa44cf"> Tomer Yoskovich的文章</a>的理解，Glue将CSV文件转换成列类型，就像你在Athena中看到的那样。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/b29b03af70611f3f19c59650eb5c25da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*prPSSF0OE4O9MA5_.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">image by Author</figcaption></figure><p id="b437" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在AWS Athena中，我可以对这些数据集运行SQL。据我所知，爬虫让我将AWS S3 CSV转移到AWS Athena表中。爬行之后，您将在下面的AWS Athena中找到这些表。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/a7b5f0f86ec7e85801bc0fd5b69919f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eDoK7DT6eHrYH4Xx.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">image by Author</figcaption></figure><p id="3461" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我可以用AWS Athena运行SQL了。我对数据集中的观察值数量很好奇。我运行下面的SQL查询来计算2020年芝加哥的乘车总数。我发现2020年有5000万次观测。</p><pre class="kw kx ky kz fd lh li lj lk aw ll bi"><span id="dbb7" class="lm jt hh li b fi ln lo l lp lq">SELECT <br/>    COUNT('geoid') <br/>FROM<br/>    "taxi"."year2020"</span></pre><p id="cfcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了检查COVID后乘坐次数是否减少，我计算了每天的出行次数。</p><pre class="kw kx ky kz fd lh li lj lk aw ll bi"><span id="a7a7" class="lm jt hh li b fi ln lo l lp lq">-- taxi2019dailyCount<br/>SELECT COUNT('trip miles'), SUBSTRING("trip start timestamp", 1, 2) AS month,<br/>    SUBSTRING("trip start timestamp", 4, 2) AS day<br/>FROM "taxi"."year2019" <br/>GROUP BY SUBSTRING("trip start timestamp", 1, 2), SUBSTRING("trip start timestamp", 4, 2)<br/>ORDER BY SUBSTRING("trip start timestamp", 1, 2), SUBSTRING("trip start timestamp", 4, 2)</span></pre><p id="526e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的SQL代码中，我使用SUBSTRING命令来创建旅行的日期和月份，并按月-日对进行分组，以计算2019年的每日旅行次数(我试图使用<a class="ae jr" href="https://www.sqltutorial.org/sql-date-functions/how-to-extract-month-from-date-in-sql/" rel="noopener ugc nofollow" target="_blank"> SQL时间戳相关代码</a>来获取月份和日期，但它对我没有用，所以我改用SUBSTRING命令)。我使用类似的命令来计算2020年的每日出行次数。我花了大约两到三秒钟运行代码。</p><p id="375a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在存储到AWS S3、抓取AWS Glue并使用AWS Athena运行SQL之后，我现在有了2019年和2020年芝加哥每日拼车次数的数据集。</p><h1 id="cacd" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">计算机编程语言</h1><p id="e347" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我从AWS导入我创建的数据来开始分析。</p><h2 id="83d5" class="lm jt hh bd ju lr ls lt jy lu lv lw kc ip lx ly kg it lz ma kk ix mb mc ko md bi translated">输入数据</h2><p id="a1c1" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">首先，我导入2019年和2020年的每日数据。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="me mf l"/></div></figure><h2 id="5f5e" class="lm jt hh bd ju lr ls lt jy lu lv lw kc ip lx ly kg it lz ma kk ix mb mc ko md bi translated">平均的</h2><p id="cde1" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我生成每年的月平均乘车次数。我使用月平均乘车次数而不是日计数，因为它看起来不那么吵，所以容易看到。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="me mf l"/></div></figure><h2 id="d6e0" class="lm jt hh bd ju lr ls lt jy lu lv lw kc ip lx ly kg it lz ma kk ix mb mc ko md bi translated">测绘</h2><p id="2e9c" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">对于图表中的标签，我将乘坐次数的单位设置为1000次。然后，我画出每年的月平均乘车次数。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="4922" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如你在下图中看到的，我发现从三月份开始乘车次数明显减少。目测一下，可以看到2019年和2020年的乘坐次数差不多，但是从2月到4月从30万下降到5万，大概是月乘坐次数下降了83.3%！乘坐人数在4月份最低，但从5月份开始反弹，但此后没有恢复。与2019年相比，只有三分之一的乘坐发生在2020年6月至12月。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mg"><img src="../Images/073f999a805ed15488da39e5859689fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*blNxTQr7Dy5zOcxAi7R0_g.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">image by Author</figcaption></figure><p id="6d0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如你在图表中看到的，我发现从三月份开始乘车次数明显减少。</p><h1 id="0ada" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">带走:</h1><ul class=""><li id="65b8" class="jd je hh ig b ih kq il kr ip mh it mi ix mj jb ji jj jk jl bi translated">您可以使用AWS S3、Glue和Athena来存储大数据(超过10 GB)并提取聚合数据以开始Python中的分析。</li></ul><p id="9ef6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Jupyter笔记本的原始代码在以下链接中:</p><div class="mk ml ez fb mm mn"><a href="https://github.com/WeonhyeokChung/blog-medium/blob/main/notebook4post/taxi.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hi fi z dy ms ea eb mt ed ef hg bi translated">blog-medium/taxi . ipynb at main weonhyoekchung/blog-medium</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">在GitHub上创建一个帐户，为weonhyoekchung/blog-medium开发做出贡献。</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb lb mn"/></div></div></a></div><p id="9125" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">相关文章</strong></p><p id="95cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[1]“教程:使用AWS S3 &amp;雅典娜构建你的数据湖”(作者托默·约斯科维奇)<a class="ae jr" rel="noopener" href="/swlh/tutorial-build-your-data-lake-using-aws-s3-athena-150c1aaa44cf">https://medium . com/swlh/Tutorial-Build-your-Data-Lake-using-AWS-S3-Athena-150 C1 AAA 44 cf</a></p><p id="42a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jr" href="https://github.com/WeonhyeokChung/blog-medium/blob/main/notebook4post/taxi.ipynb" rel="noopener ugc nofollow" target="_blank">github.com</a></p><div class="mk ml ez fb mm mn"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hi fi z dy ms ea eb mt ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">medium.com</p></div></div><div class="mw l"><div class="nc l my mz na mw nb lb mn"/></div></div></a></div></div></div>    
</body>
</html>