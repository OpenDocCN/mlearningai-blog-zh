<html>
<head>
<title>Azure Open AI Completions API with Azure Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Azure数据块的Azure开放人工智能完成API</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/azure-open-ai-completions-api-with-azure-databricks-b94d71c063c9?source=collection_archive---------4-----------------------#2022-10-22">https://medium.com/mlearning-ai/azure-open-ai-completions-api-with-azure-databricks-b94d71c063c9?source=collection_archive---------4-----------------------#2022-10-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="5888" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用data bricks process open ai Completions API处理大规模文档</h1><h1 id="1a40" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="b794" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="7513" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储帐户</li><li id="dd4d" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure数据块</li><li id="20bb" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建计算</li><li id="ecca" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">从<a class="ae jz" href="https://microsoft.github.io/SynapseML/docs/getting_started/installation/#databricks" rel="noopener ugc nofollow" target="_blank">https://Microsoft . github . io/SynapseML/docs/getting _ started/installation/# data bricks</a>安装库</li><li id="2ee6" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">库位置—<a class="ae jz" href="https://mmlspark.blob.core.windows.net/dbcs/SynapseMLExamplesv0.10.1.dbc" rel="noopener ugc nofollow" target="_blank">https://mmls park . blob . core . windows . net/dbcs/synapsemlexamplesv 0 . 10 . 1 . DBC</a></li></ul><h1 id="e657" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">密码</h1><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="4fcb" class="kj if hh kf b fi kk kl l km kn">import os<br/>from pyspark.sql import SparkSession<br/>from synapse.ml.core.platform import running_on_synapse, find_secret</span><span id="2690" class="kj if hh kf b fi ko kl l km kn"># Bootstrap Spark Session<br/>spark = SparkSession.builder.getOrCreate()<br/>if running_on_synapse():<br/>    from notebookutils.visualization import display</span><span id="2389" class="kj if hh kf b fi ko kl l km kn"># Fill in the following lines with your service information<br/>service_name = "openaiservicenamecreated"<br/>deployment_name = "synapseml-openai"<br/>key = "xxxxxxxxxxxxxxxxxxxxxx"</span></pre><ul class=""><li id="2f23" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">创建一个示例数据框架</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="a0b8" class="kj if hh kf b fi kk kl l km kn">df = spark.createDataFrame(<br/>    [<br/>        ("Hello my name is",),<br/>        ("The best code is code thats",),<br/>        ("SynapseML is ",),<br/>    ]<br/>).toDF("prompt")</span></pre><ul class=""><li id="998a" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">开放人工智能完成</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="3790" class="kj if hh kf b fi kk kl l km kn">from synapse.ml.cognitive import OpenAICompletion</span><span id="daa0" class="kj if hh kf b fi ko kl l km kn">completion = (<br/>    OpenAICompletion()<br/>    .setSubscriptionKey(key)<br/>    .setDeploymentName(deployment_name)<br/>    .setUrl("https://{}.openai.azure.com/".format(service_name))<br/>    .setMaxTokens(200)<br/>    .setPromptCol("prompt")<br/>    .setErrorCol("error")<br/>    .setOutputCol("completions")<br/>)</span></pre><ul class=""><li id="0104" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">运行数据框架</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="6abd" class="kj if hh kf b fi kk kl l km kn">from pyspark.sql.functions import col</span><span id="2fd6" class="kj if hh kf b fi ko kl l km kn">completed_df = completion.transform(df).cache()<br/>display(<br/>    completed_df.select(<br/>        col("prompt"),<br/>        col("error"),<br/>        col("completions.choices.text").getItem(0).alias("text"),<br/>    )<br/>)</span></pre><figure class="ka kb kc kd fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/3755525863da1d002ecdf4ce22f41898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pm9pNkYjEWApjyeX.jpg"/></div></div></figure><ul class=""><li id="da9e" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">现在批量处理</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2ef8" class="kj if hh kf b fi kk kl l km kn">batch_df = spark.createDataFrame(<br/>    [<br/>        (["The time has come", "Pleased to", "Today stocks", "Here's to"],),<br/>        (["The only thing", "Ask not what", "Every litter", "I am"],),<br/>    ]<br/>).toDF("batchPrompt")</span><span id="8ac7" class="kj if hh kf b fi ko kl l km kn">batch_completion = (<br/>    OpenAICompletion()<br/>    .setSubscriptionKey(key)<br/>    .setDeploymentName(deployment_name)<br/>    .setUrl("https://{}.openai.azure.com/".format(service_name))<br/>    .setMaxTokens(200)<br/>    .setBatchPromptCol("batchPrompt")<br/>    .setErrorCol("error")<br/>    .setOutputCol("completions")<br/>)</span><span id="a9b5" class="kj if hh kf b fi ko kl l km kn">completed_batch_df = batch_completion.transform(batch_df).cache()<br/>display(completed_batch_df)</span></pre><figure class="ka kb kc kd fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lc"><img src="../Images/c39246d687ddd1767edf827897305fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q_FmUgxoYXoufy6c.jpg"/></div></div></figure><ul class=""><li id="93f8" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">安装python openai</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="f947" class="kj if hh kf b fi kk kl l km kn">!pip install openai</span></pre><ul class=""><li id="123c" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">创建开放的ai api rest</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="8e51" class="kj if hh kf b fi kk kl l km kn">import os<br/>import openai<br/>openai.api_type = "azure"<br/>openai.api_base = "https://bbopenai.openai.azure.com/"<br/>openai.api_version = "2022-06-01-preview"<br/>openai.api_key = "xxxxxxxx"</span><span id="e202" class="kj if hh kf b fi ko kl l km kn">response = openai.Completion.create(<br/>  engine="synapseml-openai",<br/>  prompt="you have reached the essence of hargon this is donna i'll be assisting you with your inquiries today please be informed that this call is being recorded and monitored for quality assurance purposes how may i help you well i bought i i got this from essence of oregon oil umm for shipping handling and handling costs of five ninety nine sample of it and if i want to cancel the order i had to do it within fifteen days and so that is what i want wanted to do i didn't want to i didn't want to get you know like a monthly for what is it eighty three dollars a month OK i can't afford that OK i'm more than happy for me i'm happy to assist you for me to be able to pull up your subscription here could you kindly provide me your first and your last name from caroline C A R O L Y N lake L A K E O L Y and then yes lake yes OK let's just go ahead and pull up here subscription here or your account OK and could you gonna verify your email address please it's lake three nine two one at hotmail dot com how about your shipping address three ten warren avenue number two gillette wyoming eight two seven one six and is your shipping address same as your billing address correct how about your phone number three oh seven six eight oh two oh six eight OK thank you very much for that information miss lake if you don't mind me asking may i know the reason why you want to cancel the subscription well i just i thought i was just getting a a sample order of it you know i was curious have you seen how it worked and everything yes i mean have you already used not all of it but not all of it but i have that i have been using it yes OK i do understand that miss lake this is what i can do for you for you to be able you know to maximize or enjoy the benefits of the organ outgoing to extend your pre trial for another fifteen days with no charge so at least you do have fifteen days to enjoy you know the amazing product and then give us a call back before the end of that fifteen day additional extension period to give us the feedback because what i heard from you is that you haven't used the product that much so you're not you know here did not yet get what the benefits of it so that's the reason why i'm extending your uh period are your pre trial for you to be able to enjoy and discover the benefits of essence of argan OK OK umm what date would that be OK let me check here so you're already extended your pre tier it will end on august twenty fourth so you need to give us a call back before august twenty fourth to give us a feedback if you i mean what happened to the product if it didn't something it gives you the benefits that you need but let's say you love the product like the product you don't need to give us a call back then OK it will be automatically uh you will be receiving another;dr",<br/>  temperature=0.7,<br/>  max_tokens=60,<br/>  top_p=1,<br/>  frequency_penalty=0,<br/>  presence_penalty=0,<br/>  stop=None<br/>)</span></pre><ul class=""><li id="c121" class="jc jd hh je b jf kp jh kq jj kr jl ks jn kt jp jq jr js jt bi translated">显示响应</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="6f86" class="kj if hh kf b fi kk kl l km kn">print(response.choices[0].text)</span></pre><figure class="ka kb kc kd fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ld"><img src="../Images/b7d86b4abfca3c94eb8ffe22ac418872.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sa8XbCLNz8sC11Lu.jpg"/></div></div></figure><h1 id="d7b9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">【https://github.com】最初发表于<a class="ae jz" href="https://github.com/balakreshnan/Samples2022/blob/main/AzureAI/openaiadb.md" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a><em class="le">。</em></h1><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hi fi z dy ln ea eb lo ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw la li"/></div></div></a></div></div></div>    
</body>
</html>