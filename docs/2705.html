<html>
<head>
<title>Music genre classification using CNN: Part 2- Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CNN的音乐类型分类:第2部分-分类</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/music-genre-classification-using-cnn-part-2-classification-ee5400cfbc4f?source=collection_archive---------2-----------------------#2022-06-01">https://medium.com/mlearning-ai/music-genre-classification-using-cnn-part-2-classification-ee5400cfbc4f?source=collection_archive---------2-----------------------#2022-06-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0db7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">了解如何使用CNN对音乐流派进行分类。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/562ce9f3d89216e7d3a32fd02b5ba152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECR78PVfyhwKhG3aLFM1cA.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@marius?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Marius Masalar</a> on <a class="ae js" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="eab2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<a class="ae js" rel="noopener" href="/mlearning-ai/music-genre-classification-using-cnn-part-1-feature-extraction-b417547b8981">前一部分</a>中，我们学习了从音频样本中提取特征。现在，我们有了不同的特性，我们继续分类任务。首先，我们将分别使用特征对音频样本进行分类，然后我们将使用所有特征的集合进行分类。</p><h2 id="9a0a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤1:导入库</h2><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><h2 id="602c" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤2:导入npz文件，提取特征，分割训练测试数据</h2><p id="34de" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们在<a class="ae js" rel="noopener" href="/mlearning-ai/music-genre-classification-using-cnn-part-1-feature-extraction-b417547b8981">之前的文章</a>中提取了这些特征，并保存在npz文件中。我们只是在这里加载文件。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><h2 id="2f23" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤3:调整数据的大小和形状</h2><p id="b4b5" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">缩放操作仅适用于定型数据集。在测试期间，相同的最大值(来自训练数据)用于对测试数据执行缩放。</p><p id="ef42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们找出<em class="kv"> S_train </em>和<em class="kv">T7的最大值，然后将<em class="kv"> S_train </em>除以最大值。在测试过程中，我们也将<em class="kv"> S_test </em>除以<em class="kv"> S_train </em>的最大值。</em></p><p id="39f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，我们将数据整形为(N，row，col，1)形式，因为CNN要求输入是这种形式。它表示图像中只有一个通道。谱图的原始形状是(944，1025，1295)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="8747" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">MFCC的最初形状是(944，10，1293)。我们首先将MFCC训练和测试数据的大小调整为(944，120，600)。之后，我们为CNN将数据整形为(N，row，col，1)。然后我们将数据标准化。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="2e08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Mel谱图的原始形状是(944，128，1293)。我们首先使用最大的训练数据来缩放训练和测试数据。然后，我们将CNN的数据整形为(N，row，col，1)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><h2 id="b3fb" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤4:在npz文件中保存培训和测试特征</h2><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="e688" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于所有模型，我们将纪元设置为100，批量大小为32，学习率为0.001。</p><h2 id="f0c8" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤5:使用光谱图进行分类</h2><p id="3b1f" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们将首先加载训练测试分割数据(。npz文件)。然后我们定义一个CNN模型进行分类。除了最后一层我们使用了softmax，我们已经使用ReLU作为层的激活函数。然后我们使用Adam优化器。我们在每5个时期后有一个检查点，如果在任何情况下我们的模型在训练期间被中断，我们可以使用它。之后，我们保存训练好的模型。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="3d6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们可以对模型训练部分进行注释，并加载训练好的模型。我们计算训练数据的准确度，然后测试数据。然后，我们显示测试数据的混淆矩阵。我们在测试数据集上取得了71.96%的准确率。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="ee79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在这个项目中，我们使用了两种光谱图模型。下面的代码是声谱图的第二个模型。我们在测试数据集上取得了73.54%的准确率。我们将考虑这两种模式，同时采取合奏。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="0ca5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最佳谱图模型的混淆矩阵如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/d195b2a747b7d92eb1bbc4022344d3aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGgdFrJk6GCZ-Tn7umayrQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Confusion matrix for the best model of Spectrogram (Image by the Author)</figcaption></figure><h2 id="be90" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">第六步:使用MFCC分类</h2><p id="d276" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">对于MFCC，我们训练了三个模型，并使用这三个模型的集合来报告准确性。我们还使用了k倍交叉验证，k =10。我们在测试数据上取得了74.07%的准确率。</p><p id="d460" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们再次加载MFCC的列车测试分割并定义模型。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="54c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，因为我们将采用三个MFCC模型的集合，我们定义一个函数来从三个模型中取多数票。然后我们训练所有三个模型。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="69b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们训练完模型之后，我们将加载模型并将<em class="kv"> y_pred </em>发送到<em class="kv"> get_majority() </em>函数中。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="f8ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在测试数据上取得了74.07%的准确率。MFCC的混淆矩阵如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/9d1786d690e75fe69caf560352a2dd65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEqpJh4mPO8RRQRQBJ6Yyw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Confusion matrix for MFCC (Image by the Author)</figcaption></figure><h2 id="75d3" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤7:使用Mel谱图进行分类</h2><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="d006" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在测试数据上取得了75.13%的准确率。Mel谱图的混淆矩阵如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/cb51010736c26f2de9ba2f4b985cac22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8D0DxVCvfTErEcSM-s-34w.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Confusion matrix for Mel-spectrogram (Image by the Author)</figcaption></figure><h2 id="045d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">步骤8:创建声谱图、梅尔声谱图和MFCC CNN的集合</h2><p id="9484" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">现在，对于系综，我们将加载所有模型(使用新文件以避免任何混淆和错误)并计算<em class="kv"> y-pred </em>。该集合包含2个声谱图模型、3个MFCC模型和1个梅尔声谱图模型。之后，我们将把预测发送给<em class="kv"> get_majority </em>函数，并报告集合的准确性。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="5f1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用集成获得的准确率为79.36%。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="7924" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">系综的混淆矩阵如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/98cef85416d9e8cf2ce7335a7e0c7389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lqZ2E2yDIKzFEWZmMhU5A.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Confusion matrix for the Ensemble (Image by the Author)</figcaption></figure><h1 id="ea7c" class="kx ju hh bd jv ky kz la jz lb lc ld kd le lf lg kg lh li lj kj lk ll lm km ln bi translated">结论</h1><p id="94cd" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们已经学会了如何使用CNN进行音乐流派分类。测试数据被单独取出，以避免任何数据泄露。首先，分别训练特征进行分类。其次，创建不同特征的集合，并使用多数投票策略进行预测。我们使用了2个声谱图模型、3个MFCC模型和1个梅尔声谱图模型。我们在集成上实现了79.36%的准确率，这明显优于单一特征模型。这显示了使用集合模型的稳健性和效率。在被错误分类的流派中，被错误分类最多的流派是“摇滚”。它大多被错误地归类为“金属”、“迪斯科”、“布鲁斯”和“乡村音乐”。第二大被错误分类的流派是“乡村”，它被错误地分类为“摇滚”、“雷鬼”和“布鲁斯”。</p><blockquote class="lo lp lq"><p id="6372" class="ie if kv ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated">完整代码可在<a class="ae js" href="https://github.com/namratadutt/Music-genre-classification-part-2/tree/main" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p><p id="e8a9" class="ie if kv ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated">感谢阅读！我希望这篇文章对你有所帮助。</p><p id="d810" class="ie if kv ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated">加油鳄鱼队！🐊</p></blockquote><div class="lu lv ez fb lw lx"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">medium.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml jm lx"/></div></div></a></div></div></div>    
</body>
</html>