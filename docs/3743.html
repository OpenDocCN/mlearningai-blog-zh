<html>
<head>
<title>Market basket Analysis: Step-by-step coding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">购物篮分析:逐步编码</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/market-basket-analysis-step-by-step-coding-cd13ce1f8de9?source=collection_archive---------0-----------------------#2022-10-15">https://medium.com/mlearning-ai/market-basket-analysis-step-by-step-coding-cd13ce1f8de9?source=collection_archive---------0-----------------------#2022-10-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/62f85d2a25ffc74adfd3c9fc3c6472bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bimSluLLqDb-hbhQrWGjmA.png"/></div></div></figure><p id="1a1c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在上一篇文章中，我写了购物篮分析和apriori算法，但没有编写代码。</p><p id="839c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" rel="noopener" href="/mlearning-ai/what-are-market-basket-analysis-and-the-apriori-algorithm-fe0e8e6e34d">https://medium . com/mlearning-ai/what-is-market-basket-analysis-and-the-apriori-algorithm-Fe 0 e 8 e 6 e 34d</a></p><p id="a7d5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我将一步步向您展示如何使用Python实现购物篮分析。建议先了解理论再看这篇文章。</p><h1 id="e849" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">指标概述</h1><ul class=""><li id="c4c6" class="km kn hh ir b is ko iw kp ja kq je kr ji ks jm kt ku kv kw bi translated"><strong class="ir hi">支持:</strong>项目在所有交易中出现的概率</li><li id="a51e" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">置信度:</strong>在给定某些项目的情况下，下列项目在同一交易中出现的概率</li><li id="6d03" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi"> Lift: </strong>给定A存在的B发生的概率与不知道A存在的B发生的概率之比。</li><li id="3ecb" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">杠杆:</strong>A和B一起发生的概率与A和B各自独立的概率之差。</li><li id="b29a" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">确信:</strong>如果规则碰巧在那里或者不在</li></ul><blockquote class="lc"><p id="615b" class="ld le hh bd lf lg lh li lj lk ll jm dx translated">开始编码吧！！</p></blockquote><h1 id="1f65" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl bi translated">资料组</h1><p id="7fa8" class="pw-post-body-paragraph ip iq hh ir b is ko iu iv iw kp iy iz ja lp jc jd je lq jg jh ji lr jk jl jm ha bi translated">数据集可以从<a class="ae jn" href="https://www.kaggle.com/datasets/shazadudwadia/supermarket" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/datasets/shazadudwadia/supermarket</a>下载</p><p id="603b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该数据集包含11个项目:果酱、MAGGI、糖、咖啡、奶酪、茶、BOURNVITA、玉米片、面包、饼干和牛奶。</p><p id="c58f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有19个事务，1行代表1个事务。</p><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/c94353414b2d2d4bf63431bda20ea00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*g5582cfcWlJTg3fhWdVqbw.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">Dataset sample</figcaption></figure><h1 id="f9cc" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤摘要</h1><ol class=""><li id="eb2a" class="km kn hh ir b is ko iw kp ja kq je kr ji ks jm mb ku kv kw bi translated">导入库并加载数据</li><li id="c547" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm mb ku kv kw bi translated">一键编码</li><li id="89f9" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm mb ku kv kw bi translated">利用Apriori寻找频繁项集</li><li id="7f0e" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm mb ku kv kw bi translated">关联规则</li></ol><h2 id="53a4" class="mc jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated">1.导入库</h2><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="4fa9" class="mc jp hh mr b fi mv mw l mx my">import pandas as pd<br/>from mlxtend.preprocessing import TransactionEncoder<br/>from mlxtend.frequent_patterns import apriori, association_rules</span><span id="1104" class="mc jp hh mr b fi mz mw l mx my">df = pd.read_csv("GroceryStoreDataSet.csv", names = ['transaction'], sep = ',')</span></pre><ul class=""><li id="08b6" class="km kn hh ir b is it iw ix ja na je nb ji nc jm kt ku kv kw bi translated">用于数据帧管理的熊猫</li><li id="ebd6" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><a class="ae jn" href="http://rasbt.github.io/mlxtend/" rel="noopener ugc nofollow" target="_blank"> mlxtend </a>(机器学习扩展)是一个Python库，提供了用于日常数据科学任务的有用工具。</li><li id="e292" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">mlxtend.preprocessing用于执行任务前的数据预处理。</li><li id="dfd8" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">关联规则任务的mlxtend.frequent _ patterns。</li><li id="a95f" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">将数据作为变量df加载</li></ul><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es nd"><img src="../Images/62f74a93a9209ddb8914b9eb7d87da1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*C5thIZP5Rz09XFz5uc7CpA.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">dataframe sample</figcaption></figure><h2 id="52d7" class="mc jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated">2.一键编码</h2><p id="5ef9" class="pw-post-body-paragraph ip iq hh ir b is ko iu iv iw kp iy iz ja lp jc jd je lq jg jh ji lr jk jl jm ha bi translated">在将数据输入Apriori算法之前，我们必须将数据转换为适当的格式。目标是一个<strong class="ir hi">独热数据帧</strong>。</p><ul class=""><li id="e8b6" class="km kn hh ir b is it iw ix ja na je nb ji nc jm kt ku kv kw bi translated">将数据框架更改为列表列表。</li></ul><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="8996" class="mc jp hh mr b fi mv mw l mx my">df = list(df["transaction"].apply(lambda x:x.split(",")))</span></pre><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es ne"><img src="../Images/bab5ba7d482764b19246fbef8515399b.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*sAjmYrJt0GWlAfHXW6InTA.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">list of list</figcaption></figure><ul class=""><li id="42bc" class="km kn hh ir b is it iw ix ja na je nb ji nc jm kt ku kv kw bi translated">使用mlxtend库中的TransactionEncoder将事务列表更改为独热数组。</li></ul><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="4d40" class="mc jp hh mr b fi mv mw l mx my">one_hot_transformer = TransactionEncoder()</span><span id="8138" class="mc jp hh mr b fi mz mw l mx my">df_transform = one_hot_transformer.fit_transform(df)</span></pre><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es nf"><img src="../Images/4df5c7083537796f77d09984a3ffecaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*A-3mrgdrtsxEe7R5zB33RQ.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">one-hot array</figcaption></figure><p id="0fb2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它仍然很难阅读，所以我们将把它改为带有列名的dataframe。</p><ul class=""><li id="89a5" class="km kn hh ir b is it iw ix ja na je nb ji nc jm kt ku kv kw bi translated">将独热阵列更改为数据帧。</li></ul><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="1640" class="mc jp hh mr b fi mv mw l mx my">df = pd.DataFrame(df_transform,columns=one_hot_transformer.columns_)</span></pre><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es ng"><img src="../Images/75a62016fbf73612a897dcd20aac9ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*LjK48GVeEjVx2_cBIkOm4g.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">one-hot dataframe</figcaption></figure><p id="6e47" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是我们想要的格式，一热。列是商店中的商品，每行代表一笔交易。如果值为True，则该商品在该交易中售出。现在，数据已经准备好输入算法。</p><h2 id="826f" class="mc jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated">3.利用Apriori寻找频繁项集</h2><p id="a9c6" class="pw-post-body-paragraph ip iq hh ir b is ko iu iv iw kp iy iz ja lp jc jd je lq jg jh ji lr jk jl jm ha bi translated">我们将使用Apriori从一次性事务数据帧中找出频繁项集。这一步的目的是减少关联规则的计算量。</p><p id="bb01" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">频繁项集的支持度高于最小支持度。您可以调整min_support以适应您的数据集。</p><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="ea1c" class="mc jp hh mr b fi mv mw l mx my">df = apriori(df, min_support = 0.2, use_colnames = True)<br/>df.sort_values(['support'],ascending=False, inplace = True)</span></pre><figure class="lt lu lv lw fd ii er es paragraph-image"><div class="er es nh"><img src="../Images/43fe35e5164713541b6a98b2b4843903.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*cltMmHmUQgf8i9Pfpc9P7w.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">The itemsets whose support is higher than 0.2</figcaption></figure><p id="51ad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本例中，我将最小支持度设置为0.2，因此它将只过滤一组支持度大于0.2(或大于19个事务的20%)的项目。</p><p id="b4ef" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">只有这些被认为重要的项目集才会进入关联规则。</p><h2 id="5545" class="mc jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated">4.关联规则</h2><p id="3abc" class="pw-post-body-paragraph ip iq hh ir b is ko iu iv iw kp iy iz ja lp jc jd je lq jg jh ji lr jk jl jm ha bi translated">是时候迈出主要的一步了！！</p><p id="bd66" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">association_rules函数将自动计算我们交易数据的关键指标，包括支持、信心、提升、杠杆和信念。</p><pre class="lt lu lv lw fd mq mr ms mt aw mu bi"><span id="7ad6" class="mc jp hh mr b fi mv mw l mx my">df_ar = association_rules(df, metric="lift", min_threshold=1)</span></pre><p id="e31a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">结果如下所示。</p><figure class="lt lu lv lw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ni"><img src="../Images/71022839c8db7ba354dd9b3c42e64293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdHYZpZLwyORwb_cgLNQ-Q.png"/></div></div></figure><p id="fcae" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">其结果需要进一步的业务操作解释。</p><p id="b1a9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">解读示例</strong></p><ul class=""><li id="c85b" class="km kn hh ir b is it iw ix ja na je nb ji nc jm kt ku kv kw bi translated">从指数0的最高置信度开始，置信度为0.8。意思是买牛奶的顾客八成会买面包。然而，你必须记住，自信不是一切。这一行的高信心是由于面包的高支持(后果支持0.65)，这意味着面包在许多交易中发生，所以如果我们试图出售带牛奶的面包，它不会产生商业影响。</li><li id="ed9a" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">更好的衡量标准是提升或杠杆。指数8的升力和杠杆最高，分别为2.28和0.1125。这意味着购买茶叶的顾客很可能也会购买Maggi。</li></ul><p id="c907" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">知道这些后我们能做什么？</strong></p><ol class=""><li id="f624" class="km kn hh ir b is it iw ix ja na je nb ji nc jm mb ku kv kw bi translated">改变货架布局，销售靠近茶叶的Maggi。</li><li id="5f60" class="km kn hh ir b is kx iw ky ja kz je la ji lb jm mb ku kv kw bi translated">把玛吉和茶一起推广。</li></ol><h1 id="9636" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="309e" class="pw-post-body-paragraph ip iq hh ir b is ko iu iv iw kp iy iz ja lp jc jd je lq jg jh ji lr jk jl jm ha bi translated">在本文中，您将学习如何使用Python中的mlxtend库执行购物篮分析。在做出业务决策之前，您必须从关键指标(如置信度和lift)中解释关联规则的结果。</p><div class="nj nk ez fb nl nm"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nn ab dw"><div class="no ab np cl cj nq"><h2 class="bd hi fi z dy nr ea eb ns ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nt l"><h3 class="bd b fi z dy nr ea eb ns ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="nu l"><p class="bd b fp z dy nr ea eb ns ed ef dx translated">medium.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa in nm"/></div></div></a></div></div></div>    
</body>
</html>