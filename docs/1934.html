<html>
<head>
<title>Predicting Store Sales — Random Forest Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测商店销售额-随机森林回归</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/predicting-store-sales-random-forest-regression-b77abec64c17?source=collection_archive---------2-----------------------#2022-02-13">https://medium.com/mlearning-ai/predicting-store-sales-random-forest-regression-b77abec64c17?source=collection_archive---------2-----------------------#2022-02-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5f5630af74373e02f53eceae9fcc2cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPCafO9IUfhS3B6icYeMeg.jpeg"/></div></div></figure><p id="6267" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在任何业务中，销售都是推动收入和利润的最重要因素之一。因此，这也是为什么现在的公司都在头脑风暴如何增加总销售额的原因。</p><p id="5b67" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">尤其是在基于web/app的公司中，每天都会生成数据。公司希望将这些数据转化为可操作的见解，以提高销售额。</p><p id="021f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文的其余部分，我将概述一些关于公司如何生成自己的预测模型的基本方法。</p><p id="e48c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用的数据集可以从这个<a class="ae jn" href="https://www.kaggle.com/c/competitive-data-science-predict-future-sales/data" rel="noopener ugc nofollow" target="_blank">链接</a>下载，它有几个shop_id和item_id，每天销售的总商品和商品价格不同。该数据集的主要目标是确定下个月销售了多少商品。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="e8cc" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">未来销售预测模型</h1><p id="78af" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">概述:开发一个ML模型，用于预测多个商店和项目的未来总项目</p><p id="789b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目标:<br/> 1。从给定的数据集<br/> 2中分析并生成洞察。确定预测模型<br/> 3。测量模型精度<br/> 4。生成预测结果</p><p id="8bbd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">文件描述:<br/> 1。sales _ train.csv训练集。2013年1月至2015年10月的每日历史数据。<br/> 2。test.csv —测试集。你需要预测这些商店和产品在2015年11月的销售额。<br/> 3。items.csv关于物品/产品的补充信息。<br/> 4。item _ categories.csv关于项目类别的补充信息。<br/> 5。关于商店的补充信息。</p><p id="f513" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">数据字段:<br/> 1。ID —表示测试集<br/> 2中的(商店，商品)元组的ID。shop_id —商店的唯一标识符<br/> 3。item_id —产品的唯一标识符<br/> 4。item_category_id —项目类别的唯一标识符<br/> 5。item_cnt_day —售出的产品数量。你在预测这项措施的每月金额<br/> 6。item _ price——物品的当前价格<br/> 7。日期—格式为dd/mm/yyyy <br/> 8的日期。date _ block _ num为方便起见而使用的连续月份数。2013年1月是0，2013年2月是1，…，2015年10月是33 <br/> 9。item_name —项目的名称<br/> 10。商店名称—商店名称<br/> 11。项目类别名称—项目类别的名称</p><h1 id="3a67" class="jv jw hh bd jx jy ky ka kb kc kz ke kf kg la ki kj kk lb km kn ko lc kq kr ks bi translated">指导方针</h1><p id="f3e1" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在本文中，以下是我们模型开发的步骤。数据准备、清理和操作<br/> 2。探索性数据分析<br/> 3。特征工程、模型开发和评估<br/> 4。生成预测结果</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="c811" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">1.数据准备、清理和操作</h1><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ld"><img src="../Images/7a08af2bf6647200bf75ebaf7c27e711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODiHBzC7Uic3V2zS707Xag.png"/></div></div></figure><p id="611c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以上是加载文件并检查数据集中是否有空值。</p><p id="3af4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">加载数据集后，我们根据每个唯一的id合并数据，并删除重复的数据。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="efd4" class="ln jw hh lj b fi lo lp l lq lr">#Creating final df for training model and submission</span><span id="2850" class="ln jw hh lj b fi ls lp l lq lr">train_final = sales_train.merge(items, on = 'item_id', how = 'left').merge(item_categories, on = 'item_category_id', how = 'left').merge(shops, on = 'shop_id', how = 'left')<br/>test_final = test.merge(items, on = 'item_id', how = 'left').merge(item_categories, on = 'item_category_id', how = 'left').merge(shops, on = 'shop_id', how = 'left')<br/></span><span id="b2e6" class="ln jw hh lj b fi ls lp l lq lr">#Check duplicates in dataset and remove if any<br/>print('Total Rows Before Removing Duplicate : ', train_final.shape[0])</span><span id="421f" class="ln jw hh lj b fi ls lp l lq lr">print('Total Duplicate Rows : ',train_final.duplicated().sum())</span><span id="d08b" class="ln jw hh lj b fi ls lp l lq lr">train_final = train_final[~train_final.duplicated()]<br/>print('Total Rows After Removing Duplicate : ',train_final.shape[0])</span></pre><p id="d801" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以下是上述代码的打印结果:</p><ul class=""><li id="7413" class="lt lu hh ir b is it iw ix ja lv je lw ji lx jm ly lz ma mb bi translated">删除重复项之前的总行数:2935849</li><li id="d73c" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">重复行总数:6</li><li id="c267" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">删除重复项后的总行数:2935843</li></ul><p id="5d83" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们的合并数据集中只有6个重复的行，保留这些数据实际上是没问题的，因为它对我们的模型训练没有太大影响。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="c446" class="ln jw hh lj b fi lo lp l lq lr">#Changing date format and add additional columns</span><span id="d740" class="ln jw hh lj b fi ls lp l lq lr">train_final['date'] = pd.to_datetime(train_final['date']).dt.date</span><span id="d283" class="ln jw hh lj b fi ls lp l lq lr">train_final['sales'] = train_final['item_price']*train_final['item_cnt_day']<br/>train_final['year'] = pd.DatetimeIndex(train_final['date']).year<br/>train_final['month'] = pd.DatetimeIndex(train_final['date']).month</span></pre><p id="a829" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因为我们希望根据年和月来训练我们的模型，所以我们创建了“年”和“月”列，以便稍后进行分组。</p><p id="b38e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，为了减少数据集中的任何噪声，我们将从数据中移除异常值。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="def6" class="ln jw hh lj b fi lo lp l lq lr">#Printing Values for each percentile</span><span id="5afe" class="ln jw hh lj b fi ls lp l lq lr">for a in range(0,101,10) :<br/>    print(f'{a}th percentile value for item_cnt_day is {np.percentile(train_final["item_cnt_day"],a)}')</span><span id="642a" class="ln jw hh lj b fi ls lp l lq lr">for a in range(0,101,10) :<br/>    print(f'{a}th percentile value for item_price is {np.percentile(final["item_price"],a)}')</span></pre><p id="7dce" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上述每个循环的结果:</p><ol class=""><li id="aacb" class="lt lu hh ir b is it iw ix ja lv je lw ji lx jm mh lz ma mb bi translated">项目天数:</li></ol><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="b77d" class="ln jw hh lj b fi lo lp l lq lr">0th percentile value for item_cnt_day is -22.0<br/>10th percentile value for item_cnt_day is 1.0<br/>20th percentile value for item_cnt_day is 1.0<br/>30th percentile value for item_cnt_day is 1.0<br/>40th percentile value for item_cnt_day is 1.0<br/>50th percentile value for item_cnt_day is 1.0<br/>60th percentile value for item_cnt_day is 1.0<br/>70th percentile value for item_cnt_day is 1.0<br/>80th percentile value for item_cnt_day is 1.0<br/>90th percentile value for item_cnt_day is 2.0<br/>100th percentile value for item_cnt_day is 2169.0</span></pre><p id="0950" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.项目_价格:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="f070" class="ln jw hh lj b fi lo lp l lq lr">0th percentile value for item_price is -1.0<br/>10th percentile value for item_price is 149.0<br/>20th percentile value for item_price is 199.0<br/>30th percentile value for item_price is 299.0<br/>40th percentile value for item_price is 349.0<br/>50th percentile value for item_price is 399.0<br/>60th percentile value for item_price is 573.96<br/>70th percentile value for item_price is 799.0<br/>80th percentile value for item_price is 1190.0<br/>90th percentile value for item_price is 1999.0<br/>100th percentile value for item_price is 307980.0</span></pre><p id="5c52" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据上面的结果，应该根据item_cnt_day筛选低于90%和高于0%的数据。然后，我们将使用item_price列进行筛选(&gt; 0%值且≤90%值)。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="e6d3" class="ln jw hh lj b fi lo lp l lq lr">#Removing Outliers</span><span id="7273" class="ln jw hh lj b fi ls lp l lq lr">final = train_final[(train_final[‘item_cnt_day’]&gt;0)&amp;(train_final[‘item_cnt_day’] &lt; train_final[‘item_cnt_day’].quantile(0.96))]</span><span id="28e8" class="ln jw hh lj b fi ls lp l lq lr">final = final[(final['item_price'] &gt; 0)&amp;(final['item_price']&lt;final['item_price'].quantile(0.92))]</span></pre><p id="73c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在移除重复值、异常值和检查空值之后，数据应该可以进行探索和训练了。</p><h1 id="4d24" class="jv jw hh bd jx jy ky ka kb kc kz ke kf kg la ki kj kk lb km kn ko lc kq kr ks bi translated">2.探索性数据分析</h1><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/bbcc1047cdc5aed4255f4600486b8f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vtsBQwZoOYg5eBlJXlL8QQ.png"/></div></div></figure><p id="3ea2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从日常角度来看，销售额连续3年呈横向增长，在2013年底和2014年出现大幅增长。由于我们已经删除了上一步中的异常值，数据显示出了更好的一致性(噪音和波动性更小)。</p><div class="le lf lg lh fd ab cb"><figure class="mj ii mk ml mm mn mo paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/d24af469562abe734e7d73c9a0a6fdf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*CmeikfjrCWsu8tp9aU8tJg.png"/></div></figure><figure class="mj ii mp ml mm mn mo paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/6c5f6d701b600dcc655c6b0a9d4b4498.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*ZL28g4xpjvYYMxttClM4MQ.png"/></div></figure><figure class="mj ii mq ml mm mn mo paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/6255b6e3f495744760e4e63a8a4785fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*w8kU3ePsjsNWiuJRuTYGKA.png"/></div><figcaption class="mr ms et er es mt mu bd b be z dx mv di mw mx">Distribution Plot</figcaption></figure></div><p id="c963" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">分布图表示Item_Price和Sales的右偏度(其中大多数值低于500)。而另一方面，如图所示，Item_Cnt_Day列的值为1。</p><p id="d891" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们列出数据集中排名前10的商店和商品。</p><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/d5275752ded1e5480973352d4ceffa4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkqUDFKzvcVPsJGsYzZqbQ.png"/></div></div></figure><p id="3322" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据数据中排名前10位的商店和商品，可以得出这样的结论:即使是表现最好的商店，在商品总销售额方面也普遍表现不佳。前1名和前10名之间的总销售额差距很大，大约有60%的差距。</p><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/63af9c39805502f2e65571a7227470e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bui8sKEqhEYC8wTJGermHA.png"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">Correlation Heat Map</figcaption></figure><p id="76ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">显然，上述特征与每天售出的商品总量没有直接关系。因此，可能存在与此高度相关的其他因素，但由于提供的数据有限，因此实际上最好找到其他数据源，以发现这些商店和项目中销售的项目的原因。</p><h1 id="15eb" class="jv jw hh bd jx jy ky ka kb kc kz ke kf kg la ki kj kk lb km kn ko lc kq kr ks bi translated">3.特征工程、模型开发和评估</h1><p id="2660" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">因为我们上面的数据集显示了特征和目标变量之间的低(负)相关性。我们将使用随机森林回归来训练我们的模型。</p><p id="bbea" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以下是我决定使用随机森林的原因:</p><ul class=""><li id="d2af" class="lt lu hh ir b is it iw ix ja lv je lw ji lx jm ly lz ma mb bi translated">有利于避免过度拟合</li><li id="4fde" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">非常适合实验(灵活的参数调整)</li><li id="541e" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">处理好线性和非线性的关系</li><li id="bd45" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">受离群值影响较小(或不受离群值影响)</li></ul><p id="8cf9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是使用这种算法也有几个缺点:</p><ul class=""><li id="f21e" class="lt lu hh ir b is it iw ix ja lv je lw ji lx jm ly lz ma mb bi translated">计算成本高(尤其是数据集很大时)</li><li id="8b2e" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">很难解释这个模型</li><li id="15e1" class="lt lu hh ir b is mc iw md ja me je mf ji mg jm ly lz ma mb bi translated">很少控制模型在幕后做什么(这就是为什么它首先被称为随机的)</li></ul><p id="f744" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，在训练模型之前，让我们先将数据集分为要素和标注。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="afd0" class="ln jw hh lj b fi lo lp l lq lr">#Selecting shop_id and item_id that exist in test dataset</span><span id="7e63" class="ln jw hh lj b fi ls lp l lq lr">test_shop_ids = test['shop_id'].unique()<br/>test_item_ids = test['item_id'].unique()</span><span id="3b30" class="ln jw hh lj b fi ls lp l lq lr">monthly_item_cnt = monthly_item_cnt[monthly_item_cnt['shop_id'].isin(test_shop_ids)]<br/>monthly_item_cnt = monthly_item_cnt[monthly_item_cnt['item_id'].isin(test_item_ids)]</span><span id="5333" class="ln jw hh lj b fi ls lp l lq lr">#Import Model and Metrics</span><span id="f49c" class="ln jw hh lj b fi ls lp l lq lr">from sklearn.ensemble import RandomForestRegressor<br/>from sklearn.model_selection import train_test_split, GridSearchCV, RandomizedSearchCV<br/>from sklearn.metrics import mean_squared_error, r2_score<br/>from numpy import mean, std<br/>from pprint import pprint</span><span id="5508" class="ln jw hh lj b fi ls lp l lq lr">X,y = monthly_item_cnt[['year','month','shop_id','item_id']], monthly_item_cnt['item_cnt_day']<br/>X_train, X_test, y_train, y_test = train_test_split(X,y, test_size = 0.25, random_state = 42)</span><span id="240c" class="ln jw hh lj b fi ls lp l lq lr">random_rf = RandomForestRegressor(random_state = 42)<br/>pprint(random_rf.get_params())</span></pre><figure class="le lf lg lh fd ii er es paragraph-image"><div class="er es na"><img src="../Images/6c32f6622229d347b672e1303b013594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*LXuVoZ_lOzv24COTlxn66A.png"/></div><figcaption class="mr ms et er es mt mu bd b be z dx">Random Forest Parameters</figcaption></figure><p id="7917" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，我们可以开始调整模型的参数。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="d3c6" class="ln jw hh lj b fi lo lp l lq lr">bootstrap = [True, False]<br/>n_estimators = [int(x) for x in np.linspace(start=200,stop=2000, num = 10)]<br/>max_depth = [int(x) for x in np.linspace(start=10, stop = 110, num = 11)]<br/>max_depth.append(None)<br/>max_features = ['auto','sqrt']<br/>min_samples_split = [2,5,10]<br/>min_samples_leaf = [1,2,4]</span><span id="3560" class="ln jw hh lj b fi ls lp l lq lr">random_grid = {<br/>    'bootstrap' : bootstrap,<br/>    'n_estimators' : n_estimators,<br/>    'max_depth' : max_depth,<br/>    'max_features' : max_features,<br/>    'min_samples_split' : min_samples_split,<br/>    'min_samples_leaf' : min_samples_leaf<br/>}</span><span id="e46a" class="ln jw hh lj b fi ls lp l lq lr">pprint(random_grid)</span></pre><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nb"><img src="../Images/3c78f1bef6e955d761fc34017e6b6a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YaJh00tncGrfhJ3jIIX8dA.png"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">Parameters for Training</figcaption></figure><p id="fb5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">既然一切都已经设置好了，现在我们准备训练我们的模型。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="bb88" class="ln jw hh lj b fi lo lp l lq lr">rf_random = RandomizedSearchCV(estimator = random_rf, param_distributions = random_grid,<br/>                               cv = 3, n_jobs = -1, random_state = 42, n_iter = 3, scoring='neg_mean_absolute_error',<br/>                               verbose = 2, return_train_score = True)</span><span id="dbce" class="ln jw hh lj b fi ls lp l lq lr">rf_random.fit(X_train,y_train)</span></pre><p id="5b7d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如你们从上面可以看到的，n_iter设置为3，CV设置为3，这意味着模型将使用上面参数的随机组合训练(或拟合)9次。</p><p id="d61e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得最好的结果，应该进行更多的训练，但是由于当我设置n_iter大于10时，我的笔记本电脑在完成之前就关机了，所以我不得不将其缩小到3(即使这样也几乎失败)。</p><p id="d621" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">训练完成后，我们可以使用我们拆分的测试数据集来评估模型。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="311d" class="ln jw hh lj b fi lo lp l lq lr">def evaluate(model, X_test, y_test) :<br/>    prediction = model.predict(X_test)<br/>    error = abs(prediction - y_test)<br/>    mape = 100 * np.mean(error/y_test)<br/>    accuracy = 100 - mape<br/>    print('Model Performance')<br/>    print('Average Error: {:0.4f} degrees.'.format(np.mean(error)))<br/>    print('Accuracy = {:0.2f}%.'.format(accuracy))<br/>    <br/>    return accuracy</span><span id="514d" class="ln jw hh lj b fi ls lp l lq lr">random_model = rf_random.best_estimator_<br/>evaluate(random_model, X_test, y_test)</span></pre><figure class="le lf lg lh fd ii er es paragraph-image"><div class="er es nc"><img src="../Images/85e040e73b0ee1881bb8a5d2a33167c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*oRviZ7EEjz490e8eHsu-9w.png"/></div></figure><p id="596c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该模型显示了60%的准确性，老实说，这实际上不是很大，但由于我不得不等待1个多小时来训练这个模型，我决定在这一点上停止。</p><p id="ef2e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是对于那些可能拥有超过32GB内存的人，我鼓励你们通过调整参数和在模型上设置更多迭代来对模型进行实验。因为，使用随机森林的好处是，我们可以通过设置正确的参数来提高其准确性(这只能通过更多的试错来实现)。</p><h1 id="ece0" class="jv jw hh bd jx jy ky ka kb kc kz ke kf kg la ki kj kk lb km kn ko lc kq kr ks bi translated">4.生成预测结果</h1><p id="4a1b" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在最后一部分，我们将使用上面的测试数据，通过上面的训练模型来预测结果。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="59c5" class="ln jw hh lj b fi lo lp l lq lr">#Generate item_cnt_month result using above model</span><span id="b7a1" class="ln jw hh lj b fi ls lp l lq lr">test_df = test.copy()<br/>test_df['year'] = '2015'<br/>test_df['month'] = '11'</span><span id="40a1" class="ln jw hh lj b fi ls lp l lq lr">result_rf = random_model.predict(test_df[['year','month','shop_id','item_id']])<br/>result_rf_df = pd.DataFrame(result_rf)</span><span id="b356" class="ln jw hh lj b fi ls lp l lq lr">final_result = pd.merge(test_df, result_rf_df, left_index=True, right_index=True)<br/>final_result = final_result.rename(columns={0:'item_cnt_month'})<br/>final_result = final_result[['ID','item_cnt_month']]<br/>final_result.shape</span></pre><figure class="le lf lg lh fd ii er es paragraph-image"><div class="er es nd"><img src="../Images/0731acd64d45bce9450b5c46a87c96ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*I8SQnFrBU6HX0TnRlBG_UA.png"/></div></figure><p id="b4af" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是它的结尾，如果您在submission选项卡上浏览Kaggle网站，您会看到预期的提交应该是214200行，有两列(ID和item_cnt_month)。</p><p id="8bd7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我希望这篇文章对使用Random Forest开发预测模型有所帮助。</p><p id="dd16" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">感谢您阅读此内容，请在下面给我留言，或者您可以通过我的社交媒体资料(或电子邮件)联系我！</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="e6b2" class="ln jw hh bd jx ne nf ng kb nh ni nj kf ja nk nl kj je nm nn kn ji no np kr nq bi translated">参考</h2><div class="nr ns ez fb nt nu"><a href="https://github.com/WillKoehrsen/Machine-Learning-Projects/blob/master/random_forest_explained/Improving%20Random%20Forest%20Part%202.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab dw"><div class="nw ab nx cl cj ny"><h2 class="bd hi fi z dy nz ea eb oa ed ef hg bi translated">机器学习项目/改进随机森林第2部分。</h2><div class="ob l"><h3 class="bd b fi z dy nz ea eb oa ed ef dx translated">机器学习实验和工作。有助于WillKoehrsen/机器学习项目的发展，通过创造一个…</h3></div><div class="oc l"><p class="bd b fp z dy nz ea eb oa ed ef dx translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi in nu"/></div></div></a></div><div class="nr ns ez fb nt nu"><a href="https://www.kaggle.com/c/competitive-data-science-predict-future-sales/data" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab dw"><div class="nw ab nx cl cj ny"><h2 class="bd hi fi z dy nz ea eb oa ed ef hg bi translated">预测未来销售</h2><div class="ob l"><h3 class="bd b fi z dy nz ea eb oa ed ef dx translated">Coursera课程“如何赢得数据科学竞赛”的期末项目</h3></div><div class="oc l"><p class="bd b fp z dy nz ea eb oa ed ef dx translated">www.kaggle.com</p></div></div><div class="od l"><div class="oj l of og oh od oi in nu"/></div></div></a></div><div class="nr ns ez fb nt nu"><a href="https://medium.datadriveninvestor.com/random-forest-pros-and-cons-c1c42fb64f04" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab dw"><div class="nw ab nx cl cj ny"><h2 class="bd hi fi z dy nz ea eb oa ed ef hg bi translated">随机森林:利弊</h2><div class="ob l"><h3 class="bd b fi z dy nz ea eb oa ed ef dx translated">随机森林是一种监督学习算法。它用决策树的集合构建了一个森林。这是一个简单的…</h3></div><div class="oc l"><p class="bd b fp z dy nz ea eb oa ed ef dx translated">medium.datadriveninvestor.com</p></div></div><div class="od l"><div class="ok l of og oh od oi in nu"/></div></div></a></div><div class="nr ns ez fb nt nu"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nv ab dw"><div class="nw ab nx cl cj ny"><h2 class="bd hi fi z dy nz ea eb oa ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ob l"><h3 class="bd b fi z dy nz ea eb oa ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="oc l"><p class="bd b fp z dy nz ea eb oa ed ef dx translated">medium.com</p></div></div><div class="od l"><div class="ol l of og oh od oi in nu"/></div></div></a></div></div></div>    
</body>
</html>