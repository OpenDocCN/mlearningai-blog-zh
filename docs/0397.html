<html>
<head>
<title>Streamline your Data Science Experience with Jupyter Hub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Jupyter Hub简化您的数据科学体验</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/streamline-your-data-science-experience-with-jupyter-hub-3af05d37d26d?source=collection_archive---------2-----------------------#2021-04-04">https://medium.com/mlearning-ai/streamline-your-data-science-experience-with-jupyter-hub-3af05d37d26d?source=collection_archive---------2-----------------------#2021-04-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="60ad" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Jupyter Hub、ipykernel和systemd改善您的工作流程</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/e336a20b73001e12c8148f5d71953726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uH0CuGJYKe9GF3bjtMfstg.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@esteejanssens?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Estée Janssens</a> on <a class="ae jm" href="https://unsplash.com/s/photos/notebook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="048d" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">范围</h1><p id="5bad" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">作为<em class="lb"> Jupyter笔记本</em>和/或<em class="lb">实验室</em>的狂热用户，本指南展示了如何自动启动<em class="lb"> Jupyter </em>服务器，允许您使用web界面选择所需的<em class="lb"> Python </em>环境，然后开始编码。</p><p id="2ad4" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">如果像我一样，你的典型工作流程是启动一个终端，在运行<code class="du lh li lj lk b">jupyter notebook</code>或<code class="du lh li lj lk b">jupyterlab</code>之前激活你想要的<em class="lb"> Python </em>虚拟环境，那么这个指南应该提供一个更容易和更完整的体验。它是通过将<code class="du lh li lj lk b">jupyterhub</code>安装到专用的虚拟环境中，设置对多个<em class="lb"> iPython </em>内核的访问，并使用一个<code class="du lh li lj lk b">systemd</code>启动脚本(用于相关的<em class="lb"> Linux </em>发行版)在系统启动时启动<code class="du lh li lj lk b">jupyterhub</code>来实现的。</p><p id="1af2" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">不建议服务器使用此设置(根据并行用户的数量，服务器已经有了专用指南)；此外，该指南适用于<em class="lb">Linux</em>；<em class="lb"> Mac </em>和<em class="lb"> Windows </em>用户可以遵循类似的方法，除了自动启动<em class="lb"> Jupyter Hub </em>。</p></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/78fcceeaf63440911a0c7cfe293f8811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwXiVhZaIq1tdjG8AbEfYQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Image by the Author | See below for full Attribution details</figcaption></figure><h1 id="328f" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">介绍</h1><p id="6c86" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">像许多数据科学家一样，我利用最佳实践来创建专用的、可控的和已知的Python环境，使用像T5这样的工具。同样，我也热衷于使用<em class="lb"> Jupyter </em>生态系统，尤其是<em class="lb"> Jupyter笔记本</em>以及有时<em class="lb"> Jupyter实验室</em>。下图中的顶部分支代表了我的典型工作流程:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/57d7f3b94ab2767e90baf93442492b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kY7cVu5BW1bPpgSFWUPdVQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Jupyter Workflow | by the Author</figcaption></figure><p id="d533" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">底部分支是我最近采用的新工作方式，虽然表面上看起来像是节省了一个步骤，但实际上对于经常与Jupyter打交道的人来说，这种体验的改善更为显著。最终结果是一个环境，其中<em class="lb"> Jupyter Hub </em>总是在后台运行，因此<em class="lb"> Jupyter笔记本</em>和<em class="lb">实验室</em>都是按需可用的。此外，我没有明确地激活一个特定的<code class="du lh li lj lk b">conda</code>环境，因为它可以直接从web界面选择和更改。</p><p id="f17b" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">我很欣赏在没有真正使用<em class="lb"> Jupyter Hub </em>本身的情况下<em class="lb">可以实现这一点，但是我发现当所有元素组合在一起时会容易得多。</em></p><p id="6d7d" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">最后，许多用户要么在云中运行<em class="lb"> Jupyter </em>，要么在一个服务器(本地或远程)上运行，那里有专门的指南。关键的区别是获得传输层安全性(TLS)证书来可验证地加密客户端和服务器之间的通信:</p><div class="lu lv ez fb lw lx"><a href="https://tljh.jupyter.org/en/latest/" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">最小的JupyterHub -最小的JupyterHub v0.1文档</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">针对单台服务器上少量(0-100)用户的简单JupyterHub发行版。我们建议在什么时候阅读…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">tljh.jupyter.org</p></div></div></div></a></div></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="d230" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">Jupyter中心设置</h1><h2 id="f44c" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">Conda设置</h2><p id="d236" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">本指南假设您有一个使用<code class="du lh li lj lk b">mamba</code>的<em class="lb"> Miniconda </em>或<em class="lb"> Miniforge </em>的工作环境，这是我的建议:</p><div class="lu lv ez fb lw lx"><a href="https://github.com/conda-forge/miniforge" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">康达锻造厂/小型锻造厂</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">这个库包含了一个针对conda-forge的Conda最小安装程序。它与Miniconda相当，但与…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne jg lx"/></div></div></a></div><div class="lu lv ez fb lw lx"><a href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">Miniconda - Conda文档</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">Miniconda是conda的免费最小安装程序。它是Anaconda的一个小型引导版本，只包含conda…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">docs.conda.io</p></div></div></div></a></div><p id="a8c0" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">企业/商业用户请注意<em class="lb"> Anaconda </em>关于从2020年8月起<code class="du lh li lj lk b">conda</code>使用<code class="du lh li lj lk b">main</code>频道的许可变更，这可能会限制您可以访问的<em class="lb">频道</em>。</p><h2 id="12cc" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">创造环境</h2><p id="8989" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">对于普通读者来说，下面的设置应该是熟悉的，但通常是不言自明的。因此，在您的首选终端中键入以下内容:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Conda environment for Jupyter Hub | by the Author</figcaption></figure><p id="5e8f" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">鉴于即将推出的<em class="lb"> Python 3.10 </em>，我已经将我使用的<em class="lb"> Python </em>版本撞上了最新的3.8版本(在撰写本文时为3.8.8)以及包括<code class="du lh li lj lk b">autopep8</code>在内的流行的<code class="du lh li lj lk b">jupyter_contrib_extensions</code>包。</p><p id="b315" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">在此阶段启动<code class="du lh li lj lk b">jupyterhub</code>应显示以下内容:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nh"><img src="../Images/3c2892f8ea056f2b6728e38817b761b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiphMrcIbTLlQo0r8j8aWw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of the<em class="ni"> Jupyter Hub</em> Login Page | by the Author</figcaption></figure><p id="fdb3" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">可以通过<a class="ae jm" href="http://127.0.0.1:8000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000 </a>访问该页面(假设8000端口是空闲的)，然后使用您的系统登录详细信息，即使用您用于登录您的<em class="lb"> Linux </em>发行版的相同用户名和密码。</p><p id="d7b9" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">默认情况下，<em class="lb"> Jupyter Hub </em>会重定向到<em class="lb"> Jupyter Notebook </em>服务器(<a class="ae jm" href="http://127.0.0.1:8000/user/strike/tree" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/user/&lt;username&gt;/tree</a>)，但是实验室也可以通过:<a class="ae jm" href="http://127.0.0.1:8000/user/&lt;username&gt;/lab" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/user/&lt;username&gt;/Lab</a>访问:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nj"><img src="../Images/403845f1ed8db57e8ee0c77e54fedc2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8N495Q5KpmdwgkP8Md6E2A.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Jupyter Notebook Server with New Notebook Menu | by the Author</figcaption></figure><p id="d316" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">当创建一个新的笔记本时，我们有一个无用的“<em class="lb"> Python 3 </em>”显示条目，这里不清楚它指的是哪个<code class="du lh li lj lk b">conda</code>环境。显示与<em class="lb"> Jupyter Lab </em>相似:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nh"><img src="../Images/1b97b666a9c311685bc2cbad11254109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ftuglWzy7pNu0K9PN9SGLg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Jupyter Lab with New Notebook Menu | by the Author</figcaption></figure><p id="a869" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">如果您不清楚，那么“Python 3”实际上是指本指南中创建的<code class="du lh li lj lk b">jupyter</code>环境。下一步是更新显示名称，并使其他的<code class="du lh li lj lk b">conda</code>环境可以从同一个<em class="lb"> Jupyter </em>实例中访问。</p></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="e086" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">Jupyter Python内核</h1><p id="249c" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">当你安装<em class="lb"> Jupyter </em>时，默认情况下它会安装<code class="du lh li lj lk b">ipython</code>内核，但是被限制在当前的<code class="du lh li lj lk b">conda</code>环境中(很明显)。以下命令显示系统上当前可访问的内核和所有环境:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">List of Accessible Kernels | by the Author</figcaption></figure><p id="588c" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">上面的代码片段显示，与系统上总共五个<code class="du lh li lj lk b">conda</code>环境相比，该环境中只有一个内核可用。</p><h2 id="bce5" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">重命名现有内核</h2><p id="9736" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">第一步是将现有的内核重命名为更容易识别的名称。每个内核的属性和元数据都包含在一个名为<code class="du lh li lj lk b">kernel.json</code>的专用文件中。上面代码片段中的第5行显示了包含以下内容的文件的路径:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Kernel JSON file | by the Author</figcaption></figure><p id="7fb6" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">第9行包含<code class="du lh li lj lk b">display-name</code>，它应该在文本编辑器中或通过命令行更改为“Jupyter (py3.8)”，如下所示:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Updated Kernel JSON file | by the Author</figcaption></figure><p id="9347" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">刷新<em class="lb"> Jupyter笔记本</em>或<em class="lb">实验室</em>将显示更新的描述:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nk"><img src="../Images/afd5ae72d4ac3d32b379ea5d01b1f143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CC_xOSI31z7b9w1Em7OSvg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Jupyter Lab with updated description | by the Author</figcaption></figure><p id="68ae" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">截图显示了现有内核的更新版本<code class="du lh li lj lk b">display-name</code>，现在更加清晰地显示了环境(<code class="du lh li lj lk b">Jupyter</code>)和版本<em class="lb"> Python </em> ( <code class="du lh li lj lk b">py3.8</code>)。</p><h2 id="f9fa" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">附加内核</h2><p id="c2da" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">我们想使用<code class="du lh li lj lk b">jupyter</code> <code class="du lh li lj lk b">conda</code>环境(及其<em class="lb"> Jupyter Hub </em>安装)直接从web界面访问其他<code class="du lh li lj lk b">conda</code>环境。这在i <a class="ae jm" href="https://ipython.readthedocs.io/en/stable/install/kernel_install.html#kernels-for-different-environments" rel="noopener ugc nofollow" target="_blank"> python文档</a>中有详细描述，用于访问多个内核，演示如下:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Adding ds01 to shard kernel list | by the Author</figcaption></figure><p id="9676" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">上面的例子显示了<code class="du lh li lj lk b">ds01</code> <code class="du lh li lj lk b">conda</code>环境的激活和<code class="du lh li lj lk b">ipython</code>内核在环境(<code class="du lh li lj lk b">— name</code>)<code class="du lh li lj lk b">ds01</code><code class="du lh li lj lk b">display-name</code>“ds01(py 3.7)”的用户空间中的安装。这也反映在<em class="lb"> Jupyter笔记本</em> / <em class="lb">实验室</em>中:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nl"><img src="../Images/9f427267132e2181455d02001456f0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vqgwd6auOpdzfGEf5J53Jw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Jupyter Lab with ds01 environment added | by the Author</figcaption></figure><p id="ef2b" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">应该注意的是，共享内核不仅仅是创建一个新的笔记本。基于一个内核的现有笔记本可以在加载后切换到使用不同的内核，这意味着单个项目可以从单个界面使用多个环境。例如，你可以有一个专用于可视化的环境，另一个用于深度学习，另一个用于文档等。</p><p id="b44a" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">还应该注意的是，对于如何显示环境，目前没有定制的排序选项。默认是按字母顺序排列的，所以如果你喜欢，你可以使用数字前缀来改变环境的顺序，比如<code class="du lh li lj lk b">1_</code>、<code class="du lh li lj lk b">2_ </code>或者<code class="du lh li lj lk b">A_</code>、<code class="du lh li lj lk b">B_</code>等等。</p><p id="980a" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">设置好所需的易用环境<code class="du lh li lj lk b">jupyter</code>后，下一步是自动启动<em class="lb"> Jupyter Hub </em>。</p></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="75b7" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">带Systemd的自动装载Jupyter Hub</h1><p id="c24f" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">这一步仅限于使用<code class="du lh li lj lk b">systemd</code>的<em class="lb"> Linux </em>发行版，并基于这个伟大的<em class="lb"> Stackoverflow </em>答案加上<code class="du lh li lj lk b">Environment</code>变量:</p><div class="lu lv ez fb lw lx"><a href="https://stackoverflow.com/questions/53928299/how-to-convert-a-python-script-in-a-local-conda-env-into-systemd-service-in-linu" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">如何将本地conda env中的一个python脚本转换成Linux中的systemd服务？</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">stackoverflow.com</p></div></div><div class="mz l"><div class="nm l nb nc nd mz ne jg lx"/></div></div></a></div><p id="4aee" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">作为一点背景知识，在用<code class="du lh li lj lk b">systemd</code>启动系统时，需要克服多个障碍。首先，由于<code class="du lh li lj lk b">conda</code>本身的原因，有一个抽象层<code class="du lh li lj lk b">systemd</code>跟随着另一个抽象层。经过反复试验，这些步骤允许(至少对于<em class="lb"> Ubuntu 20.04 </em>)正确的<code class="du lh li lj lk b">conda</code>环境用于<code class="du lh li lj lk b">jupyterhub</code>自动加载。所需的<code class="du lh li lj lk b">systemd</code>维修文件是:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Systemd Service file for Jupyter Hub | by the Author</figcaption></figure><p id="4af0" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">标签<code class="du lh li lj lk b">&lt;username&gt;</code>应该替换为您的用户名。本质上，系统启动时加载<em class="lb"> Jupyter Hub </em>有两个部分:</p><ol class=""><li id="b246" class="nn no hh kh b ki lc kl ld ko np ks nq kw nr la ns nt nu nv bi translated">使用正确的命令构建正确的服务文件</li><li id="2f3d" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ns nt nu nv bi translated">以<code class="du lh li lj lk b">user</code>而不是<code class="du lh li lj lk b">root</code>的身份运行服务</li></ol><h2 id="8389" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">构建服务文件</h2><p id="7cef" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">构建服务文件的两个困难部分是设置正确的<code class="du lh li lj lk b">PATH</code>变量和设置正确的环境变量。</p><p id="fa03" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated"><code class="du lh li lj lk b">ExecStart</code>需要的命令是:</p><pre class="ix iy iz ja fd ob lk oc od aw oe bi"><span id="a9e2" class="ml jo hh lk b fi of og l oh oi">/bin/bash -c 'PATH=/home/&lt;username&gt;/miniconda3/envs/jupyter/bin:$PATH exec jupyterhub'</span></pre><p id="8001" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">它包含shell的绝对路径(<code class="du lh li lj lk b">/bin/bash</code>)和一个命令，该命令更新<code class="du lh li lj lk b">PATH</code>变量以反映<code class="du lh li lj lk b">conda</code>及其二进制文件的位置，然后运行<code class="du lh li lj lk b">jupyterhub</code>命令。</p><p id="42f5" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">第二部分是传递正确的环境变量；这些可以通过运行<code class="du lh li lj lk b">env</code>命令获得:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">List of Conda related Variables | by the Author</figcaption></figure><p id="5fd7" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">对于<code class="du lh li lj lk b">systemd</code>，列表需要转换成空格分隔的单行列表，而不是换行符分隔的列表。然后这些被复制到<code class="du lh li lj lk b">Environment=</code>参数的服务文件中。</p><h2 id="5d1c" class="ml jo hh bd jp mm mn mo jt mp mq mr jx ko ms mt jz ks mu mv kb kw mw mx kd my bi translated">启用和启动Systemd服务</h2><p id="9b3c" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">有了<code class="du lh li lj lk b">systemd</code>，通过将服务文件作为<code class="du lh li lj lk b">jupyterhub.service</code>放在<code class="du lh li lj lk b">~/.config/systemd/user/</code>中，可以在没有<code class="du lh li lj lk b">root</code>权限的情况下运行。以下命令重新加载服务文件列表，检查其状态并启动测试过程:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="nf ng l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Systemd Service Check | by the Author</figcaption></figure><p id="f9f5" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">第一个命令确保<code class="du lh li lj lk b">systemd</code>从用户目录加载服务文件。status命令确认没有格式或参数错误(这些错误以红色作为附加消息列出)。为了测试服务文件，<code class="du lh li lj lk b">start</code>命令允许用户启动服务，可以通过访问<a class="ae jm" href="http://127.0.0.1:8000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000 </a>或<a class="ae jm" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>进行检查。再次运行<code class="du lh li lj lk b">status</code>命令显示运行<code class="du lh li lj lk b">jupyterhub</code>的输出。</p><p id="e74b" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">这些步骤确认服务文件按预期工作。为了确保服务在系统启动时即笔记本电脑启动时启动，必须显式启用该服务。最后的测试当然是重启机器，并在登录后检查<em class="lb"> Jupyter Hub </em>是否确实在运行。</p></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="79f8" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">配置Jupyter笔记本扩展</h1><p id="8a10" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">在Jupyter笔记本的基础上，我推荐几个poplar扩展。我不会详尽地介绍这一点，因为有许多可用的指南。要访问扩展页面，只需点击<code class="du lh li lj lk b">NBextensions</code>选项卡:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es oj"><img src="../Images/dbec8720f905f0be993fa0ccabde1263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VoAHnzlKRS0g3iaDk1Q6cQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Nbextensions tab | by the Author</figcaption></figure><p id="f17e" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">我推荐以下扩展(你可以通过点击来阅读每个扩展):</p><ul class=""><li id="7be7" class="nn no hh kh b ki lc kl ld ko np ks nq kw nr la ok nt nu nv bi translated">帮助面板-是的，你可以按下Shift键，但这是一个很好的备份</li><li id="ec9f" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">实时降价预览—在您键入时查看降价渲染</li><li id="7308" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">ExecuteTime —最有用的特性是知道命令的运行时间</li><li id="3c63" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">暂存器—例如，按CTRL+B获得运行局部变量的临时环境</li><li id="9110" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">跳过追溯—使错误消息更易于管理</li><li id="0fd6" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">Autopep8 —轻松格式化代码单元格；我主要用它来清理用锤子按钮手工输入的列表</li><li id="16b0" class="nn no hh kh b ki nw kl nx ko ny ks nz kw oa la ok nt nu nv bi translated">目录—可以显示笔记本中所有标题的侧菜单</li></ul><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nj"><img src="../Images/f79b0927bc069c764c04c2a86bd7d50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_dOrLsOye5zsP80SzC8Kw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Screenshot of Configured Notebook Extensions | by the Author</figcaption></figure></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="cf9c" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">摘要</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ol"><img src="../Images/1575d82376e7bf4fe7fe146632423a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SmnTl_oCto7vzbYRjgBCg.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Jupiter and one of its moons — Io | Image by <a class="ae jm" href="https://pixabay.com/photos/io-jupiter-planet-astronomy-2773533/" rel="noopener ugc nofollow" target="_blank">flflflfl</a> from Pixalbay</figcaption></figure><p id="5468" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">本指南介绍了三个组件，以实现更好的<em class="lb"> Jupyter笔记本</em>或<em class="lb">实验室</em>体验。第一步是将<em class="lb"> Jupyter Hub </em>安装到专用的<code class="du lh li lj lk b">conda</code>环境中。第二步是重命名现有的<code class="du lh li lj lk b">kernel</code>，使其更加明显，并与适当的<code class="du lh li lj lk b">display-name</code>共享来自不同<code class="du lh li lj lk b">conda</code>环境的其他内核。最后一步是激活新的<code class="du lh li lj lk b">conda</code>环境，并使用<code class="du lh li lj lk b">systemd</code>自动运行<code class="du lh li lj lk b">jupyterhub</code>。作为奖励，一些基本的扩展也被推荐给了Jupyter笔记本。</p><p id="c62b" class="pw-post-body-paragraph kf kg hh kh b ki lc ii kk kl ld il kn ko le kq kr ks lf ku kv kw lg ky kz la ha bi translated">最终结果是一个易于使用的基于web的环境，允许在<code class="du lh li lj lk b">conda</code>环境之间轻松切换。</p></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><h1 id="6bad" class="jn jo hh bd jp jq mg js jt ju mh jw jx in mi io jz iq mj ir kb it mk iu kd ke bi translated">属性</h1><p id="e28e" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">所有<code class="du lh li lj lk b">gists</code>，笔记本，终端演员表均为作者。所有的艺术作品都是基于明确的<a class="ae jm" href="https://creativecommons.org/share-your-work/public-domain/cc0/" rel="noopener ugc nofollow" target="_blank"> CC0、公共领域</a>许可或<a class="ae jm" href="https://scripts.sil.org/cms/scripts/page.php?item_id=OFL_web" rel="noopener ugc nofollow" target="_blank"> SIL OFL </a>的资产，因此不侵权。主题灵感来自并基于我最喜欢的<code class="du lh li lj lk b">vim</code>主题:<a class="ae jm" href="https://github.com/morhetz/gruvbox" rel="noopener ugc nofollow" target="_blank">grubbox</a>。</p></div></div>    
</body>
</html>