<html>
<head>
<title>How to use one-way ANOVA for forecasting in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用单因素方差分析进行预测</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/how-use-one-way-anova-for-forecasting-in-r-908bb1b5b4d3?source=collection_archive---------2-----------------------#2022-01-26">https://medium.com/mlearning-ai/how-use-one-way-anova-for-forecasting-in-r-908bb1b5b4d3?source=collection_archive---------2-----------------------#2022-01-26</a></blockquote><div><div class="dt gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bbc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也可以预测的统计检验</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et jd"><img src="../Images/1029433fc3c3dba5f87f494fde98ed10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OK0bst6OtiaACMpZJWq_Eg.jpeg"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">The English book section at my local bookstore. Image by author.</figcaption></figure><p id="d4a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下，当我得知在假设检验中被广泛使用的方差分析(ANOVA)可以用来预测销售额时，我有多惊讶。嗯，这真的不应该是一个惊喜，因为方差分析和回归密切相关。</p><p id="e253" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方差分析有助于回答这个问题:<em class="jt">我们的群体真的不同吗？</em>我们使用ANOVA来分析平均值的方差，然后我们可以对这些平均值做出推断。</p><p id="302d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用单向方差分析预测产品销售。单向的，因为我们只用一个独立变量来预测。如果我们想通过<strong class="ih hj">分析两个</strong>独立变量，这将是一个双向方差分析。这个数据集来自Wayne L. Winston的《营销分析:使用Microsoft Excel的数据驱动技术》的第40章。它包含位于商店不同货架位置的计算机书籍6周的销售数据。</p><p id="baa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据集有3列(前面、后面和中间货架位置),每行有总销售额。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et ju"><img src="../Images/e8eb3888466bf6c84440326351bbf6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-Axr5FLLYgfjPdEsaysNg.png"/></div></div></figure><p id="4f9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方差分析将有助于回答这个问题:<em class="jt">书架位置影响图书销售吗？我们可以期待总销售额是多少？</em></p><h1 id="9579" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">浏览数据集</h1><p id="ea51" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">首先，我们需要重塑数据，以便能够运行任何统计分析。现在，我们的数据集很宽，我们希望它很长，这样每一行只是每个时间点每个位置的一个观察值。我们将首先添加一个星期数作为行号，然后使用tidyr的pivot_longer()函数。</p><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="afe3" class="ld jw hi kz b fj le lf l lg lh">books &lt;- bookstore %&gt;% <br/>mutate(week_num = row_number())  %&gt;%<br/>  pivot_longer(!week_num, names_to = "location",<br/>               values_to = "sales")</span><span id="06f6" class="ld jw hi kz b fj li lf l lg lh">books</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et lj"><img src="../Images/44cf25bb4bb51d699ff3931b51e4aa9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hbiHUCPK0yX7nnU_utfVw.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Transformed data from wide-to-long. Image by author.</figcaption></figure><p id="4ab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重要的是要知道，在我们的分析中，我们会忽略一些缺失值，而不是删除或输入(替换)缺失值。</p><p id="2217" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们来做一些探索性的数据可视化。我们将使用箱线图按货架位置绘制销售图，以检查分布情况。</p><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="91b5" class="ld jw hi kz b fj le lf l lg lh">#set Wall Street Journal theme for all plots<br/>theme_set(theme_wsj())</span><span id="c6af" class="ld jw hi kz b fj li lf l lg lh">ggplot(data = books, aes(x=location, y=sales)) + geom_boxplot(na.rm=TRUE) + ggtitle("Book sales by shelf location")</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et lk"><img src="../Images/a0d1aecfcc5506b677d692dcb6a774ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*euhlcTHtsVhYXJThlMFALA.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Book sales ggplot boxplot using wsj theme from ggthemes package. Image by author.</figcaption></figure><p id="85c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">位于后面时，平均销售额会更高。我们也有一些异常值，用方框外的黑点表示。</p><h1 id="ab59" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">方差分析</h1><p id="0953" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">像所有的统计测试一样，需要做一些假设来确保我们可以使用我们的统计测试。对于方差分析，假设是:</p><p id="d8a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.数据来自随机样本<br/> 2。观察是独立的<br/> 3。正态分布的底层数据<br/> 4。方差的同质性</p><p id="14bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们定义我们的无效假设和替代假设:</p><p id="4599" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt"> H₀ </em> —组间均值相等<br/> <em class="jt">哈</em> —组间均值不同</p><h1 id="1476" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">方差分析假设</h1><p id="9eb7" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">为了使用方差分析，我们必须确保我们的基础数据满足上述四(4)个方差分析假设。我们最关心的假设是方差的正态性和同质性。我们将用夏皮罗-维尔克方法检验正态性，用巴勒特检验检验方差齐性。</p><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="3db3" class="ld jw hi kz b fj le lf l lg lh"># Test normality across groups (Shapiro)<br/>tapply(books$sales, books$location, FUN = shapiro.test)</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et ju"><img src="../Images/c200b1e889df33c5987446166c94b730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNldDH6FSk2oCaCu87e5zw.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Shapiro-Wilk normality test output. Image by author.</figcaption></figure><p id="35a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有货架位置的所有p值都非常大(&gt; 0.05)，因此我们可以假设基础数据的正态性。</p><p id="4791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查方差的同质性。</p><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="2602" class="ld jw hi kz b fj le lf l lg lh"># Check the homogeneity of variance (Bartlett)<br/>bartlett.test(sales ~ location, data = books)</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et ll"><img src="../Images/09b11797e3d89f18e007c14c7feb9555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*peOFXMLPLSSP7csWxvVJGA.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Output of Bartlett test. Image by author.</figcaption></figure><p id="243c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Bartlett检验的p值非常大(&gt; 0.05)，我们可以假设方差齐性。我们现在可以安全地继续进行单向方差分析。</p><h1 id="1a47" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">进行单向方差分析</h1><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="6762" class="ld jw hi kz b fj le lf l lg lh"># Perform one-way ANOVA <br/>(anova_results &lt;- oneway.test(sales ~ location, data = books, var.equal = TRUE))</span><span id="6724" class="ld jw hi kz b fj li lf l lg lh">#Extract p-value<br/>anova_results$p.value &lt; 0.05 #If true, means are different. If false, mean sales are identical in all shelf positions.</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et lm"><img src="../Images/922905e82be2088126bfd4f88c106add.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*3S2LuXpglJwQp0Il_vYpOA.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">One-way ANOVA output p-value is very large so we fail to reject the null hypothesis. Image by author.</figcaption></figure><p id="288d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单因素方差分析结果解读:<br/>检验的p值大于显著性水平α= 0.05。我们不能根据货架高度得出销售有显著差异的结论。(p值高于5%，因此我们无法拒绝组间均值相等的零假设)。换句话说，我们接受零假设，并得出结论，销售没有显着不同的货架位置。</p><h1 id="08c5" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">预报</h1><p id="23b4" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">每组的预测平均值是总体平均值。预测将是每周销售，不考虑货架位置。</p><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="a280" class="ld jw hi kz b fj le lf l lg lh">#Forecast:  mean of sales and remove n/a's<br/>mean(books$sales, na.rm = TRUE)</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et ln"><img src="../Images/50d9fa9f30db63872b2b4eca80685a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*l6ExrhyPZBCAqMBgBOsHjQ.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">Forecast for weekly sales. Image by author.</figcaption></figure><p id="ca1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们预计每周能卖出1120本书。</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h1 id="d1ef" class="jv jw hi bd jx jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks bi translated">场景2:如果各组有明显不同的方法呢？</h1><p id="5826" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">让我们用不同的场景再试一次。让我们来看一下<strong class="ih hj">新的数据集</strong>为我们的计算机书籍提供的6周的销售数据。就像我们的第一个数据集一样，该数据最初很宽，我们将其转换为长格式。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et ma"><img src="../Images/2c7ec32872d900aebdb35db54857ae81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m89esw1uyh3WJKMUVGI08Q.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Transformed data from wide-to-long. Image by author.</figcaption></figure><p id="b1f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在箱线图上绘制这个数据集。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et mb"><img src="../Images/bbd16ef3ea7bc3c1f5debc5c2ee53b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RM_Dc_aN0VFzjAls8hiQw.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy">Book sales for scenario 2 with ggplot boxplot using wsj theme from ggthemes package. Image by author.</figcaption></figure><p id="cbac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个数据集中，我们看到，与前面和中间位置相比，位于后面的书籍销量明显更多。</p><h1 id="d3df" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">方差分析假设(情景2)</h1><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="d86a" class="ld jw hi kz b fj le lf l lg lh"># Test normality across groups<br/>tapply(books2$sales, books2$location, FUN = shapiro.test)</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et mc"><img src="../Images/8418fdf1b831196e7d533da7f3df2901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*fHxig7OEiC8yjMuS9566rg.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">Shapiro-Wilk test output. Image by author.</figcaption></figure><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="9374" class="ld jw hi kz b fj le lf l lg lh"># Check the homogeneity of variance<br/>bartlett.test(sales ~ location, data = books2)</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et md"><img src="../Images/ef0b2f65bcbb8bb2bde5ccbf5c616615.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*jgVyCwe-t4OOLhK1iRcFnA.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">Bartlett test output. Image by author.</figcaption></figure><p id="88ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Bartlett检验p值也很大。</p><h1 id="d0fc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">再次进行单向方差分析</h1><pre class="je jf jg jh fe ky kz la lb aw lc bi"><span id="dcc5" class="ld jw hi kz b fj le lf l lg lh"># Perform one-way ANOVA <br/>(anova_results2 &lt;- oneway.test(sales ~ location, data = books2, var.equal = TRUE))</span><span id="c40e" class="ld jw hi kz b fj li lf l lg lh">anova_results2$p.value &lt; 0.05 #If true, means are different. reject null hypothesis and alternative hypothesis is true. if false, mean sales are identical in all shelf positions.</span></pre><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et me"><img src="../Images/0a88c103b7e357ee6ce26ddb7ba833d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*heA7uIkX2oFJ6wP-vcakRQ.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">ANOVA output for scenario 2. Image by author.</figcaption></figure><p id="7e76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单因素方差分析结果的解释:<br/>p值非常小，为0.003426，因此我们拒绝零假设，并得出结论:货架位置之间的销售额存在显著差异。</p><h1 id="0dd7" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">预测(当我们有明显不同的手段时)</h1><p id="49ef" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">每组的预测平均值等于组平均值。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et mf"><img src="../Images/0a526103cc17fb3e60caaa11794cd895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*mW787dlxnWBZyyDqChT-eA.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy">Forecast of weekly sales based on result of ANOVA. Image by author.</figcaption></figure><p id="e7aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以预计，当位于书区的前面时，每周销售900本书，当位于中间时，每周销售1100本书，当位于书区的后面时，每周销售1400本书。</p><h1 id="efdc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">关键要点</h1><p id="baa6" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">使用单因素方差分析进行预测时:</p><blockquote class="mg mh mi"><p id="c328" class="if ig jt ih b ii ij ik il im in io ip mj ir is it mk iv iw ix ml iz ja jb jc hb bi translated">如果销售平均值<strong class="ih hj">不显著</strong>跨组预测:<br/>每个组的预测平均值等于<strong class="ih hj">总体平均值</strong>。</p><p id="80e3" class="if ig jt ih b ii ij ik il im in io ip mj ir is it mk iv iw ix ml iz ja jb jc hb bi translated">F <!-- -->预测如果销售平均值<strong class="ih hj">跨组</strong> <strong class="ih hj">显著</strong>:<br/>每个组的预测平均值等于<strong class="ih hj">组平均值</strong>。</p></blockquote><p id="6ba3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码可以在<a class="ae mm" href="https://github.com/bonheurgirl/Forecasting-in-R/blob/main/Forecasting%20with%20One-way%20ANOVA%20in%20R.Rmd" rel="noopener ugc nofollow" target="_blank"> Github </a>和<a class="ae mm" href="https://rpubs.com/anitaowens/forecasting-anova" rel="noopener ugc nofollow" target="_blank"> Rpubs </a>上找到。</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h1 id="c0d8" class="jv jw hi bd jx jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks bi translated">参考资料:</h1><p id="97c5" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">温斯顿W. L. (2014年)。营销分析:微软Excel的数据驱动技术。威利。</p><div class="mn mo fa fc mp mq"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mr ab dx"><div class="ms ab mt cl cj mu"><h2 class="bd hj fj z dz mv eb ec mw ee eg hh bi translated">Mlearning.ai提交建议</h2><div class="mx l"><h3 class="bd b fj z dz mv eb ec mw ee eg dy translated">如何成为Mlearning.ai上的作家</h3></div><div class="my l"><p class="bd b fq z dz mv eb ec mw ee eg dy translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne jn mq"/></div></div></a></div></div></div>    
</body>
</html>