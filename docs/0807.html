<html>
<head>
<title>Making An EDA on Medical Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在医学图像上制作EDA</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/making-an-eda-on-medical-images-b823693a517a?source=collection_archive---------3-----------------------#2021-07-22">https://medium.com/mlearning-ai/making-an-eda-on-medical-images-b823693a517a?source=collection_archive---------3-----------------------#2021-07-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b3f148475a0fb8762d9092f05d34354b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s-JZ5vb2WxrPwC4Z"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@umanoide?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Umanoide</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="af08" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h2><p id="f4d1" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">使用医学图像会带来许多挑战。阅读、理解和使用医学数据制作模型是相当具有挑战性的。在本文中，我将尝试为第一次处理医疗数据的人制作一个初学者友好的EDA。</p><p id="22c1" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">我们将处理<a class="ae it" href="https://www.kaggle.com/c/rsna-miccai-brain-tumor-radiogenomic-classification" rel="noopener ugc nofollow" target="_blank">RSNA-密歇根脑瘤放射基因组分类</a>数据。该数据包含一个train.csv文件以及一个train文件夹和test文件夹，其中包含每个患者大脑的磁共振成像。这是我从一个Kaggle比赛中得到的。比赛的目标是预测哪些病人有MGMT启动子甲基化的基因序列，这是一种致癌基因。在这里阅读我的官方Kaggle笔记本。</p><div class="ks kt ez fb ku kv"><a href="https://www.kaggle.com/aristotle609/basic-eda-rsna" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hi fi z dy la ea eb lb ed ef hg bi translated">基本EDA RSNA</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自RSNA-密歇根大学脑肿瘤放射基因组学的数据…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">www.kaggle.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj in kv"/></div></div></a></div></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><h2 id="e715" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">启动笔记本</h2><p id="6362" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">让我们从导入我们将使用的所有依赖项开始。如果您继续操作，但无法运行下面的单元，这意味着您的环境缺少一个或多个模块。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="01f6" class="iu iv hh lw b fi ma mb l mc md">import seaborn as sns<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import pydicom <em class="me"># A library that loads dicom(dcm) files</em><br/>import numpy as np<br/>import os<br/>import glob<br/>from IPython.display import Markdown <em class="me"># we will require this to print Markdown in the console</em><br/>input_df = "../input/rsna-miccai-brain-tumor-radiogenomic-classification/train_labels.csv"<br/>sample = "../input/rsna-miccai-brain-tumor-radiogenomic-classification/sample_submission.csv"</span></pre><p id="841f" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">接下来，我们将在笔记本中安装赛璐珞(如果您希望每次在您的环境而不是笔记本上安装pip时运行相同的代码而不安装赛璐珞)</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="777e" class="iu iv hh lw b fi ma mb l mc md">!pip install celluloid</span></pre><p id="9ca7" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">现在我们来看看CSV文件。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="cdda" class="iu iv hh lw b fi ma mb l mc md">train_df = pd.read_csv(input_df)<br/>train_df</span><span id="75bc" class="iu iv hh lw b fi mf mb l mc md">sample_df = pd.read_csv(sample)<br/>sample_df</span></pre><h2 id="7b01" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">可视化数据</h2><p id="87bf" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">我们将使用pydicom库来读取<em class="me"> dcm </em>数据</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="35d4" class="iu iv hh lw b fi ma mb l mc md">def load_dicom(path):<br/>    dicom = pydicom.read_file(path) <em class="me"># pydicom is a library made to process dicom files</em><br/>    data = dicom.pixel_array <em class="me"># pixel_array shows the value of each pixel in the array</em><br/>    data = data - np.min(data) <em class="me">#helps in normalizing the image (not really required in this case)</em><br/>    if np.max(data) != 0:<br/>        data = data/np.max(data)<br/>    data = (data*255).astype(np.uint8)<br/>    return data</span></pre><p id="ae01" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">我们将使用matplotlib来绘制图像</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="c88b" class="iu iv hh lw b fi ma mb l mc md">def visualize_sample(ID,path,type_ = "flair"):<br/>    plt.figure(figsize = (16,5))<br/>    data = load_dicom(path)<br/>    plt.imshow(data)<em class="me">#</em><br/>    label = train_df[train_df['BraTS21ID'] == ID]["MGMT_value"].item()<em class="me">#this will assign the MGMT_value of the Patient to label</em><br/>    plt.title(str(ID)+" " + type_ + " MGMT_value: " +str(label))<br/>    plt.axis("off"</span></pre><p id="31f8" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">让我们来看看剧情</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="99bd" class="iu iv hh lw b fi ma mb l mc md">visualize_sample(0 , "../input/rsna-miccai-brain-tumor-radiogenomic-classification/train/00000/FLAIR/Image-250.dcm", "FLAIR")</span></pre><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es mg"><img src="../Images/31ace525b5d18ada4da750e650086461.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*3T23Ix8YdcR61tQzqejnxw.png"/></div></figure><p id="300c" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">这很好，但是，他们通常需要核磁共振成像来绘制身体的三维模型。在下一节中，我们将为dicom文件制作动画，以便更好地理解。我们将使用赛璐珞库来制作数据动画。dicom_animation函数将发送一个要制作动画的图像列表。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="6ef3" class="iu iv hh lw b fi ma mb l mc md">from celluloid import Camera<br/><br/>def create_animation(ims):<br/>    fig = plt.figure(figsize=(16, 5))<br/>    plt.axis('off')<br/>    im = plt.imshow(ims[0])<br/>    camera = Camera(fig)<br/><br/>    for i <strong class="lw hi">in</strong> range(len(ims)):<br/>        plt.imshow(ims[i])<br/>        camera.snap() <em class="me">#Each instance of the plot is saved</em><br/>    <br/>    animation = camera.animate() <em class="me"># And is then animated</em><br/>    display(animation)</span><span id="03cc" class="iu iv hh lw b fi mf mb l mc md">def dicom_animation(path):<br/>    t_path = sorted(<br/>                    glob.glob(os.path.join(path,'*'))<br/>    )<br/>    images = []<br/>    for name <strong class="lw hi">in</strong> t_path:<br/>        data = load_dicom(name)<br/>        images.append(data)<br/>    return create_animation(images)</span></pre><p id="f0bb" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">下一个函数将以更好的形式显示数据，您可以随意忽略它</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="427b" class="iu iv hh lw b fi ma mb l mc md">types = ["FLAIR", "T1w" , "T1wCE" , "T2w"]</span><span id="fc13" class="iu iv hh lw b fi mf mb l mc md">def show_anim(Id):<br/>    display(Markdown("&lt;div align = 'center'  style = 'color : lightblue'&gt;"+"ID : "+Id+"&lt;/div&gt;"))<br/>    display(Markdown("&lt;div align = 'center'  style = 'color :lightblue'&gt;"+"MGMT methylation promoter : "+str(train_df[train_df['BraTS21ID'] == int(Id)]["MGMT_value"].item())+"&lt;/div&gt;"))<br/>    <em class="me">#print("\tMGMT methylation promoter : " ,train_df[train_df['BraTS21ID'] == int(Id)]["MGMT_value"].item())</em><br/>    path = os.path.join("../input/rsna-miccai-brain-tumor-radiogenomic-classification/train",Id)<br/>    for x <strong class="lw hi">in</strong> types:<br/>        display(Markdown("&lt;div align = 'center' style = 'color : violet'&gt;"+"Type of MRI : "+x+"&lt;/div&gt;"))<br/>        dicom_animation(os.path.join(path,x))</span><span id="dd1d" class="iu iv hh lw b fi mf mb l mc md">show_anim("00000")</span></pre><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/801867a26b73646a78ad83e7a6f6e37f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3HHeJbH1jwRZWCoFKhTz4w.gif"/></div></div></figure><p id="9f24" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">我的EDA到此结束。</p></div></div>    
</body>
</html>