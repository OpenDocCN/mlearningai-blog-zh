<html>
<head>
<title>Analysis of Repeated Count Data in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中重复计数数据的分析</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/analysis-of-repeated-count-data-in-r-the-poisson-quasi-poisson-negative-binomial-e62aff528309?source=collection_archive---------0-----------------------#2021-10-05">https://medium.com/mlearning-ai/analysis-of-repeated-count-data-in-r-the-poisson-quasi-poisson-negative-binomial-e62aff528309?source=collection_archive---------0-----------------------#2021-10-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="65fc" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">泊松、拟泊松和负二项分布</h2></div><p id="ed5a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">众所周知，计数数据很难建模。它们不仅与你们大多数人熟悉的正态分布有很大的不同，而且也很难用最常与之相关的分布——泊松分布(T1)来描述。为了使它更具挑战性，我在混合中添加了重复的数据，这意味着我们现在必须处理在测量中很好相关的整数。</p><p id="b6ca" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所使用的数据集包含对猪腹泻的重复测量。腹泻在4点主观顺序量表上测量——0，1，2，3。</p><p id="ebdd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这一部分，我将展示如何使用泊松、<a class="ae js" href="https://en.wikipedia.org/wiki/Poisson_regression" rel="noopener ugc nofollow" target="_blank">准泊松</a>(不是真正的分布)和<a class="ae js" href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" rel="noopener ugc nofollow" target="_blank">负二项分布</a>来分析计数数据。下一部分将强调<a class="ae js" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">二项式</a>和<a class="ae js" href="https://en.wikipedia.org/wiki/Beta_distribution" rel="noopener ugc nofollow" target="_blank"> Beta </a>分布的使用。你心里应该已经有了危险信号，因为一个既可以作为计数又可以作为比例进行分析的指标意味着我们将会有不同的估计和不同的标准误差。只是通过发行的选择。</p><p id="97e7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我将跨时间和按时间建模，这篇文章将展示<a class="ae js" href="https://en.wikipedia.org/wiki/Generalized_linear_model" rel="noopener ugc nofollow" target="_blank">广义线性模型</a> (GLM)以及<a class="ae js" href="https://en.wikipedia.org/wiki/Generalized_linear_mixed_model#:~:text=In%20statistics%2C%20a%20generalized%20linear,models%20to%20non%2Dnormal%20data." rel="noopener ugc nofollow" target="_blank">广义线性混合模型</a> (GLMM)的应用。区别在于，后一套模型可以包括随机效应的协方差矩阵，以及模型的误差部分。</p><p id="dfae" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我在这里使用的代码和例子已经超过4年了，但是它们仍然适用。然而，它们只是一个建模者——我——的工作，所以不要把它们和事实混淆，可以随意改进它们。我相信会有很多机会。</p><p id="db82" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">尽情享受吧！</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Quite a lot of libraries were used here. The last two lines complement the parallel package and help you specify the number of cores you will allow to run in parallel.</figcaption></figure><p id="00e3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面的代码是我故意放进去的。当然，我可以从一个干净的数据集开始，但事实是我确实收到了一个干净的数据集。然而，这是一个宽列重数据集。此外，需要很快做出选择。我是允许腹泻被归类为(1，2，3)还是用(2，3)。也许我应该使用(3)并将其余的(0，1，2)标记为无腹泻。这些选择应该由科学而不是统计数据来决定模型的进一步发展方向和结果。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Lots of data-wrangling.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ke"><img src="../Images/a864bce7abd44feb2bb6ae086eaa507c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmVuz_ia9q0llH3YnIedgg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Data in wide format with a count at the end. The value in this column depends on how you classify diarrhea. Here, we used (1,2,3).</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es et"><img src="../Images/f779e2c17d8f32a702eabeb9c01a866c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdS0IkpXRbPA8SMt7GlOlg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">The data in long format.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Simple code to take a look, for each animal (id), when they did or did not have diarrhea.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kl"><img src="../Images/2611c7732e20e26965a4b6d109058cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7MEQGCqnd_mwpEO1AGOvQw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">What I am looking for is sufficient events to model. This means I need to have points at the ceiling of each cell. The red spline may hint at variation across id’s but not to much weight should be attributed to it. Especially on binary data, which this plot highlights. Image by author.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Once again, heavy wrangling to get the data ready in a format that I can use for Poisson modelling.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es km"><img src="../Images/36db74ae22f63abcf0eb0358e30141d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LSZGPakU7YQtMGapUgueQg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">The count columns you should be most interested in. The first ones (which are all the same actually) highlight the total count when diarrhea is specified as (1,2,3). The last four — all weeks, week1, week2, week3 — classified diarrhea as (2,3). The choice was science driven.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kn"><img src="../Images/5d3f4c70499a0dc8df13f92c71f02afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JhZ6tpJdDtp6Is4rT4AxYg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">In this plot, you can already see me trying out different distributions and how they will fit. An early hint that the Negative Binomial might do well. Image by author.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/50266ef15e891543add7e36076ea7f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2tppL1R-YZAZcW9PfIEa4A.png"/></div></figure><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/821dd691c52568a4f2684a16914805c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pY0uPYi7joPgioIAKBL7iw.png"/></div></figure></div><div class="ab cb"><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/e6934027541819f5ed57fba903aec0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Il46SQYJnpiQtUztpx9Jng.png"/></div></figure><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/6ca744e66e411dce5dae34ad2c1d5003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*uOOQjYSK6E9VjqYwNlJj5g.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ku di kv kw">These are simply distribution plots to look at the count of diarrhea across all weeks for each treatment, sex, factor AA, and factor BB. Image by author.</figcaption></figure></div><p id="d9fc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">好了，这就是有趣的开始。第一行代码可能是最重要的一行，它是对所有周数的均值/方差比率的简单计算。我可以说得更具体一些，分别针对多个因素，但关键是要理解泊松分布是一个非常有限的分布——均值等于方差。这被称为lambda参数，它的限制通常会导致<a class="ae js" href="http://biometry.github.io/APES//LectureNotes/2016-JAGS/Overdispersion/OverdispersionJAGS.html" rel="noopener ugc nofollow" target="_blank">过度分散</a> —泊松模型会低估数据中的标准误差，并更容易假设最有可能不存在的影响。</p><p id="97c7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">或者，用频率主义者的话说——你有更高的机会获得显著的p值。</p><p id="7a04" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面，您将找到拟合泊松模型、准泊松模型和负二项式模型的代码。尽管准泊松不是一个分布，而是泊松模型的一个扩展，它们确实代表了一系列在估计方差时变得越来越自由的模型。</p><p id="52ee" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于泊松，均值等于方差。</p><p id="e5ac" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于准泊松，方差是所有观测值的估计方差。该方差用于获得更“真实”的标准误差。</p><p id="2b83" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于负二项分布，方差是半独立估计的。它不像正态分布那样自由，但比泊松分布自由得多，也不像准泊松分布那样容易出错。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Code to run three types of models, check if the fixed effects can be changed by dropping variables, and compare them.</figcaption></figure><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="60b0" class="lc ld hh ky b fi le lf l lg lh">Variance-to-Mean Ratio<br/>[1] 1.769033   --&gt; larger than 1 hints at overdispersion</span><span id="e022" class="lc ld hh ky b fi li lf l lg lh">&gt; summary(fit.poisson.AW) # overdispersed</span><span id="5239" class="lc ld hh ky b fi li lf l lg lh">Call:<br/>glm(formula = CountAW ~ AA * BB, family = poisson(link = "log"), <br/>    data = diar_daily_poisson)</span><span id="df16" class="lc ld hh ky b fi li lf l lg lh">Deviance Residuals: <br/>     Min        1Q    Median        3Q       Max  <br/>-3.10410  -1.09661  -0.04676   0.88019   2.81010</span><span id="7d12" class="lc ld hh ky b fi li lf l lg lh">Coefficients:<br/>            Estimate Std. Error z value Pr(&gt;|z|)    <br/>(Intercept)  2.06463    0.08638  23.900   &lt;2e-16 ***<br/>AAYes       -0.17587    0.12596  -1.396    0.163    <br/>BBYes        0.06228    0.11868   0.525    0.600    <br/>AAYes:BBYes  0.21970    0.17088   1.286    0.199    <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="812d" class="lc ld hh ky b fi li lf l lg lh">(Dispersion parameter for poisson family taken to be 1)</span><span id="1b12" class="lc ld hh ky b fi li lf l lg lh">Null deviance: 134.89  on 69  degrees of freedom<br/>Residual deviance: 128.79  on 66  degrees of freedom<br/>AIC: 401.28</span><span id="f8d1" class="lc ld hh ky b fi li lf l lg lh">Number of Fisher Scoring iterations: 4</span><span id="6908" class="lc ld hh ky b fi li lf l lg lh">&gt; drop1(fit.poisson.AW)<br/>Single term deletions</span><span id="397a" class="lc ld hh ky b fi li lf l lg lh">Model:<br/>CountAW ~ AA * BB<br/>       Df Deviance    AIC<br/>&lt;none&gt;      128.79 401.28<br/>AA:BB   1   130.45 400.93</span></pre><p id="445c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">与您习惯的线性回归模型相比，上述结果并没有显示出任何异常。唯一需要寻找的是过度离差，这里通过偏差/自由度的比值来计算。在这里，128.79 / 65意味着过度离差约为2，这意味着标准误差被低估了2倍。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lj"><img src="../Images/1a979b91827b01702da6c1a3fa014e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PY0RKZtqX2U_50WKg6FXfA.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">These plots are a bit dangerous to look for, since the mode and the errors do not have to be i.i.d or independent and identically distributed random variables. The reason why they do mimic i.i.d here is because the distribution of countAW does not mimic a traditional Poisson which is right-skewed. You could already see that when I tried a Normal distribution on the data — the fit was not bad. Image by author.</figcaption></figure><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="b964" class="lc ld hh ky b fi le lf l lg lh">&gt; anova(fit.poisson.AW, fit.quasipoisson.AW,fit.nb.AW)<br/>Analysis of Deviance Table</span><span id="fa6b" class="lc ld hh ky b fi li lf l lg lh">Model 1: CountAW ~ AA * BB<br/>Model 2: CountAW ~ AA * BB<br/>Model 3: CountAW ~ AA * BB<br/>  Resid. Df Resid. Dev Df Deviance<br/>1        66    128.794            <br/>2        66    128.794  0    0.000<br/>3        66     76.407  0   52.387</span></pre><p id="3f98" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">负二项式光明正大地打败了泊松和准泊松。我并不期望有任何减少，因为我正在比较刚性分布——泊松分布——和越来越不刚性的分布。灵活性越大，就越适合数据(这并不总是你想要的，但这是另一个讨论的问题)。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Now, despite that we know that the Negative Binomial is flexible, lets still run bootstrapped simulations to check for overdispersion. In addition, I want to check for zero-inflation.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/7ca2bb7e8049defaca3338b00a2f988f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*J3h5t63G-r1DhhZS0ZWWpQ.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/0edd302e502f8eef1c99bbe08a987b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*pjqcpz6byKQTMJEn1Hhx7g.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/c3a423da092a6b9dc6fe4354ce472ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*TBbtomBaTDqdgoWNLP8VLg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ll di lm kw">Simulations do not show any weird. residuals. The Negative Binomial for the countAW data is good to go. Image by author.</figcaption></figure></div></div><div class="ab cl ln lo go lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ha hb hc hd he"><p id="1769" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi lu translated">现在，上面的例子处理的是跨时间的计数数据，这意味着不包括时间因素。我们只是研究了腹泻的患病率，而不是一段时间内的发病率。这就是我们现在要做的，这将把我们带到广义线性混合模型的世界。</p><p id="8216" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就像我说的，GLMM模型是GLM的一个重要扩展，它为我们提供了建模方差的可能性。由于重复数据的自相关性是众所周知的，而且我们已经在动物水平上进行了观察，我们应该能够利用这些数据做更多的事情。</p><p id="7a09" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是一个非详尽的练习。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Putting data in long format requires additional wrangling.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es md"><img src="../Images/4412c91af89e0a7fe8568a329508dd9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89StMQ0kWUn_r0S1ftP3nQ.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Plots to show the shift in diarrhea counts per week and per treatment. Enough going on to model overall. Image by author.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Code to get a better feeling of where the majority of the events (diarrhea) are taking place.</figcaption></figure><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="c1e6" class="lc ld hh ky b fi le lf l lg lh">&gt; tapply(Datalong_poisson$Count, list(Datalong_poisson$Week), mean)<br/>        1         2         3 <br/>0.6285714 4.7000000 2.5714286</span><span id="da10" class="lc ld hh ky b fi li lf l lg lh">&gt; tapply(Datalong_poisson$Count, list(Datalong_poisson$treatm), mean)<br/>       1        2        3        4 <br/>2.627451 2.203704 2.796296 2.921569</span><span id="5fd1" class="lc ld hh ky b fi li lf l lg lh">&gt; tapply(Datalong_poisson$Count, list(Datalong_poisson$treatm,Datalong_poisson$Week), mean)<br/>          1        2        3<br/>1 1.1176471 4.470588 2.294118<br/>2 0.4444444 4.222222 1.944444<br/>3 0.5555556 4.666667 3.166667<br/>4 0.4117647 5.470588 2.882353</span><span id="2585" class="lc ld hh ky b fi li lf l lg lh">&gt; tapply(Datalong_poisson$Count, list(Datalong_poisson$treatm, Datalong_poisson$Week), sum)<br/>   1  2  3<br/>1 19 76 39<br/>2  8 76 35<br/>3 10 84 57<br/>4  7 93 49</span></pre><p id="eeec" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面你可以看到GLMM模型的代码。代码本身非常简单，除了(1|x)部分。这些是模型的随机效应。当我指定(1|Week)时，我请求以随机截距的形式将该周作为随机效果包含在内。对动物也有同样的要求。因此，在这个GLMM泊松模型中，我有两个随机效应— <em class="me">周</em>和<em class="me">动物数量</em>。因为我在模型中是分开添加的，所以方差分量是分开的。这是一个选择。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es mf"><img src="../Images/ddbbfa1993677f0bc48e89a24801b877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9osa7vgWwjRQgVk3LjZHg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">The results show we approached the data as a nested set, containing 70 animals with 3 observations each leading to a total of 210 observations. There is no reason to include the Week random effect. It has no variance. The results suggest an overdisperion factor of 732 / 184 = 5. Hence, the standard error of the fixed effects are underestimated by a factor five.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">I deleted the Week random effect, and specified Sex as a main effect instead of full interaction. I then asked a comparison between two models, and specified code for the assessment of the smaller model.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es mg"><img src="../Images/e032f54c34e4b61833c43bccbfa26492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXZ73NTOXaYf1Mph8BxP7A.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">The Anova sees no reason to keep the larger model as we expected.</figcaption></figure><div class="jt ju jv jw fd ab cb"><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/2cb1859dd456a6887a0b0481e6de1dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*a0H5yOELO391APg7vB_GCg.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/d22159cb6a36920332150a34ce1f8c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0A6T4aGOV5tPbamim_8zTw.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/9df48b955df044868aa387220833aaa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zukoicfm0-U0v7R_GD0gIg.png"/></div></figure></div><div class="ab cb"><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/f6c654f242eb78ed5f36a010c6c98337.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*sXPFuLVcHNtrK9iN1Rc6lg.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/f1d62f101515e489090331c8c320b0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0pbIGvx4Uv3oYBCafuTgdA.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/760d295df4057ee548555dfd3fd5ef3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zDYgvy1aHtpRAL80_YI9xg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ll di lm kw">Image by author.</figcaption></figure></div><div class="ab cb"><figure class="ko jx mh kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/6edb34b4965e1131e91b3a8a9ef97f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*uGzhumz2-OIxrMpzHviRvA.png"/></div></figure><figure class="ko jx mi kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/936359417d3f7db9bc52acecfbe3d5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*LvGoP2PbG1cY5AKNCMZDIg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx mj di mk kw">Plots looking at residuals across factors, the normality of the random effect, the estimates provided for the fixed effects, the predictions per factor, and the animal specific random effects. You want to see residuals that are homogenous, random effects that follow normality and show variance, predictions that make sense, and fixed effect estimates that follow biology. Image by author.</figcaption></figure></div><p id="3b5e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">第一次使用drop1 时，我就爱上了它。从统计学角度来看，这是一种快速的逐步筛选算法。这里，建议放弃完全相互作用，如超过主观阈值3的AIC差所示。</p><p id="c11f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果不明智地使用并以生物学为指导，这个工具可能弊大于利，但我仍然喜欢它。</p><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="d6ad" class="lc ld hh ky b fi le lf l lg lh">&gt; drop1(fit.poisson.week_smaller)<br/>Single term deletions</span><span id="f124" class="lc ld hh ky b fi li lf l lg lh">Model:<br/>Count ~ AA * BB * as.factor(Week) + SEX + (1 | animal_number)<br/>                      npar    AIC<br/>&lt;none&gt;                     766.28<br/>SEX                      1 764.29<br/>AA:BB:as.factor(Week)    2 762.89</span></pre><p id="b5d4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面你可以看到拟合两个广义矩的代码——泊松和准泊松。我们再次添加了一个观察水平方差分量(1|Id)来将泊松转换为准泊松。基于自举的模拟用于测试模型的剩余部分。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div></figure><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="5514" class="lc ld hh ky b fi le lf l lg lh">&gt; summary(fit.quasipoisson.week)<br/>Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) ['glmerMod']<br/> Family: poisson  ( log )<br/>Formula: Count ~ AA * BB * Week + SEX + (1 | Week) + (1 | Id)<br/>   Data: Datalong_poisson<br/>Control: glmerControl(optimizer = "bobyqa", nAGQ = 10)</span><span id="0595" class="lc ld hh ky b fi li lf l lg lh">AIC      BIC   logLik deviance df.resid <br/>   789.5    826.3   -383.7    767.5      199</span><span id="4335" class="lc ld hh ky b fi li lf l lg lh">Scaled residuals: <br/>     Min       1Q   Median       3Q      Max <br/>-1.79287 -0.74991 -0.03795  0.60581  2.77765</span><span id="1757" class="lc ld hh ky b fi li lf l lg lh">Random effects:<br/> Groups Name        Variance Std.Dev.<br/> Id     (Intercept) 0.06459  0.2542  <br/> Week   (Intercept) 0.39123  0.6255  <br/>Number of obs: 210, groups:  Id, 210; Week, 3</span><span id="ba83" class="lc ld hh ky b fi li lf l lg lh">Fixed effects:<br/>                 Estimate   Std. Error z value Pr(&gt;|z|)  <br/>(Intercept)      -0.11411    1.01639  -0.112   0.9106  <br/>AAYes            -0.72744    0.50702  -1.435   0.1514  <br/>BBYes            -1.01081    0.49184  -2.055   0.0399 *<br/>Week              0.41468    0.46764   0.887   0.3752  <br/>SEXM             -0.02044    0.09425  -0.217   0.8283  <br/>AAYes:BBYes       0.92020    0.71174   1.293   0.1960  <br/>AAYes:Week        0.24416    0.22192   1.100   0.2712  <br/>BBYes:Week        0.47812    0.21230   2.252   0.0243 *<br/>AAYes:BBYes:Week -0.31183    0.30586  -1.020   0.3080  <br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="ce44" class="lc ld hh ky b fi li lf l lg lh">Correlation of Fixed Effects:<br/>            (Intr)  AAYes  BBYes  Week   SEXM   AAYs:BBY AAYs:W BBYs:W<br/>AAYes       -0.214                                                   <br/>BBYes       -0.216  0.464                                            <br/>Week        -0.929  0.202  0.205                                     <br/>SEXM        -0.037 -0.007 -0.018  0.000                              <br/>AAYes:BBYes  0.151 -0.709 -0.688 -0.142  0.003                       <br/>AAYes:Week   0.209 -0.962 -0.452 -0.214  0.000  0.683                <br/>BBYes:Week   0.215 -0.459 -0.963 -0.221  0.002  0.663    0.486       <br/>AAYs:BBYs:W -0.151  0.696  0.665  0.154 -0.004 -0.964   -0.724 -0.691</span></pre><p id="e65a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你计算准泊松中的偏差/ df，你仍然会发现4倍的过度偏差。然而，由于我们包括了观察水平的方差成分，我们对标准误差的估计更放心。即使方差分量不是很大。</p><p id="7799" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">固定效应的相关矩阵总是很好看，以便进一步指定-简化-您的模型。特别是<em class="me">周</em>有一些非常重的相关性。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ml"><img src="../Images/2b726263ac91d8ecf21e05edb045f092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yiZSA2uXs-Cb_s-ohsjyxA.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Comparison between three models shows that the fit.poisson.week is the best model. I guess adding the observational-level variance component did not do that much. We already expected as such.</figcaption></figure><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="7b13" class="lc ld hh ky b fi le lf l lg lh">&gt; testZeroInflation(simulationOutput)</span><span id="c2eb" class="lc ld hh ky b fi li lf l lg lh">DHARMa zero-inflation test via comparison to expected zeros with simulation under H0 = fitted model</span><span id="2936" class="lc ld hh ky b fi li lf l lg lh">data:  simulationOutput<br/>ratioObsSim = 1.2956, p-value = 0.452<br/>alternative hypothesis: two.sided</span><span id="b0c0" class="lc ld hh ky b fi li lf l lg lh">&gt; testDispersion(simulationOutput)</span><span id="5062" class="lc ld hh ky b fi li lf l lg lh">DHARMa nonparametric dispersion test via mean deviance residual fitted vs. simulated-refitted</span><span id="8488" class="lc ld hh ky b fi li lf l lg lh">data:  simulationOutput<br/>dispersion = 1.1075, p-value = 0.408<br/>alternative hypothesis: two.sided</span></pre><div class="jt ju jv jw fd ab cb"><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/dabde18221782c0e3cd63c1e9ea5ba6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qgqjM8_AfutXXI7Y7M7n2g.png"/></div></figure><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/c8e6ae551de6eb9a5cf90f3798e0e3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*gBC2xmGDuLlBor-lbfUbKQ.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ku di kv kw">Simulation results for the Quasi-Poisson seem to be OK, overall. Image by author.</figcaption></figure></div><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kl"><img src="../Images/f746ee497a6c09e9b145eb9ac8b841e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hweaYEJsZACTq0fu106AIw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Simulations results zoomed in for the various factors seem mostly okay, expect when you look at the individual animal level. I suspect this is because the first Quasi-Poisson model did fit week-specific, but not animal-specific intercepts. Image by author.</figcaption></figure><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">The code to run a GLMM Negative Binomial has a different code, but follows the same structure.</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es mm"><img src="../Images/50098fc1117a1e8724446b859fc86153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEM2LTs673ybyDFj3LQrhw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Also here, overdispersion is present, and we see the same high-correlation across certain fixed effects.</figcaption></figure><p id="a56e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面的结果应该告诉你，当你有计数数据时，负二项式不会自动救你。该模型只是没有很好地指定，导致过度分散，高固定效应相关性，以及方差估计应该出现的缺口。</p><div class="jt ju jv jw fd ab cb"><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/8ee51f90c564b26459de446998acb8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*yqVbVtYpKLr1RnbzmgTZ8w.png"/></div></figure><figure class="ko jx kp kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/0305b3c2a38c40419b097b153ecc15de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2w-QzhP6ZWrb0Xj0ZDcFQA.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ku di kv kw">Image by author.</figcaption></figure></div><div class="ab cb"><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/ced92cfd18e3b829ebdc90ddb20121f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zrQitxvOzB4vHlovj9z5hw.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/01eb192d725a968640d324ed8b073ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*KiirJACczszloeFSqEQn0A.png"/></div></figure><figure class="ko jx lk kq kr ks kt paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><img src="../Images/2d3b6288e741a5461dc40e8984c49c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*kzKZd22sub6womVgedOJiA.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx ll di lm kw">Diagnostic plots show no real deviances, expect at the animal. Image by author.</figcaption></figure></div><p id="9c7e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这一点上，我不会认为模型完成了，但这并不损害结果。作为一个建模者，我们永远不会真正完成，需要做更多的工作来获得给定数据和科学的最佳可能模型。</p></div><div class="ab cl ln lo go lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ha hb hc hd he"><p id="c698" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi lu translated">最后，但并非最不重要的是，我想包含应用一个<a class="ae js" href="https://en.wikipedia.org/wiki/Zero-inflated_model" rel="noopener ugc nofollow" target="_blank">零膨胀泊松</a> (ZIFP)模型的代码。尽管每个模型的每个模拟都没有暗示零通货膨胀，因此ZIFP不可能增加任何东西，但你会比你想象的更容易遇到零通货膨胀。在大多数情况下，计数数据有许多0和1，并且过多的0暗示了一个应该由两个模型组成的模型:</p><ol class=""><li id="3a7f" class="mn mo hh iy b iz ja jc jd jf mp jj mq jn mr jr ms mt mu mv bi translated">模型A解释为什么有许多零</li><li id="0668" class="mn mo hh iy b iz mw jc mx jf my jj mz jn na jr ms mt mu mv bi translated">模型B解释如果不为零，计数会是多少。</li></ol><p id="3657" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以是的，它们就像一棵决策树。</p></div><div class="ab cl ln lo go lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ha hb hc hd he"><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Poisson vs Zero-Inflated Poisson vs. Negative Binomial. Do note that now, the random effect is a random slope (fWeek | animal_number).</figcaption></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es nb"><img src="../Images/ea683ea78749b78a23ef0ae496d64a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGQZwzYGB8fD5BJtmCQqbw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Does not hint at severe Zero-Inflation.</figcaption></figure><p id="fdc2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，下面的代码确实表明ZIFP模型比泊松模型更好。也许这并不奇怪，如果你考虑到任何只有一个多分布参数的模型都可能比单参数泊松分布做得更好。这并不意味着ZIFP真的是更好的模型。也有可能我们的泊松从一开始就没有被很好地建模。</p><pre class="jt ju jv jw fd kx ky kz la aw lb bi"><span id="8531" class="lc ld hh ky b fi le lf l lg lh">&gt; anova(fit.p, fit.pzif)<br/>Analysis of Deviance Table</span><span id="4c61" class="lc ld hh ky b fi li lf l lg lh">Model 1: Count ~ AA * BB * SEX<br/>Model 2: Count ~ AA * BB * SEX<br/>  NoPar  LogLik Df Deviance  Pr(&gt;Chi)    <br/>1    11 -456.99                          <br/>2    12 -438.03  1   37.926 7.348e-10 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span id="5e8b" class="lc ld hh ky b fi li lf l lg lh">&gt; anova(fit.p, fit.nb,fit.pzif)<br/>Analysis of Deviance Table</span><span id="c3b2" class="lc ld hh ky b fi li lf l lg lh">Model 1: Count ~ AA * BB * SEX<br/>Model 2: Count ~ AA * BB * SEX<br/>Model 3: Count ~ AA * BB * SEX<br/>  NoPar  LogLik Df Deviance  Pr(&gt;Chi)    <br/>1    11 -456.99                          <br/>2    12 -445.83  1   22.312 2.318e-06 ***<br/>3    12 -438.03  0   15.614 &lt; 2.2e-16 ***<br/>---<br/>Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></pre><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es nc"><img src="../Images/de1b46fdad1d809d60a2ef6deece2d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qme7sd74Rlk4KapdXa0kYw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">In the end, the NB beats the ZIFP model. Image by author.</figcaption></figure><p id="6128" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我希望您喜欢这个使用泊松、准泊松、负二项式和零膨胀泊松模型分析重复计数数据的例子。记住，这个例子并不详尽，还有很多可以改进的地方！</p><div class="nd ne ez fb nf ng"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hi fi z dy nl ea eb nm ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kj ng"/></div></div></a></div></div></div>    
</body>
</html>