<html>
<head>
<title>Azure Machine Learning SDK v2 using AutoML — Titanic dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AutoML-Titanic数据集的Azure机器学习SDK v2</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/azure-machine-learning-sdk-v2-using-automl-titanic-dataset-2cbff7fc37f?source=collection_archive---------6-----------------------#2022-08-06">https://medium.com/mlearning-ai/azure-machine-learning-sdk-v2-using-automl-titanic-dataset-2cbff7fc37f?source=collection_archive---------6-----------------------#2022-08-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="7620" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用Azure Machine Learning SDK v2训练模型、注册和部署模型</h1><h1 id="4ea5" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="c145" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="2741" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure机器学习工作区</li><li id="a22e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储帐户</li><li id="53a5" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">获取titanic.csv</li><li id="cf4e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建文件夹</li><li id="cb9c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建数据文件夹</li><li id="bdbc" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">培训文件夹</li><li id="afde" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">测试文件夹</li><li id="04c3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">验证文件夹</li><li id="8af3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将文件上传到以上文件夹</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es jz"><img src="../Images/2bc4c7f213e48246e9afed7528298863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*imrVIUVXN7edbb3e.jpg"/></div></div></figure><figure class="ka kb kc kd fd ke er es paragraph-image"><div class="er es kl"><img src="../Images/373da4654e943b2d8f7c0d1426b2a04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*hanGygH42daPCqrO.jpg"/></div></figure><h1 id="0e40" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">密码</h1><ul class=""><li id="c577" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">导入库</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="bae3" class="kr if hh kn b fi ks kt l ku kv"># Import required libraries<br/>from azure.identity import DefaultAzureCredential<br/>from azure.identity import AzureCliCredential<br/>from azure.ai.ml import automl, Input, MLClient</span><span id="131f" class="kr if hh kn b fi kw kt l ku kv">from azure.ai.ml.constants import AssetTypes<br/>from azure.ai.ml.automl import (<br/>    classification,<br/>    ClassificationPrimaryMetrics,<br/>    ClassificationModels,<br/>)</span></pre><ul class=""><li id="a21f" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">加载工作空间</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="e931" class="kr if hh kn b fi ks kt l ku kv">from azure.identity import DefaultAzureCredential<br/>from azure.ai.ml import MLClient</span><span id="31b3" class="kr if hh kn b fi kw kt l ku kv">credential = DefaultAzureCredential()<br/>ml_client = None<br/>try:<br/>    ml_client = MLClient.from_config(credential)<br/>except Exception as ex:<br/>    print(ex)<br/>    # Enter details of your AzureML workspace<br/>    subscription_id = "xxxxx-xxxxxx-xxxxxx"<br/>    resource_group = "rgname"<br/>    workspace = "workspacename"<br/>    ml_client = MLClient(credential, subscription_id, resource_group, workspace)</span></pre><ul class=""><li id="a5cf" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">显示工作区</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="eeee" class="kr if hh kn b fi ks kt l ku kv">workspace = ml_client.workspaces.get(name=ml_client.workspace_name)</span><span id="eea7" class="kr if hh kn b fi kw kt l ku kv">subscription_id = ml_client.connections._subscription_id<br/>resource_group = workspace.resource_group<br/>workspace_name = ml_client.workspace_name</span><span id="e0c3" class="kr if hh kn b fi kw kt l ku kv">output = {}<br/>output["Workspace"] = workspace_name<br/>output["Subscription ID"] = subscription_id<br/>output["Resource Group"] = resource_group<br/>output["Location"] = workspace.location<br/>output</span></pre><ul class=""><li id="3619" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">配置培训数据</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="4e8d" class="kr if hh kn b fi ks kt l ku kv"># Create MLTables for training dataset</span><span id="379d" class="kr if hh kn b fi kw kt l ku kv">my_training_data_input = Input(<br/>    type=AssetTypes.MLTABLE, path="./data/training-mltable-folder"<br/>)</span></pre><ul class=""><li id="86b7" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">配置实验名称</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="0d93" class="kr if hh kn b fi ks kt l ku kv"># General job parameters<br/>compute_name = "cpu-cluster"<br/>max_trials = 5<br/>exp_name = "automlv2-Titanic-classifier-experiment"</span></pre><ul class=""><li id="17e7" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">自动配置</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="a512" class="kr if hh kn b fi ks kt l ku kv"># Create the AutoML classification job with the related factory-function.</span><span id="a700" class="kr if hh kn b fi kw kt l ku kv">classification_job = automl.classification(<br/>    compute=compute_name,<br/>    experiment_name=exp_name,<br/>    training_data=my_training_data_input,<br/>    target_column_name="Survived",<br/>    primary_metric="accuracy",<br/>    n_cross_validations=5,<br/>    enable_model_explainability=True,<br/>    tags={"my_custom_tag": "My Titanic Automl Exp"},<br/>)</span><span id="79c9" class="kr if hh kn b fi kw kt l ku kv"># Limits are all optional<br/>classification_job.set_limits(<br/>    timeout_minutes=600,<br/>    trial_timeout_minutes=20,<br/>    max_trials=max_trials,<br/>    # max_concurrent_trials = 4,<br/>    # max_cores_per_trial: -1,<br/>    enable_early_termination=True,<br/>)</span><span id="a532" class="kr if hh kn b fi kw kt l ku kv"># Training properties are optional<br/>classification_job.set_training(<br/>    blocked_training_algorithms=[ClassificationModels.LOGISTIC_REGRESSION],<br/>    enable_onnx_compatible_models=True,<br/>)</span></pre><ul class=""><li id="68e9" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">创造一份工作</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="644d" class="kr if hh kn b fi ks kt l ku kv"># Submit the AutoML job<br/>returned_job = ml_client.jobs.create_or_update(<br/>    classification_job<br/>)  # submit the job to the backend</span><span id="88c2" class="kr if hh kn b fi kw kt l ku kv">print(f"Created job: {returned_job}")</span></pre><ul class=""><li id="5f06" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">获取详细信息</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="2d72" class="kr if hh kn b fi ks kt l ku kv">ml_client.jobs.stream(returned_job.name)</span></pre><ul class=""><li id="82b9" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">获取端点url</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="afa5" class="kr if hh kn b fi ks kt l ku kv"># Get a URL for the status of the job<br/>returned_job.services["Studio"].endpoint<br/>print(returned_job.name)</span></pre><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lc"><img src="../Images/12218e5558d10016ffc0ce8f9af75be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8-5vw_XNwp-peYU9.jpg"/></div></div></figure><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lc"><img src="../Images/3d452538fe01ed06689582c31fccf67a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UsQNYmeaobBrNNYu.jpg"/></div></div></figure><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ld"><img src="../Images/8aa89806e66891915d531bba60a63868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TIl448mhW_e04bLw.jpg"/></div></div></figure><ul class=""><li id="b89e" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">显示最佳模型</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es le"><img src="../Images/d955f7c1a59137292d3ef13427d89504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*exrQ5otV1FyCr16h.jpg"/></div></div></figure><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lc"><img src="../Images/9d23c3992b6b39816572835622555fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8FzYsZ94QLDbOoSU.jpg"/></div></div></figure><ul class=""><li id="08f3" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">调用MLFLow以获取详细信息</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="2e53" class="kr if hh kn b fi ks kt l ku kv">import mlflow</span><span id="66c0" class="kr if hh kn b fi kw kt l ku kv"># Obtain the tracking URL from MLClient<br/>MLFLOW_TRACKING_URI = ml_client.workspaces.get(<br/>    name=ml_client.workspace_name<br/>).mlflow_tracking_uri</span><span id="82b2" class="kr if hh kn b fi kw kt l ku kv">print(MLFLOW_TRACKING_URI)</span><span id="6130" class="kr if hh kn b fi kw kt l ku kv"># Set the MLFLOW TRACKING URI</span><span id="f195" class="kr if hh kn b fi kw kt l ku kv">mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)</span><span id="655e" class="kr if hh kn b fi kw kt l ku kv">print("\nCurrent tracking uri: {}".format(mlflow.get_tracking_uri()))</span></pre><ul class=""><li id="d0e6" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">启用MLFLow</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="2845" class="kr if hh kn b fi ks kt l ku kv">from mlflow.tracking.client import MlflowClient</span><span id="6863" class="kr if hh kn b fi kw kt l ku kv"># Initialize MLFlow client<br/>mlflow_client = MlflowClient()</span><span id="b08d" class="kr if hh kn b fi kw kt l ku kv">job_name = returned_job.name</span><span id="4d8e" class="kr if hh kn b fi kw kt l ku kv"># Example if providing an specific Job name/ID<br/># job_name = "b4e95546-0aa1-448e-9ad6-002e3207b4fc"</span><span id="a1a5" class="kr if hh kn b fi kw kt l ku kv"># Get the parent run<br/>mlflow_parent_run = mlflow_client.get_run(job_name)</span><span id="b7e7" class="kr if hh kn b fi kw kt l ku kv">print("Parent Run: ")<br/>print(mlflow_parent_run)</span></pre><ul class=""><li id="0d46" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">获取标签</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="b815" class="kr if hh kn b fi ks kt l ku kv"># Print parent run tags. 'automl_best_child_run_id' tag should be there.<br/>print(mlflow_parent_run.data.tags)</span></pre><ul class=""><li id="1cc1" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">获得最佳运行</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="2338" class="kr if hh kn b fi ks kt l ku kv"># Get the best model's child run</span><span id="0873" class="kr if hh kn b fi kw kt l ku kv">best_child_run_id = mlflow_parent_run.data.tags["automl_best_child_run_id"]<br/>print("Found best child run id: ", best_child_run_id)</span><span id="0061" class="kr if hh kn b fi kw kt l ku kv">best_run = mlflow_client.get_run(best_child_run_id)</span><span id="5de8" class="kr if hh kn b fi kw kt l ku kv">print("Best child run: ")<br/>print(best_run)</span></pre><ul class=""><li id="cd85" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">显示指标</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="6b02" class="kr if hh kn b fi ks kt l ku kv">best_run.data.metrics</span></pre><ul class=""><li id="4ae6" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">创建文件夹以下载机器学习</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="8411" class="kr if hh kn b fi ks kt l ku kv">import os</span><span id="98a6" class="kr if hh kn b fi kw kt l ku kv"># Create local folder<br/>local_dir = "./artifact_downloads"<br/>if not os.path.exists(local_dir):<br/>    os.mkdir(local_dir)</span><span id="eb39" class="kr if hh kn b fi kw kt l ku kv"># Download run's artifacts/outputs<br/>local_path = mlflow_client.download_artifacts(<br/>    best_run.info.run_id, "outputs", local_dir<br/>)<br/>print("Artifacts downloaded in: {}".format(local_path))<br/>print("Artifacts: {}".format(os.listdir(local_path)))</span><span id="0a4a" class="kr if hh kn b fi kw kt l ku kv"># Show the contents of the MLFlow model folder<br/>os.listdir("./artifact_downloads/outputs/mlflow-model")</span></pre><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lf"><img src="../Images/f7b76aa06163dd1ad84e22a7cd6bdb48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b4IXxdPBQjvMN4KT.jpg"/></div></div></figure><ul class=""><li id="49f2" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在创建在线托管</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="8250" class="kr if hh kn b fi ks kt l ku kv"># import required libraries<br/># import required libraries<br/>from azure.ai.ml import MLClient<br/>from azure.ai.ml.entities import (<br/>    ManagedOnlineEndpoint,<br/>    ManagedOnlineDeployment,<br/>    Model,<br/>    Environment,<br/>    CodeConfiguration,<br/>    ProbeSettings,<br/>)<br/>from azure.ai.ml.constants import ModelType</span><span id="332d" class="kr if hh kn b fi kw kt l ku kv">model_name = "titanic-model-v2"<br/>model = Model(<br/>    path=f"azureml://jobs/{best_run.info.run_id}/outputs/artifacts/outputs/model.pkl",<br/>    name=model_name,<br/>    description="my sample titanic mlflow model",<br/>)</span><span id="b89f" class="kr if hh kn b fi kw kt l ku kv"># for downloaded file<br/># model = Model(path="artifact_downloads/outputs/model.pkl", name=model_name)</span><span id="ded0" class="kr if hh kn b fi kw kt l ku kv">registered_model = ml_client.models.create_or_update(model)</span><span id="4961" class="kr if hh kn b fi kw kt l ku kv">registered_model.id</span><span id="0b1d" class="kr if hh kn b fi kw kt l ku kv"># Creating a unique endpoint name with current datetime to avoid conflicts<br/>import datetime</span><span id="0c90" class="kr if hh kn b fi kw kt l ku kv">online_endpoint_name = "titanic-" + datetime.datetime.now().strftime("%m%d%H%M%f")</span><span id="7785" class="kr if hh kn b fi kw kt l ku kv"># create an online endpoint<br/>endpoint = ManagedOnlineEndpoint(<br/>    name=online_endpoint_name,<br/>    description="this is a sample online endpoint for titanic mlflow model",<br/>    auth_mode="key",<br/>    tags={"foo": "bar"},<br/>)</span><span id="9200" class="kr if hh kn b fi kw kt l ku kv">ml_client.begin_create_or_update(endpoint)</span></pre><ul class=""><li id="0e9f" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">设置环境</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="efc5" class="kr if hh kn b fi ks kt l ku kv">env = Environment(<br/>    name="automl-titanic-tabular-env",<br/>    description="environment for automl inference",<br/>    image="mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04:20210727.v1",<br/>    conda_file="artifact_downloads/outputs/conda_env_v_1_0_0.yml",<br/>)</span></pre><ul class=""><li id="4dfc" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">将评分脚本用于受管理端点api</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="0400" class="kr if hh kn b fi ks kt l ku kv">code_configuration = CodeConfiguration(<br/>    code="artifact_downloads/outputs/", scoring_script="scoring_file_v_2_0_0.py"<br/>)</span></pre><ul class=""><li id="0f64" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">设置部署</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="0d69" class="kr if hh kn b fi ks kt l ku kv">deployment = ManagedOnlineDeployment(<br/>    name="titanic-deploy",<br/>    endpoint_name=online_endpoint_name,<br/>    model=registered_model.id,<br/>    environment=env,<br/>    code_configuration=code_configuration,<br/>    instance_type="Standard_DS2_V2",<br/>    instance_count=1,<br/>)</span></pre><ul class=""><li id="0bac" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">更新上述端点的部署</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="e463" class="kr if hh kn b fi ks kt l ku kv">ml_client.online_deployments.begin_create_or_update(deployment)</span></pre><ul class=""><li id="f79b" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">设置流量</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="6fe2" class="kr if hh kn b fi ks kt l ku kv"># bankmarketing deployment to take 100% traffic<br/>endpoint.traffic = {"titanic-deploy": 100}<br/>ml_client.begin_create_or_update(endpoint)</span></pre><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lg"><img src="../Images/0a1e497e016ea9ac2b3fefb3d2f5c23d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4tb4tg_c6eHpBv1g.jpg"/></div></div></figure><ul class=""><li id="f617" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">端点的详细信息</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lh"><img src="../Images/88f050c276587279f659aa3d861eae4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mNrTchNUZQkL00ui.jpg"/></div></div></figure><ul class=""><li id="3327" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">测试端点</li><li id="f0b6" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">配置示例数据</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="09cf" class="kr if hh kn b fi ks kt l ku kv">{"data": [<br/>    [ 1, "3", "Braund Mr. Owen Harris", "male", "22", "1", "0", "A/5 21171", 7.25, "C76", "S"],<br/>    [ 2, "1", "Cumings Mrs. John Bradley", "female", "38", "1", "0", "PC 17599", 71.2833, "C85", "C"]<br/>]}</span></pre><ul class=""><li id="9b9a" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">呼叫端点</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="6835" class="kr if hh kn b fi ks kt l ku kv">import urllib.request<br/>import json<br/>import os<br/>import ssl</span><span id="a01d" class="kr if hh kn b fi kw kt l ku kv">def allowSelfSignedHttps(allowed):<br/>    # bypass the server certificate verification on client side<br/>    if allowed and not os.environ.get('PYTHONHTTPSVERIFY', '') and getattr(ssl, '_create_unverified_context', None):<br/>        ssl._create_default_https_context = ssl._create_unverified_context</span><span id="edd1" class="kr if hh kn b fi kw kt l ku kv">allowSelfSignedHttps(True) # this line is needed if you use self-signed certificate in your scoring service.</span><span id="0eca" class="kr if hh kn b fi kw kt l ku kv"># Request data goes here<br/># The example below assumes JSON formatting which may be updated<br/># depending on the format your endpoint expects.<br/># More information can be found here:<br/># https://docs.microsoft.com/azure/machine-learning/how-to-deploy-advanced-entry-script<br/>data =  {<br/>  "Inputs": {<br/>    "data": [<br/>      {<br/>        "PassengerId": 1,<br/>        "Pclass": "3",<br/>        "Name": "Braund Mr Owen Harris",<br/>        "Sex": "male",<br/>        "Age": 22,<br/>        "SibSp": "1",<br/>        "Parch": "0",<br/>        "Ticket": "A/5 21171",<br/>        "Fare": 22.5,<br/>        "Cabin": "C76",<br/>        "Embarked": "S"<br/>      }<br/>    ]<br/>  },<br/>  "GlobalParameters": {<br/>    "method": "predict"<br/>  }<br/>}</span><span id="7b87" class="kr if hh kn b fi kw kt l ku kv">body = str.encode(json.dumps(data))</span><span id="dedb" class="kr if hh kn b fi kw kt l ku kv">url = 'https://xxxxxxxxxxxxxxxxxxxxxx.centralus.inference.ml.azure.com/score'<br/>api_key = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' # Replace this with the API key for the web service</span><span id="c2ff" class="kr if hh kn b fi kw kt l ku kv"># The azureml-model-deployment header will force the request to go to a specific deployment.<br/># Remove this header to have the request observe the endpoint traffic rules<br/>headers = {'Content-Type':'application/json', 'Authorization':('Bearer '+ api_key), 'azureml-model-deployment': 'titanic-deploy' }</span><span id="2666" class="kr if hh kn b fi kw kt l ku kv">req = urllib.request.Request(url, body, headers)</span><span id="ced6" class="kr if hh kn b fi kw kt l ku kv">try:<br/>    response = urllib.request.urlopen(req)</span><span id="a54e" class="kr if hh kn b fi kw kt l ku kv">    result = response.read()<br/>    print(result)<br/>except urllib.error.HTTPError as error:<br/>    print("The request failed with status code: " + str(error.code))</span><span id="7488" class="kr if hh kn b fi kw kt l ku kv">    # Print the headers - they include the requert ID and the timestamp, which are useful for debugging the failure<br/>    print(error.info())<br/>    print(error.read().decode("utf8", 'ignore'))</span></pre><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es li"><img src="../Images/0cdde178a267db84491862ecbd2b8782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mT5BkK6FpW26X9kc.jpg"/></div></div></figure><ul class=""><li id="55ad" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">预测_proba</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lj"><img src="../Images/4abd8a6f882f20f1d15bfb3fac520c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9ccSJgZCRpL_Wca4.jpg"/></div></div></figure><ul class=""><li id="5d7c" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">获取端点详细信息</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="fbc7" class="kr if hh kn b fi ks kt l ku kv"># Get the details for online endpoint<br/>endpoint = ml_client.online_endpoints.get(name=online_endpoint_name)</span><span id="525f" class="kr if hh kn b fi kw kt l ku kv"># existing traffic details<br/>print(endpoint.traffic)</span><span id="2307" class="kr if hh kn b fi kw kt l ku kv"># Get the scoring URI<br/>print(endpoint.scoring_uri)</span></pre><ul class=""><li id="dcb5" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在删除端点</li></ul><pre class="ka kb kc kd fd km kn ko kp aw kq bi"><span id="1765" class="kr if hh kn b fi ks kt l ku kv">ml_client.online_endpoints.begin_delete(name=online_endpoint_name)</span></pre></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><p id="c9c2" class="pw-post-body-paragraph lr ls hh je b jf kx lt lu jh ky lv lw jj lx ly lz jl ma mb mc jn md me mf jp ha bi translated"><em class="mg">最初发表于</em><a class="ae mh" href="https://github.com/balakreshnan/Samples2022/blob/main/AzureMLV2/titanicsdkv2.md" rel="noopener ugc nofollow" target="_blank"><em class="mg">【https://github.com】</em></a><em class="mg">。</em></p><div class="mi mj ez fb mk ml"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hi fi z dy mq ea eb mr ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz kj ml"/></div></div></a></div></div></div>    
</body>
</html>