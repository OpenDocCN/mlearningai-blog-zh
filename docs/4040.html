<html>
<head>
<title>Introduction to diffusion models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩散模型介绍</h1>
<blockquote>原文：<a href="https://medium.com/mlearning-ai/introduction-to-diffusion-models-86afe13a4c50?source=collection_archive---------2-----------------------#2022-11-29">https://medium.com/mlearning-ai/introduction-to-diffusion-models-86afe13a4c50?source=collection_archive---------2-----------------------#2022-11-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8c08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近<a class="jc jd ge" href="https://medium.com/u/b1574f0c6c5e?source=post_page-----86afe13a4c50--------------------------------" rel="noopener" target="_blank">拥抱脸</a>推出了一门关于扩散模型的课程。这个博客旨在介绍扩散模型的基础知识，它们是如何工作的？还有<strong class="ig hi">扩散库！🤗</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/8ef5b31025f1d26381c465cf51d46120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rg5lZJGdjxhcjdLc"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae ju" href="https://unsplash.com/ja/@marc_schulte?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marc Schulte</a> on <a class="ae ju" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ad01" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">扩散模型有哪些？</h2><p id="eeb5" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">它们是生成模型的类型。它们生成一组不同的输出，这些输出类似于训练数据，但不是完全相同的副本。为了使扩散模型起作用，训练是反复进行的。在添加随机噪声和模型估计的情况下，我们如何从小噪声到完全去噪的图像。</p><h2 id="92a5" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">扩散模型的培训程序:</h2><ol class=""><li id="1f49" class="kv kw hh ig b ih kq il kr ip kx it ky ix kz jb la lb lc ld bi translated">加载数据</li><li id="07cb" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated">添加噪声(不同数量)</li><li id="8a04" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated">输入有噪声的版本</li><li id="f423" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated">优化模型降噪的效果。</li><li id="fc35" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated">根据上述信息更新模型权重。</li></ol><h2 id="d5c0" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">用扩散模型生成新图像:</h2><p id="250a" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们从完全随机的输入更新开始，每次都基于模型预测进行少量更新。</p><h2 id="388f" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">梦幻小屋</h2><p id="5b8b" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">稳定扩散模型是一个文本条件模型。它让我们创造出自己的变体，拥有额外的特定面孔、物体或风格。</p><h2 id="bc6f" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">拥抱面API扩散器</h2><ol class=""><li id="8734" class="kv kw hh ig b ih kq il kr ip kx it ky ix kz jb la lb lc ld bi translated"><strong class="ig hi">管道</strong>:高级类</li><li id="50c0" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated"><strong class="ig hi">型号</strong>:架构</li><li id="c9a2" class="kv kw hh ig b ih le il lf ip lg it lh ix li jb la lb lc ld bi translated"><strong class="ig hi">调度器</strong>:在推理过程中从噪声中生成图像，以及为训练生成有噪声的图像。</li></ol><p id="8a09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> DDPM(去噪扩散概率模型)调度器:<br/> </strong> ddpm是噪声调度器，它将噪声图像馈送给模型，在推理期间，我们迭代地使用模型预测来去除噪声。调度程序帮助我们处理这个过程。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lj"><img src="../Images/8853e1a9e0984f8f31bbe2ce38d93e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*QuKm4ofbbujjCq3OeGlF3w.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">adding noise to butterfly images.</figcaption></figure><h2 id="9c1b" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">定义模型</h2><p id="6541" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们可以将该模型定义为UNET架构的变体(如下图所示)</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lk"><img src="../Images/75d313a3a7a99d14de0b05b921c249c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-7rHclT_qvky2rYnWOFyQ.png"/></div></div></figure><p id="ff8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该模型具有当前层的几个块，这些块将图像大小减半，之后我们再次上采样以增加图像大小。</p><p id="06b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">定义模型后，我们可以将模型训练为常规pytorch训练循环</p><h2 id="251a" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">训练循环+给图像添加噪声</h2><pre class="jf jg jh ji fd ll lm ln bn lo lp bi"><span id="2685" class="lq jw hh lm b be lr ls l lt lu"># Set the noise scheduler<br/>noise_scheduler = DDPMScheduler(<br/>    num_train_timesteps=1000, beta_schedule="squaredcos_cap_v2"<br/>)<br/><br/># Training loop<br/>optimizer = torch.optim.AdamW(model.parameters(), lr=4e-4)<br/><br/>losses = []<br/><br/>for epoch in range(30):<br/>    for step, batch in enumerate(train_dataloader):<br/>        clean_images = batch["images"].to(device)<br/>        # Sample noise to add to the images<br/>        noise = torch.randn(clean_images.shape).to(clean_images.device)<br/>        bs = clean_images.shape[0]<br/><br/>        # Sample a random timestep for each image<br/>        timesteps = torch.randint(<br/>            0, noise_scheduler.num_train_timesteps, (bs,), device=clean_images.device<br/>        ).long()<br/><br/>        # Add noise to the clean images according to the noise magnitude at each timestep<br/>        noisy_images = noise_scheduler.add_noise(clean_images, noise, timesteps)<br/><br/>        # Get the model prediction<br/>        noise_pred = model(noisy_images, timesteps, return_dict=False)[0]<br/><br/>        # Calculate the loss<br/>        loss = F.mse_loss(noise_pred, noise)<br/>        loss.backward(loss)<br/>        losses.append(loss.item())<br/><br/>        # Update the model parameters with the optimizer<br/>        optimizer.step()<br/>        optimizer.zero_grad()<br/><br/>    if (epoch + 1) % 5 == 0:<br/>        loss_last_epoch = sum(losses[-len(train_dataloader) :]) / len(train_dataloader)<br/>        print(f"Epoch:{epoch+1}, loss: {loss_last_epoch}")</span></pre><p id="1930" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过50个时期的训练模型，可以生成与训练数据相似的图像。</p><p id="6f32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lj"><img src="../Images/b7461d093f4dfe2a682caf00bc4399de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*SGjfWro9j7wb7oxscO8wUQ.png"/></div></figure><h2 id="b1f3" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">笔记本链接</h2><div class="lv lw ez fb lx ly"><a href="https://colab.research.google.com/github/huggingface/diffusion-models-class/blob/main/unit1/01_introduction_to_diffusers.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">谷歌联合实验室</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">编辑描述</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">colab.research.google.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm jo ly"/></div></div></a></div><h2 id="cf6d" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">链接到课程GitHub</h2><div class="lv lw ez fb lx ly"><a href="https://github.com/huggingface/diffusion-models-class/tree/main/unit1" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">主结合面处的扩散模型-等级/单元1/扩散模型-等级</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">欢迎来到拥抱脸扩散模型课程的第一单元！在这一单元，你将学习如何扩散的基本知识…</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">github.com</p></div></div><div class="mh l"><div class="mn l mj mk ml mh mm jo ly"/></div></div></a></div><h2 id="18a3" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">参考</h2><div class="lv lw ez fb lx ly"><a href="https://arxiv.org/abs/2006.11239" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">去噪扩散概率模型</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">我们提出了高质量的图像合成结果使用扩散概率模型，一类潜在变量模型…</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">arxiv.org</p></div></div><div class="mh l"><div class="mo l mj mk ml mh mm jo ly"/></div></div></a></div><div class="lv lw ez fb lx ly"><a rel="noopener follow" target="_blank" href="/mlearning-ai/mlearning-ai-submission-suggestions-b51e2b130bfb"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">Mlearning.ai提交建议</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">如何成为Mlearning.ai上的作家</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">medium.com</p></div></div><div class="mh l"><div class="mp l mj mk ml mh mm jo ly"/></div></div></a></div></div></div>    
</body>
</html>